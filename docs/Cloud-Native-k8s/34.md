+ [author](http://nsddd.top)

# ç¬¬34èŠ‚ Kubernetes å¼€å‘ä¹‹æ—…

<div><a href = '33.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '35.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## ğŸ’¡å®ƒå¾ˆé‡è¦

å®ƒå°±åƒæ˜¯æ•°æ®åº“ä¸€æ ·é‡è¦ï¼Œç¼ºäº†å®ƒï¼Œæˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡åŠæ³•å®ç°ï¼Œä½†æ˜¯ç›¸æ¯”è¾ƒæ§åˆ¶å™¨ï¼Œå®ƒåˆä¸æ˜¯æˆ‘ä»¬æ ¸å¿ƒã€‚

ä½†æ˜¯æˆ‘ä»¬ä½œä¸ºç¬¬ä¸€æ­¥ï¼Œæˆ‘å¸Œæœ›å¯ä»¥ä»å®ƒå¼€å§‹å­¦ä¹ ~



## ä¸‰ä¸ªé‡è¦çš„ API åè¯

### API Object

æ˜¯ Kubernetes å†…éƒ¨ç®¡ç†çš„åŸºæœ¬å…ƒç´ ï¼Œæ˜¯ Kubernetes åœ¨ ETCD ä¸­ä¿¡æ¯å­˜å‚¨å•å…ƒã€‚

ä¾‹å¦‚ Deploymentï¼ŒPodï¼ŒServiceï¼Œéƒ½æ˜¯ API Objectã€‚å†…éƒ¨ä»£ç å¸¸ç”¨ `API` ç§°å‘¼ã€‚



### API  Group

ä¸€ç»„ API Object ç»„æˆçš„ä¸€ä¸ªå…·æœ‰å…±æœ‰æ€§è´¨çš„å¯¹è±¡é›†åˆã€‚

ä¾‹å¦‚ï¼šapps è¿™ä¸ª group ï¼Œå®ƒç”± Deploymentï¼ŒReplicaSetï¼ŒStatefulSetã€‚



### Legacy API Object

ç»å¤§å¤šæ•°çš„ API Object éƒ½è¢«å½’åœ¨ API Group ä¸‹é¢ï¼Œç‰¹åˆ«æ˜¯æ–°ç‰ˆä¸­å¼•å…¥çš„ä¸€å®šééµä»è¿™ä¸€åŸåˆ™ã€‚

ä½†æ˜¯åœ¨ Kubernetes é¡¹ç›®é¡¹ç›®åˆå§‹åŒ–é˜¶æ®µæ‰€å¼•å…¥çš„ API Object æ²¡æœ‰æ˜¾ç¤ºå®šä¹‰åœ¨ API Group ä¸‹é¢ï¼Œä¾‹å¦‚ Podï¼ŒEventï¼ŒNodeç­‰ç­‰ï¼Œåœ¨ä»£ç ä¸­æœ‰æ—¶ä¹Ÿç§°å‘¼ä»–ä»¬ä¸º `core` ã€API Object



## API Server åœ¨ cobra çš„å®ç°

`API Server`ï¼š

```go
func main() {
	command := app.NewAPIServerCommand()	
	code := cli.Run(command)	//è·‘ command
	os.Exit(code)	//ä¸€ç›´è·‘ï¼Œé™¤éè°ƒç”¨ code 
}
```

> å¾ˆç®€æ´çš„ä¸»ç¨‹åº~



## server chain

**æ„å»ºè¿‡ç¨‹ ä»å³å‘å·¦ï¼› è¯·æ±‚æµå‘ ä»å·¦å‘å³ï¼š**

é“¾è¡¨ç»“æ„ï¼Œ



## Master ä¸­è½¬è½½ API

API Server çš„å†…å®¹ æ˜¯ API Object 

é€šè¿‡ Restful æœåŠ¡å¯¹å¤–æä¾›æ“ä½œ API Object çš„èƒ½åŠ›ã€‚





## è¯¦è§£ Scheme æœºåˆ¶

::: warning å®šä¹‰
Scheme æ˜¯ä¸€ä¸ªæ¥å£ä½“ï¼Œå†…å«å¤„ç†å¤–éƒ¨ Version ä¹‹é—´çš„è½¬æ¢ï¼Œ GVK å’Œ Go Typeä¹‹é—´çš„è½¬æ¢ä¹‹ç”¨çš„æ•°æ®å’Œæ–¹æ³•ã€‚

:::



 Scheme å®šä¹‰äº†èµ„æºåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ–¹æ³•ä»¥åŠèµ„æºç±»å‹å’Œç‰ˆæœ¬çš„å¯¹åº”å…³ç³»ï¼›è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç†è§£æˆä¸€å¼ çºªå½•è¡¨ã€‚å®šä¹‰åœ¨ [k8s.io/apimachinery/pkg/runtime/scheme.go](https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apimachinery/pkg/runtime/scheme.go) ä¸­ã€‚éœ€è¦å…³æ³¨çš„ `gvkToTypeype` å’Œ `typeToGVK` å­—æ®µ

```go
// Schemes are not expected to change at runtime and are only threadsafe after
// registration is complete.
type Scheme struct {
	// gvkToType allows one to figure out the go type of an object with
	// the given version and name.
	gvkToType map[schema.GroupVersionKind]reflect.Type

	// typeToGVK allows one to find metadata for a given go object.
	// The reflect.Type we index by should *not* be a pointer.
	typeToGVK map[reflect.Type][]schema.GroupVersionKind

	// unversionedTypes are transformed without conversion in ConvertToVersion.
	unversionedTypes map[reflect.Type]schema.GroupVersionKind

	// unversionedKinds are the names of kinds that can be created in the context of any group
	// or version
	// TODO: resolve the status of unversioned types.
	unversionedKinds map[string]reflect.Type

	// Map from version and resource to the corresponding func to convert
	// resource field labels in that version to internal version.
	fieldLabelConversionFuncs map[schema.GroupVersionKind]FieldLabelConversionFunc

	// defaulterFuncs is a map to funcs to be called with an object to provide defaulting
	// the provided object must be a pointer.
	defaulterFuncs map[reflect.Type]func(interface{})

	// converter stores all registered conversion functions. It also has
	// default converting behavior.
	converter *conversion.Converter

	// versionPriority is a map of groups to ordered lists of versions for those groups indicating the
	// default priorities of these versions as registered in the scheme
	versionPriority map[string][]string

	// observedVersions keeps track of the order we've seen versions during type registration
	observedVersions []schema.GroupVersion

	// schemeName is the name of this scheme.  If you don't specify a name, the stack of the NewScheme caller will be used.
	// This is useful for error reporting to indicate the origin of the scheme.
	schemeName string
}
```

å’Œ API Server é€šä¿¡çš„æ—¶å€™èƒ½å¤Ÿå¤„ç†æ–°çš„ types ç±»å‹å°±éœ€è¦çŸ¥é“æœ‰æ–°çš„typesç±»å‹ï¼ŒAddToScheme ä¼šåˆ©ç”¨åˆ°åå°„ï¼Œæ–°å®šä¹‰çš„ types ç±»å‹çš„ç»“æ„ä½“çš„å‘½åå¿…é¡»å’Œè‡ªå®šä¹‰çš„ Kind çš„å‘½åä¸€è‡´ï¼Œå¦åˆ™æ‰¾ä¸åˆ°å¯¹åº”çš„kind





## Version

æ¯ä¸€ä¸ª API Group éƒ½ä¼šæœ‰å¾ˆå¤š versionï¼Œæ¯ä¸€ä¸ª version åŒ…å«å¾ˆå¤šä¸ª kind ï¼ˆä¸€ä¸ª KIndä¼šå‡ºç°åœ¨å¤šä¸ª version ä¸‹ï¼‰

è¿™äº› Version åˆç§°ä¸º External Version ï¼Œå®ƒä»¬é¢å‘ API Server å¤–éƒ¨ï¼ŒInternal Version æ˜¯ API Server åœ¨å†…éƒ¨ç¨‹åºä¸­å¤„ç†æ•°æ®æ—¶ API Object çš„å®é™…ç±»å‹ã€‚



## GVK

Groupï¼ŒVersionï¼ŒKind ã€‚è¿™ä¸‰å…ƒç»„ç¡®å®šäº†ä¸€ä¸ª Kindï¼Œå½“ç„¶å¹¶ä¸æ˜¯ç¼ºä¸€ä¸å¯ã€‚GVK ç†è§£ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯ä¸‰è€…æ‹¼æ¥çš„ç»“æœã€‚





## Type

ä»£ç ä¸­å¸¸è§ "TYPE" ã€‚





## END é“¾æ¥
<ul><li><div><a href = '33.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '35.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

