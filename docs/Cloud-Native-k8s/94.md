+ [author](http://nsddd.top)

# ç¬¬94èŠ‚  Kubernetes çš„ cluster ç›®å½• ä»¥åŠå„ä¸ªé…ç½®

<div><a href = '93.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '95.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

Kubernetesçš„ä»£ç éƒ½åœ¨kubernetesç›®å½•ä¸‹ï¼Œå¦‚å›¾ï¼Œæ ¹æ®åŠŸèƒ½ä¸»è¦åˆ†æˆä»¥ä¸‹å‡ ç±»ï¼š
 1ã€`æ–‡æ¡£ç±»`ï¼ˆapiã€docsã€logoï¼‰
 2ã€`å·¥å…·ç±»`ï¼ˆbuildã€clusterã€Godepsã€hackã€stagingã€translationsï¼‰
 3ã€`ä»£ç ç±»`ï¼ˆcmdã€pkgã€pluginã€testã€third_partyï¼‰

å·¥å…·ç±»ä¸»è¦ç”¨åˆ°çš„buildç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œè‡ªå·±åŠ¨æ‰‹ç¼–è¯‘çš„æ—¶å€™ä¼šç”¨åˆ°ï¼›æ ¸å¿ƒä»£ç é›†ä¸­åœ¨cmdå’Œpkgä¸­ã€‚
cmdå†…éƒ¨åŒ…å«å„ä¸ªç»„ä»¶çš„å…¥å£ï¼Œå…·ä½“æ ¸å¿ƒçš„å®ç°éƒ¨åˆ†åœ¨pkgç›®å½•ä¸‹ã€‚



## ä»‹ç»

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ Kubernetesçš„`cluster`ç›®å½•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Kubernetesçš„`cluster`ç›®å½•çš„ç»“æ„ï¼š

```
kubernetes$ tree cluster/ -L 1
cluster/
â”œâ”€â”€ addons
â”œâ”€â”€ common.sh
â”œâ”€â”€ gce
â”œâ”€â”€ get-kube-binaries.sh
â”œâ”€â”€ get-kube.sh
â”œâ”€â”€ images
â”œâ”€â”€ kubectl.sh
â”œâ”€â”€ kube-down.sh
â”œâ”€â”€ kubemark
â”œâ”€â”€ kube-up.sh
â”œâ”€â”€ kube-util.sh
â”œâ”€â”€ log-dump
â”œâ”€â”€ OWNERS
â”œâ”€â”€ pre-existing
â”œâ”€â”€ README.md
â”œâ”€â”€ skeleton
â””â”€â”€ validate-cluster.sh
```

è¿™ä¸ªç›®å½•åŒ…å«äº†ä¸Kubernetesé›†ç¾¤ç›¸å…³çš„å¤šä¸ªå­ç›®å½•å’Œè„šæœ¬æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¸»è¦ç»„ä»¶çš„ç®€è¦è¯´æ˜ï¼š

1. **addons**ï¼šè¿™ä¸ªç›®å½•é€šå¸¸åŒ…å«ä¸€äº›ç”¨äºKubernetesé›†ç¾¤çš„é™„åŠ ç»„ä»¶ã€‚
2. **common.sh**ï¼šä¸€ä¸ªåŒ…å«å¸¸ç”¨å‡½æ•°å’Œå˜é‡çš„shellè„šæœ¬ï¼Œè¿™äº›é€šå¸¸åœ¨å…¶ä»–è„šæœ¬ä¸­è¢«å¼•ç”¨ã€‚
3. **gce**ï¼šç‰¹å®šäºGoogle Compute Engine (GCE) çš„è„šæœ¬å’Œé…ç½®ã€‚
4. **get-kube-binaries.sh** å’Œ **get-kube.sh**ï¼šè¿™äº›è„šæœ¬ç”¨äºä¸‹è½½Kubernetesçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
5. **images**ï¼šä¸Kubernetesé›†ç¾¤ç›¸å…³çš„é•œåƒæ–‡ä»¶ã€‚
6. **kubectl.sh**ï¼šä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæ‰§è¡Œkubectlå‘½ä»¤ã€‚
7. **kube-down.sh** å’Œ **kube-up.sh**ï¼šç”¨äºå¯åŠ¨å’Œå…³é—­Kubernetesé›†ç¾¤çš„è„šæœ¬ã€‚
8. **kubemark**ï¼šä¸€ä¸ªæ¨¡æ‹Ÿå¤§å‹Kubernetesé›†ç¾¤çš„å·¥å…·ç›®å½•ã€‚
9. **kube-util.sh**ï¼šæä¾›ä¸€äº›å·¥å…·å‡½æ•°çš„è„šæœ¬ã€‚
10. **log-dump**ï¼šç”¨äºæ”¶é›†æ—¥å¿—ä¿¡æ¯çš„å·¥å…·ã€‚
11. **OWNERS**ï¼šåŒ…å«é¡¹ç›®

1. **OWNERS**ï¼šè¿™ä¸ªæ–‡ä»¶é€šå¸¸åŒ…å«äº†é¡¹ç›®çš„ç»´æŠ¤è€…ä¿¡æ¯ã€‚
2. **pre-existing**ï¼šåŒ…å«ç”¨äºå·²å­˜åœ¨é›†ç¾¤çš„è„šæœ¬å’Œé…ç½®ã€‚
3. **README.md**ï¼šä¸€ä¸ªMarkdownæ ¼å¼çš„æ–‡ä»¶ï¼Œæä¾›æœ‰å…³ç›®å½•çš„åŸºæœ¬ä¿¡æ¯å’Œä½¿ç”¨è¯´æ˜ã€‚
4. **skeleton**ï¼šä¸€ä¸ªç¤ºä¾‹ç›®å½•ï¼Œé€šå¸¸åŒ…å«æ¨¡æ¿æˆ–èµ·å§‹æ–‡ä»¶ã€‚
5. **validate-cluster.sh**ï¼šç”¨äºéªŒè¯é›†ç¾¤æ˜¯å¦æ­£ç¡®é…ç½®å’Œè¿è¡Œçš„è„šæœ¬ã€‚



## é…ç½®

[Kubernetes](https://so.csdn.net/so/search?q=Kubernetes&spm=1001.2101.3001.7020)çš„é…ç½®ç›®å½•åŒ…æ‹¬ `/etc/kubernetes`ã€ `/home/supermap/.kube` å’Œ `/var/lib/kubelet` ç›®å½•ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ï¼Œè¿™äº›ç›®å½•é‡Œåˆ°åº•æœ‰äº›ä»€ä¹ˆæ–‡ä»¶ï¼ˆæ“ä½œç³»ç»Ÿä½¿ç”¨Ubuntu 18.04LTS desktopï¼‰ã€‚

å®‰è£…treeå‘½ä»¤ï¼š

```bash
sudo apt install tree
```



### kubernetesä¸»é…ç½®ç›®å½•

æ˜¾ç¤º/etc/kubernetesç›®å½•ç»“æ„ï¼š

```bash
root@openim-super:~# tree /etc/kubernetes
/etc/kubernetes
â”œâ”€â”€ kube-controller-manager.kubeconfig
â”œâ”€â”€ kubelet.kubeconfig
â”œâ”€â”€ kube-proxy.kubeconfig
â”œâ”€â”€ kube-scheduler.kubeconfig
â””â”€â”€ ssl
    â”œâ”€â”€ aggregator-proxy-key.pem
    â”œâ”€â”€ aggregator-proxy.pem
    â”œâ”€â”€ ca-key.pem
    â”œâ”€â”€ ca.pem
    â”œâ”€â”€ etcd-key.pem
    â”œâ”€â”€ etcd.pem
    â”œâ”€â”€ kubelet-key.pem
    â”œâ”€â”€ kubelet.pem
    â”œâ”€â”€ kubernetes-key.pem
    â””â”€â”€ kubernetes.pem
```

ä»ä½ æä¾›çš„ `/etc/kubernetes` ç›®å½•ç»“æ„æ¥çœ‹ï¼Œè¿™ä¸ªç›®å½•ä¸»è¦åŒ…å«äº† Kubernetes é›†ç¾¤çš„ä¸€äº›å…³é”®é…ç½®æ–‡ä»¶å’Œè¯ä¹¦æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘å°†åˆ†åˆ«è¯´æ˜è¿™äº›æ–‡ä»¶å’Œç›®å½•çš„ä½œç”¨ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚

1. **kube-controller-manager.kubeconfig**
   - ä½œç”¨ï¼šè¿™æ˜¯ Kubernetes Controller Manager çš„ kubeconfig æ–‡ä»¶ã€‚å®ƒåŒ…å«äº†è®¿é—® API æœåŠ¡å™¨æ‰€éœ€çš„è®¤è¯ä¿¡æ¯ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šé€šå¸¸åœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤æ—¶ç”Ÿæˆã€‚å¯ä»¥é€šè¿‡ `kubeadm init` å‘½ä»¤æ¥åˆ›å»ºã€‚

2. **kubelet.kubeconfig**
   - ä½œç”¨ï¼šç”¨äº Kubernetes Kubelet ä¸ API æœåŠ¡å™¨é€šä¿¡çš„ kubeconfig æ–‡ä»¶ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šåœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ç”± kubeadm åˆ›å»ºã€‚

3. **kube-proxy.kubeconfig**
   - ä½œç”¨ï¼šKubernetes ç½‘ç»œä»£ç† kube-proxy çš„é…ç½®æ–‡ä»¶ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šåœ¨èŠ‚ç‚¹åŠ å…¥é›†ç¾¤æ—¶ç”± kubeadm åˆ›å»ºã€‚

4. **kube-scheduler.kubeconfig**
   - ä½œç”¨ï¼šKubernetes è°ƒåº¦å™¨çš„ kubeconfig æ–‡ä»¶ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šé€šå¸¸åœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤æ—¶ç”Ÿæˆã€‚

5. **ssl ç›®å½•**
   - ä½œç”¨ï¼šåŒ…å« Kubernetes é›†ç¾¤æ‰€éœ€çš„å„ç§ SSL è¯ä¹¦å’Œå¯†é’¥ã€‚
   - å…·ä½“æ–‡ä»¶ï¼š
     - `ca.pem` å’Œ `ca-key.pem`ï¼šCAï¼ˆè¯ä¹¦é¢å‘æœºæ„ï¼‰çš„è¯ä¹¦å’Œå¯†é’¥ï¼Œç”¨äºç­¾å‘å…¶ä»–è¯ä¹¦ã€‚
     - `etcd.pem` å’Œ `etcd-key.pem`ï¼šetcd æœåŠ¡å™¨çš„ SSL è¯ä¹¦å’Œå¯†é’¥ã€‚
     - `kubelet.pem` å’Œ `kubelet-key.pem`ï¼šKubelet çš„ SSL è¯ä¹¦å’Œå¯†é’¥ã€‚
     - `kubernetes.pem` å’Œ `kubernetes-key.pem`ï¼šAPI æœåŠ¡å™¨çš„ SSL è¯ä¹¦å’Œå¯†é’¥ã€‚
     - `aggregator-proxy.pem` å’Œ `aggregator-proxy-key.pem`ï¼šAPI èšåˆä»£ç†çš„è¯ä¹¦å’Œå¯†é’¥ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šè¿™äº›è¯ä¹¦é€šå¸¸åœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤æ—¶ç”Ÿæˆï¼Œå¯ä»¥é€šè¿‡ `kubeadm init` å‘½ä»¤æŒ‡å®šè¯ä¹¦è·¯å¾„æˆ–è®© kubeadm è‡ªåŠ¨ç”Ÿæˆã€‚

åœ¨ Kubernetes çš„æºç ä¸­ï¼Œç›¸å…³çš„æ¨¡å—åŒ…æ‹¬ç”¨äºç®¡ç†è¯ä¹¦çš„ `certificates` æ¨¡å—ã€è´Ÿè´£ kubeconfig æ–‡ä»¶ç”Ÿæˆçš„ç›¸å…³è„šæœ¬å’Œé…ç½®æ¨¡å—ï¼Œä»¥åŠå„ä¸ªç»„ä»¶ï¼ˆå¦‚ kubeletã€kube-proxyã€kube-scheduler ç­‰ï¼‰çš„é…ç½®å’Œå¯åŠ¨è„šæœ¬ã€‚

1. **è¯ä¹¦ç®¡ç†ï¼ˆ`certificates` æ¨¡å—ï¼‰**
   - è¿™éƒ¨åˆ†æºç è´Ÿè´£å¤„ç†é›†ç¾¤çš„è¯ä¹¦ç”Ÿæˆã€ç­¾å‘å’Œç®¡ç†ã€‚åœ¨ Kubernetes é›†ç¾¤åˆå§‹åŒ–æˆ–èŠ‚ç‚¹åŠ å…¥æ—¶ï¼Œè¿™äº›è¯ä¹¦ä¼šè¢«åˆ›å»ºå¹¶åˆ†é…åˆ°å„ä¸ªç»„ä»¶ã€‚

2. **kubeconfig æ–‡ä»¶ç”Ÿæˆ**
   - æºç ä¸­åŒ…å«ç”¨äºç”Ÿæˆ kubeconfig æ–‡ä»¶çš„è„šæœ¬å’Œé…ç½®ã€‚è¿™äº›æ–‡ä»¶åŒ…å«äº†è¿æ¥åˆ° Kubernetes API æœåŠ¡å™¨æ‰€éœ€çš„å®¢æˆ·ç«¯è®¤è¯ä¿¡æ¯ï¼ŒåŒ…æ‹¬ API æœåŠ¡å™¨çš„åœ°å€ã€å®¢æˆ·ç«¯è¯ä¹¦å’Œå¯†é’¥ç­‰ã€‚

3. **ç»„ä»¶é…ç½®å’Œå¯åŠ¨**
   - Kubernetes çš„å„ä¸ªç»„ä»¶ï¼ˆå¦‚ kubeletã€kube-proxyã€kube-scheduler ç­‰ï¼‰çš„å¯åŠ¨å’Œè¿è¡Œé…ç½®ä¹Ÿåœ¨æºç ä¸­è¿›è¡Œäº†å®šä¹‰ã€‚è¿™åŒ…æ‹¬å¦‚ä½•è¯»å–å’Œè§£æ kubeconfig æ–‡ä»¶ï¼Œå¦‚ä½•ä¸ API æœåŠ¡å™¨é€šä¿¡ï¼Œä»¥åŠå„ç§è¿è¡Œå‚æ•°çš„è®¾ç½®ã€‚



### kubernetesç”¨æˆ·é…ç½®ç›®å½•

ä¸»ç”¨æˆ·ç›®å½•ä¸‹çš„éšè—ç›®å½• `.kube` åŒ…å«ç”¨æˆ·çš„é…ç½®å‚æ•°å’Œç¼“å­˜æ•°æ®ã€‚ç›®å½•ç»“æ„ä¸ºï¼š

```bash
root@openim-super:~# tree ~/.kube/ -L 3
â”œâ”€â”€ cache
â”‚   â”œâ”€â”€ discovery
â”‚   â”‚   â””â”€â”€ 192.168.0.160_6443
â”‚   â””â”€â”€ http
â”‚       â”œâ”€â”€ f6becdb7c001591b298210cecd3a8a29ac5092ee41004082f0b25057709c7c42
â”‚       â”œâ”€â”€ fbf7adbe7695b909e041d93552b5dbaf614149e49c33dd47a5a85507d9b36363
â”‚       â””â”€â”€ fc3d095b91a3fd1ade4dd3f4e3c69292
â””â”€â”€ config
```

ä½ æä¾›çš„æ˜¯ `~/.kube/` ç›®å½•çš„ç»“æ„ï¼Œè¿™ä¸ªç›®å½•é€šå¸¸ç”¨äºå­˜å‚¨ Kubernetes ç”¨æˆ·çš„ä¸ªäººé…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ kubeconfig æ–‡ä»¶å’Œä¸€äº›ç¼“å­˜æ•°æ®ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªæ–‡ä»¶å’Œç›®å½•çš„å…·ä½“ä½œç”¨ï¼š

1. **cache ç›®å½•**
   - ä½œç”¨ï¼šè¿™ä¸ªç›®å½•ç”¨äºå­˜å‚¨ kubectl å‘½ä»¤çš„ç¼“å­˜æ•°æ®ã€‚
   - å­ç›®å½•ï¼š
     - `discovery`ï¼šå­˜å‚¨é›†ç¾¤å‘ç°ä¿¡æ¯çš„ç¼“å­˜ï¼Œæ¯”å¦‚ API æœåŠ¡å™¨çš„åœ°å€å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚åœ¨è¿™é‡Œï¼Œ`192.168.0.160_6443` ä»£è¡¨ä¸€ä¸ªç‰¹å®š API æœåŠ¡å™¨çš„ç¼“å­˜æ•°æ®ã€‚
     - `http`ï¼šå­˜å‚¨ HTTP è¯·æ±‚çš„ç¼“å­˜æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯èƒ½åŒ…æ‹¬ä» API æœåŠ¡å™¨è·å–çš„ä¸€äº›èµ„æºå¯¹è±¡çš„ç¼“å­˜ã€‚

2. **config æ–‡ä»¶**
   - ä½œç”¨ï¼šè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„ kubeconfig æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†è®¿é—® Kubernetes é›†ç¾¤æ‰€éœ€çš„è®¤è¯ä¿¡æ¯ï¼Œå¦‚ API æœåŠ¡å™¨çš„åœ°å€ã€è®¤è¯ç”¨æˆ·çš„è¯ä¹¦å’Œç§é’¥ç­‰ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šè¿™ä¸ªæ–‡ä»¶å¯ä»¥æ‰‹åŠ¨åˆ›å»ºå’Œç¼–è¾‘ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `kubectl` å‘½ä»¤ï¼ˆä¾‹å¦‚ `kubectl config set-cluster`, `kubectl config set-credentials` ç­‰ï¼‰ç”Ÿæˆå’Œä¿®æ”¹ã€‚å½“ä½ ä½¿ç”¨ `kubectl` å‘½ä»¤ä¸ Kubernetes é›†ç¾¤äº¤äº’æ—¶ï¼Œå®ƒä¼šè¯»å–è¿™ä¸ªæ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ã€‚

è¿™ä¸ªç›®å½•é€šå¸¸æ˜¯ Kubernetes ç”¨æˆ·çš„ç§æœ‰é…ç½®ï¼Œä¸åŒäº `/etc/kubernetes` ç›®å½•ï¼Œåè€…æ˜¯ç”¨äº Kubernetes é›†ç¾¤ç»„ä»¶æœ¬èº«çš„é…ç½®ã€‚å¯ä»¥ç†è§£ä¸º `~/.kube/` ç›®å½•æ˜¯ç”¨æˆ·çº§åˆ«çš„ï¼Œè€Œ `/etc/kubernetes` æ˜¯ç³»ç»Ÿçº§åˆ«çš„ã€‚



### kubeletæœåŠ¡çš„é…ç½®ç›®å½•

æ¯ä¸€ä¸ªksèŠ‚ç‚¹éƒ½éœ€è¦è¿è¡ŒkubeletæœåŠ¡ã€‚kubeletæœåŠ¡çš„é…ç½®åœ¨ `/var/lib/kubelet` ç›®å½•ä¸‹ï¼š

```
$ tree /var/lib/kubelet
â”œâ”€â”€ config.yaml
â”œâ”€â”€ cpu_manager_state
â”œâ”€â”€ device-plugins
â”‚   â”œâ”€â”€ DEPRECATION
â”‚   â”œâ”€â”€ kubelet_internal_checkpoint
â”‚   â””â”€â”€ kubelet.sock
â”œâ”€â”€ kubeadm-flags.env
â”œâ”€â”€ pki
â”‚   â”œâ”€â”€ kubelet-client-2018-11-23-10-08-12.pem
â”‚   â”œâ”€â”€ kubelet-client-2018-11-23-10-08-38.pem
â”‚   â”œâ”€â”€ kubelet-client-current.pem -> /var/lib/kubelet/pki/kubelet-client-2018-11-23-10-08-38.pem
â”‚   â”œâ”€â”€ kubelet.crt
â”‚   â””â”€â”€ kubelet.key
â”œâ”€â”€ plugin-containers [error opening dir]
â”œâ”€â”€ plugins [error opening dir]
â”œâ”€â”€ plugins_registry [error opening dir]
â”œâ”€â”€ pod-resources [error opening dir]
â””â”€â”€ pods [error opening dir]
```

è¿™æ˜¯ Kubernetes èŠ‚ç‚¹ä¸Šçš„ `/var/lib/kubelet` ç›®å½•ç»“æ„ï¼Œè¯¥ç›®å½•åŒ…å«äº† kubeletï¼ˆKubernetes èŠ‚ç‚¹ä»£ç†ï¼‰çš„é…ç½®æ–‡ä»¶ã€è¯ä¹¦å’Œä¸€äº›è¿è¡Œæ—¶æ•°æ®ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªæ–‡ä»¶å’Œç›®å½•çš„å…·ä½“ä½œç”¨ï¼š

1. **config.yaml**
   - ä½œç”¨ï¼šè¿™æ˜¯ kubelet çš„é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰äº† kubelet çš„è¿è¡Œå‚æ•°å’Œè¡Œä¸ºã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šå¯ä»¥æ‰‹åŠ¨åˆ›å»ºå’Œç¼–è¾‘ï¼Œæˆ–è€…åœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–èŠ‚ç‚¹æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚

2. **cpu_manager_state**
   - ä½œç”¨ï¼šCPU ç®¡ç†å™¨çš„çŠ¶æ€æ–‡ä»¶ï¼Œç”¨äºè®°å½•èŠ‚ç‚¹ä¸Šçš„ CPU åˆ†é…çŠ¶æ€ã€‚

3. **device-plugins ç›®å½•**
   - `DEPRECATION`ï¼šä¸€ä¸ªç”¨äºæé†’æŸäº›ç‰¹æ€§æˆ–APIå·²åºŸå¼ƒçš„æ–‡ä»¶ã€‚
   - `kubelet_internal_checkpoint`ï¼šè®¾å¤‡æ’ä»¶çš„å†…éƒ¨æ£€æŸ¥ç‚¹æ–‡ä»¶ï¼Œè®°å½•äº†è®¾å¤‡åˆ†é…çŠ¶æ€ã€‚
   - `kubelet.sock`ï¼šè®¾å¤‡æ’ä»¶ä¸ kubelet é€šä¿¡çš„ Unix å¥—æ¥å­—æ–‡ä»¶ã€‚

4. **kubeadm-flags.env**
   - ä½œç”¨ï¼šå­˜å‚¨ kubeadm åˆå§‹åŒ–æ—¶ä¼ é€’ç»™ kubelet çš„å‚æ•°ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šåœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–èŠ‚ç‚¹æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚

5. **pki ç›®å½•**
   - åŒ…å« kubelet çš„è¯ä¹¦å’Œç§é’¥ï¼Œç”¨äºä¸ Kubernetes API æœåŠ¡å™¨è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚
   - `kubelet-client-*.pem`ï¼škubelet çš„å®¢æˆ·ç«¯è¯ä¹¦ã€‚
   - `kubelet-client-current.pem`ï¼šæŒ‡å‘å½“å‰æœ‰æ•ˆçš„ kubelet å®¢æˆ·ç«¯è¯ä¹¦çš„ç¬¦å·é“¾æ¥ã€‚
   - `kubelet.crt` å’Œ `kubelet.key`ï¼škubelet çš„æœåŠ¡å™¨è¯ä¹¦å’Œç§é’¥ã€‚

6. **plugin-containersã€pluginsã€plugins_registryã€pod-resourcesã€pods ç›®å½•**
   - è¿™äº›ç›®å½•æ˜¯ kubelet è¿è¡Œæ—¶ä½¿ç”¨çš„ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ’ä»¶ä¿¡æ¯ã€Pod èµ„æºæ•°æ®å’Œ Pod è¿è¡Œæ—¶çš„çŠ¶æ€ã€‚
   - `[error opening dir]` è¡¨ç¤ºåœ¨è·å–è¿™äº›ç›®å½•çš„å†…å®¹æ—¶å‡ºç°äº†é”™è¯¯ï¼Œå¯èƒ½æ˜¯å› ä¸ºæƒé™é—®é¢˜æˆ–ç›®å½•ä¸ºç©ºã€‚

è¿™ä¸ªç›®å½•å¯¹äº Kubernetes èŠ‚ç‚¹çš„è¿è¡Œè‡³å…³é‡è¦ï¼ŒåŒ…å«äº† kubelet çš„æ ¸å¿ƒé…ç½®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚äº†è§£è¿™äº›æ–‡ä»¶å’Œç›®å½•çš„ä½œç”¨å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œç®¡ç† Kubernetes èŠ‚ç‚¹ã€‚å¦‚æœä½ å¯¹ kubelet çš„é…ç½®æˆ–ç®¡ç†æœ‰æ›´å¤šçš„ç–‘é—®ï¼Œè¯·éšæ—¶æé—®ã€‚

```
tree /var/lib/kube-proxy/
/var/lib/kube-proxy/
â””â”€â”€ kube-proxy-config.yaml
```

`/var/lib/kube-proxy/` ç›®å½•æ˜¯ Kubernetes èŠ‚ç‚¹ä¸Š kube-proxy ç»„ä»¶çš„æ•°æ®ç›®å½•ã€‚åœ¨ä½ æä¾›çš„ç»“æ„ä¸­ï¼Œè¿™ä¸ªç›®å½•åŒ…å«äº†ä¸€ä¸ªé‡è¦çš„æ–‡ä»¶ï¼š

1. **kube-proxy-config.yaml**
   - ä½œç”¨ï¼šè¿™æ˜¯ kube-proxy çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº† kube-proxy çš„è¿è¡Œå‚æ•°å’Œè¡Œä¸ºã€‚kube-proxy è´Ÿè´£åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚
   - ç”Ÿæˆæ–¹å¼ï¼šè¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨ä½¿ç”¨ kubeadm åˆå§‹åŒ–é›†ç¾¤æˆ–åŠ å…¥æ–°èŠ‚ç‚¹æ—¶ç”Ÿæˆã€‚ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶æ¥è°ƒæ•´ kube-proxy çš„é…ç½®ã€‚

kube-proxy æ˜¯ Kubernetes ç½‘ç»œçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œè´Ÿè´£å¤„ç†é›†ç¾¤å†…çš„ç½‘ç»œè·¯ç”±å’ŒæœåŠ¡ä»£ç†ã€‚äº†è§£ kube-proxy çš„é…ç½®æ–‡ä»¶å¯¹äºç®¡ç†å’Œè°ƒä¼˜ Kubernetes é›†ç¾¤çš„ç½‘ç»œè¡Œä¸ºéå¸¸é‡è¦ã€‚



### kubelet.serviceæœåŠ¡ç›®å½•

kubeletä½¿ç”¨systemdç®¡ç†ï¼Œserviceå®šä¹‰æ–‡ä»¶ä½äºï¼š `/lib/systemd/system/kubelet.service`ã€‚

æœ€æ–°çš„dropinæ–‡ä»¶ä½äºï¼š `/etc/systemd/system/kubelet.service.d`ï¼Œå†…å®¹ä¸ºï¼š

```bash
 cat /etc/systemd/system/kubelet.service 
[Unit]
Description=Kubernetes Kubelet
Documentation=https://github.com/GoogleCloudPlatform/kubernetes

[Service]
WorkingDirectory=/var/lib/kubelet
ExecStart=/opt/kube/bin/kubelet \
  --config=/var/lib/kubelet/config.yaml \
  --container-runtime-endpoint=unix:///run/containerd/containerd.sock \
  --hostname-override=192.168.0.160 \
  --kubeconfig=/etc/kubernetes/kubelet.kubeconfig \
  --root-dir=/var/lib/kubelet \
  --v=2
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

è¿™ä¸ªæ–‡ä»¶æ˜¯ Kubernetes èŠ‚ç‚¹ä¸Š kubelet æœåŠ¡çš„ systemd æœåŠ¡é…ç½®æ–‡ä»¶ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•å¯åŠ¨å’Œç®¡ç† kubelet è¿›ç¨‹ã€‚ä»¥ä¸‹æ˜¯è¯¥é…ç½®æ–‡ä»¶çš„ä¸»è¦éƒ¨åˆ†åŠå…¶ä½œç”¨ï¼š

1. **[Unit] éƒ¨åˆ†**
   - `Description`: æœåŠ¡çš„ç®€çŸ­æè¿°ã€‚
   - `Documentation`: æŒ‡å‘ç›¸å…³æ–‡æ¡£çš„é“¾æ¥ï¼Œè¿™é‡Œæ˜¯ Kubernetes çš„ GitHub é¡µé¢ã€‚

2. **[Service] éƒ¨åˆ†**
   - `WorkingDirectory`: kubelet çš„å·¥ä½œç›®å½•ï¼Œè¿™é‡Œè®¾ç½®ä¸º `/var/lib/kubelet`ã€‚
   - `ExecStart`: å¯åŠ¨ kubelet æœåŠ¡æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚
     - `--config`: æŒ‡å‘ kubelet çš„é…ç½®æ–‡ä»¶ã€‚
     - `--container-runtime-endpoint`: æŒ‡å®šå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼Œè¿™é‡Œæ˜¯ containerdã€‚
     - `--hostname-override`: æŒ‡å®šèŠ‚ç‚¹çš„ä¸»æœºåã€‚
     - `--kubeconfig`: kubelet è¿æ¥ Kubernetes API æœåŠ¡å™¨æ‰€ä½¿ç”¨çš„ kubeconfig æ–‡ä»¶ã€‚
     - `--root-dir`: kubelet çš„æ ¹ç›®å½•ï¼Œç”¨äºå­˜å‚¨ kubelet è¿è¡Œæ—¶æ•°æ®ã€‚
     - `--v`: æ—¥å¿—ç­‰çº§ã€‚
   - `Restart`: æœåŠ¡å¤±è´¥æ—¶çš„é‡å¯ç­–ç•¥ï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ€»æ˜¯é‡å¯ã€‚
   - `RestartSec`: é‡å¯å‰ç­‰å¾…çš„ç§’æ•°ã€‚

3. **[Install] éƒ¨åˆ†**
   - `WantedBy`: æŒ‡å®šè¿™ä¸ªæœåŠ¡åº”è¯¥åœ¨å“ªä¸ªç›®æ ‡ä¸‹å¯åŠ¨ï¼Œè¿™é‡Œæ˜¯ `multi-user.target`ï¼Œå³å¤šç”¨æˆ·ç›®æ ‡ã€‚

è¿™ä¸ª systemd æœåŠ¡æ–‡ä»¶å¯¹äºç®¡ç† Kubernetes é›†ç¾¤ä¸­çš„èŠ‚ç‚¹è‡³å…³é‡è¦ï¼Œå®ƒç¡®ä¿ kubelet ä½œä¸ºæœåŠ¡è¿è¡Œï¼Œ







## END é“¾æ¥

<ul><li><div><a href = '93.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '95.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

