+ [author](http://nsddd.top)

# ç¬¬80èŠ‚ OpenIM Helm Charts è®¾è®¡

<div><a href = '79.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '81.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]



# OpenIM Helm Charts

OpenIM Helm Charts ç”¨äºåœ¨ Kubernetes é›†ç¾¤ä¸Šè½»æ¾éƒ¨ç½²å’Œç®¡ç† OpenIM å³æ—¶æ¶ˆæ¯é€šä¿¡å¹³å°åŠå…¶ç›¸å…³ä¸­é—´ä»¶ã€‚

## å‰ææ¡ä»¶

+ å·²å®‰è£…å¹¶é…ç½®å¥½çš„ Kubernetesï¼ˆK8sï¼‰ç¯å¢ƒã€‚
+ è‡³å°‘æœ‰ä¸¤ä¸ªå¯ç”¨çš„åŸŸåï¼šä¸€ä¸ªç”¨äº MinIO API è®¿é—®ï¼Œå¦ä¸€ä¸ªç”¨äº OpenIM Server API è®¿é—®ã€‚
+ å·²é…ç½®çš„ StorageClassï¼ˆæ­¤ç¤ºä¾‹ä½¿ç”¨ NFS-Clientï¼‰ã€‚
+ ï¼ˆå¯é€‰ï¼‰å¦‚æœæ‚¨çš„ K8s ç³»ç»Ÿçš„ Ingress Controller èŠ‚ç‚¹é…ç½®äº† LoadBalancerï¼Œæ‰€æœ‰ `-config.yaml` æ–‡ä»¶ä¸­çš„åŸŸåä¿¡æ¯æ— éœ€é…ç½® TLS é¡¹ã€‚

> **æ³¨æ„**ï¼šä¸‹ä¸ªç‰ˆæœ¬å°†æ¨å‡ºåŸºäºå•ä¸€åŸŸåè®¿é—®å’ŒåŸºäº IP çš„ URL è®¿é—®åŠŸèƒ½ã€‚



## ç”¨æˆ·æŒ‡å—

è¦ä½¿ç”¨è¿™äº› Helm Chartsï¼Œæ‚¨éœ€è¦å…ˆå®‰è£… [Helm](https://helm.sh/)ã€‚è¯·å‚è€ƒ Helm çš„ [æ–‡æ¡£](https://helm.sh/docs/) æ¥å¼€å§‹ä½¿ç”¨ Helmã€‚

ä¸€æ—¦ Helm å®‰è£…å®Œæ¯•ï¼Œè¯·æŒ‰å¦‚ä¸‹æ–¹å¼æ·»åŠ  Helm ä»“åº“ï¼š

```
helm repo add openim https://openim.github.io/helm-charts
```

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥è¿è¡Œ `helm search repo openim` æ¥æŸ¥çœ‹å¯ç”¨çš„ Chartsã€‚

### å®‰è£… Chart

```
helm install [RELEASE_NAME] openim/openim-server
```

*æŸ¥çœ‹ä¸‹é¢çš„[é…ç½®](https://github.com/openim/helm-charts/tree/main/charts/)ä¿¡æ¯ã€‚*

*æœ‰å…³å‘½ä»¤æ–‡æ¡£ï¼Œè¯·å‚è€ƒ [helm install](https://helm.sh/docs/helm/helm_install/)ã€‚*

### å¸è½½ Chart

```
helm uninstall [RELEASE_NAME]
```

è¿™å°†åˆ é™¤ä¸ Chart ç›¸å…³çš„æ‰€æœ‰ Kubernetes ç»„ä»¶å¹¶å¸è½½å‘å¸ƒã€‚

*æœ‰å…³å‘½ä»¤æ–‡æ¡£ï¼Œè¯·å‚è€ƒ [helm uninstall](https://helm.sh/docs/helm/helm_uninstall/)ã€‚*

### å‡çº§ Chart

```
helm upgrade [RELEASE_NAME] [CHART] --install
```

*æœ‰å…³å‘½ä»¤æ–‡æ¡£ï¼Œè¯·å‚è€ƒ [helm upgrade](https://helm.sh/docs/helm/helm_upgrade/)ã€‚*

### åˆ—å‡ºå‘å¸ƒ

```
helm list
```

## ç›®å½•ç»“æ„

### adminfront

è¿™ä¸ªç›®å½•åŒ…å«äº† "adminfront" æœåŠ¡çš„ Helm Chartã€‚

+ `Chart.yaml`: åŒ…å«äº† Chart çš„åŸºæœ¬ä¿¡æ¯å’Œç‰ˆæœ¬ã€‚
+ `templates/`: åŒ…å«äº† Kubernetes æ¨¡æ¿æ–‡ä»¶ã€‚
+ `values.yaml`: é»˜è®¤é…ç½®æ–‡ä»¶ã€‚

### adminfront-config.yaml

åŒ…å«äº† "adminfront" æœåŠ¡çš„è‡ªå®šä¹‰é…ç½®ä¿¡æ¯ã€‚

### chat-server

è¿™ä¸ªç›®å½•åŒ…å«äº† "chat-server" æœåŠ¡çš„ Helm Chartã€‚

+ `Chart.yaml`: åŒ…å«äº† Chart çš„åŸºæœ¬ä¿¡æ¯å’Œç‰ˆæœ¬ã€‚
+ `charts/`: (å¯é€‰) å¦‚æœ Chart ä¾èµ–å…¶ä»– Chartï¼Œå¯ä»¥å°†å®ƒä»¬æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚
+ `templates/`: åŒ…å«äº† Kubernetes æ¨¡æ¿æ–‡ä»¶ã€‚
+ `values.yaml`: é»˜è®¤é…ç½®æ–‡ä»¶ã€‚

### infra

è¿™ä¸ªç›®å½•åŒ…å«äº† OpenIM æ‰€ä¾èµ–çš„æ‰€æœ‰ä¸­é—´ä»¶çš„ Helm Charts æˆ–ç›¸å…³é…ç½®ã€‚

+ `ingress-nginx`, `kafka`, `minio`, `mongodb`, `mysql`, `nfs-subdir-external-provisioner`, `redis`: è¿™äº›ç›®å½•å¯èƒ½åŒ…å«äº†å¯¹åº”ä¸­é—´ä»¶çš„ Helm Chartsã€‚
+ `kafka-config.yaml`, `minio-config.yaml`, `mongodb-config.yaml`, `mysql-config.yaml`, `redis-config.yaml`: è¿™äº›æ–‡ä»¶åŒ…å«äº†å¯¹åº”ä¸­é—´ä»¶çš„è‡ªå®šä¹‰é…ç½®ã€‚

## å‰ææ¡ä»¶

+ å·²å®‰è£…å¹¶é…ç½®å¥½çš„ Kubernetesï¼ˆK8sï¼‰ç¯å¢ƒã€‚
+ è‡³å°‘æœ‰ä¸¤ä¸ªå¯ç”¨çš„åŸŸåï¼šä¸€ä¸ªç”¨äº MinIO API è®¿é—®ï¼Œå¦ä¸€ä¸ªç”¨äº OpenIM Server API è®¿é—®ã€‚
+ å·²é…ç½®çš„ StorageClassï¼ˆæ­¤ç¤ºä¾‹ä½¿ç”¨ NFS-Clientï¼‰ã€‚
+ ï¼ˆå¯é€‰ï¼‰å¦‚æœæ‚¨çš„ K8s ç³»ç»Ÿçš„ Ingress Controller èŠ‚ç‚¹é…ç½®äº† LoadBalancerï¼Œæ‰€æœ‰ `-config.yaml` æ–‡ä»¶ä¸­çš„åŸŸåä¿¡æ¯æ— éœ€é…ç½® TLS é¡¹ã€‚

> æ³¨æ„ï¼šä¸‹ä¸ªç‰ˆæœ¬å°†æ¨å‡ºåŸºäºå•ä¸€åŸŸåè®¿é—®å’ŒåŸºäº IP çš„ URL è®¿é—®åŠŸèƒ½ã€‚

## å®‰è£…ä¸­é—´ä»¶

åœ¨éƒ¨ç½² OpenIM æœåŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦éƒ¨ç½²ä¸€äº›ä¾èµ–çš„ä¸­é—´ä»¶æœåŠ¡ã€‚

ä¸ºäº†æ–¹ä¾¿éƒ¨ç½²å’Œç®¡ç†ï¼Œæˆ‘ä»¬ä¸ºè¿™äº›ä¸­é—´ä»¶æä¾›äº†ä¸€å¥— Helm Chartsï¼Œå®ƒä»¬ä½äº infra ç›®å½•ä¸‹ã€‚

ä»¥ä¸‹å‘½ä»¤å°†åˆ†åˆ«å®‰è£… MySQLã€Kafkaã€MinIOã€MongoDB å’Œ Redis ä¸­é—´ä»¶ï¼š

```bash
helm repo add openim-infra https://xxxxx.xxx
helm install im-mysql im-infra/mysql -f mysql-config.yaml
helm install im-kafka im-infra/kafka -f kafka-config.yaml
helm install im-minio im-infra/minio -f minio-config.yaml
helm install im-mongodb im-infra/mongodb -f mongodb-config.yaml
helm install im-redis im-infra/redis -f redis-config.yaml
```

> **æ³¨æ„**
>
> å¦‚æœ OpenIM é›†ç¾¤éƒ¨ç½²åœ¨ `openim` å‘½åç©ºé—´ä¸­ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `-n` å‚æ•°æŒ‡å®šå‘½åç©ºé—´ã€‚å¦‚æœå‘½åç©ºé—´ä¸å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ `--create-namespace` åˆ›å»ºä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ã€‚

è¿™äº›é…ç½®æ–‡ä»¶åŒ…æ‹¬è´¦æˆ·ä¿¡æ¯ï¼Œä¾‹å¦‚ `minio-config.yaml` è¿˜åŒ…æ‹¬åŸŸåä¿¡æ¯ã€‚

## å®‰è£… OpenIM Server æœåŠ¡

```bash
helm install openim-server -f open-im-server-config.yaml -f notification.yaml ./openim/open-im-server/
```

è¯·ç¡®ä¿åœ¨ `open-im-server-config.yaml` ä¸­é…ç½®åŸŸåä¿¡æ¯ã€‚è´¦æˆ·ä¿¡æ¯é»˜è®¤ä¸ä¸­é—´ä»¶ï¼ˆinfra/ï¼‰çš„ `-config.yaml` æ–‡ä»¶åŒæ­¥ã€‚å¦‚æœåœ¨å®‰è£…ä¸­é—´ä»¶æ—¶ä¿®æ”¹äº† `config.yaml`ï¼Œè¯·åŒæ­¥ä¿®æ”¹ `open-im-server-config.yaml`ã€‚

## å®‰è£… OpenIM Chat æœåŠ¡

```
bashCopy code
helm install openim-chat -f chat-server-config.yaml ./openim/openim-chat
```

è¯·ç¡®ä¿åœ¨ `chat-server-config.yaml` ä¸­é…ç½®åŸŸåä¿¡æ¯ã€‚è´¦æˆ·ä¿¡æ¯é»˜è®¤ä¸ä¸­é—´ä»¶çš„ `-config.yaml` æ–‡ä»¶åŒæ­¥ã€‚å¦‚æœåœ¨å®‰è£…ä¸­é—´ä»¶æ—¶ä¿®æ”¹äº† `config.yaml`ï¼Œè¯·åŒæ­¥ä¿®æ”¹ `chat-server-config.yaml`ã€‚

## å®‰è£… Webfront

```bash
helm install imwebfront -f webfront-config.yaml ./webfront/
```

è¯·ç¡®ä¿åœ¨ `webfront-config.yaml` ä¸­é…ç½®äº†åŸŸåä¿¡æ¯ã€‚

## å®‰è£… Adminfront

```
helm install imadminfront -f adminfront-config.yaml ./adminfront/
```

è¯·ç¡®ä¿åœ¨ `adminfront-config.yaml` ä¸­é…ç½®äº†åŸŸåä¿¡æ¯ã€‚

## å¸è½½æ–¹æ³•

å¦‚æœæ‚¨éœ€è¦å¸è½½ OpenIM åŠå…¶ç›¸å…³ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ Helm å‘½ä»¤ï¼š

```
helm uninstall [RELEASE_NAME]
```

å…¶ä¸­ `[RELEASE_NAME]` æ˜¯æ‚¨åœ¨å®‰è£…æ—¶æŒ‡å®šçš„åç§°ï¼Œä¾‹å¦‚ `openimserver`ã€‚

## è°ƒè¯• Helm Charts

å¦‚æœæ‚¨éœ€è¦è°ƒè¯• Helm Chartsï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```
helm install [RELEASE_NAME] [CHART] --dry-run --debug
```

æˆ–è€…ä½¿ç”¨ `helm template` å‘½ä»¤ï¼š

```
helm template [CHART] --name [RELEASE_NAME] --debug
```

## æ›´å¤šä¿¡æ¯

è¦äº†è§£æœ‰å…³ OpenIM å’Œå„ä¸ªç»„ä»¶çš„é…ç½®å’Œä½¿ç”¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®[OpenIMå®˜æ–¹æ–‡æ¡£](https://docs.openim.io/)ã€‚





# Response and Translation into English:

## OpenIM Helm Charts

OpenIM Helm Charts are utilized for easy deployment and management of the OpenIM instant messaging platform and its related middleware on Kubernetes clusters.

## Prerequisites

+ Installed and configured Kubernetes (K8s) environment.
+ At least two available domain names: one for MinIO API access, and another for OpenIM Server API access.
+ Configured StorageClass (this example uses NFS-Client).
+ (Optional) If your K8s systemâ€™s Ingress Controller nodes are configured with LoadBalancer, all domain information in `-config.yaml` files do not need to configure TLS items.

> **Note**: The next version will introduce single domain access and IP-based URL access features.

## User Guide

To use these Helm Charts, you first need to install [Helm](https://helm.sh/). Please refer to Helm's [documentation](https://helm.sh/docs/) to get started with Helm.

Once Helm is installed, add the Helm repository as follows:

```
helm repo add openim https://openim.github.io/helm-charts
```

Next, you can run `helm search repo openim` to view the available Charts.

### Install Chart

```
helm install [RELEASE_NAME] openim/openim-server
```

*See the [configuration](https://github.com/openim/helm-charts/tree/main/charts/) information below.*

*For command documentation, refer to [helm install](https://helm.sh/docs/helm/helm_install/).*

### Uninstall Chart

```
helm uninstall [RELEASE_NAME]
```

This will delete all Kubernetes components related to the Chart and uninstall the release.

*For command documentation, refer to [helm uninstall](https://helm.sh/docs/helm/helm_uninstall/).*

### Upgrade Chart

```
helm upgrade [RELEASE_NAME] [CHART] --install
```

*For command documentation, refer to [helm upgrade](https://helm.sh/docs/helm/helm_upgrade/).*

### List Releases

```bash
helm list
```

## Directory Structure

### adminfront

This directory contains the Helm Chart for the "adminfront" service.

+ `Chart.yaml`: Contains basic information and version of the Chart.
+ `templates/`: Contains Kubernetes template files.
+ `values.yaml`: Default configuration file.

### adminfront-config.yaml

Contains custom configuration information for the "adminfront" service.

### chat-server

This directory contains the Helm Chart for the "chat-server" service.

+ `Chart.yaml`: Contains basic information and version of the Chart.
+ `charts/`: (Optional) If the Chart depends on other Charts, they can be placed in this directory.
+ `templates/`: Contains Kubernetes template files.
+ `values.yaml`: Default configuration file.

### infra

This directory contains all Helm Charts or related configurations for the middleware that OpenIM depends on.

+ `ingress-nginx`, `kafka`, `minio`, `mongodb`, `mysql`, `nfs-subdir-external-provisioner`, `redis`: These directories may contain Helm Charts for the corresponding middleware.
+ `kafka-config.yaml`, `minio-config.yaml`, `mongodb-config.yaml`, `mysql-config.yaml`, `redis-config.yaml`: These files contain custom configurations for the corresponding middleware.

## Prerequisites

+ Installed and configured Kubernetes (K8s) environment.
+ At least two available domain names: one for MinIO API access, and another for OpenIM Server API access.
+ Configured StorageClass (this example uses NFS-Client).
+ (Optional) If your K8s systemâ€™s Ingress Controller nodes are configured with LoadBalancer, all domain information in `-config.yaml` files do not need to configure TLS items.

> Note: The next version will introduce single domain access and IP-based URL access features.

## Install Middleware

Before deploying the OpenIM services, we need to deploy some dependent middleware services.

For easy deployment and management, we provide a set of Helm Charts for these middleware, located in the infra directory.

The following commands will respectively install MySQL, Kafka, MinIO, MongoDB, and Redis middleware:

```bash
helm repo add openim-infra https://xxxxx.xxx
helm install im-mysql im-infra/mysql -f mysql-config.yaml
helm install im-kafka im-infra/kafka -f kafka-config.yaml
helm install im-minio im-infra/minio -f minio-config.yaml
helm install im-mongodb im-infra/mongodb -f mongodb-config.yaml
helm install im-redis im-infra/redis -f redis-config.yaml
```

> **Note**
>
> If the OpenIM cluster is deployed in the `openim` namespace, use the `-n` argument to specify the namespace. If the namespace does not exist, you can use `--create-namespace` to create a new namespace.

These configuration files include account information, for example, `minio-config.yaml` also includes domain information.

## Install OpenIM Server Service

```bash
helm install openim-server -f open-im-server-config.yaml -f notification.yaml ./openim/open-im-server/
```

Ensure that the domain information is configured in `open-im-server-config.yaml`. Account information defaults to sync with the middleware (`infra/`) `-config.yaml` files. If `config.yaml` was modified when installing the middleware, please sync modify `open-im-server-config.yaml`.

## Install OpenIM Chat Service

```bash
helm install openim-chat -f chat-server-config.yaml ./openim/openim-chat
```

Ensure that the domain information is configured in `chat-server-config.yaml`. Account information defaults to sync with the middleware `-config.yaml` files. If `config.yaml` was modified when installing the middleware, please sync modify `chat-server-config.yaml`.



## END é“¾æ¥
<ul><li><div><a href = '79.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '81.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

