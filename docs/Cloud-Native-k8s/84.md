+ [author](http://nsddd.top)

# ç¬¬84èŠ‚ ä½¿ç”¨Dockeræˆ–Docker Composeå®‰è£…Loki

<div><a href = '83.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '85.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>

> â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:[http://nsddd.top](http://nsddd.top/)

---
[TOC]

## é€‰æ‹©

å¦‚æœæ‚¨æ­£åœ¨è¯„ä¼°ã€æµ‹è¯•æˆ–å¼€å‘Lokiï¼Œåˆ™å¯ä»¥ä½¿ç”¨Dockeræˆ–Docker Composeå®‰è£…Lokiå’ŒPromtailã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨Tankaæˆ–Helmå®‰è£…ã€‚

ä½¿ç”¨è¿™äº›å®‰è£…è¯´æ˜è·å¾—çš„é…ç½®å°†Lokiä½œä¸ºå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶è¿è¡Œã€‚



## Prerequisites å…ˆå†³æ¡ä»¶

+ [Docker](https://docs.docker.com/install)
+ [Docker Compose](https://docs.docker.com/compose/install) (optional, only needed for the Docker Compose install method)



## Install with Docker Compose

åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚å®ƒä»¬é€‚ç”¨äºWindowsæˆ–Linuxç³»ç»Ÿã€‚

```bash
wget https://raw.githubusercontent.com/grafana/loki/v2.9.1/production/docker-compose.yaml -O docker-compose.yaml
docker-compose -f docker-compose.yaml up
```

åœ°å€æ˜¯: https://raw.githubusercontent.com/grafana/loki/v2.9.1/production/docker-compose.yaml



Docker  Compose çš„å†…å®¹æ˜¯ï¼š

```bash
version: "3"

networks:
  loki:

services:
  loki:
    image: grafana/loki:2.9.0
    ports:
      - "3100:3100"
    command: -config.file=/etc/loki/local-config.yaml
    networks:
      - loki

  promtail:
    image: grafana/promtail:2.9.0
    volumes:
      - /var/log:/var/log
    command: -config.file=/etc/promtail/config.yml
    networks:
      - loki

  grafana:
    environment:
      - GF_PATHS_PROVISIONING=/etc/grafana/provisioning
      - GF_AUTH_ANONYMOUS_ENABLED=true
      - GF_AUTH_ANONYMOUS_ORG_ROLE=Admin
    entrypoint:
      - sh
      - -euc
      - |
        mkdir -p /etc/grafana/provisioning/datasources
        cat <<EOF > /etc/grafana/provisioning/datasources/ds.yaml
        apiVersion: 1
        datasources:
        - name: Loki
          type: loki
          access: proxy
          orgId: 1
          url: http://loki:3100
          basicAuth: false
          isDefault: true
          version: 1
          editable: false
        EOF
        /run.sh
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    networks:
      - loki
```



## node-exporter

`node-exporter` æ˜¯ä¸€ä¸ªå¼€æºçš„å·¥å…·ï¼Œç”¨äºæ”¶é›†ä¸ Linux ç³»ç»Ÿä¸Šçš„ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å„ç§æŒ‡æ ‡æœ‰å…³çš„ä¿¡æ¯ï¼Œå¹¶ä½¿å…¶èƒ½å¤Ÿè¢« Prometheus æœåŠ¡è·å–å’Œå­˜å‚¨ã€‚å®ƒæ˜¯ Prometheus ç›‘æ§å·¥å…·é“¾çš„ä¸€éƒ¨åˆ†ã€‚

> "exporter" æ˜¯ä¸€ä¸ªä¸“é—¨çš„ç»„ä»¶ï¼Œå…¶ä¸»è¦èŒè´£æ˜¯æ”¶é›†é Prometheus ç³»ç»Ÿä¸­çš„æŒ‡æ ‡å¹¶å°†å…¶è½¬åŒ–ä¸º Prometheus å¯è¯»çš„æ ¼å¼ã€‚è¿™æ„å‘³ç€è¿™äº› "exporter" ç»„ä»¶å……å½“äº†æ•°æ®æ¥æºå’Œ Prometheus ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œç¡®ä¿ Prometheus å¯ä»¥è½»æ¾æŠ“å–å¹¶ç›‘æ§è¿™äº›æ•°æ®ã€‚

ä½¿ç”¨ `node-exporter` å¯ä»¥æä¾›ä»¥ä¸‹ç­‰æ–¹é¢çš„æŒ‡æ ‡ï¼š

1. **CPU ä½¿ç”¨æƒ…å†µ**ï¼šç”¨æˆ·ç©ºé—´ã€ç³»ç»Ÿã€I/O ç­‰å¾…ç­‰ã€‚
2. **å†…å­˜ä½¿ç”¨æƒ…å†µ**ï¼šä½¿ç”¨é‡ã€ç¼“å­˜ã€äº¤æ¢ç­‰ã€‚
3. **ç£ç›˜ç©ºé—´**ï¼šæ¯ä¸ªåˆ†åŒºçš„ä½¿ç”¨é‡ã€æ€»é‡ã€å¯ç”¨é‡ç­‰ã€‚
4. **I/O**ï¼šè¯»å†™æ“ä½œã€å­—èŠ‚ç­‰ã€‚
5. **ç½‘ç»œ**ï¼šä¼ å…¥/ä¼ å‡ºæ•°æ®åŒ…ã€é”™è¯¯ç­‰ã€‚
6. **æ–‡ä»¶ç³»ç»Ÿ**ï¼ši-nodes ä½¿ç”¨æƒ…å†µã€å¤§å°ç­‰ã€‚
7. **ç¡¬ä»¶ä¿¡æ¯**ï¼šå¦‚ CPU æ¸©åº¦ã€é£æ‰‡é€Ÿåº¦ç­‰ï¼ˆå–å†³äºç³»ç»Ÿæ˜¯å¦æœ‰è¿™äº›ä¼ æ„Ÿå™¨ä¿¡æ¯ï¼‰ã€‚
8. å…¶ä»–ç³»ç»Ÿä¿¡æ¯ï¼Œå¦‚è¿è¡Œçš„è¿›ç¨‹æ•°é‡ã€ç³»ç»Ÿè´Ÿè½½ç­‰ã€‚

ä½¿ç”¨ `node-exporter`ï¼Œè¿ç»´å›¢é˜Ÿå’Œå¼€å‘å›¢é˜Ÿå¯ä»¥ï¼š

1. ç›‘æ§æœåŠ¡å™¨å’ŒåŸºç¡€è®¾æ–½çš„å¥åº·æƒ…å†µã€‚
2. è®¾ç½®è­¦æŠ¥ï¼Œå½“æŸäº›æŒ‡æ ‡è¶…å‡ºé¢„è®¾èŒƒå›´æ—¶è‡ªåŠ¨é€šçŸ¥ç›¸å…³äººå‘˜ã€‚
3. å¯¹ç³»ç»Ÿæ€§èƒ½è¿›è¡Œåˆ†æå’Œä¼˜åŒ–ã€‚
4. äº†è§£ç³»ç»Ÿçš„èµ„æºä½¿ç”¨æƒ…å†µå’Œè¶‹åŠ¿ï¼Œä¸ºæœªæ¥çš„æ‰©å±•å’Œå‡çº§åšå‡†å¤‡ã€‚

> æ³¨æ„ï¼Œå¯¹äº Windows æ¥è¯´ï¼Œåº”è¯¥ä½¿ç”¨ `wmi_exporter`







## END é“¾æ¥
<ul><li><div><a href = '83.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '85.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>

+ [â“‚ï¸å›åˆ°ç›®å½•ğŸ ](../README.md)

+ [**ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–**](https://nsddd.top/archives/contributors))

+ âœ´ï¸ç‰ˆæƒå£°æ˜ &copy; ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª[CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰&copy;](http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0åè®®æ–‡æœ¬) 

