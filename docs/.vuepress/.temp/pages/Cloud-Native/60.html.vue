<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬60èŠ‚-é«˜çº§çš„-githook-è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#ç¬¬60èŠ‚-é«˜çº§çš„-githook-è®¾è®¡" aria-hidden="true">#</a> ç¬¬60èŠ‚ é«˜çº§çš„ Githook è®¾è®¡</h1>
<div><a href = '59.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '61.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•è®°å½•<a href="https://github.com/cubxxw/sealos" target="_blank" rel="noopener noreferrer">sealos<ExternalLinkIcon/></a>å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚<a href="https://github.com/cubxxw/sealos" target="_blank" rel="noopener noreferrer">k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ <ExternalLinkIcon/></a>ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="ç¤¾åŒºä¸è§„èŒƒæ€ä¹ˆåŠ" tabindex="-1"><a class="header-anchor" href="#ç¤¾åŒºä¸è§„èŒƒæ€ä¹ˆåŠ" aria-hidden="true">#</a> ç¤¾åŒºä¸è§„èŒƒæ€ä¹ˆåŠ</h2>
<p>ä½œä¸º <a href="https://github.com/OpenIMSDK" target="_blank" rel="noopener noreferrer">OpenIM<ExternalLinkIcon/></a> ç¤¾åŒºé¦–å¸­è¿è¥å®˜ï¼Œå¯¹æ•´ä¸ªç¤¾åŒºçš„ <a href="https://github.com/OpenIMSDK/community" target="_blank" rel="noopener noreferrer">communtiy<ExternalLinkIcon/></a> ä»¥åŠ <a href="https://github.com/OpenIMSDK/.github" target="_blank" rel="noopener noreferrer">GitHub é…ç½®ä»“åº“<ExternalLinkIcon/></a> è¿›è¡Œäº†å…¨é¢çš„é…ç½®ã€‚å¹¶ä¸”å¯¹æ•´ä¸ª OpenIM çš„ <code v-pre>Makefile</code> å’Œ <code v-pre>CICD</code> æµï¼Œä»¥åŠæ•´ä¸ª OpenIM ä½¿ç”¨çš„æ—¥å¿—åŒ… ã€é”™è¯¯ç ã€ååŒæµã€è´¡çŒ®è€…æ–‡æ¡£ä»¥åŠ ç¤¾åŒºæ–‡æ¡£ è¿›è¡Œæ¶æ„å’Œè®¾è®¡ã€‚</p>
<p>åœ¨è¿™ä¸ªæ—¶å€™æ€»ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œå³ä½¿ä½ è§‰å¾—è‡ªå·±çš„ <a href="https://github.com/OpenIMSDK/Open-IM-Server/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">è´¡çŒ®è€…æ–‡æ¡£<ExternalLinkIcon/></a> å†™çš„å¾ˆç‰›é€¼äº†ï¼Œå¾ˆå…¨é¢äº†ï¼Œä½†æ˜¯ä¾æ—§å¾ˆå°‘æœ‰äººæ„¿æ„èŠ±å¿ƒæ€å»æŒ‰ç…§ä½ å†™çš„è§„èŒƒå»å­¦ä¹ ã€‚è¿™å¯¹æˆ‘æ‰“é€ é¡¶çº§çš„å¼€æºç¤¾åŒºæ˜¯ä¸€ä¸ªéå¸¸å¤§çš„é˜»ç¢ï¼Œäºæ˜¯å°±æœ‰äº†ä»Šå¤©çš„è¿™ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä¼šå°†å®ƒè®°å½•åœ¨ <a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694" target="_blank" rel="noopener noreferrer">GitHub Gists<ExternalLinkIcon/></a> ä¸Šï¼Œæä¾›æ‹‰å–å’Œä½¿ç”¨çš„è¯´æ˜ã€é“¾æ¥ï¼Œå¹¶ä¸”å®šæœŸçš„ç»´æŠ¤å®ƒã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘æä¾›å…‹éš†çš„é“¾æ¥ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">git</span> clone https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="å¦‚ä½•è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•è®¾è®¡" aria-hidden="true">#</a> å¦‚ä½•è®¾è®¡</h2>
<p>é¦–å…ˆæ˜¯é’ˆå¯¹åŸºç¡€çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ <code v-pre>commit</code> ä¿¡æ¯å’Œ <code v-pre>push</code> ä¿¡æ¯ã€‚</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥å¯¹ <code v-pre>commit</code> ä¿¡æ¯çš„æ ¼å¼è¿›è¡Œè®¾ç½®</li>
<li>æˆ‘ä»¬å¯ä»¥å¯¹ <code v-pre>push</code> çš„å¤§å°è¿›è¡Œè®¾ç½®</li>
<li>æˆ‘ä»¬æä¾›äº† <code v-pre>actions</code> çš„åŠŸèƒ½</li>
<li>æˆ‘ä»¬æä¾›äº† <code v-pre>Makefile</code> æ ‡è®°å’Œæ¸…é™¤ <code v-pre>Hook</code> çš„èƒ½åŠ›</li>
</ul>
<p>æˆ‘ä¹‹å‰åœ¨å­¦ä¹  git çš„æ—¶å€™å†™äº†ä¸€ç¯‡å¾ˆå…¨çš„ç¬”è®°ï¼Œå¹¶ä¸”åˆ†äº«åœ¨ GitHub ä¸Šé¢ï¼Œåœ¨è¿™ä¸ª <a href="https://github.com/cubxxw/awesome-cs-course/blob/master/Git/README.md" target="_blank" rel="noopener noreferrer">ğŸ¤– é“¾æ¥<ExternalLinkIcon/></a> ä¸Šå¯ä»¥å­¦ä¹ åˆ° git å¾ˆå¤šé«˜çº§ç”¨æ³•ã€‚</p>
<blockquote>
<p>è¿™ç¯‡æ–‡ç« è®²è§£äº† git æœ‰å“ªäº›è§„èŒƒï¼Œå¯»æ‰¾åˆé€‚çš„ CICD æµï¼š</p>
<p>ç»Ÿä¸€æ ¼å¼ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>ç»Ÿä¸€æ ¼å¼ï¼šgit commit <span class="token parameter variable">-m</span> <span class="token string">'type(scope): æè¿°(#issue)'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬åœ¨æäº¤çš„æ—¶å€™å¸¦ä¸Šé‚®ç®±ä¿¡æ¯ <code v-pre>-s</code> æ¥ç­¾è¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¹ æƒ¯ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">git</span> commit <span class="token parameter variable">-s</span> <span class="token parameter variable">-m</span> <span class="token string">"..."</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code v-pre>git commit</code>è‰ºæœ¯ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>&lt;ç±»å‹>[å¯é€‰ èŒƒå›´]: &lt;æè¿°>
[å¯é€‰ æ­£æ–‡]
[å¯é€‰ è„šæ³¨]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>git commit</code>æäº¤ç±»å‹å¯ä»¥æ˜¯å¦‚ä¸‹ï¼š</p>
<ol>
<li><code v-pre>feat</code>ï¼šæ–°åŠŸèƒ½ï¼ˆfeatureï¼‰</li>
<li><code v-pre>fix</code>ï¼šä¿®è¡¥bug</li>
<li><code v-pre>docs</code>ï¼šæ–‡æ¡£ï¼ˆdocumentationï¼‰</li>
<li><code v-pre>style</code>ï¼š æ ¼å¼ï¼ˆä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨ï¼‰</li>
<li><code v-pre>refactor</code>ï¼šé‡æ„ï¼ˆå³ä¸æ˜¯æ–°å¢åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®æ”¹bugçš„ä»£ç å˜åŠ¨ï¼‰</li>
<li><code v-pre>test</code>ï¼šå¢åŠ æµ‹è¯•</li>
<li><code v-pre>chore</code>ï¼šæ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨</li>
<li><code v-pre>perf</code>ï¼šæ€§èƒ½ä¼˜åŒ–</li>
<li><code v-pre>revert</code>ï¼šå›æ»š</li>
<li><code v-pre>build</code>ï¼šæ„å»º</li>
<li><code v-pre>ci</code>ï¼šæŒç»­é›†æˆ</li>
</ol>
</blockquote>
<p><strong>âš ï¸ ä½¿ç”¨è¿™ä¸ª Git hook åº”è¯¥æ³¨æ„ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li>è¿™ä¸ª <code v-pre>git hook</code> ä¼šåœ¨ä½ ä¸å°å¿ƒä¸Šä¼ å¤§æ–‡ä»¶çš„æ—¶å€™ï¼Œé˜»æ­¢ä½ ï¼Œå¹¶ä¸”è­¦å‘Šä½ ï¼Œè¿™æ˜¯ä¸å¯é€†è½¬çš„</li>
<li>è¿™ä¸ª <code v-pre>git hook</code> ä¼šåœ¨ä½ æ²¡æœ‰åŠæ³•æ§åˆ¶æäº¤æ ¼å¼çš„æ—¶å€™ï¼Œè®©ä½ å¾ˆç—›è‹¦ã€‚</li>
</ul>
<h2 id="å¦‚ä½•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨" aria-hidden="true">#</a> å¦‚ä½•ä½¿ç”¨</h2>
<p><strong>ä½ å¯ä»¥é€‰æ‹©ä¸¤ç§æ–¹å¼æ¥ä½¿ç”¨ Git hook:</strong></p>
<ol>
<li>ç›´æ¥ä½œä¸º <code v-pre>.git/hooks</code>æ–‡ä»¶å¤¹ä¸­çš„ <code v-pre>pre-commit</code> é’©å­ã€‚</li>
<li>ä½¿ç”¨ Husky æ›´æ–°æ‚¨çš„ <code v-pre>package.json</code>ï¼š</li>
</ol>
<p><a href="https://github.com/cubxxw/awesome-cs-course/blob/master/Git/README.md" target="_blank" rel="noopener noreferrer">Husky<ExternalLinkIcon/></a> ä½¿å¾— git hook å˜çš„æ›´åŠ å®¹æ˜“å’Œæ–¹ä¾¿ï¼š</p>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token property">"husky"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"hooks"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"pre-commit"</span><span class="token operator">:</span> <span class="token string">"sh ./some-path/pre-commit-prevent-large-files.sh"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªé’©å­æˆ‘æ˜¯ä¸º <a href="https://github.com/OpenIMSDK/Open-IM-Server/" target="_blank" rel="noopener noreferrer">OpenIM<ExternalLinkIcon/></a> ç¤¾åŒºé¡¹ç›®è®¾è®¡çš„ï¼Œä½†æ˜¯è½¬å¿µä¸€æƒ³ï¼Œåæ­£éƒ½åšæˆå¾ˆæ–¹ä¾¿å’Œé«˜ç«¯çš„ <a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694" target="_blank" rel="noopener noreferrer">Github Gist<ExternalLinkIcon/></a> äº†ï¼Œä¸ºä½•ä¸ç”¨ Gist çš„ç‰¹æ€§æ¥å¯¹ Git Hook åšä¸€ä¸ªè®°å½•å’Œä¿å­˜ï¼ŒåæœŸæä¾›ç»´æŠ¤å’Œä¸‹è½½ï¼Œä¹Ÿæä¾›äº†ä¸€ä¸ªäº¤æµå¹³å°ï¼Œè¿™æ˜¯éå¸¸ perfect çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ç¬¬ä¸€æ­¥ï¼Œåˆ©ç”¨äº† <a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694" target="_blank" rel="noopener noreferrer">GitHub Gist<ExternalLinkIcon/></a> æä¾›äº†ä¸€ä¸ªä¸‹è½½çš„é€šé“ï¼Œè¿™æ ·ä»¥åæœ‰åˆ«çš„é¡¹ç›®ä¹Ÿå¯ä»¥ç›´æ¥ä¸€é”®ä½¿ç”¨è„šæœ¬æ¥æ‹‰å–åˆ°æœ¬åœ°ã€‚</p>
<p>ä¸ä»…ä»…å¦‚æ­¤ï¼Œæˆ‘é’ˆå¯¹æäº¤è®¾è®¡äº†ä¸€ä¸ª<a href="https://gist.githubusercontent.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/gitsync.sh" target="_blank" rel="noopener noreferrer">è„šæœ¬<ExternalLinkIcon/></a>ï¼Œæˆ‘ä»¬ä½¿ç”¨è„šæœ¬å¯ä»¥ä¸€é”®å¹¶ä¸”è§„èŒƒçš„ push åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://gist.githubusercontent.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/gitsync.sh <span class="token operator">|</span><span class="token function">sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>é»˜è®¤é™åˆ¶ä¸ºæ¯ä¸ªæ–‡ä»¶æœ€å¤§5MBã€‚å¦‚æœä½ è§‰å¾—ä½ çš„æäº¤æ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¦†ç›–è¿™ä¸ªé™åˆ¶ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token assign-left variable">GIT_FILE_SIZE_LIMIT</span><span class="token operator">=</span><span class="token number">50000000</span> <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"test: this commit is allowed file sizes up to 50MB"</span>
<span class="token comment"># OR</span>
<span class="token function">git</span> commit --no-verify
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä¸å…³å¿ƒä»»ä½•ç‰¹å®šçš„æ–‡ä»¶ï¼Œåªæ˜¯é™åˆ¶æ•´ä¸ªæäº¤æœ¬èº«ï¼Œè¿™è‡³å°‘åº”è¯¥ä½¿å¼€å‘äººå‘˜çš„äº‹æƒ…ä¸¤æ¬¡ä¹‹å‰ï¼Œä»–ä»¬å¯èƒ½ä¼šä½œå‡ºå†³å®š <code v-pre>git commit --no-verify</code></p>
<p><strong>å¯å¤ç”¨è„šæœ¬ä¸€é”®å®‰è£…ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/install.sh <span class="token operator">|</span><span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="contents" tabindex="-1"><a class="header-anchor" href="#contents" aria-hidden="true">#</a> Contents</h2>
<ul>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-install-sh" target="_blank" rel="noopener noreferrer">ä½¿ç”¨å®‰è£…è„šæœ¬<ExternalLinkIcon/></a></li>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-commit-msg" target="_blank" rel="noopener noreferrer">commit çš„ä¿¡æ¯<ExternalLinkIcon/></a></li>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-gitsync-sh" target="_blank" rel="noopener noreferrer">è‡ªåŠ¨ push ä¸€é”®æµè„šæœ¬ gitsync<ExternalLinkIcon/></a></li>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-makefile" target="_blank" rel="noopener noreferrer">Makefile<ExternalLinkIcon/></a></li>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-pre-commit" target="_blank" rel="noopener noreferrer">é¢„æäº¤ï¼šé’©å­æœ¬èº«: pre-commit<ExternalLinkIcon/></a></li>
<li><a href="https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694#file-pre-push" target="_blank" rel="noopener noreferrer">æäº¤ push å¤„ç†<ExternalLinkIcon/></a></li>
</ul>
<blockquote>
<p><strong>Note</strong> ç‚¹å‡»å³ä¸Šè§’ <code v-pre>Raw</code> è¿›å…¥è„šæœ¬æ–‡ä»¶</p>
</blockquote>
<h2 id="å¯å¤ç”¨çš„å®‰è£…è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#å¯å¤ç”¨çš„å®‰è£…è„šæœ¬" aria-hidden="true">#</a> å¯å¤ç”¨çš„å®‰è£…è„šæœ¬</h2>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token shebang important">#!/bin/sh</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Starting install script..."</span>

<span class="token assign-left variable">SET_GIT_TEMPLATE_DIR</span><span class="token operator">=</span>false
<span class="token assign-left variable">EXISTING_TEMPLATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> config <span class="token parameter variable">--global</span> init.templateDir <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">""</span><span class="token variable">)</span></span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$EXISTING_TEMPLATE</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Creating a new global git template dir at ~/.git_template"</span>
  <span class="token function">mkdir</span> ~/.git_template
  <span class="token assign-left variable">EXISTING_TEMPLATE</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> ~<span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span> <span class="token parameter variable">-P</span><span class="token variable">)</span></span>/.git_template"</span>
  <span class="token assign-left variable">SET_GIT_TEMPLATE_DIR</span><span class="token operator">=</span>true
<span class="token keyword">else</span>
  <span class="token assign-left variable">EXISTING_TEMPLATE</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">eval</span> <span class="token builtin class-name">cd</span> <span class="token punctuation">$(</span>dirname <span class="token string">"<span class="token variable">$EXISTING_TEMPLATE</span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token builtin class-name">pwd</span> <span class="token parameter variable">-P</span><span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> <span class="token string">"<span class="token variable">$EXISTING_TEMPLATE</span>"</span><span class="token variable">)</span></span>"</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Using existing git template dir: <span class="token variable">$EXISTING_TEMPLATE</span>"</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">HOOKS_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$EXISTING_TEMPLATE</span>/hooks"</span>
<span class="token assign-left variable">PRECOMMIT_HOOK</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$HOOKS_DIR</span>/pre-commit"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Creating hooks dir if it doesn't already exist: <span class="token variable">$HOOKS_DIR</span>"</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$HOOKS_DIR</span>"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$PRECOMMIT_HOOK</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Cannot install hook as it's already defined: '<span class="token variable">$PRECOMMIT_HOOK</span>'"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Downloading the hook to <span class="token variable">$PRECOMMIT_HOOK</span>"</span>
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/pre-commit <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$PRECOMMIT_HOOK</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/commit-msg <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$PRECOMMIT_HOOK</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null
<span class="token function">curl</span> <span class="token parameter variable">-L</span> https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694/raw/pre-push <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">$PRECOMMIT_HOOK</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null

<span class="token builtin class-name">echo</span> <span class="token string">"Making it executable"</span>
<span class="token function">chmod</span> +x <span class="token string">"<span class="token variable">$PRECOMMIT_HOOK</span>"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$SET_GIT_TEMPLATE_DIR</span>"</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"Defining ~/.git_template as the global git template dir"</span>
  <span class="token function">git</span> config <span class="token parameter variable">--global</span> init.templateDir <span class="token string">'~/.git_template'</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span>Done! Any future git repo created in this user profile will contain the hook<span class="token entity" title="\n">\n</span>"</span>


<span class="token comment">##################################################</span>
<span class="token assign-left variable">GIT_PATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> rev-parse --show-toplevel<span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"===> Copying hooks to <span class="token variable">$GIT_PATH</span>/.git/hooks/"</span>
<span class="token function">mv</span> ~/.git_template/hooks/* <span class="token variable">$GIT_PATH</span>/.git/hooks/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="git-commit-è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#git-commit-è®¾ç½®" aria-hidden="true">#</a> git commit è®¾ç½®</h2>
<p><strong>pre-commit æ–‡ä»¶:</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Copyright Â© 2023 OpenIMSDK.</span>
<span class="token comment">#</span>
<span class="token comment"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="token comment"># you may not use this file except in compliance with the License.</span>
<span class="token comment"># You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>
<span class="token comment">#</span>
<span class="token comment"># ==============================================================================</span>
<span class="token comment"># This is a pre-commit hook that ensures attempts to commit files that are</span>
<span class="token comment"># are larger than $limit to your _local_ repo fail, with a helpful error message.</span>

<span class="token comment"># You can override the default limit of 2MB by supplying the environment variable:</span>
<span class="token comment"># GIT_FILE_SIZE_LIMIT=50000000 git commit -m "test: this commit is allowed file sizes up to 50MB"</span>
<span class="token comment">#</span>
<span class="token comment"># ==============================================================================</span>


<span class="token assign-left variable">YELLOW</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[93m"</span>
<span class="token assign-left variable">GREEN</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[32m"</span>
<span class="token assign-left variable">RED</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[31m"</span>
<span class="token assign-left variable">ENDCOLOR</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[0m"</span>

<span class="token function-name function">printMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${YELLOW}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${GREEN}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${RED}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

printMessage <span class="token string">"Running local OpenIM pre-commit hook."</span>

<span class="token comment"># flutter format .</span>
<span class="token comment"># https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694</span>
<span class="token comment"># TODO! GIT_FILE_SIZE_LIMIT=50000000 git commit -m "test: this commit is allowed file sizes up to 50MB"</span>
<span class="token comment"># Maximum file size limit in bytes</span>
<span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token variable">${GIT_FILE_SIZE_LIMIT<span class="token operator">:-</span>2000000}</span> <span class="token comment"># Default 2MB</span>
<span class="token assign-left variable">limitInMB</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $limit <span class="token operator">/</span> <span class="token number">1000000</span> <span class="token variable">))</span></span>

<span class="token keyword">function</span> <span class="token function-name function">file_too_large</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token variable">$0</span>
	<span class="token assign-left variable">filesize</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span> $<span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token operator">**</span><span class="token number">20</span> <span class="token variable">))</span></span>

	<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">HEREDOC

	File <span class="token variable">$filename</span> is <span class="token variable">$filesize</span> MB, which is larger than github's maximum
        file size (2 MB). We will not be able to push this file to GitHub.
	Commit aborted

HEREDOC</span>
    <span class="token function">git</span> status

<span class="token punctuation">}</span>

<span class="token comment"># Move to the repo root so git files paths make sense</span>
<span class="token assign-left variable">repo_root</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token function">git</span> rev-parse --show-toplevel <span class="token variable">)</span></span>
<span class="token builtin class-name">cd</span> <span class="token variable">$repo_root</span>

<span class="token assign-left variable">empty_tree</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token function">git</span> hash-object <span class="token parameter variable">-t</span> tree /dev/null <span class="token variable">)</span></span>

<span class="token keyword">if</span> <span class="token function">git</span> rev-parse <span class="token parameter variable">--verify</span> HEAD <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token keyword">then</span>
	<span class="token assign-left variable">against</span><span class="token operator">=</span>HEAD
<span class="token keyword">else</span>
	<span class="token assign-left variable">against</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$empty_tree</span>"</span>
<span class="token keyword">fi</span>

<span class="token comment"># Set split so that for loop below can handle spaces in file names by splitting on line breaks</span>
<span class="token assign-left variable"><span class="token environment constant">IFS</span></span><span class="token operator">=</span><span class="token string">'
'</span>

<span class="token assign-left variable">shouldFail</span><span class="token operator">=</span>false
<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span> <span class="token function">git</span> diff-index <span class="token parameter variable">--cached</span> --name-only $against <span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>
	<span class="token assign-left variable">file_size</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>[ <span class="token operator">!</span> <span class="token operator">-</span>f $file ] <span class="token operator">&amp;&amp;</span> echo <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>ls <span class="token operator">-</span>la $file <span class="token operator">|</span> awk '{ print $<span class="token number">5</span> }'<span class="token variable">))</span></span>
	<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$file_size</span>"</span> <span class="token parameter variable">-gt</span>  <span class="token string">"<span class="token variable">$limit</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
	    printError <span class="token string">"File <span class="token variable">$file</span> is <span class="token variable"><span class="token variable">$((</span> $file_size <span class="token operator">/</span> <span class="token number">10</span><span class="token operator">**</span><span class="token number">6</span> <span class="token variable">))</span></span> MB, which is larger than our configured limit of <span class="token variable">$limitInMB</span> MB"</span>
        <span class="token assign-left variable">shouldFail</span><span class="token operator">=</span>true
	<span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token keyword">if</span> <span class="token variable">$shouldFail</span>
<span class="token keyword">then</span>
    printMessage <span class="token string">"If you really need to commit this file, you can override the size limit by setting the GIT_FILE_SIZE_LIMIT environment variable, e.g. GIT_FILE_SIZE_LIMIT=42000000 for 42MB. Or, commit with the --no-verify switch to skip the check entirely."</span>
	  printError <span class="token string">"Commit aborted"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>commit-msg</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token comment"># Copyright Â© 2023 OpenIMSDK.</span>
<span class="token comment">#</span>
<span class="token comment"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="token comment"># you may not use this file except in compliance with the License.</span>
<span class="token comment"># You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>
<span class="token comment">#</span>
<span class="token comment"># ==============================================================================</span>
<span class="token comment">#</span>
<span class="token comment"># Store this file as .git/hooks/commit-msg in your repository in order to</span>
<span class="token comment"># enforce checking for proper commit message format before actual commits.</span>
<span class="token comment"># You may need to make the script executable by 'chmod +x .git/hooks/commit-msg'.</span>

<span class="token comment"># commit-msg use go-gitlint tool, install go-gitlint via `go get github.com/llorllale/go-gitlint/cmd/go-gitlint`</span>
<span class="token comment"># go-gitlint --msg-file="$1"</span>

<span class="token comment"># An example hook script to check the commit log message.</span>
<span class="token comment"># Called by "git commit" with one argument, the name of the file</span>
<span class="token comment"># that has the commit message.  The hook should exit with non-zero</span>
<span class="token comment"># status after issuing an appropriate message if it wants to stop the</span>
<span class="token comment"># commit.  The hook is allowed to edit the commit message file.</span>

<span class="token assign-left variable">YELLOW</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[93m"</span>
<span class="token assign-left variable">GREEN</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[32m"</span>
<span class="token assign-left variable">RED</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[31m"</span>
<span class="token assign-left variable">ENDCOLOR</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[0m"</span>

<span class="token function-name function">printMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${YELLOW}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${GREEN}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${RED}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

printMessage <span class="token string">"Running the OpenIM commit-msg hook."</span>

<span class="token comment"># This example catches duplicate Signed-off-by lines.</span>

<span class="token builtin class-name">test</span> <span class="token string">""</span> <span class="token operator">=</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token string">'^Signed-off-by: '</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span>
	 <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token parameter variable">-e</span> <span class="token string">'/^[ 	]*1[ 	]/d'</span><span class="token variable">)</span></span>"</span> <span class="token operator">||</span> <span class="token punctuation">{</span>
	<span class="token builtin class-name">echo</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span> Duplicate Signed-off-by lines.
	<span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

./tools/go-gitlint <span class="token punctuation">\</span>
	 --msg-file<span class="token operator">=</span><span class="token variable">$1</span> <span class="token punctuation">\</span>
	 --subject-regex<span class="token operator">=</span><span class="token string">"^(build|chore|ci|docs|feat|feature|fix|perf|refactor|revert|style|test)(.*)?:\s?.*"</span> <span class="token punctuation">\</span>
    --subject-maxlen<span class="token operator">=</span><span class="token number">150</span> <span class="token punctuation">\</span>
    --subject-minlen<span class="token operator">=</span><span class="token number">10</span> <span class="token punctuation">\</span>
    --body-regex<span class="token operator">=</span><span class="token string">".*"</span> <span class="token punctuation">\</span>
    --max-parents<span class="token operator">=</span><span class="token number">1</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    printError <span class="token string">"Please fix your commit message to match OpenIM coding standards"</span>
    printError <span class="token string">"https://gist.github.com/cubxxw/126b72104ac0b0ca484c9db09c3e5694"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="push" tabindex="-1"><a class="header-anchor" href="#push" aria-hidden="true">#</a> push</h2>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token assign-left variable">YELLOW</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[93m"</span>
<span class="token assign-left variable">GREEN</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[32m"</span>
<span class="token assign-left variable">RED</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[31m"</span>
<span class="token assign-left variable">ENDCOLOR</span><span class="token operator">=</span><span class="token string">"<span class="token entity" title="\e">\e</span>[0m"</span>

<span class="token function-name function">printMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${YELLOW}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${GREEN}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">printError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token builtin class-name">printf</span> <span class="token string">"<span class="token variable">${RED}</span>OpenIM : <span class="token variable">$1</span><span class="token variable">${ENDCOLOR}</span><span class="token entity" title="\n">\n</span>"</span>
<span class="token punctuation">}</span>

printMessage <span class="token string">"Running local OpenIM pre-push hook."</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token function">git</span> status <span class="token parameter variable">--porcelain</span><span class="token variable">`</span></span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
  printError <span class="token string">"This script needs to run against committed code only. Please commit or stash you changes."</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment">#</span>
<span class="token comment">#printMessage "Running the Flutter analyzer"</span>
<span class="token comment">#flutter analyze</span>
<span class="token comment">#</span>
<span class="token comment">#if [ $? -ne 0 ]; then</span>
<span class="token comment">#  printError "Flutter analyzer error"</span>
<span class="token comment">#  exit 1</span>
<span class="token comment">#fi</span>
<span class="token comment">#</span>
<span class="token comment">#printMessage "Finished running the Flutter analyzer"</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="actions" tabindex="-1"><a class="header-anchor" href="#actions" aria-hidden="true">#</a> actions</h2>
<p><code v-pre>git-warning.yml</code> æ–‡ä»¶ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token comment"># This workflow will check for large files being added in PRs</span>
<span class="token comment"># and label the PR if one is found that exceeds the configured limit.</span>
<span class="token comment">#</span>
<span class="token comment"># For more information, see: https://github.com/marketplace/actions/lfs-warning</span>

<span class="token key atrule">name</span><span class="token punctuation">:</span> Large file size warning

<span class="token key atrule">on</span><span class="token punctuation">:</span> 
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token comment"># Ignore some files to avoid consuming Actions minutes unnecessarily </span>
    <span class="token comment"># for file types we're fairly confident we'll never need to worry about</span>
    <span class="token key atrule">paths-ignore</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> <span class="token string">'**.config'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.cs'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.cshtml'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.cs'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.csproj'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.cmd'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.dockerignore'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.gitignore'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.graphql'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.jsx?'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.md'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.props'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.ps1'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.scss'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.sh'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.sln'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.tsx?'</span>
      <span class="token punctuation">-</span> <span class="token string">'**.yml'</span>
      <span class="token punctuation">-</span> <span class="token string">'**/appsettings.*.json'</span>
      <span class="token punctuation">-</span> <span class="token string">'**/Dockerfile'</span>
      
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">run-check</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actionsdesk/lfs<span class="token punctuation">-</span>warning@v2.0
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token comment">#token: ${{ secrets.GITHUB_TOKEN }} # Optional</span>
        <span class="token key atrule">filesizelimit</span><span class="token punctuation">:</span> <span class="token string">'5242880'</span> <span class="token comment"># 5MB</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åµŒå…¥åˆ° Makefile åï¼Œæ•´ä¸ªé€»è¾‘å°±æ›´ç®€å•äº†ï¼š</strong></p>
<div class="language-makefile ext-makefile line-numbers-mode"><pre v-pre class="language-makefile"><code><span class="token comment"># Copy githook scripts when execute makefile</span>
COPY_GITHOOK<span class="token operator">:=</span><span class="token variable">$</span><span class="token punctuation">(</span><span class="token function">shell</span> cp -f script/githooks/* .git/hooks/<span class="token punctuation">;</span> chmod +x .git/hooks/*<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '59.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '61.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


