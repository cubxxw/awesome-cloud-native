<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬67èŠ‚-æ·±å…¥å­¦ä¹ -beego-æºç " tabindex="-1"><a class="header-anchor" href="#ç¬¬67èŠ‚-æ·±å…¥å­¦ä¹ -beego-æºç " aria-hidden="true">#</a> ç¬¬67èŠ‚ æ·±å…¥å­¦ä¹  beego æºç </h1>
<div><a href = '66.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '68.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•è®°å½•<a href="https://github.com/cubxxw/sealos" target="_blank" rel="noopener noreferrer">sealos<ExternalLinkIcon/></a>å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚<a href="https://github.com/cubxxw/sealos" target="_blank" rel="noopener noreferrer">k8sï¼Œdockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ <ExternalLinkIcon/></a>ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»" aria-hidden="true">#</a> ä»‹ç»</h2>
<p>Beego ç”¨äºå¿«é€Ÿå¼€å‘ Go ä¸­çš„ä¼ä¸šåº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ RESTful APIã€Web åº”ç”¨ç¨‹åºå’Œåç«¯æœåŠ¡ã€‚</p>
<p><strong>GitHubåœ°å€ï¼š</strong></p>
<ul>
<li><a href="https://github.com/beego/beego/" target="_blank" rel="noopener noreferrer">https://github.com/beego/beego/<ExternalLinkIcon/></a></li>
</ul>
<hr>
<p><img src="http://sm.nsddd.top/sm202305191917988.png" alt="architecture"></p>
<p><strong>Beegoç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š</strong></p>
<ol>
<li>åŸºç¡€æ¨¡å—ï¼šåŒ…æ‹¬æ—¥å¿—æ¨¡å—ã€é…ç½®æ¨¡å—ã€è°ƒé€Ÿå™¨æ¨¡å—;</li>
<li>ä»»åŠ¡ï¼šç”¨äºè¿è¡Œå®šæ—¶ä»»åŠ¡æˆ–å‘¨æœŸæ€§ä»»åŠ¡;</li>
<li>å®¢æˆ·ç«¯ï¼šåŒ…æ‹¬ORMæ¨¡å—ã€httplibæ¨¡å—ã€ç¼“å­˜æ¨¡å—;</li>
<li>æœåŠ¡å™¨ï¼šåŒ…æ‹¬ç½‘ç»œæ¨¡å—ã€‚æˆ‘ä»¬å°†æ¥æ”¯æŒ gRPC;</li>
</ol>
<p>Beego å°±ç›¸å½“äºæ˜¯ä¸€ä¸ª <strong>ç§¯æœ¨å¼é›†åˆ</strong>ï¼Œå°†æ¯ä¸€ä¸ªæ¨¡å—éƒ½é›†æˆåœ¨é¡¹ç›®ä¸­ï¼Œæ¯”å¦‚è¯´ cache çš„ç¼“å­˜æ¨¡å—ã€‚</p>
<h3 id="mvc-æ¶æ„" tabindex="-1"><a class="header-anchor" href="#mvc-æ¶æ„" aria-hidden="true">#</a> MVC æ¶æ„</h3>
<p>è¿™é‡Œä½¿ç”¨markdown Draw.ioçš„mermaidæ‰©å±•æ¥ç”»MVCæ¶æ„å›¾:</p>
<div class="language-mermaid ext-mermaid line-numbers-mode"><pre v-pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
    client<span class="token text string">(Client)</span> <span class="token arrow operator">--></span> view<span class="token text string">(View)</span>
    view <span class="token arrow operator">--></span> controller<span class="token text string">(Controller)</span>
    controller <span class="token arrow operator">--></span> model<span class="token text string">(Model)</span>
    model <span class="token arrow operator">--></span> database<span class="token text string">(Database)</span>

    <span class="token keyword">classDef</span> blue <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#bbf<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#f66<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span><span class="token punctuation">;</span>
    <span class="token keyword">classDef</span> orange <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#f96<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#f66<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span><span class="token punctuation">;</span>
    <span class="token keyword">classDef</span> green <span class="token style"><span class="token property">fill</span><span class="token operator">:</span>#9f9<span class="token punctuation">,</span><span class="token property">stroke</span><span class="token operator">:</span>#0f0<span class="token punctuation">,</span><span class="token property">stroke-width</span><span class="token operator">:</span>2px</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> Client blue
    <span class="token keyword">class</span> View blue
    <span class="token keyword">class</span> Controller orange
    <span class="token keyword">class</span> Model orange
    <span class="token keyword">class</span> Database green
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªå›¾å±•ç¤ºäº†ä¸€ä¸ªåŸºæœ¬çš„MVCæ¶æ„:- å®¢æˆ·ç«¯(Client)è°ƒç”¨Viewå±‚</p>
<ul>
<li>å®¢æˆ·ç«¯(Client)è°ƒç”¨Viewå±‚</li>
<li>Viewå±‚æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå§”æ‰˜ç»™Controllerå±‚</li>
<li>Controllerå±‚è°ƒç”¨Modelå±‚è·å–æ•°æ®æˆ–ä¸šåŠ¡é€»è¾‘</li>
<li>Modelå±‚å°†è¯·æ±‚è½¬å‘ç»™æ•°æ®åº“</li>
<li>æ•°æ®åº“æŸ¥è¯¢å“åº”ï¼ŒModelå±‚å°†ç»“æœè¿”å›ç»™Controller</li>
<li>Controllerå±‚å°†Modelå±‚ç»“æœè¿”å›ç»™Viewå±‚</li>
<li>Viewå±‚å°†ç»“æœå‘ˆç°ç»™å®¢æˆ·ç«¯</li>
</ul>
<p>beego ä½¿ç”¨çš„æ¶æ„æ˜¯ MVC æ¶æ„ï¼š</p>
<p><img src="http://sm.nsddd.top/sm202305191932281.png" alt="Http Request"></p>
<p>æµç¨‹å›¾è¯´æ˜ï¼š</p>
<ol>
<li>httpè¯·æ±‚ä»å·¦ä¾§mainå…¥å£å‡½æ•°å¼€å§‹è¿›å…¥æ¡†æ¶</li>
<li>UrLè·¯ç”±è§£æç„¶åç¡®å®šæ‰§è¡Œé‚£ä¸ªæ§åˆ¶å™¨(controller)</li>
<li>æ‰§è¡Œè¯·æ±‚å‰çš„è¿‡æ»¤å™¨ ï¼ˆè¿‡æ»¤å™¨ä¸€èˆ¬ç”¨æ¥æ‹¦æˆªè¯·æ±‚ï¼Œä¾‹å¦‚åšapiç­¾åæ ¡éªŒï¼Œsessionå¤„ç†ï¼Œå®‰å…¨éªŒè¯ç­‰ç­‰ï¼‰</li>
<li>æ‰§è¡Œæ§åˆ¶å™¨ ï¼ˆæ§åˆ¶å™¨æ ¹æ®éœ€è¦è°ƒç”¨modelï¼Œsession, æ—¥å¿—ç­‰æ¨¡å—ï¼‰</li>
<li>æ‰§è¡Œè¯·æ±‚åçš„è¿‡æ»¤å™¨</li>
<li>è§†å›¾è¾“å‡ºè¿”å›ç»™ç”¨æˆ·</li>
</ol>
<h2 id="ç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ç»“æ„" aria-hidden="true">#</a> ç›®å½•ç»“æ„</h2>
<p>beego æ˜¯ä¸€ä¸ª Go è¯­è¨€å¼€å‘çš„ Web æ¡†æ¶ï¼Œå®ƒçš„ç›®å½•ç»“æ„å¦‚ä¸‹:</p>
<ul>
<li>
<p><code v-pre>app</code>: ç”¨äºæ”¾ç½®åº”ç”¨ç¨‹åºçš„æ§åˆ¶å™¨ã€æ¨¡å‹ã€è§†å›¾ç­‰ã€‚</p>
</li>
<li>
<p><code v-pre>conf</code>: ç”¨äºæ”¾ç½®é…ç½®æ–‡ä»¶ï¼Œå¦‚ app.confã€‚</p>
</li>
<li>
<p><code v-pre>controllers</code>: ç”¨äºæ”¾ç½®æ§åˆ¶å™¨ä»£ç ï¼Œæ§åˆ¶å™¨è´Ÿè´£è§£æç”¨æˆ·çš„è¾“å…¥ï¼Œå¤„ç†åè¿”å›ç›¸åº”çš„ç»“æœã€‚</p>
</li>
<li>
<p><code v-pre>models</code>: ç”¨äºæ”¾ç½®æ¨¡å‹ä»£ç ï¼Œæ¨¡å‹æ˜¯ä¸æ•°æ®åº“äº¤äº’çš„éƒ¨åˆ†ã€‚</p>
</li>
<li>
<p><code v-pre>routers</code>: ç”¨äºè®¾ç½® URL è·¯ç”±æ˜ å°„ï¼Œæ¯”å¦‚å°† /user æ˜ å°„åˆ° controllers/user.goã€‚</p>
</li>
<li>
<p><code v-pre>static</code>: ç”¨äºæ”¾ç½®é™æ€èµ„æºï¼Œå¦‚ JSã€CSSã€å›¾ç‰‡ç­‰ã€‚</p>
</li>
<li>
<p><code v-pre>tests</code>: ç”¨äºæ”¾ç½®æµ‹è¯•ä»£ç ã€‚</p>
</li>
<li>
<p><code v-pre>views</code>: ç”¨äºæ”¾ç½®æ¨¡æ¿æ–‡ä»¶ï¼Œbeego æ”¯æŒå¤šç§æ¨¡æ¿ï¼Œå¦‚ goTemplateã€fastTemplate ç­‰ã€‚</p>
</li>
<li>
<p><code v-pre>main.go</code>: ç¨‹åºå…¥å£æ–‡ä»¶ï¼Œç”¨äºåˆå§‹åŒ– Beegoã€‚</p>
</li>
<li>
<p><code v-pre>conf/</code>: ç”¨äºå­˜æ”¾é…ç½®æ–‡ä»¶</p>
</li>
<li>
<p><code v-pre>logs/</code>: ç”¨äºå­˜æ”¾æ—¥å¿—æ–‡ä»¶</p>
</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰:</p>
<ul>
<li><code v-pre>cache</code>: ç”¨äºè®¾ç½®ç¼“å­˜ï¼Œå¦‚ redisã€memcached ç­‰ã€‚</li>
<li><code v-pre>toolbox</code>: ç”¨äºæ”¾ç½®å·¥å…·å‡½æ•°ã€‚</li>
<li><code v-pre>docs</code>: ç”¨äºæ”¾ç½®æ–‡æ¡£ã€‚</li>
<li><code v-pre>plugins</code>: beego çš„æ’ä»¶æœºåˆ¶å…è®¸å¼€å‘è€…æ‰©å±•æ›´å¤šåŠŸèƒ½ã€‚</li>
</ul>
<h3 id="beego-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#beego-å®‰è£…" aria-hidden="true">#</a> Beego å®‰è£…</h3>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>go get github.com/beego/beego/v2@latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å‘½ä»¤ï¼š</strong></p>
<ul>
<li>newï¼šåŸºäºç½‘ç«™å¼€å‘</li>
<li>apiï¼šæ‰‹æœºæ¥å£å¼€å‘</li>
<li>runï¼šè¿è¡Œ</li>
</ul>
<h2 id="beego-ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#beego-ä½¿ç”¨" aria-hidden="true">#</a> Beego ä½¿ç”¨</h2>
<h3 id="new" tabindex="-1"><a class="header-anchor" href="#new" aria-hidden="true">#</a> new</h3>
<p><code v-pre>new</code>: ç”¨äºåˆ›å»ºä¸€ä¸ª beego é¡¹ç›®çš„è„šæ‰‹æ¶</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>beego new PROJECT_NAME
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ PROJECT_NAME,å¹¶åœ¨é‡Œé¢åˆå§‹åŒ– beego é¡¹ç›®çš„åŸºæœ¬ç›®å½•ç»“æ„å’Œæ–‡ä»¶ã€‚</p>
<h3 id="api" tabindex="-1"><a class="header-anchor" href="#api" aria-hidden="true">#</a> api</h3>
<p><code v-pre>api</code>:ç”¨äºå¿«é€Ÿåˆ›å»º RESTful API æœåŠ¡ã€‚æ ¼å¼ä¸º:</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>beego api <span class="token punctuation">[</span>name<span class="token punctuation">]</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨åœ¨ controllers ç›®å½•ä¸‹åˆ›å»ºåä¸º name çš„ API æ§åˆ¶å™¨,å¹¶åœ¨ <code v-pre>conf/app.conf</code> é‡Œæ³¨å†Œè¯¥ APIã€‚</p>
<h3 id="run" tabindex="-1"><a class="header-anchor" href="#run" aria-hidden="true">#</a> run</h3>
<p><code v-pre>run</code>: ç”¨äºè¿è¡Œå’Œç¼–è¯‘ beego é¡¹ç›®ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>beego run   <span class="token comment"># è¿è¡Œé¡¹ç›®</span>
beego build <span class="token comment"># ç¼–è¯‘é¡¹ç›®</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>run å‘½ä»¤ä¼šç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨ç¼–è¯‘å’Œé‡è½½,æ–¹ä¾¿å¼€å‘è°ƒè¯•ã€‚build å‘½ä»¤ä¼šç¼–è¯‘ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶,ç”¨äºéƒ¨ç½²ä¸Šçº¿ã€‚</p>
<p>æ‰€ä»¥,å¦‚æœä½ è¦å¼€å‘ä¸€ä¸ª beego Webåº”ç”¨,é€šå¸¸çš„æµç¨‹æ˜¯:</p>
<ol>
<li>
<p>ä½¿ç”¨ beego new myproject åˆå§‹åŒ–é¡¹ç›®</p>
</li>
<li>
<p>ç¼–å†™ä»£ç (æ§åˆ¶å™¨ã€æ¨¡å‹ã€è·¯ç”±ç­‰)</p>
</li>
<li>
<p>ä½¿ç”¨ beego run è¿è¡Œé¡¹ç›®è¿›è¡Œå¼€å‘è°ƒè¯•</p>
</li>
<li>
<p>ä½¿ç”¨ beego build ç¼–è¯‘å‘å¸ƒå¯æ‰§è¡Œæ–‡ä»¶</p>
</li>
<li>
<p>éƒ¨ç½²å¯æ‰§è¡Œæ–‡ä»¶åˆ°ç”Ÿäº§ç¯å¢ƒ</p>
</li>
</ol>
<h2 id="ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨" aria-hidden="true">#</a> ä½¿ç”¨</h2>
<h3 id="æ§åˆ¶å™¨çš„é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨çš„é€»è¾‘" aria-hidden="true">#</a> æ§åˆ¶å™¨çš„é€»è¾‘</h3>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	beego <span class="token string">"github.com/beego/beego/v2/server/web"</span>
<span class="token punctuation">)</span>

<span class="token comment">// å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨ç»“æ„ä½“</span>
<span class="token comment">// æˆ‘ä»¬ä¸€èˆ¬ä¸€ä¸ªæ¨¡å—å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨</span>
<span class="token keyword">type</span> MainController <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// åµŒå¥—beegoåŸºç¡€æ§åˆ¶å™¨ï¼Œåœ¨goè¯­è¨€ä¸­åµŒå¥—structï¼Œå°±ç±»ä¼¼ç»§æ‰¿çš„æ¦‚å¿µã€‚</span>
    <span class="token comment">// è¿™é‡Œå°±ç›¸å½“äºï¼Œç»§æ‰¿äº†beego.Controllerçš„æ–¹æ³•å’Œå±æ€§ã€‚</span>
	beego<span class="token punctuation">.</span>Controller 
<span class="token punctuation">}</span>

<span class="token comment">// è¦†ç›–beego.Controllerçš„Getæ–¹æ³•ï¼Œç”¨äºå¤„ç†RESTfulè¯·æ±‚ä¸­çš„getè¯·æ±‚</span>
<span class="token comment">// beego.Controlleré»˜è®¤æ”¯æŒå¤šç§RESTfulæ–¹æ³•ï¼Œä¾‹å¦‚ï¼šPostã€Putã€Deleteç­‰ç­‰</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>MainController<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Dataæ˜¯ç»§æ‰¿è¿‡æ¥çš„å±æ€§ï¼Œæ˜¯mapç±»å‹ï¼Œå¯ä»¥ä¿å­˜ä»»æ„ç±»å‹æ•°æ®ï¼Œä¸»è¦ç”¨äºä¿å­˜è¯·æ±‚å“åº”æ•°æ®</span>
    <span class="token comment">// æˆ‘ä»¬å¯ä»¥é€šè¿‡Dataå°†å‚æ•°ï¼Œä¼ å…¥è§†å›¾æ¨¡æ¿æ–‡ä»¶ã€‚</span>
	<span class="token comment">// è¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªå‚æ•°</span>
	c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">"Website"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"nsddd.com"</span>
	c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">"Email"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"nsddd@demo.com"</span>
	
	<span class="token comment">// è®¾ç½®éœ€è¦æ¸²æŸ“çš„æ¨¡æ¿æ–‡ä»¶ï¼Œæ¡†æ¶ä¼šå»viewsç›®å½•æŸ¥æ‰¾è¿™ä¸ªæ¨¡æ¿æ–‡ä»¶</span>
	c<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">"index.tpl"</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è®¾ç½®urlè·¯ç”±" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®urlè·¯ç”±" aria-hidden="true">#</a> è®¾ç½®Urlè·¯ç”±</h3>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> routers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"nsddd/controllers"</span>
	beego <span class="token string">"github.com/beego/beego/v2/server/web"</span>
<span class="token punctuation">)</span>

<span class="token comment">// go åŒ…åˆå§‹åŒ–å‡½æ•°ï¼Œgoè¯­è¨€ä¸­åœ¨å¯¼å…¥ä¸€ä¸ªåŒ…çš„æ—¶å€™ï¼Œå¦‚æœè¢«å¯¼å…¥åŒ…å­˜åœ¨initå‡½æ•°ï¼Œä¼šæ‰§è¡Œinitå‡½æ•°</span>
<span class="token comment">// å› æ­¤è¿™é‡Œå¯ä»¥ä½¿ç”¨initå‡½æ•°åˆå§‹åŒ–è·¯ç”±è®¾ç½®</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨beego.Routerå‡½æ•°ï¼Œæ³¨å†Œè·¯ç”±è§„åˆ™ã€‚</span>
    <span class="token comment">// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯urlè·¯ç”±ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ§åˆ¶å™¨</span>
    <span class="token comment">// è¿™é‡Œçš„æ„æ€å°±æ˜¯å°†è®¿é—® / è¿™ä¸ªurlçš„è¯·æ±‚ï¼Œäº¤ç»™controllers.MainControlleræ§åˆ¶å™¨å¤„ç†ã€‚</span>
    beego<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>controllers<span class="token punctuation">.</span>MainController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬å¢åŠ ä¸‹é¢è·¯ç”±è®¾ç½®:</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>beego<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token string">"/nsddd"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>controllers<span class="token punctuation">.</span>MainController<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è®¿é—®:http://localhost:8080/nsddd å’Œ http://localhost:8080/ å¾—åˆ°çš„ç»“æœä¸€æ ·ï¼Œå› ä¸ºè¿™ä¸¤ä¸ªurlåœ°å€éƒ½æ˜¯ç”±åŒä¸€ä¸ªæ§åˆ¶å™¨å¤„ç†ã€‚</p>
<p><code v-pre>beego RESTful</code>è·¯ç”±è§„åˆ™ï¼Œé»˜è®¤æ˜¯é€šè¿‡ <strong>è¯·æ±‚æ–¹æ³•</strong> ç¡®è®¤ç”±é‚£ä¸ªæ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œï¼Œä¾‹å¦‚getè¯·æ±‚ï¼Œç”±Getæ–¹æ³•æ‰§è¡Œï¼ŒPOSTè¯·æ±‚ç”±Postæ–¹æ³•æ‰§è¡Œã€‚</p>
<h3 id="ç¼–å†™modelé€»è¾‘" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™modelé€»è¾‘" aria-hidden="true">#</a> ç¼–å†™modelé€»è¾‘</h3>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸ªmysqlæ•°æ®åº“æ“ä½œçš„ä¾‹å­ã€‚</p>
<p><em>å®šä¹‰è¡¨çš„ç»“æ„ï¼š</em></p>
<div class="language-mysql ext-mysql line-numbers-mode"><pre v-pre class="language-mysql"><code>CREATE TABLE `users` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢ID',
  `username` varchar(30) NOT NULL COMMENT 'è´¦å·',
  `password` varchar(100) NOT NULL COMMENT 'å¯†ç ',
   PRIMARY KEY (`id`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆå§‹åŒ–æ•°æ®åº“è¿æ¥" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–æ•°æ®åº“è¿æ¥" aria-hidden="true">#</a> åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</h3>
<p>ä¸€èˆ¬åˆå§‹åŒ–æ•°æ®åº“è¿æ¥éƒ½æ˜¯åœ¨main.goå…¥å£çš„åœ°æ–¹è®¾ç½®ä¸€æ¬¡å°±è¡Œï¼Œä¸‹é¢çœ‹ä¸‹main.goæ–‡ä»¶æ”¹æˆä»€ä¹ˆæ ·äº†ã€‚</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	beego <span class="token string">"github.com/beego/beego/v2/server/web"</span>
	<span class="token string">"github.com/beego/beego/v2/client/orm"</span>
	<span class="token boolean">_</span> <span class="token string">"nsddd/routers"</span>
	<span class="token comment">//å¯¼å…¥mysqlé©±åŠ¨ï¼Œè¿™æ˜¯å¿…é¡»çš„</span>
	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token comment">//åˆå§‹åŒ–åº”ç”¨è®¾ç½®ï¼Œ æˆ‘ä»¬é€šè¿‡initå‡½æ•°åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼Œgoè¯­è¨€ä¸­è¿™ä¸ªå‡½æ•°ä¼šä¼˜å…ˆæ‰§è¡Œ</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿™é‡Œæ³¨å†Œä¸€ä¸ªdefaulté»˜è®¤æ•°æ®åº“ï¼Œæ•°æ®åº“é©±åŠ¨æ˜¯mysql.</span>
    <span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°æ®åº“dsn, é…ç½®æ•°æ®åº“çš„è´¦å·å¯†ç ï¼Œæ•°æ®åº“åç­‰å‚æ•°</span>
    <span class="token comment">//  dsnå‚æ•°è¯´æ˜ï¼š</span>
    <span class="token comment">//      username    - mysqlè´¦å·</span>
    <span class="token comment">//      password    - mysqlå¯†ç </span>
    <span class="token comment">//      db_name     - æ•°æ®åº“å</span>
    <span class="token comment">//      127.0.0.1:3306 - æ•°æ®åº“çš„åœ°å€å’Œç«¯å£</span>
	orm<span class="token punctuation">.</span><span class="token function">RegisterDataBase</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/db_name?charset=utf8"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	beego<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆå§‹åŒ–æ•°æ®åº“è¿æ¥-1" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–æ•°æ®åº“è¿æ¥-1" aria-hidden="true">#</a> åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</h3>
<blockquote>
<p>ä¸€èˆ¬åˆå§‹åŒ–æ•°æ®åº“è¿æ¥éƒ½æ˜¯åœ¨main.goå…¥å£çš„åœ°æ–¹è®¾ç½®ä¸€æ¬¡å°±è¡Œï¼Œä¸‹é¢çœ‹ä¸‹main.goæ–‡ä»¶æ”¹æˆä»€ä¹ˆæ ·äº†ã€‚</p>
</blockquote>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	beego <span class="token string">"github.com/beego/beego/v2/server/web"</span>
	<span class="token string">"github.com/beego/beego/v2/client/orm"</span>
	<span class="token boolean">_</span> <span class="token string">"nsddd/routers"</span>
	<span class="token comment">//å¯¼å…¥mysqlé©±åŠ¨ï¼Œè¿™æ˜¯å¿…é¡»çš„</span>
	<span class="token boolean">_</span> <span class="token string">"github.com/go-sql-driver/mysql"</span>
<span class="token punctuation">)</span>

<span class="token comment">//åˆå§‹åŒ–åº”ç”¨è®¾ç½®ï¼Œ æˆ‘ä»¬é€šè¿‡initå‡½æ•°åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ï¼Œgoè¯­è¨€ä¸­è¿™ä¸ªå‡½æ•°ä¼šä¼˜å…ˆæ‰§è¡Œ</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿™é‡Œæ³¨å†Œä¸€ä¸ªdefaulté»˜è®¤æ•°æ®åº“ï¼Œæ•°æ®åº“é©±åŠ¨æ˜¯mysql.</span>
    <span class="token comment">// ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ•°æ®åº“dsn, é…ç½®æ•°æ®åº“çš„è´¦å·å¯†ç ï¼Œæ•°æ®åº“åç­‰å‚æ•°</span>
    <span class="token comment">//  dsnå‚æ•°è¯´æ˜ï¼š</span>
    <span class="token comment">//      username    - mysqlè´¦å·</span>
    <span class="token comment">//      password    - mysqlå¯†ç </span>
    <span class="token comment">//      db_name     - æ•°æ®åº“å</span>
    <span class="token comment">//      127.0.0.1:3306 - æ•°æ®åº“çš„åœ°å€å’Œç«¯å£</span>
	orm<span class="token punctuation">.</span><span class="token function">RegisterDataBase</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token string">"mysql"</span><span class="token punctuation">,</span> <span class="token string">"username:password@tcp(127.0.0.1:3306)/db_name?charset=utf8"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	beego<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸ºäº†åˆå§‹åŒ–mysqlè¿æ¥ï¼Œåœ¨å…¥å£main.goæ–‡ä»¶ï¼Œå¢åŠ initå‡½æ•°åˆå§‹åŒ–æ•°æ®åº“è®¾ç½®ã€‚</p>
<h3 id="åˆ›å»ºmodel" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºmodel" aria-hidden="true">#</a> åˆ›å»ºmodel</h3>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªuser model, æ–‡ä»¶è·¯å¾„ï¼šnsddd/models/user.go , ä»£ç å¦‚ä¸‹</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> models

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/beego/beego/v2/client/orm"</span>
<span class="token punctuation">)</span>

<span class="token comment">// å®šä¹‰Useræ¨¡å‹ï¼Œç»‘å®šusersè¡¨ç»“æ„, å…¶å®å°±æ˜¯ç”¨æ¥ä¿å­˜sqlæŸ¥è¯¢ç»“æœã€‚</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Id <span class="token builtin">int</span>
	Username <span class="token builtin">string</span>
	Password <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®šä¹‰User æ¨¡å‹ç»‘å®šé‚£ä¸ªè¡¨ï¼Ÿ</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">TableName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿”å›mysqlè¡¨å</span>
	<span class="token keyword">return</span> <span class="token string">"users"</span>
<span class="token punctuation">}</span>

<span class="token comment">//åˆå§‹åŒ–å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥å‘ormæ³¨å†Œmodel</span>
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å‘ormæ³¨å†Œuseræ¨¡å‹</span>
	orm<span class="token punctuation">.</span><span class="token function">RegisterModel</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span>
<span class="token keyword">func</span> <span class="token function">GetUserById</span><span class="token punctuation">(</span>id <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>User <span class="token punctuation">{</span>
	<span class="token keyword">if</span>  id <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>  <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
    
    <span class="token comment">// åˆ›å»ºormå¯¹è±¡, åé¢éƒ½æ˜¯é€šè¿‡ormå¯¹è±¡æ“ä½œæ•°æ®åº“</span>
	o <span class="token operator">:=</span> orm<span class="token punctuation">.</span><span class="token function">NewOrm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	<span class="token comment">// åˆå§‹åŒ–ä¸€ä¸ªUseræ¨¡å‹å¯¹è±¡</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token comment">// è®¾ç½®æŸ¥è¯¢å‚æ•°</span>
	user<span class="token punctuation">.</span>Id <span class="token operator">=</span> id
	
	<span class="token comment">// è°ƒç”¨Readæ–¹æ³•ï¼Œæ ¹æ®userè®¾ç½®çš„å‚æ•°ï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½•ï¼Œç»“æœä¿å­˜åˆ°userç»“æ„ä½“å˜é‡ä¸­</span>
	<span class="token comment">// é»˜è®¤æ˜¯æ ¹æ®ä¸»é”®è¿›è¡ŒæŸ¥è¯¢</span>
	<span class="token comment">// ç­‰ä»·sqlï¼š SELECT `id`, `username`, `password` FROM `users` WHERE `id` = 1</span>
	err <span class="token operator">:=</span> o<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	
	<span class="token comment">// æ£€æµ‹æŸ¥è¯¢ç»“æœï¼Œ</span>
	<span class="token keyword">if</span> err <span class="token operator">==</span> orm<span class="token punctuation">.</span>ErrNoRows <span class="token punctuation">{</span>
		<span class="token comment">// æ‰¾ä¸åˆ°è®°å½•</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">==</span> orm<span class="token punctuation">.</span>ErrMissPK <span class="token punctuation">{</span>
		<span class="token comment">// æ‰¾ä¸åˆ°ä½å»º</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> <span class="token operator">&amp;</span>user
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é€šè¿‡æ§åˆ¶å™¨è°ƒç”¨model" tabindex="-1"><a class="header-anchor" href="#é€šè¿‡æ§åˆ¶å™¨è°ƒç”¨model" aria-hidden="true">#</a> é€šè¿‡æ§åˆ¶å™¨è°ƒç”¨model</h3>
<p>ä¿®æ”¹ æ§åˆ¶å™¨çš„ä»£ç ï¼Œäº‹å®ä¸Š æ§åˆ¶å™¨ä¹Ÿæ˜¯æœ€åå»æ“ä½œçš„ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥åº”è¯¥å¤„ç†æ•°æ®åº“çš„ä¸€äº›æ“ä½œã€‚</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>MainController<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">"Website"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"nsddd.com"</span>
	c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">"Email"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"nsddd@demo.com"</span>
	
	<span class="token comment">// è°ƒç”¨modelï¼ŒæŸ¥è¯¢ç”¨æˆ·idä¸º1 çš„ç”¨æˆ·ä¿¡æ¯</span>
    user <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	
	<span class="token comment">// ç„¶åå°†useræ•°æ®ä¿å­˜åˆ°Dataä¸­, å°†å‚æ•°ä¼ ç»™åé¢çš„viewsè§†å›¾æ¨¡æ¿å¤„ç†</span>
	c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> user
	
	<span class="token comment">// ä½¿ç”¨æ–°çš„è§†å›¾æ¨¡æ¿user.tpl</span>
	c<span class="token punctuation">.</span>TplName <span class="token operator">=</span> <span class="token string">"user.tpl"</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç¼–å†™viewè§†å›¾é€»è¾‘" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™viewè§†å›¾é€»è¾‘" aria-hidden="true">#</a> ç¼–å†™viewè§†å›¾é€»è¾‘</h3>
<p>è¿™é‡Œç¼–å†™ä¸€ä¸ªæ–°çš„è§†å›¾æ¨¡æ¿, ä»£ç å¦‚ä¸‹:</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"zh-CN"</span><span class="token operator">></span>
<span class="token operator">&lt;</span>head<span class="token operator">></span>
	<span class="token operator">&lt;</span>title<span class="token operator">></span>Demo<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
	<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
<span class="token operator">&lt;</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span>h1<span class="token operator">></span>ç½‘ç«™<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Website<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">.</span>user <span class="token punctuation">}</span><span class="token punctuation">}</span>
ç”¨æˆ·å<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span>Username<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">else</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
æŸ¥æ‰¾ä¸åˆ°ç”¨æˆ·
<span class="token punctuation">{</span><span class="token punctuation">{</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¿é—®url: <a href="http://localhost:8080/" target="_blank" rel="noopener noreferrer">http://localhost:8080<ExternalLinkIcon/></a>, å¦‚æœæŸ¥è¯¢çš„ç”¨æˆ·å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºç”¨æˆ·åï¼Œå¦åˆ™æ˜¾ç¤ºæŸ¥æ‰¾ä¸åˆ°ç”¨æˆ·ã€‚</p>
<h3 id="é¡¹ç›®æ‰“åŒ…" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®æ‰“åŒ…" aria-hidden="true">#</a> é¡¹ç›®æ‰“åŒ…</h3>
<p>é¡¹ç›®å®Œæˆåéœ€è¦å°†ä»£ç æ‰“åŒ…å‘å¸ƒåˆ°çº¿ä¸Šï¼Œè¿™é‡Œä¾ç„¶æ¨èä½¿ç”¨beeå·¥å…·æ‰“åŒ…ï¼Œbeeå·¥å…·å¯ä»¥ä¸€é”®å°†é¡¹ç›®éœ€è¦çš„ç›¸å…³æ–‡ä»¶ä¸€èµ·æ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©åŒ…ï¼Œåªéœ€è¦åˆ°çº¿ä¸Šè§£å‹å³å¯ã€‚</p>
<p>ä¸‹é¢æ˜¯beeæ‰“åŒ…çš„ä¾‹å­ï¼Œ é¦–å…ˆå°†å‘½ä»¤çª—å£çš„ç›®å½•åˆ‡æ¢åˆ° &quot;é¡¹ç›®æ ¹ç›®å½•&quot;, ç„¶åæ‰§è¡Œä¸‹é¢å‘½ä»¤</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>bee pack
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰“åŒ…æˆåŠŸåå†é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª <code v-pre>nsddd.tar.gz</code> çš„å‹ç¼©åŒ…ï¼Œå‘½åæ ¼å¼: <code v-pre>${é¡¹ç›®å}.tar.gz</code></p>
<p>æˆ‘ä»¬å¯ä»¥è§£å‹ç¼©ï¼Œçœ‹çœ‹å‹ç¼©åŒ…åŒ…å«ä»€ä¹ˆå†…å®¹ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>nsddd.tar.gz
â”œâ”€â”€ conf            - é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•,è¿™é‡ŒåŒ…å«æˆ‘ä»¬çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ static          - é™æ€èµ„æºç›®å½•ï¼ŒåŒ…å«æˆ‘ä»¬é™æ€èµ„æºæ–‡ä»¶
â”œâ”€â”€ views           - è§†å›¾æ¨¡æ¿ç›®å½•ï¼ŒåŒ…å«æ¨¡æ¿æ–‡ä»¶
â””â”€â”€ nsddd         - è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬çš„é¡¹ç›®æ‰“åŒ…åçš„å¯æ‰§è¡Œç¨‹åºï¼ŒæŒ‰æˆ‘ä»¬é¡¹ç›®å‘½å
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="beego-æºç " tabindex="-1"><a class="header-anchor" href="#beego-æºç " aria-hidden="true">#</a> beego æºç </h2>
<p>å®˜æ–¹æä¾›çš„ç¤ºä¾‹éå¸¸ç®€å•ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"github.com/astaxie/beego"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    beego<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ä¹ˆï¼Œä»<code v-pre>Run()</code>æ–¹æ³•å¼€å§‹ï¼Œåœ¨<a href="https://github.com/astaxie/beego/blob/master/beego.go#L179" target="_blank" rel="noopener noreferrer">beego.go#179<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initBeforeHTTPRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> EnableAdmin <span class="token punctuation">{</span>
        <span class="token keyword">go</span> beeAdminApp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    BeeApp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æœ€é‡Œé¢çš„çœ‹çœ‹ <code v-pre>initBeforeHTTPRun()</code></p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token comment">// TODO move to module init function</span>
<span class="token keyword">func</span> <span class="token function">initBeforeHTTPRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	initHttpOnce<span class="token punctuation">.</span><span class="token function">Do</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// init hooks</span>
		<span class="token function">AddAPPStartHook</span><span class="token punctuation">(</span>
			registerMime<span class="token punctuation">,</span>
			registerDefaultErrorHandler<span class="token punctuation">,</span>
			registerSession<span class="token punctuation">,</span>
			registerTemplate<span class="token punctuation">,</span>
			registerAdmin<span class="token punctuation">,</span>
			registerGzip<span class="token punctuation">,</span>
			<span class="token comment">// registerCommentRouter,</span>
		<span class="token punctuation">)</span>

		<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> hk <span class="token operator">:=</span> <span class="token keyword">range</span> hooks <span class="token punctuation">{</span>
			<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">hk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
				<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ä»£ç çœ‹åˆ°åœ¨<code v-pre>Run()</code>çš„ç¬¬ä¸€æ­¥ï¼Œåˆå§‹åŒ–<code v-pre>AppConfig</code>ï¼Œè°ƒç”¨<code v-pre>hooks</code>ï¼Œåˆå§‹åŒ–<code v-pre>GlobalSessions</code>ï¼Œç¼–è¯‘æ¨¡æ¿<code v-pre>BuildTemplate()</code>ï¼Œå’ŒåŠ è½½ä¸­é—´ä»¶<code v-pre>middleware.RegisterErrorHandler()</code>ï¼Œåˆ†åˆ«ç®€å•å™è¿°ã€‚</p>
<h3 id="åŠ è½½é…ç½®" tabindex="-1"><a class="header-anchor" href="#åŠ è½½é…ç½®" aria-hidden="true">#</a> åŠ è½½é…ç½®</h3>
<p>åŠ è½½é…ç½®çš„ä»£ç æ˜¯ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">if</span> AppConfigPath <span class="token operator">!=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>AppPath<span class="token punctuation">,</span> <span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token string">"app.conf"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err <span class="token operator">:=</span> <span class="token function">ParseConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> AppConfigPath <span class="token operator">!=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>workPath<span class="token punctuation">,</span> <span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token string">"app.conf"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// configuration is critical to app, panic here if parse failed</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ¤æ–­é…ç½®æ–‡ä»¶æ˜¯ä¸æ˜¯<code v-pre>AppPath/conf/app.conf</code>ï¼Œå¦‚æœä¸æ˜¯å°±<code v-pre>ParseConfig()</code>ã€‚æ˜¾ç„¶ä»–ä¹‹å‰å°±å·²ç»åŠ è½½è¿‡ä¸€æ¬¡äº†ã€‚æ‰¾äº†ä¸€ä¸‹ï¼Œåœ¨<a href="https://github.com/astaxie/beego/blob/master/config.go#L152" target="_blank" rel="noopener noreferrer">config.go#L152<ExternalLinkIcon/></a>ï¼Œå…·ä½“åŠ è½½ä»€ä¹ˆå°±ä¸è¯´æ˜äº†ã€‚éœ€è¦è¯´æ˜çš„æ˜¯<code v-pre>AppPath</code>å’Œ<code v-pre>workPath</code>è¿™ä¿©å˜é‡ã€‚æ‰¾åˆ°å®šä¹‰<a href="https://github.com/astaxie/beego/blob/master/config.go#L72" target="_blank" rel="noopener noreferrer">config.go#72<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>workPath<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">Getwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
workPath<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>workPath<span class="token punctuation">)</span>
<span class="token comment">// initialize default configurations</span>
AppPath<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>filepath<span class="token punctuation">.</span><span class="token function">Dir</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

AppConfigPath <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>AppPath<span class="token punctuation">,</span> <span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token string">"app.conf"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> workPath <span class="token operator">!=</span> AppPath <span class="token punctuation">{</span>
    <span class="token keyword">if</span> utils<span class="token punctuation">.</span><span class="token function">FileExists</span><span class="token punctuation">(</span>AppConfigPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        os<span class="token punctuation">.</span><span class="token function">Chdir</span><span class="token punctuation">(</span>AppPath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        AppConfigPath <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>workPath<span class="token punctuation">,</span> <span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token string">"app.conf"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>workPath</code>æ˜¯<code v-pre>os.Getwd()</code>ï¼Œå³å½“å‰çš„ç›®å½•ï¼›<code v-pre>AppPath</code>æ˜¯<code v-pre>os.Args[0]</code>ï¼Œå³äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚æœ‰äº›æƒ…å†µä¸‹è¿™ä¸¤ä¸ªæ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚æŠŠå‘½ä»¤åŠ åˆ°<code v-pre>PATH</code>ä¸­ï¼Œç„¶åcdåˆ°åˆ«çš„ç›®å½•æ‰§è¡Œã€‚<code v-pre>beego</code>ä»¥äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸ºä¼˜å…ˆã€‚å¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨ç›®å½•æ²¡æœ‰å‘ç°<code v-pre>conf/app.conf</code>ï¼Œå†å»<code v-pre>workPath</code>é‡Œæ‰¾ã€‚</p>
<h3 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> Hooks</h3>
<p><code v-pre>hooks</code>å°±æ˜¯é’©å­ï¼Œåœ¨åŠ è½½é…ç½®åå°±æ‰§è¡Œï¼Œè¿™æ˜¯è¦åšå•¥å‘¢ï¼Ÿåœ¨ <a href="https://github.com/astaxie/beego/blob/master/beego.go#L173" target="_blank" rel="noopener noreferrer">beego.go#L173<ExternalLinkIcon/></a> æ·»åŠ æ–°çš„hookï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token comment">// The hookfunc will run in beego.Run()</span>
<span class="token comment">// such as sessionInit, middlerware start, buildtemplate, admin start</span>
<span class="token keyword">func</span> <span class="token function">AddAPPStartHook</span><span class="token punctuation">(</span>hf hookfunc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hooks <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>hooks<span class="token punctuation">,</span> hf<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>hooks</code>çš„å®šä¹‰åœ¨<a href="https://github.com/astaxie/beego/blob/master/beego.go#L19" target="_blank" rel="noopener noreferrer">beego.go#L19<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">type</span> hookfunc <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token comment">//hook function to run</span>
<span class="token keyword">var</span> hooks <span class="token punctuation">[</span><span class="token punctuation">]</span>hookfunc       <span class="token comment">//hook function slice to store the hookfunc</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>hook</code>å°±æ˜¯<code v-pre>func() error</code>ç±»å‹çš„å‡½æ•°ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè°ƒç”¨<code v-pre>hooks</code>å¯ä»¥å®ç°ä»£ç æ³¨é‡Šä¸­çš„å¦‚<code v-pre>middleware start, build template</code>å‘¢ï¼Ÿå› ä¸º<code v-pre>beego</code>ä½¿ç”¨çš„æ˜¯å•å®ä¾‹çš„æ¨¡å¼ã€‚</p>
<h3 id="å•å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å•å®ä¾‹" aria-hidden="true">#</a> å•å®ä¾‹</h3>
<p><code v-pre>beego</code>çš„æ ¸å¿ƒç»“æ„æ˜¯<code v-pre>beego.APP</code>ï¼Œä¿å­˜è·¯ç”±è°ƒåº¦ç»“æ„<code v-pre>*beego.ControllerRegistor</code>ã€‚ä»<code v-pre>beego.Run()</code>æ–¹æ³•çš„ä»£ç <code v-pre>BeeApp.Run()</code>å‘ç°ï¼Œ<code v-pre>beego</code>æœ‰ä¸€ä¸ªå…¨å±€å˜é‡<code v-pre>BeeApp</code>æ˜¯å®é™…è°ƒç”¨çš„<code v-pre>*beego.APP</code>å®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´æ•´ä¸ª<code v-pre>beego</code>å°±æ˜¯ä¸€ä¸ªå®ä¾‹ï¼Œä¸éœ€è¦ç±»ä¼¼<code v-pre>NewApp()</code>è¿™æ ·çš„å†™æ³•ã€‚</p>
<p>å› æ­¤ï¼Œå¾ˆå¤šç»“æ„éƒ½ä½œä¸ºå…¨å±€å˜é‡å¦‚<code v-pre>beego.BeeApp</code>æš´éœ²åœ¨å¤–ã€‚è¯¦ç»†çš„å®šä¹‰åœ¨ <a href="https://github.com/astaxie/beego/blob/master/config.go#L18" target="_blank" rel="noopener noreferrer">config.go#L18<ExternalLinkIcon/></a>ï¼Œç‰¹åˆ«æ³¨æ„ä¸€ä¸‹<code v-pre>SessionProvider(string)</code>ï¼Œé©¬ä¸Šå°±è¦æåˆ°ã€‚</p>
<h3 id="ä¼šè¯-globalsessions" tabindex="-1"><a class="header-anchor" href="#ä¼šè¯-globalsessions" aria-hidden="true">#</a> ä¼šè¯ <code v-pre>GlobalSessions</code></h3>
<p>ç»§ç»­<code v-pre>beego.Run()</code>çš„é˜…è¯»ï¼Œ<code v-pre>hooks</code>è°ƒç”¨å®Œæ¯•åï¼Œåˆå§‹åŒ–ä¼šè¯<code v-pre>GlobalSessions</code>ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if SessionOn {
    var err error
    sessionConfig := AppConfig.String("sessionConfig")
    if sessionConfig == "" {
        sessionConfig = `{"cookieName":"` + SessionName + `",` +
            `"gclifetime":` + strconv.FormatInt(SessionGCMaxLifetime, 10) + `,` +
            `"providerConfig":"` + SessionSavePath + `",` +
            `"secure":` + strconv.FormatBool(HttpTLS) + `,` +
            `"sessionIDHashFunc":"` + SessionHashFunc + `",` +
            `"sessionIDHashKey":"` + SessionHashKey + `",` +
            `"enableSetCookie":` + strconv.FormatBool(SessionAutoSetCookie) + `,` +
            `"cookieLifeTime":` + strconv.Itoa(SessionCookieLifeTime) + `}`
    }
    GlobalSessions, err = session.NewManager(SessionProvider,
        sessionConfig)
    if err != nil {
        panic(err)
    }
    go GlobalSessions.GC()
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>beego.SessionOn</code>å®šä¹‰æ˜¯å¦å¯åŠ¨SessionåŠŸèƒ½ï¼Œç„¶å<code v-pre>sessionConfig</code>æ˜¯Sessionçš„é…ç½®ï¼Œå¦‚æœé…ç½®ä¸ºç©ºï¼Œå°±ä½¿ç”¨æ‹¼æ¥çš„é»˜è®¤é…ç½®ã€‚<code v-pre>sessionConfig</code>æ˜¯jsonæ ¼å¼ã€‚</p>
<p><code v-pre>session.NewManager()</code>è¿”å›<code v-pre>*session.Manager</code>ï¼Œsessionçš„æ•°æ®å­˜å‚¨å¼•æ“æ˜¯<code v-pre>beego.SessionProvider</code>å®šä¹‰ï¼Œæ¯”å¦‚&quot;fileâ€ï¼Œæ–‡ä»¶å­˜å‚¨ã€‚</p>
<p><code v-pre>go GlobalSessions.GC()</code>å¼€å¯ä¸€ä¸ªgoroutineæ¥å¤„ç†sessionçš„å›æ”¶ã€‚é˜…è¯»ä¸€ä¸‹<code v-pre>GC()</code>çš„ä»£ç ï¼Œåœ¨ <a href="https://github.com/astaxie/beego/blob/master/session/session.go#L183" target="_blank" rel="noopener noreferrer">session/session.go#L183<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>func (manager *Manager) GC() {
    manager.provider.SessionGC()
    time.AfterFunc(time.Duration(manager.config.Gclifetime)*time.Second, func() { manager.GC() })
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸ª<strong>æ— é™å¾ªç¯</strong>ã€‚<code v-pre>time.AfterFunc()</code>åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´é—´éš”<code v-pre>time.Duration(...)</code>ä¹‹åï¼Œåˆè°ƒç”¨è‡ªå·±ï¼Œç›¸å½“äºåˆå¼€å§‹å¯åŠ¨<code v-pre>time.AfterFunc()</code>ç­‰å¾…ä¸‹ä¸€æ¬¡åˆ°æœŸã€‚<code v-pre>manager.provider.SessionGC()</code>æ˜¯ä¸åŒsessionå­˜å‚¨å¼•æ“çš„å›æ”¶æ–¹æ³•ï¼ˆå…¶å®æ˜¯<code v-pre>session.Provider</code>æ¥å£çš„ï¼‰ã€‚</p>
<h3 id="æ¨¡æ¿æ„å»º" tabindex="-1"><a class="header-anchor" href="#æ¨¡æ¿æ„å»º" aria-hidden="true">#</a> æ¨¡æ¿æ„å»º</h3>
<p>ç»§ç»­<code v-pre>beego.Run()</code>ï¼Œsessionåˆå§‹åŒ–åï¼Œæ„å»ºæ¨¡æ¿ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>err := BuildTemplate(ViewsPath)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code v-pre>beego.ViewsPath</code>æ˜¯æ¨¡æ¿çš„ç›®å½•å•¦ï¼Œä¸å¤šè¯´ã€‚ä»”ç»†æ¥çœ‹çœ‹<code v-pre>BuildTemplate()</code>å‡½æ•°ï¼Œ<a href="https://github.com/astaxie/beego/blob/master/template.go#L114" target="_blank" rel="noopener noreferrer">template.goL#114<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// build all template files in a directory.
// it makes beego can render any template file in view directory.
func BuildTemplate(dir string) error {
    if _, err := os.Stat(dir); err != nil {
        if os.IsNotExist(err) {
            return nil
        } else {
            return errors.New("dir open err")
        }
    }
    self := &amp;templatefile{
        root:  dir,
        files: make(map[string][]string),
    }
    err := filepath.Walk(dir, func(path string, f os.FileInfo, err error) error {
        return self.visit(path, f, err)
    })
    if err != nil {
        fmt.Printf("filepath.Walk() returned %v\n", err)
        return err
    }
    for _, v := range self.files {
        for _, file := range v {
            t, err := getTemplate(self.root, file, v...)
            if err != nil {
                Trace("parse template err:", file, err)
            } else {
                BeeTemplates[file] = t
            }
        }
    }
    return nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯”è¾ƒå¤æ‚ã€‚ä¸€ç‚¹ç‚¹æ¥çœ‹ï¼Œ<code v-pre>os.Stat(dir)</code>åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚<code v-pre>filepath.Walk()</code>èµ°ä¸€è¾¹ç›®å½•é‡Œçš„æ–‡ä»¶ï¼Œè®°å½•åœ¨<code v-pre>self.files</code>é‡Œé¢ã€‚å¾ªç¯<code v-pre>self.files</code>ä¸­çš„<code v-pre>file</code>ï¼ˆmap[dir][]file])ï¼Œç”¨<code v-pre>getTemplate</code>è·å–<code v-pre>*template.Template</code>å®ä¾‹ï¼Œä¿å­˜åœ¨<code v-pre>beego.BeeTemplates</code>ï¼ˆmap[string]*template.Templateï¼‰ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦<strong>é¢„å…ˆç¼–è¯‘</strong>æ¨¡æ¿ï¼Ÿæƒ³åƒä¸€ä¸‹ï¼Œå¦‚æœæ¯æ¬¡è¯·æ±‚ï¼Œéƒ½å»å¯»æ‰¾æ¨¡æ¿å†ç¼–è¯‘ä¸€éã€‚è¿™æ˜¾ç„¶æ˜¯ä¸ªæµªè´¹çš„ã€‚è€Œä¸”å¦‚æœæ¨¡æ¿å¤æ‚ï¼ŒåµŒå¥—ä¼—å¤šï¼Œç¼–è¯‘é€Ÿåº¦ä¼šæ˜¯å¾ˆå¤§çš„é—®é¢˜ã€‚å› æ­¤å­˜ä¸‹ç¼–è¯‘å¥½çš„<code v-pre>*template.Template</code>æ˜¯å¿…ç„¶çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œç¼–è¯‘åæ¨¡æ¿çš„ä¿®æ”¹ä¸èƒ½ç«‹å³å“åº”äº†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå…ˆç»§ç»­çœ‹ä¸‹å»ã€‚</p>
<h3 id="ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸­é—´ä»¶" aria-hidden="true">#</a> ä¸­é—´ä»¶</h3>
<p><code v-pre>middleware</code>åŒ…ç›®å‰ä¼¼ä¹åªæœ‰é”™è¯¯å¤„ç†çš„åŠŸèƒ½ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>middleware.RegisterErrorHandler()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åªæ˜¯æ³¨å†Œé»˜è®¤çš„é”™è¯¯å¤„ç†æ–¹æ³• <code v-pre>middleware.NotFound</code> ç­‰å‡ ä¸ªã€‚</p>
<h3 id="beeadminapp" tabindex="-1"><a class="header-anchor" href="#beeadminapp" aria-hidden="true">#</a> beeAdminApp</h3>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if EnableAdmin {
    go beeAdminApp.Run()
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>beeAdminApp</code>ä¹Ÿæ˜¯ä¸€ä¸ª<code v-pre>*beego.adminApp</code>ï¼Œè´Ÿè´£ç³»ç»Ÿç›‘æ§ã€æ€§èƒ½æ£€æµ‹ã€è®¿é—®ç»Ÿè®¡å’Œå¥åº·æ£€æŸ¥ç­‰ã€‚å…·ä½“çš„ä»‹ç»å’Œä½¿ç”¨å¯ä»¥è®¿é—®<a href="http://www.oschina.net/#" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<ExternalLinkIcon/></a>ã€‚</p>
<h2 id="httpæœåŠ¡" tabindex="-1"><a class="header-anchor" href="#httpæœåŠ¡" aria-hidden="true">#</a> HTTPæœåŠ¡</h2>
<p>å†™äº†è¿™ä¹ˆå¤šï¼Œç»ˆäºè¦å¼€å§‹è®²æ ¸å¿ƒç»“æ„<code v-pre>beego.BeeApp</code>çš„å¯åŠ¨ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>BeeApp.Run()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code v-pre>Run()</code>çš„å®ç°ä»£ç åœ¨<a href="https://github.com/astaxie/beego/blob/master/app.go#L29" target="_blank" rel="noopener noreferrer">app.go#L29<ExternalLinkIcon/></a>ã€‚ä»£ç è¾ƒé•¿ï¼Œçœ‹çœ‹æœ€é‡è¦çš„ä¸€æ®µï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if UseFcgi {
    if HttpPort == 0 {
        l, err = net.Listen("unix", addr)
    } else {
        l, err = net.Listen("tcp", addr)
    }
    if err != nil {
        BeeLogger.Critical("Listen: ", err)
    }
    err = fcgi.Serve(l, app.Handlers)
} else {
    if EnableHotUpdate {
        server := &amp;http.Server{
            Handler:      app.Handlers,
            ReadTimeout:  time.Duration(HttpServerTimeOut) * time.Second,
            WriteTimeout: time.Duration(HttpServerTimeOut) * time.Second,
        }
        laddr, err := net.ResolveTCPAddr("tcp", addr)
        if nil != err {
            BeeLogger.Critical("ResolveTCPAddr:", err)
        }
        l, err = GetInitListener(laddr)
        theStoppable = newStoppable(l)
        err = server.Serve(theStoppable)
        theStoppable.wg.Wait()
        CloseSelf()
    } else {
        s := &amp;http.Server{
            Addr:         addr,
            Handler:      app.Handlers,
            ReadTimeout:  time.Duration(HttpServerTimeOut) * time.Second,
            WriteTimeout: time.Duration(HttpServerTimeOut) * time.Second,
        }
        if HttpTLS {
            err = s.ListenAndServeTLS(HttpCertFile, HttpKeyFile)
        } else {
            err = s.ListenAndServe()
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>beego.UseFcgi</code>å®šä¹‰æ˜¯å¦ä½¿ç”¨<code v-pre>fast-cgi</code>æœåŠ¡ï¼Œè€Œä¸æ˜¯HTTPã€‚å¦ä¸€éƒ¨åˆ†æ˜¯å¯åŠ¨HTTPã€‚é‡Œé¢æœ‰ä¸ªé‡è¦åŠŸèƒ½<code v-pre>EnableHotUpdate</code>â€”â€”â€”â€”<strong>çƒ­æ›´æ–°</strong>ã€‚å¯¹ä»–çš„æè¿°ï¼Œå¯ä»¥çœ‹çœ‹å®˜æ–¹<a href="http://beego.me/docs/advantage/reload.md" target="_blank" rel="noopener noreferrer">æ–‡æ¡£<ExternalLinkIcon/></a>ã€‚</p>
<h3 id="_2-1-httpè¿‡ç¨‹æ€»è§ˆ" tabindex="-1"><a class="header-anchor" href="#_2-1-httpè¿‡ç¨‹æ€»è§ˆ" aria-hidden="true">#</a> 2.1 HTTPè¿‡ç¨‹æ€»è§ˆ</h3>
<p>ä¸Šé¢çš„ä»£ç çœ‹å¾—åˆ°<code v-pre>*http.Server.Handler</code>æ˜¯<code v-pre>app.Handlers</code>ï¼Œå³<code v-pre>*beego.ControllerRegistor</code>ï¼Œ<code v-pre>ServeHTTP</code>å°±å®šä¹‰åœ¨ä»£ç <a href="https://github.com/astaxie/beego/blob/master/router.go#L431" target="_blank" rel="noopener noreferrer">router.go#L431<ExternalLinkIcon/></a>ã€‚éå¸¸é•¿ï¼Œæˆ‘ä»¬æ£€å‡ºé‡è¦çš„éƒ¨åˆ†æ¥è¯´è¯´ã€‚</p>
<p>é¦–å…ˆæ˜¯è¦åˆ›å»ºå½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// init context
context := &amp;beecontext.Context{
    ResponseWriter: w,
    Request:        r,
    Input:          beecontext.NewInput(r),
    Output:         beecontext.NewOutput(),
}
context.Output.Context = context
context.Output.EnableGzip = EnableGzip
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>context</code>çš„ç±»å‹æ˜¯<code v-pre>*context.Context</code>ï¼ŒæŠŠå½“å‰çš„<code v-pre>w(http.ResponseWriter)</code>å’Œ<code v-pre>r(*http.Request)</code>å†™åœ¨<code v-pre>context</code>çš„å­—æ®µä¸­ã€‚</p>
<p>ç„¶åï¼Œå®šä¹‰äº†è¿‡æ»¤å™¨<code v-pre>filter</code>çš„è°ƒç”¨æ–¹æ³•ï¼ŒæŠŠ<code v-pre>context</code>ä¼ é€’ç»™è¿‡æ»¤å™¨æ“ä½œï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>do_filter := func(pos int) (started bool) {
    if p.enableFilter {
        if l, ok := p.filters[pos]; ok {
            for _, filterR := range l {
                if ok, p := filterR.ValidRouter(r.URL.Path); ok {
                    context.Input.Params = p
                    filterR.filterFunc(context)
                    if w.started {
                        return true
                    }
                }
            }
        }
    }
    return false
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼ŒåŠ è½½Sessionï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if SessionOn {
    context.Input.CruSession = GlobalSessions.SessionStart(w, r)
    defer func() {
        context.Input.CruSession.SessionRelease(w)
    }()
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>defer</code>ä¸­çš„<code v-pre>SessionRelease()</code>æ˜¯å°†sessionæŒä¹…åŒ–åˆ°å­˜å‚¨å¼•æ“ä¸­ï¼Œæ¯”å¦‚å†™å…¥æ–‡ä»¶ä¿å­˜ã€‚</p>
<p>ç„¶åï¼Œåˆ¤æ–­è¯·æ±‚æ–¹å¼æ˜¯å¦æ”¯æŒï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !utils.InSlice(strings.ToLower(r.Method), HTTPMETHOD) {
    http.Error(w, "Method Not Allowed", 405)
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œçœ‹ä¸€çœ‹åˆ° <code v-pre>goto Admin</code>ï¼Œå°±æ˜¯æ‰§è¡Œ<code v-pre>AdminApp</code>çš„ç›‘æ§æ“ä½œï¼Œè®°å½•è¿™æ¬¡è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚<code v-pre>Admin</code>å®šä¹‰åœ¨æ•´ä¸ªHTTPæ‰§è¡Œçš„æœ€åï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>Admin:
    //admin module record QPS
    if EnableAdmin {
        timeend := time.Since(starttime)
        if FilterMonitorFunc(r.Method, requestPath, timeend) {
            if runrouter != nil {
                go toolbox.StatisticsMap.AddStatistics(r.Method, requestPath, runrouter.Name(), timeend)
            } else {
                go toolbox.StatisticsMap.AddStatistics(r.Method, requestPath, "", timeend)
            }
        }
    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰€ä»¥<code v-pre>goto Admin</code>ç›´æ¥å°±è·³è¿‡ä¸­é—´è¿‡ç¨‹ï¼Œèµ°åˆ°HTTPæ‰§è¡Œçš„æœ€åäº†ã€‚æ˜¾ç„¶ï¼Œå½“è¯·æ±‚æ–¹å¼ä¸æ”¯æŒçš„æ—¶å€™ï¼Œç›´æ¥è·³åˆ°HTTPæ‰§è¡Œæœ€åã€‚å¦‚æœä¸å¯ç”¨<code v-pre>AdminApp</code>ï¼Œé‚£å°±æ˜¯HTTPæ‰§è¡Œè¿‡ç¨‹ç»“æŸã€‚</p>
<p>ç»§ç»­é˜…è¯»ï¼Œå¼€å§‹å¤„ç†é™æ€æ–‡ä»¶äº†ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if serverStaticRouter(context) {
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åå¤„ç†POSTè¯·æ±‚çš„å†…å®¹ä½“ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if context.Input.IsPost() {
    if CopyRequestBody &amp;&amp; !context.Input.IsUpload() {
        context.Input.CopyBody()
    }
    context.Input.ParseFormOrMulitForm(MaxMemory)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œä¸¤ä¸ªå‰ç½®çš„è¿‡æ»¤å™¨ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if do_filter(BeforeRouter) {
    goto Admin
}

if do_filter(AfterStatic) {
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¿©é¡ºåºæ€ªæ€ªçš„ï¼Œåº”è¯¥å…ˆ<code v-pre>AfterStatic</code>å<code v-pre>BeforeRouter</code>ã€‚éœ€è¦æ³¨æ„ï¼Œè¿‡æ»¤å™¨å¦‚æœè¿”å›<code v-pre>false</code>ï¼Œæ•´ä¸ªæ‰§è¡Œå°±ç»“æŸï¼ˆè·³åˆ°æœ€åï¼‰ã€‚</p>
<p>ç»§ç»­é˜…è¯»ï¼Œç„¶ååˆ¤æ–­æœ‰æ²¡æœ‰æŒ‡å®šæ‰§è¡Œçš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if context.Input.RunController != nil &amp;&amp; context.Input.RunMethod != "" {
    findrouter = true
    runMethod = context.Input.RunMethod
    runrouter = context.Input.RunController
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¿‡æ»¤å™¨æ‰§è¡Œåï¼Œå¯¹<code v-pre>context</code>æŒ‡å®šäº†æ‰§è¡Œçš„æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼Œå°±ç”¨æŒ‡å®šçš„ã€‚</p>
<p>ç»§ç»­ï¼Œè·¯ç”±çš„å¯»æ‰¾å¼€å§‹ï¼Œæœ‰ä¸‰ç§è·¯ç”±ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !findrouter {
    for _, route := range p.fixrouters {
        n := len(requestPath)
        if requestPath == route.pattern {
            runMethod = p.getRunMethod(r.Method, context, route)
            if runMethod != "" {
                runrouter = route.controllerType
                findrouter = true
                break
            }
        }
        //......
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>p.fixrouters</code>å°±æ˜¯ä¸å¸¦æ­£åˆ™çš„è·¯ç”±ï¼Œæ¯”å¦‚<code v-pre>/user</code>ã€‚<code v-pre>route.controllerType</code>çš„ç±»å‹æ˜¯<code v-pre>reflect.Type</code>ï¼Œåé¢ä¼šç”¨æ¥åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹ã€‚<code v-pre>p.getRunMethod()</code>è·å–å®é™…è¯·æ±‚æ–¹å¼ã€‚ä¸ºäº†æ»¡è¶³æµè§ˆå™¨æ— æ³•å‘é€è¡¨å•<code v-pre>PUT</code>å’Œ<code v-pre>DELETE</code>æ–¹æ³•ï¼Œå¯ä»¥ç”¨è¡¨å•åŸŸ<code v-pre>_method</code>å€¼ä»£æ›¿ã€‚ï¼ˆæ³¨æ˜ä¸€ä¸‹<code v-pre>p</code>å°±æ˜¯<code v-pre>*beego.ControllerRegistor</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å½“ç„¶æ˜¯æ­£åˆ™çš„è·¯ç”±ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !findrouter {
    //find a matching Route
    for _, route := range p.routers {

        //check if Route pattern matches url
        if !route.regex.MatchString(requestPath) {
            continue
        }
        // ......
        runMethod = p.getRunMethod(r.Method, context, route)
        if runMethod != "" {
            runrouter = route.controllerType
            context.Input.Params = params
            findrouter = true
            break
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­£åˆ™è·¯ç”±æ¯”å¦‚<code v-pre>/user/:id:int</code>ï¼Œè¿™ç§å¸¦å‚æ•°çš„ã€‚åŒ¹é…åçš„å‚æ•°ä¼šè®°å½•åœ¨<code v-pre>context.Input.Params</code>ä¸­ã€‚</p>
<p>è¿˜æ²¡æ‰¾åˆ°ï¼Œå°±çœ‹çœ‹æ˜¯å¦éœ€è¦è‡ªåŠ¨è·¯ç”±ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !findrouter &amp;&amp; p.enableAuto {
    // ......
    for cName, methodmap := range p.autoRouter {
        // ......
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŠŠæ‰€æœ‰è·¯ç”±è§„åˆ™èµ°å®Œï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è§„åˆ™ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !findrouter {
    middleware.Exception("404", rw, r, "")
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦ä¸€ç§æƒ…å†µå°±æ˜¯æ‰¾åˆ°è·¯ç”±è§„åˆ™å’¯ï¼Œä¸”çœ‹ä¸‹æ–‡ã€‚</p>
<h3 id="_2-2-è·¯ç”±è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#_2-2-è·¯ç”±è°ƒç”¨" aria-hidden="true">#</a> 2.2 è·¯ç”±è°ƒç”¨</h3>
<p>ä¸Šé¢çš„ä»£ç å‘ç°è·¯ç”±çš„è°ƒç”¨ä¾èµ–<code v-pre>runrouter</code>å’Œ<code v-pre>runmethod</code>å˜é‡ã€‚ä»–ä»¬å€¼è§‰å¾—äº†åˆ°åº•è°ƒç”¨ä»€ä¹ˆæ§åˆ¶å™¨å’Œæ–¹æ³•ã€‚æ¥çœ‹çœ‹å…·ä½“å®ç°ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if findrouter {
    //execute middleware filters
    if do_filter(BeforeExec) {
        goto Admin
    }

    //Invoke the request handler
    vc := reflect.New(runrouter)
    execController, ok := vc.Interface().(ControllerInterface)
    if !ok {
        panic("controller is not ControllerInterface")
    }

    //call the controller init function
    execController.Init(context, runrouter.Name(), runMethod, vc.Interface())

    //if XSRF is Enable then check cookie where there has any cookie in the  request's cookie _csrf
    if EnableXSRF {
        execController.XsrfToken()
        if r.Method == "POST" || r.Method == "DELETE" || r.Method == "PUT" ||
            (r.Method == "POST" &amp;&amp; (r.Form.Get("_method") == "delete" || r.Form.Get("_method") == "put")) {
            execController.CheckXsrfCookie()
        }
    }

    //call prepare function
    execController.Prepare()

    if !w.started {
        //exec main logic
        switch runMethod {
        case "Get":
            execController.Get()
        case "Post":
            execController.Post()
        case "Delete":
            execController.Delete()
        case "Put":
            execController.Put()
        case "Head":
            execController.Head()
        case "Patch":
            execController.Patch()
        case "Options":
            execController.Options()
        default:
            in := make([]reflect.Value, 0)
            method := vc.MethodByName(runMethod)
            method.Call(in)
        }

        //render template
        if !w.started &amp;&amp; !context.Input.IsWebsocket() {
            if AutoRender {
                if err := execController.Render(); err != nil {
                    panic(err)
                }

            }
        }
    }

    // finish all runrouter. release resource
    execController.Finish()

    //execute middleware filters
    if do_filter(AfterExec) {
        goto Admin
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç ”è¯»ä¸€ä¸‹ï¼Œæœ€å¼€å§‹çš„åˆæ˜¯è¿‡æ»¤å™¨ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if do_filter(BeforeExec) {
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>BeforeExec</code>æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•å‰çš„è¿‡æ»¤ã€‚</p>
<p>ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨å®ä¾‹ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>vc := reflect.New(runrouter)
execController, ok := vc.Interface().(ControllerInterface)
if !ok {
    panic("controller is not ControllerInterface")
}

//call the controller init function
execController.Init(context, runrouter.Name(), runMethod, vc.Interface())
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>reflect.New()</code>åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œç”¨<code v-pre>vc.Interface().(ControllerInterface)</code>å–å‡ºï¼Œè°ƒç”¨æ¥å£çš„<code v-pre>Init</code>æ–¹æ³•ï¼Œå°†è¯·æ±‚çš„ä¸Šä¸‹æ–‡ç­‰ä¼ é€’è¿›å»ã€‚
è¿™é‡Œå°±è¯´æ˜ä¸ºä»€ä¹ˆä¸èƒ½å­˜ä¸‹æ§åˆ¶å™¨å®ä¾‹ç»™æ¯æ¬¡è¯·æ±‚ä½¿ç”¨ï¼Œå› ä¸ºæ¯æ¬¡è¯·æ±‚çš„ä¸Šä¸‹æ–‡æ˜¯<strong>ä¸åŒçš„</strong>ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>execController.Prepare()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ§åˆ¶å™¨çš„å‡†å¤‡å·¥ä½œï¼Œè¿™é‡Œå¯ä»¥å†™ç”¨æˆ·ç™»å½•éªŒè¯ç­‰ã€‚</p>
<p>ç„¶åæ ¹æ®<code v-pre>runmethod</code>æ‰§è¡Œæ§åˆ¶å™¨å¯¹åº”çš„æ–¹æ³•ï¼Œéæ¥å£å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨<code v-pre>reflect.Call</code>è°ƒç”¨ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if !w.started &amp;&amp; !context.Input.IsWebsocket() {
    if AutoRender {
        if err := execController.Render(); err != nil {
            panic(err)
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè‡ªåŠ¨æ¸²æŸ“<code v-pre>AutoRender</code>ï¼Œå°±è°ƒç”¨<code v-pre>Render()</code>æ–¹æ³•æ¸²æŸ“é¡µé¢ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>execController.Finish()

//execute middleware filters
if do_filter(AfterExec) {
    goto Admin
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ§åˆ¶å™¨æœ€åä¸€åˆ€<code v-pre>Finish</code>æå®šï¼Œç„¶åè¿‡æ»¤å™¨<code v-pre>AfterExec</code>ä½¿ç”¨ã€‚</p>
<p>æ€»ç»“èµ·æ¥ï¼Œ<code v-pre>beego.ControllerInterface</code>æ¥å£æ–¹æ³•çš„<code v-pre>Init</code>,<code v-pre>Prepare</code>,<code v-pre>Render</code>å’Œ<code v-pre>Finish</code>å‘æŒ¥å¾ˆå¤§ä½œç”¨ã€‚é‚£å°±æ¥ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2 id="æ§åˆ¶å™¨å’Œè§†å›¾" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨å’Œè§†å›¾" aria-hidden="true">#</a> æ§åˆ¶å™¨å’Œè§†å›¾</h2>
<h3 id="æ§åˆ¶å™¨æ¥å£" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨æ¥å£" aria-hidden="true">#</a> æ§åˆ¶å™¨æ¥å£</h3>
<p>æ§åˆ¶å™¨æ¥å£<code v-pre>beego.ControllerInterface</code>çš„å®šä¹‰åœ¨<a href="https://github.com/astaxie/beego/blob/master/controller.go#L47" target="_blank" rel="noopener noreferrer">controller.go#L47<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>type ControllerInterface interface {
    Init(ct *context.Context, controllerName, actionName string, app interface{})
    Prepare()
    Get()
    Post()
    Delete()
    Put()
    Head()
    Patch()
    Options()
    Finish()
    Render() error
    XsrfToken() string
    CheckXsrfCookie() bool
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®˜æ–¹çš„å®ç°<code v-pre>beego.Controller</code>å®šä¹‰åœ¨<a href="https://github.com/astaxie/beego/blob/master/controller.go#L29" target="_blank" rel="noopener noreferrer">controller.go#L29<ExternalLinkIcon/></a>ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>type Controller struct {
    Ctx            *context.Context
    Data           map[interface{}]interface{}
    controllerName string
    actionName     string
    TplNames       string
    Layout         string
    LayoutSections map[string]string // the key is the section name and the value is the template name
    TplExt         string
    _xsrf_token    string
    gotofunc       string
    CruSession     session.SessionStore
    XSRFExpire     int
    AppController  interface{}
    EnableReander  bool
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å†…å®¹å¥½å¤šï¼Œæ²¡å¿…è¦å…¨éƒ¨éƒ½çœ‹çœ‹ï¼Œé‡ç‚¹åœ¨<code v-pre>Init</code>,<code v-pre>Prepare</code>,<code v-pre>Render</code>å’Œ<code v-pre>Finish</code>è¿™å››ä¸ªã€‚</p>
<h3 id="æ§åˆ¶å™¨çš„å®" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨çš„å®" aria-hidden="true">#</a> æ§åˆ¶å™¨çš„å®</h3>
<p><code v-pre>Init</code>æ–¹æ³•ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// Init generates default values of controller operations.
func (c *Controller) Init(ctx *context.Context, controllerName, actionName string, app interface{}) {
    c.Layout = ""
    c.TplNames = ""
    c.controllerName = controllerName
    c.actionName = actionName
    c.Ctx = ctx
    c.TplExt = "tpl"
    c.AppController = app
    c.EnableReander = true
    c.Data = ctx.Input.Data
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ²¡ä»€ä¹ˆè¯è¯´ï¼Œä¸€å †èµ‹å€¼ã€‚å”¯ä¸€è¦è°ˆçš„æ˜¯<code v-pre>c.EnableReander</code>ï¼Œè¿™ç§æ‹¼å†™é”™è¯¯å®åœ¨æ˜¯ï¼Œæ‰é˜´æ²Ÿé‡Œã€‚å®é™…çš„æ„æ€æ˜¯<code v-pre>EnableRender</code>ã€‚</p>
<p><code v-pre>Prepare</code>å’Œ<code v-pre>Finish</code>æ–¹æ³•ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// Prepare runs after Init before request function execution.
func (c *Controller) Prepare() {

}

// Finish runs after request function execution.
func (c *Controller) Finish() {

}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç©ºçš„ï¼åŸæ¥æˆ‘è¦è‡ªå·±å¡«å†…å®¹å•Šã€‚</p>
<p><code v-pre>Render</code>æ–¹æ³•ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// Render sends the response with rendered template bytes as text/html type.
func (c *Controller) Render() error {
    if !c.EnableReander {
        return nil
    }
    rb, err := c.RenderBytes()

    if err != nil {
        return err
    } else {
        c.Ctx.Output.Header("Content-Type", "text/html; charset=utf-8")
        c.Ctx.Output.Body(rb)
    }
    return nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è§†å›¾æ¸²æŸ“" tabindex="-1"><a class="header-anchor" href="#è§†å›¾æ¸²æŸ“" aria-hidden="true">#</a> è§†å›¾æ¸²æŸ“</h3>
<p>æ¸²æŸ“çš„æ ¸å¿ƒæ–¹æ³•æ˜¯<code v-pre>c.RenderBytes()</code>:</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>// RenderBytes returns the bytes of rendered template string. Do not send out response.
func (c *Controller) RenderBytes() ([]byte, error) {
    //if the controller has set layout, then first get the tplname's content set the content to the layout
    if c.Layout != "" {
        if c.TplNames == "" {
            c.TplNames = strings.ToLower(c.controllerName) + "/" + strings.ToLower(c.actionName) + "." + c.TplExt
        }
        if RunMode == "dev" {
            BuildTemplate(ViewsPath)
        }
        newbytes := bytes.NewBufferString("")
        if _, ok := BeeTemplates[c.TplNames]; !ok {
            panic("can't find templatefile in the path:" + c.TplNames)
            return []byte{}, errors.New("can't find templatefile in the path:" + c.TplNames)
        }
        err := BeeTemplates[c.TplNames].ExecuteTemplate(newbytes, c.TplNames, c.Data)
        if err != nil {
            Trace("template Execute err:", err)
            return nil, err
        }
        tplcontent, _ := ioutil.ReadAll(newbytes)
        c.Data["LayoutContent"] = template.HTML(string(tplcontent))

        if c.LayoutSections != nil {
            for sectionName, sectionTpl := range c.LayoutSections {
                if sectionTpl == "" {
                    c.Data[sectionName] = ""
                    continue
                }

                sectionBytes := bytes.NewBufferString("")
                err = BeeTemplates[sectionTpl].ExecuteTemplate(sectionBytes, sectionTpl, c.Data)
                if err != nil {
                    Trace("template Execute err:", err)
                    return nil, err
                }
                sectionContent, _ := ioutil.ReadAll(sectionBytes)
                c.Data[sectionName] = template.HTML(string(sectionContent))
            }
        }

        ibytes := bytes.NewBufferString("")
        err = BeeTemplates[c.Layout].ExecuteTemplate(ibytes, c.Layout, c.Data)
        if err != nil {
            Trace("template Execute err:", err)
            return nil, err
        }
        icontent, _ := ioutil.ReadAll(ibytes)
        return icontent, nil
    } else {
        //......
    }
    return []byte{}, nil
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä¸»è¦æ˜¯ä¸¤ç§æƒ…å†µï¼Œæœ‰æ²¡æœ‰Layoutã€‚å¦‚æœæœ‰Layoutï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>err := BeeTemplates[c.TplNames].ExecuteTemplate(newbytes, c.TplNames, c.Data)
// ......
tplcontent, _ := ioutil.ReadAll(newbytes)
c.Data["LayoutContent"] = template.HTML(string(tplcontent))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶ï¼Œå°±æ˜¯å¸ƒå±€çš„ä¸»å†…å®¹ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>for sectionName, sectionTpl := range c.LayoutSections {
    if sectionTpl == "" {
        c.Data[sectionName] = ""
        continue
    }

    sectionBytes := bytes.NewBufferString("")
    err = BeeTemplates[sectionTpl].ExecuteTemplate(sectionBytes, sectionTpl, c.Data)
    // ......
    sectionContent, _ := ioutil.ReadAll(sectionBytes)
    c.Data[sectionName] = template.HTML(string(sectionContent))
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¸²æŸ“å¸ƒå±€é‡Œçš„åˆ«çš„åŒºå—<code v-pre>c.LayoutSections</code>ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>ibytes := bytes.NewBufferString("")
err = BeeTemplates[c.Layout].ExecuteTemplate(ibytes, c.Layout, c.Data)
// ......
icontent, _ := ioutil.ReadAll(ibytes)
return icontent, nil
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åæ˜¯æ¸²æŸ“å¸ƒå±€æ–‡ä»¶ï¼Œ<code v-pre>c.Data</code>é‡Œå¸¦æœ‰æ‰€æœ‰å¸ƒå±€çš„ä¸»å†…å®¹å’ŒåŒºå—ï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼åœ¨å¸ƒå±€é‡Œã€‚</p>
<p>æ¸²æŸ“è¿‡ç¨‹æœ‰è¶£çš„ä»£ç ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>if RunMode == "dev" {
    BuildTemplate(ViewsPath)
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¼€å‘çŠ¶æ€ä¸‹ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°<code v-pre>BuildTemplate()</code>ã€‚è¿™æ ·å°±å¯ä»¥ç†è§£ï¼Œæœ€åˆæ¸²æŸ“æ¨¡æ¿å¹¶å­˜ä¸‹<code v-pre>*template.Template</code>ï¼Œç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œæ˜¯ä¸ä¼šå“åº”å³æ—¶çš„æ¨¡ç‰ˆä¿®æ”¹ã€‚</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '66.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '68.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


