<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬22èŠ‚-sealer-1-9-1æ–°å¹´è§„åˆ’" tabindex="-1"><a class="header-anchor" href="#ç¬¬22èŠ‚-sealer-1-9-1æ–°å¹´è§„åˆ’" aria-hidden="true">#</a> ç¬¬22èŠ‚ sealer 1.9.1æ–°å¹´è§„åˆ’</h1>
<div><a href = '21.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '23.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•è®°å½•<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">sealos<ExternalLinkIcon/></a>å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ <ExternalLinkIcon/></a>ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="å‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡" aria-hidden="true">#</a> å‡†å¤‡</h2>
<ul>
<li><a href="https://github.com/sealerio/sealer/discussions/1997" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/discussions/1997<ExternalLinkIcon/></a></li>
<li><a href="https://github.com/sealerio/sealer/issues/2001" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/issues/2001<ExternalLinkIcon/></a></li>
</ul>
<p><strong>æ—¶é—´é™åˆ¶ï¼š</strong></p>
<p>0.9.2 å‘å¸ƒ - 20230228</p>
<p>æˆªæ­¢åˆ° 2 æœˆ 28 å·ï¼Œä¸¤å‘¨ä¸ºæœŸé™å®ç°éœ€æ±‚ï¼Œæœ€åä¸€å‘¨æ£€æŸ¥ã€‚</p>
<blockquote>
<p>æ‰€æœ‰å‘½ä»¤å¿…é¡»ä»¥<code v-pre>root</code>ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œç›®å‰ä¸æ”¯æŒè¿è¡Œä¸º<code v-pre>sudoers</code>æˆ–<code v-pre>rootless</code></p>
<p>sealer æ”¯æŒ <code v-pre>sudoers</code></p>
</blockquote>
<p><strong>æ·»åŠ ä¸€äº› e2e æµ‹è¯•æ¡ˆä¾‹ï¼š</strong></p>
<ul>
<li><a href="https://github.com/sealerio/sealer/issues/1966" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/issues/1966<ExternalLinkIcon/></a></li>
</ul>
<h2 id="æˆ‘çš„ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#æˆ‘çš„ä»»åŠ¡" aria-hidden="true">#</a> æˆ‘çš„ä»»åŠ¡</h2>
<ul>
<li>https://github.com/sealerio/sealer/issues/1999</li>
</ul>
<p>AFAKï¼Œå®‰è£… k8s ä¸ä¸€å®šéœ€è¦ root ç”¨æˆ·ï¼Œè€Œæ˜¯å…·æœ‰ root æƒé™çš„ç”¨æˆ·ã€‚æœ‰äº›æƒ…å†µä¸‹ç”¨æˆ·ä¸æƒ³æä¾› root ç”¨æˆ·ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸º sealer éœ€è¦æ”¯æŒè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<blockquote>
<p>sealerä¸æ”¯æŒæ²¡æœ‰sudoæƒé™çš„æ™®é€šç”¨æˆ·å®‰è£…è¿è¡Œã€‚</p>
</blockquote>
<p>ç›®å‰ï¼Œsealer ä»ç„¶ä¸æ”¯æŒå…·æœ‰ sudo æƒé™çš„æ™®é€šç”¨æˆ·ã€‚è€Œåœ¨æœªæ¥å¯¹sealerè¿›è¡Œä¸€äº›é‡æ„ä¹‹åï¼Œæˆ‘ä»¬è‚¯å®šä¼šæ”¯æŒå…·æœ‰sudoæƒé™çš„æ™®é€šç”¨æˆ·ã€‚</p>
<p><strong>æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>ç¡®å®šç”¨æˆ·æƒé™è¦æ±‚ï¼šéœ€è¦ç¡®å®š k8s å®‰è£…è¿‡ç¨‹ä¸­éœ€è¦å“ªäº›æƒé™ï¼Œå¹¶ä¸”éœ€è¦çŸ¥é“å¦‚ä½•åœ¨é root ç”¨æˆ·ä¸‹æˆäºˆè¿™äº›æƒé™ã€‚</li>
<li>ä¿®æ”¹å®‰è£…è„šæœ¬å’Œä»£ç ï¼šæ ¹æ®ç”¨æˆ·æƒé™è¦æ±‚ï¼Œä¿®æ”¹å®‰è£…è„šæœ¬ä»¥ç¡®ä¿å®ƒèƒ½åœ¨é root ç”¨æˆ·ä¸‹æ­£å¸¸è¿è¡Œã€‚</li>
<li>æµ‹è¯•å®‰è£…ï¼šåœ¨é root ç”¨æˆ·ä¸‹æµ‹è¯• k8s å®‰è£…æ˜¯å¦æ­£å¸¸ã€‚</li>
<li>æ›´æ–°ç”¨æˆ·æ–‡æ¡£ï¼šæ›´æ–° Sealer ç”¨æˆ·æ–‡æ¡£ï¼Œæä¾›å…³äºé root ç”¨æˆ·å®‰è£… k8s çš„è¯´æ˜ã€‚</li>
</ol>
<h2 id="è§£å†³çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#è§£å†³çš„é—®é¢˜" aria-hidden="true">#</a> è§£å†³çš„é—®é¢˜</h2>
<ul>
<li><a href="https://github.com/sealerio/sealer/issues/1591" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/issues/1591<ExternalLinkIcon/></a></li>
</ul>
<h2 id="æ–‡æ¡£æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#æ–‡æ¡£æ”¯æŒ" aria-hidden="true">#</a> æ–‡æ¡£æ”¯æŒ</h2>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/administer-cluster/kubelet-in-userns/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/tasks/administer-cluster/kubelet-in-userns/<ExternalLinkIcon/></a></li>
</ul>
<p>æœ¬æ–‡æ¡£æè¿°äº†å¦‚ä½•åœ¨æ²¡æœ‰ root æƒé™çš„æƒ…å†µä¸‹è¿è¡Œ Kubernetes Node ç»„ä»¶ï¼Œä¾‹å¦‚ kubeletã€CRIã€OCI å’Œ CNIï¼Œä½¿ç”¨<a href="https://man7.org/linux/man-pages/man7/user_namespaces.7.html" target="_blank" rel="noopener noreferrer">ç”¨æˆ·å‘½åç©ºé—´<ExternalLinkIcon/></a>.</p>
<p>è¿™ç§æŠ€æœ¯ä¹Ÿç§°ä¸º <em><strong>rootless mode</strong></em>ã€‚</p>
<ul>
<li><a href="https://rancher.com/docs/k3s/latest/en/advanced/#running-k3s-with-rootless-mode-experimental" target="_blank" rel="noopener noreferrer">k3så®éªŒæ€§æ”¯æŒ rootless<ExternalLinkIcon/></a></li>
</ul>
<h2 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ</h2>
<p>ä¸¤ç§æ–¹æ¡ˆ <strong>å¼‚æ­¥å¼€å§‹</strong> ï¼š</p>
<ul>
<li>è·‘ç¨‹åºï¼Œå¿«é€Ÿä½¿ç”¨é root ç”¨æˆ·è¿‡ä¸€éï¼Œæ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼Œè·‘é€šå°±å®ç°äº†ã€‚</li>
<li>è¿‡ä»£ç ï¼Œå¿«é€Ÿè¿‡ä¸€éæ„å»ºéƒ¨åˆ†çš„ä»£ç ï¼Œæ‰¾å‡ºè§£å†³çš„æ–¹æ¡ˆã€‚</li>
</ul>
<h3 id="è·‘ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#è·‘ç¨‹åº" aria-hidden="true">#</a> è·‘ç¨‹åº</h3>
<ul>
<li>
<p>ä¸‰å°è™šæ‹Ÿæœº</p>
</li>
<li>
<p>ç¯å¢ƒï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@cubmaster01:~/workspces/sealer/_output/bin/sealer/linux_amd64<span class="token comment"># source /etc/profile;sealer version</span>
<span class="token punctuation">{</span><span class="token string">"gitVersion"</span><span class="token builtin class-name">:</span><span class="token string">"unknown"</span>,<span class="token string">"gitCommit"</span><span class="token builtin class-name">:</span><span class="token string">"2cd5bb8af"</span>,<span class="token string">"buildDate"</span><span class="token builtin class-name">:</span><span class="token string">"2023-02-03 13:11:59"</span>,<span class="token string">"goVersion"</span><span class="token builtin class-name">:</span><span class="token string">"go1.19.3"</span>,<span class="token string">"compiler"</span><span class="token builtin class-name">:</span><span class="token string">"gc"</span>,<span class="token string">"platform"</span><span class="token builtin class-name">:</span><span class="token string">"linux/amd64"</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p>ä¸»æœºï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token number">192.168</span>.71.134 node01
<span class="token number">192.168</span>.71.133 node02
<span class="token number">192.168</span>.71.131 master01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
</ul>
<p><strong>è¿è¡Œï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealer run docker.io/sealerio/kubernetes:v1.22.15 <span class="token punctuation">\</span>
  <span class="token parameter variable">--masters</span> <span class="token number">192.168</span>.71.131 <span class="token punctuation">\</span>
  <span class="token parameter variable">--nodes</span> <span class="token number">192.168</span>.71.133,192.168.71.134 <span class="token parameter variable">--passwd</span> <span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="test" tabindex="-1"><a class="header-anchor" href="#test" aria-hidden="true">#</a> test</h2>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@cubmaster01:~/workspces<span class="token comment"># sealer run docker.io/sealerio/kubernetes:v1.22.15   --masters 192.168.71.131   --nodes 192.168.71.133,192.168.71.134 --passwd 123456</span>
Trying to pull docker.io/sealerio/kubernetes:v1.22.15<span class="token punctuation">..</span>.
Getting image <span class="token builtin class-name">source</span> signatures
Copying blob f5947d538452 skipped: already exists  
Copying blob 570ae92500e2 <span class="token keyword">done</span>  
Copying blob 55f8dfb1b045 <span class="token keyword">done</span>  
Copying blob 8b638286c448 <span class="token keyword">done</span>  
Copying blob 20d88a7b893f <span class="token keyword">done</span>  
Copying blob 7193b0539042 <span class="token keyword">done</span>  
Copying blob 2e3ef0681087 <span class="token keyword">done</span>  
Copying blob c738739a1608 <span class="token keyword">done</span>  
Copying blob bac05865934b <span class="token keyword">done</span>  
Copying config bb75382891 <span class="token keyword">done</span>  
Writing manifest to image destination
Storing signatures
<span class="token number">2023</span>-02-03 <span class="token number">15</span>:16:25 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>pull.go:79<span class="token punctuation">]</span> bb75382891e7f04f192f1baeab18ef9c9f5503f4de8ac6dfc2a4d94f2164dde6

<span class="token number">2023</span>-02-03 <span class="token number">15</span>:16:25 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>run.go:229<span class="token punctuation">]</span> start to create new cluster with image: docker.io/sealerio/kubernetes:v1.22.15

<span class="token number">2023</span>-02-03 <span class="token number">15</span>:16:36 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>pull.go:79<span class="token punctuation">]</span> bb75382891e7f04f192f1baeab18ef9c9f5503f4de8ac6dfc2a4d94f2164dde6

copying files to <span class="token number">192.168</span>.71.134: <span class="token number">31</span>/31 
copying files to <span class="token number">192.168</span>.71.133: <span class="token number">31</span>/31 
+ <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>
+++ <span class="token function">dirname</span> /var/lib/sealer/data/my-cluster/rootfs/scripts/docker.sh
++ <span class="token builtin class-name">cd</span> /var/lib/sealer/data/my-cluster/rootfs/scripts
++ <span class="token builtin class-name">pwd</span>
+ <span class="token assign-left variable">scripts_path</span><span class="token operator">=</span>/var/lib/sealer/data/my-cluster/rootfs/scripts
+ <span class="token assign-left variable">image_dir</span><span class="token operator">=</span>/var/lib/sealer/data/my-cluster/rootfs/scripts/<span class="token punctuation">..</span>/images
+ <span class="token assign-left variable">DOCKER_VERSION</span><span class="token operator">=</span><span class="token number">19.03</span>.15
+ <span class="token assign-left variable">storage</span><span class="token operator">=</span>/var/lib/docker
+ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/lib/docker
+ utils_command_exists <span class="token function">docker</span>
+ <span class="token builtin class-name">command</span> <span class="token parameter variable">-v</span> <span class="token function">docker</span>
+ disable_selinux
+ <span class="token string">'['</span> <span class="token parameter variable">-s</span> /etc/selinux/config <span class="token string">']'</span>
+ systemctl daemon-reload
+ systemctl restart docker.service
+ check_docker_valid
+ <span class="token function">docker</span> info
Client:
 Context:    default
 Debug Mode: <span class="token boolean">false</span>
 Plugins:
  app: Docker App <span class="token punctuation">(</span>Docker Inc., v0.9.1-beta3<span class="token punctuation">)</span>
  buildx: Docker Buildx <span class="token punctuation">(</span>Docker Inc., v0.9.1-docker<span class="token punctuation">)</span>
  compose: Docker Compose <span class="token punctuation">(</span>Docker Inc., v2.14.1<span class="token punctuation">)</span>
  scan: Docker Scan <span class="token punctuation">(</span>Docker Inc., v0.23.0<span class="token punctuation">)</span>

Server:
 Containers: <span class="token number">34</span>
  Running: <span class="token number">0</span>
  Paused: <span class="token number">0</span>
  Stopped: <span class="token number">34</span>
 Images: <span class="token number">19</span>
 Server Version: <span class="token number">20.10</span>.22
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: <span class="token boolean">true</span>
  Native Overlay Diff: <span class="token boolean">true</span>
  userxattr: <span class="token boolean">false</span>
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: <span class="token number">1</span>
 Plugins:
  Volume: <span class="token builtin class-name">local</span>
  Network: bridge <span class="token function">host</span> ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file <span class="token builtin class-name">local</span> logentries splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 5b842e528e99d4d4c1686467debf2bd4b88ecd86
 runc version: v1.1.4-0-g5fd4c4d
 init version: de40ad0
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: <span class="token number">5.4</span>.0-137-generic
 Operating System: Ubuntu <span class="token number">20.04</span>.5 LTS
 OSType: linux
 Architecture: x86_64
 CPUs: <span class="token number">2</span>
 Total Memory: <span class="token number">3</span>.81GiB
 Name: cubmaster01
 ID: YROS:6C7Z:JISN:TGQP:AAGJ:JAOZ:A7XO:3LBP:YJWN:AQIR:TRPC:5ASC
 Docker Root Dir: /var/lib/docker
 Debug Mode: <span class="token boolean">false</span>
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: <span class="token boolean">false</span>
 Insecure Registries:
  <span class="token number">127.0</span>.0.0/8
 Live Restore Enabled: <span class="token boolean">false</span>

WARNING: No swap limit support
++ <span class="token function">docker</span> info <span class="token parameter variable">--format</span> <span class="token string">'{{json .ServerVersion}}'</span>
++ <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'"'</span>
+ <span class="token assign-left variable">dockerVersion</span><span class="token operator">=</span><span class="token number">20.10</span>.22
+ <span class="token string">'['</span> <span class="token number">20.10</span>.22 <span class="token string">'!='</span> <span class="token number">19.03</span>.15 <span class="token string">']'</span>
+ panic <span class="token string">'docker version is 20.10.22, should be 19.03.15, please check'</span>
/var/lib/sealer/data/my-cluster/rootfs/scripts/docker.sh: line <span class="token number">64</span>: panic: <span class="token builtin class-name">command</span> not found
<span class="token number">2023</span>-02-03 <span class="token number">15</span>:17:25 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> <span class="token punctuation">[</span>remove_container.go:66<span class="token punctuation">]</span> d400abc92de5308584e6a6e5b06a098698220124ec096b6bbeb3654c2e49bf28

Usage:
  sealer run <span class="token punctuation">[</span>flags<span class="token punctuation">]</span>

Examples:

run cluster by Clusterfile: 
  sealer run <span class="token parameter variable">-f</span> Clusterfile

run cluster by CLI flags:
  sealer run docker.io/sealerio/kubernetes:v1.22.15 <span class="token parameter variable">-m</span> <span class="token number">172.28</span>.80.01 <span class="token parameter variable">-n</span> <span class="token number">172.28</span>.80.02 <span class="token parameter variable">-p</span> Sealer123

run app image:
  sealer run localhost/nginx:v1


Flags:
  -f, <span class="token parameter variable">--Clusterfile</span> string   Clusterfile path to run a Kubernetes cluster
      <span class="token parameter variable">--apps</span> strings         override default AppNames of clusterimage
      <span class="token parameter variable">--cmds</span> strings         override default LaunchCmds of clusterimage
  -e, <span class="token parameter variable">--env</span> strings          <span class="token builtin class-name">set</span> custom environment variables
  -h, <span class="token parameter variable">--help</span>                 <span class="token builtin class-name">help</span> <span class="token keyword">for</span> run
  -m, <span class="token parameter variable">--masters</span> string       <span class="token builtin class-name">set</span> count or IPList to masters
      <span class="token parameter variable">--mode</span> string          load images to the specified registry <span class="token keyword">in</span> advance <span class="token punctuation">(</span>default <span class="token string">"apply"</span><span class="token punctuation">)</span>
  -n, <span class="token parameter variable">--nodes</span> string         <span class="token builtin class-name">set</span> count or IPList to nodes
  -p, <span class="token parameter variable">--passwd</span> string        <span class="token builtin class-name">set</span> cloud provider or baremetal server password
      <span class="token parameter variable">--pk</span> string            <span class="token builtin class-name">set</span> baremetal server private key <span class="token punctuation">(</span>default <span class="token string">"/root/.ssh/id_rsa"</span><span class="token punctuation">)</span>
      --pk-passwd string     <span class="token builtin class-name">set</span> baremetal server private key password
      <span class="token parameter variable">--port</span> uint16          <span class="token builtin class-name">set</span> the sshd <span class="token function">service</span> port number <span class="token keyword">for</span> the server <span class="token punctuation">(</span>default port: <span class="token number">22</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>default <span class="token number">22</span><span class="token punctuation">)</span>
  -u, <span class="token parameter variable">--user</span> string          <span class="token builtin class-name">set</span> baremetal server username <span class="token punctuation">(</span>default <span class="token string">"root"</span><span class="token punctuation">)</span>

Global Flags:
      <span class="token parameter variable">--color</span> string               <span class="token builtin class-name">set</span> the log color mode, the possible values can be <span class="token punctuation">[</span>never always<span class="token punctuation">]</span> <span class="token punctuation">(</span>default <span class="token string">"always"</span><span class="token punctuation">)</span>      <span class="token parameter variable">--config</span> string              config <span class="token function">file</span> of sealer tool <span class="token punctuation">(</span>default is <span class="token environment constant">$HOME</span>/.sealer.json<span class="token punctuation">)</span>
  -d, <span class="token parameter variable">--debug</span>                      turn on debug mode
      --hide-path                  hide the log path
      --hide-time                  hide the log <span class="token function">time</span>
      --log-to-file                <span class="token function">write</span> log message to disk
  -q, <span class="token parameter variable">--quiet</span>                      silence the usage when fail
      --remote-logger-url string   remote logger url, <span class="token keyword">if</span> not empty, will send log to this url
      --task-name string           task name <span class="token function">which</span> will embedded <span class="token keyword">in</span> the remote logger header, only valid when --remote-logger-url is <span class="token builtin class-name">set</span>

<span class="token number">2023</span>-02-03 <span class="token number">15</span>:17:25 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-unknown: failed to <span class="token function">install</span> docker: execute command<span class="token punctuation">(</span>bash /var/lib/sealer/data/my-cluster/rootfs/scripts/docker.sh <span class="token punctuation">)</span> on <span class="token function">host</span> <span class="token punctuation">(</span><span class="token number">192.168</span>.71.131<span class="token punctuation">)</span>: error<span class="token punctuation">(</span>failed to execute command<span class="token punctuation">(</span>bash /var/lib/sealer/data/my-cluster/rootfs/scripts/docker.sh <span class="token punctuation">)</span> on host<span class="token punctuation">(</span><span class="token number">192.168</span>.71.131<span class="token punctuation">)</span>: error<span class="token punctuation">(</span>exit status <span class="token number">127</span><span class="token punctuation">))</span>

root@cubmaster01:~/workspces<span class="token comment"># sealer images</span>
REPOSITORY                           TAG        IMAGE ID       CREATED        SIZE
docker.io/sealerio/kubernetes        v1.22.15   bb75382891e7   <span class="token number">4</span> weeks ago    <span class="token number">963</span> MB
docker.io/fanux/ingress-nginx        v1.2.0     d32b3c0b33a8   <span class="token number">2</span> months ago   <span class="token number">58.6</span> KB
localhost/3293172751/ingress-nginx   v1.2.0     d32b3c0b33a8   <span class="token number">2</span> months ago   <span class="token number">58.6</span> KB
root@cubmaster01:~/workspces<span class="token comment"># kubectl get node</span>
The connection to the server <span class="token number">127.0</span>.0.1:6443 was refused - did you specify the right <span class="token function">host</span> or port?
root@cubmaster01:~/workspces<span class="token comment"># </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>é‡åˆ°çš„é—®é¢˜ï¼Œdockerç‰ˆæœ¬ä¸ç¬¦åˆ</strong></p>
<p>ä¹Ÿæœ‰å…¶ä»–çš„é—®é¢˜ï¼Œå…¶ä»–èŠ‚ç‚¹ä¸å¤Ÿå¹²å‡€ï¼Œdockerç‰ˆæœ¬ä¸ç¬¦åˆï¼Œè¿˜æœ‰dockeræ‰€æœ‰æƒé—®é¢˜ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> root:docker /var/run/docker.sock
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Ubuntu 22.04 æ˜¯æˆ‘çš„æ“ä½œç³»ç»Ÿã€‚åœ¨è¿›è¡Œå¹¿æ³›ç ”ç©¶å¹¶æµè§ˆå¤§é‡ç½‘ç«™åï¼Œæˆ‘å‘ç°ä»¥é root ç”¨æˆ·èº«ä»½è¿è¡Œ Docker ä¼šåˆ›å»ºä¸åŒçš„ä¸Šä¸‹æ–‡ã€‚ä½¿ç”¨ä¸‹é¢åˆ—å‡ºçš„å‘½ä»¤è§£å†³äº†æˆ‘çš„é—®é¢˜ã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>docker context ls 
docker context use default 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”¨æˆ·å¯èƒ½æ²¡æœ‰ä¸ docker å®ˆæŠ¤è¿›ç¨‹é€šä¿¡çš„è®¿é—®æƒé™</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>
<span class="token number">2023</span>-02-04 08:51:00 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-unknown: failed to init master0: failed to execute command<span class="token punctuation">(</span>kubeadm init <span class="token parameter variable">--config</span><span class="token operator">=</span>/etc/kubernetes/kubeadm.yaml --upload-certs <span class="token parameter variable">-v</span> <span class="token number">0</span> --ignore-preflight-errors<span class="token operator">=</span>SystemVerification,Port-10250,DirAvailable--etc-kubernetes-manifests<span class="token punctuation">)</span> on host<span class="token punctuation">(</span><span class="token number">192.168</span>.71.131<span class="token punctuation">)</span>: error<span class="token punctuation">(</span>W0204 08:50:55.248878   <span class="token number">36042</span> strict.go:55<span class="token punctuation">]</span> error unmarshaling configuration schema.GroupVersionKind<span class="token punctuation">{</span>Group:<span class="token string">"kubelet.config.k8s.io"</span>, Version:<span class="token string">"v1beta1"</span>, Kind:<span class="token string">"KubeletConfiguration"</span><span class="token punctuation">}</span>: error unmarshaling JSON: <span class="token keyword">while</span> decoding JSON: json: unknown field <span class="token string">"flushFrequency"</span>
        <span class="token punctuation">[</span>WARNING FileExisting-socat<span class="token punctuation">]</span>: socat not found <span class="token keyword">in</span> system path
        <span class="token punctuation">[</span>WARNING Port-10250<span class="token punctuation">]</span>: Port <span class="token number">10250</span> is <span class="token keyword">in</span> use
error execution phase preflight: <span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Some fatal errors occurred:
        <span class="token punctuation">[</span>ERROR Port-6443<span class="token punctuation">]</span>: Port <span class="token number">6443</span> is <span class="token keyword">in</span> use
        <span class="token punctuation">[</span>ERROR Port-10259<span class="token punctuation">]</span>: Port <span class="token number">10259</span> is <span class="token keyword">in</span> use
        <span class="token punctuation">[</span>ERROR Port-10257<span class="token punctuation">]</span>: Port <span class="token number">10257</span> is <span class="token keyword">in</span> use
        <span class="token punctuation">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-apiserver.yaml<span class="token punctuation">]</span>: /etc/kubernetes/manifests/kube-apiserver.yaml already exists
        <span class="token punctuation">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-controller-manager.yaml<span class="token punctuation">]</span>: /etc/kubernetes/manifests/kube-controller-manager.yaml already exists
        <span class="token punctuation">[</span>ERROR FileAvailable--etc-kubernetes-manifests-kube-scheduler.yaml<span class="token punctuation">]</span>: /etc/kubernetes/manifests/kube-scheduler.yaml already exists
        <span class="token punctuation">[</span>ERROR FileAvailable--etc-kubernetes-manifests-etcd.yaml<span class="token punctuation">]</span>: /etc/kubernetes/manifests/etcd.yaml already exists
        <span class="token punctuation">[</span>ERROR Port-2379<span class="token punctuation">]</span>: Port <span class="token number">2379</span> is <span class="token keyword">in</span> use
        <span class="token punctuation">[</span>ERROR Port-2380<span class="token punctuation">]</span>: Port <span class="token number">2380</span> is <span class="token keyword">in</span> use
        <span class="token punctuation">[</span>ERROR DirAvailable--var-lib-etcd<span class="token punctuation">]</span>: /var/lib/etcd is not empty
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> If you know what you are doing, you can <span class="token function">make</span> a check non-fatal with <span class="token variable"><span class="token variable">`</span>--ignore-preflight-errors<span class="token operator">=</span><span class="token punctuation">..</span>.<span class="token variable">`</span></span>
To see the stack trace of this error execute with <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">5</span> or higher
<span class="token punctuation">)</span>. Please clean and reinstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¸…ç†é›†ç¾¤ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealer delete <span class="token parameter variable">-a</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="rootless" tabindex="-1"><a class="header-anchor" href="#rootless" aria-hidden="true">#</a> rootless</h2>
<p><strong>ä¸»æœºï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>192.168.71.130 node01
192.168.71.134 node02
192.168.71.133 master01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¿è¡Œï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealer run docker.io/sealerio/kubernetes:v1.22.15   <span class="token parameter variable">--masters</span> <span class="token number">192.168</span>.71.133   <span class="token parameter variable">--nodes</span> <span class="token number">192.168</span>.71.130,192.168.71.134 <span class="token parameter variable">--passwd</span> <span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>é‡åˆ°çš„é—®é¢˜ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token number">2023</span>-02-04 <span class="token number">11</span>:58:21 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-unknown: <span class="token function">open</span> /etc/containers/policy.json: permission denied
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>root.goï¼š75 context</strong></p>
<p>Execute å°†æ‰€æœ‰å­å‘½ä»¤æ·»åŠ åˆ°rootå‘½ä»¤å¹¶é€‚å½“è®¾ç½®æ ‡å¿—ã€‚ä¼šè¢« main.main() è°ƒç”¨ä¸€æ¬¡ã€‚</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token comment">// rootCmd represents the base command when called without any subcommands</span>
<span class="token keyword">var</span> rootCmd <span class="token operator">=</span> <span class="token operator">&amp;</span>cobra<span class="token punctuation">.</span>Command<span class="token punctuation">{</span>
	Use<span class="token punctuation">:</span>           <span class="token string">"sealer"</span><span class="token punctuation">,</span>
	Short<span class="token punctuation">:</span>         <span class="token string">"A tool to build, share and run any distributed applications."</span><span class="token punctuation">,</span>
	Long<span class="token punctuation">:</span>          longRootCmdDescription<span class="token punctuation">,</span>
	SilenceUsage<span class="token punctuation">:</span>  <span class="token boolean">true</span><span class="token punctuation">,</span>
	SilenceErrors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// Execute adds all child commands to the root command and sets flags appropriately.</span>
<span class="token comment">// This is called by main.main(). It only needs to happen once to the rootCmd.</span>
<span class="token keyword">func</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> err <span class="token operator">:=</span> rootCmd<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		logrus<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"sealer-%s: %v"</span><span class="token punctuation">,</span> version<span class="token punctuation">.</span><span class="token function">GetSingleVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>rootCmd</code> æ˜¯ä¸€ä¸ª cobra åº”ç”¨ç¨‹åºçš„æ ¹å‘½ä»¤ï¼Œå®ƒä»£è¡¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„å‘½ä»¤è¡Œç•Œé¢ã€‚è°ƒç”¨ <code v-pre>rootCmd.Execute()</code> å‡½æ•°å°†æ‰§è¡Œæ•´ä¸ªå‘½ä»¤è¡Œç¨‹åºï¼Œå¹¶æ‰§è¡Œå…¶ä¸­å®šä¹‰çš„å‘½ä»¤å’Œå­å‘½ä»¤ã€‚</p>
<h3 id="å®‰è£…æ—¶å€™æ²¡æœ‰æƒé™æ‰“å¼€ç›®å½•" tabindex="-1"><a class="header-anchor" href="#å®‰è£…æ—¶å€™æ²¡æœ‰æƒé™æ‰“å¼€ç›®å½•" aria-hidden="true">#</a> å®‰è£…æ—¶å€™æ²¡æœ‰æƒé™æ‰“å¼€ç›®å½•</h3>
<p><strong>æ²¡æœ‰æƒé™ï¼Œæˆ‘å°±ç”¨æƒé™æ‰“å¼€ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="ç›®å½•" tabindex="-1"><a class="header-anchor" href="#ç›®å½•" aria-hidden="true">#</a> ç›®å½•</h3>
<table>
<thead>
<tr>
<th style="text-align:center">æ–‡ä»¶</th>
<th style="text-align:center">ç›®çš„</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code v-pre>/etc/shadow</code></td>
<td style="text-align:center">ä¿æŠ¤ç”¨æˆ·å¸æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center"><code v-pre>/etc/passwd</code></td>
<td style="text-align:center">ç”¨æˆ·è´¦æˆ·ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center"><code v-pre>/etc/gshadow</code></td>
<td style="text-align:center">åŒ…å«ç»„å¸æˆ·çš„é˜´å½±ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center"><code v-pre>/etc/group</code></td>
<td style="text-align:center">å®šä¹‰ç”¨æˆ·æ‰€å±çš„ç»„</td>
</tr>
</tbody>
</table>
<h3 id="sudo" tabindex="-1"><a class="header-anchor" href="#sudo" aria-hidden="true">#</a> sudo</h3>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>test@cubmaster01:/var/lib/dpkg$ <span class="token function">sudo</span> sealer run docker.io/sealerio/kubernetes:v1.22.15   <span class="token parameter variable">--masters</span> <span class="token number">192.168</span>.71.133   <span class="token parameter variable">--nodes</span> <span class="token number">192.168</span>.71.130,192.168.71.134 <span class="token parameter variable">--passwd</span> <span class="token number">123456</span>
<span class="token punctuation">[</span>sudo<span class="token punctuation">]</span> password <span class="token keyword">for</span> test: 
<span class="token builtin class-name">test</span> is not <span class="token keyword">in</span> the sudoers file.  This incident will be reported.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¼–è¾‘sudoersæ–‡ä»¶ï¼š</strong></p>
<p>å³æ‰§è¡Œï¼š<code v-pre>vi /etc/sudoers</code></p>
<p>æ‰¾åˆ°è¿™è¡Œ root ALL=(ALL) ALL,åœ¨ä»–ä¸‹é¢æ·»åŠ xxx ALL=(ALL) ALL (è¿™é‡Œçš„xxxæ˜¯ä½ çš„ç”¨æˆ·å)</p>
<p>psï¼šè¿™é‡Œè¯´ä¸‹ä½ å¯ä»¥sudoersæ·»åŠ ä¸‹é¢å››è¡Œä¸­ä»»æ„ä¸€æ¡</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>youuser <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
%youuser <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> ALL
youuser <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
%youuser <span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span> NOPASSWD: ALL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol>
<li>ç¬¬ä¸€è¡Œ:å…è®¸ç”¨æˆ·youuseræ‰§è¡Œsudoå‘½ä»¤(éœ€è¦è¾“å…¥å¯†ç ).</li>
<li>ç¬¬äºŒè¡Œ:å…è®¸ç”¨æˆ·ç»„youuseré‡Œé¢çš„ç”¨æˆ·æ‰§è¡Œsudoå‘½ä»¤(éœ€è¦è¾“å…¥å¯†ç ).</li>
<li>ç¬¬ä¸‰è¡Œ:å…è®¸ç”¨æˆ·youuseræ‰§è¡Œsudoå‘½ä»¤,å¹¶ä¸”åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸è¾“å…¥å¯†ç .</li>
<li>ç¬¬å››è¡Œ:å…è®¸ç”¨æˆ·ç»„youuseré‡Œé¢çš„ç”¨æˆ·æ‰§è¡Œsudoå‘½ä»¤,å¹¶ä¸”åœ¨æ‰§è¡Œçš„æ—¶å€™ä¸è¾“å…¥å¯†ç .</li>
</ol>
<p><strong>passwd æ–‡ä»¶</strong></p>
<p>æœ¬åœ°ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åœ¨çº¯æ–‡æœ¬<code v-pre>/etc/passwd</code>æ–‡ä»¶ä¸­ï¼šå®ƒçš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªç”¨æˆ·å¸æˆ·ï¼Œå¹¶ä¸”æœ‰ä¸ƒä¸ªç”±å†’å·åˆ†éš”çš„å­—æ®µã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>å¸æˆ·ï¼šå¯†ç ï¼šUIDï¼šGIDï¼šGECOSï¼šç›®å½•ï¼šshell
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨å“ªé‡Œï¼š</p>
<ul>
<li>
<p><code v-pre>*account*</code>æ˜¯ç”¨æˆ·åã€‚æ­¤å­—æ®µä¸èƒ½ä¸ºç©ºã€‚æ ‡å‡† *NIX å‘½åè§„åˆ™é€‚ç”¨ã€‚</p>
</li>
<li>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ˜¯ç”¨æˆ·å¯†ç ã€‚</p>
<p><strong>è­¦å‘Šï¼š<strong>è¯¥<code v-pre>passwd</code>æ–‡ä»¶æ˜¯å…¨çƒå¯è¯»çš„ï¼Œå› æ­¤åœ¨æ­¤æ–‡ä»¶ä¸­å­˜å‚¨å¯†ç ï¼ˆæ•£åˆ—æˆ–å…¶ä»–æ–¹å¼ï¼‰æ˜¯ä¸å®‰å…¨çš„ã€‚ç›¸åï¼ŒArch Linux ä½¿ç”¨<a href="https://wiki.archlinux.org/title/Security#Password_hashes" target="_blank" rel="noopener noreferrer">é˜´å½±å¯†ç <ExternalLinkIcon/></a>ï¼šè¯¥<code v-pre>password</code>å­—æ®µå°†åŒ…å«ä¸€ä¸ªå ä½ç¬¦å­—ç¬¦ ( <code v-pre>x</code>)ï¼Œè¡¨ç¤ºå“ˆå¸Œå¯†ç ä¿å­˜åœ¨è®¿é—®å—é™æ–‡ä»¶<code v-pre>/etc/shadow</code>ä¸­ã€‚å› æ­¤ï¼Œå»ºè®®å§‹ç»ˆä½¿ç”¨</strong>passwd</strong>å‘½ä»¤æ›´æ”¹å¯†ç ã€‚</p>
</li>
<li>
<p><code v-pre>*UID*</code>æ˜¯æ•°å­—ç”¨æˆ· IDã€‚åœ¨ Arch ä¸­ï¼Œä¸æœåŠ¡ç›¸å¯¹çš„æ‰€è°“æ™®é€šç”¨æˆ·çš„ç¬¬ä¸€ä¸ªç™»å½•åï¼ˆåœ¨ root ä¹‹åï¼‰é»˜è®¤ä¸º UID 1000ï¼›ç”¨æˆ·çš„åç»­ UID æ¡ç›®åº”å¤§äº 1000ã€‚</p>
</li>
<li>
<p><code v-pre>*GID*</code>æ˜¯ç”¨æˆ·çš„æ•°å­—ä¸»è¦ç»„ IDã€‚GID çš„æ•°å€¼åˆ—åœ¨<a href="https://wiki.archlinux.org/title/users_and_groups#Group_management" target="_blank" rel="noopener noreferrer">/etc/group<ExternalLinkIcon/></a>ä¸­ã€‚</p>
</li>
<li>
<p><code v-pre>*GECOS*</code>æ˜¯ç”¨äºä¿¡æ¯ç›®çš„çš„å¯é€‰å­—æ®µï¼›é€šå¸¸å®ƒåŒ…å«å®Œæ•´çš„ç”¨æˆ·åï¼Œä½†å®ƒä¹Ÿå¯ä»¥ç”±<em>finger</em>ç­‰æœåŠ¡ä½¿ç”¨ï¼Œå¹¶é€šè¿‡<a href="https://wiki.archlinux.org/title/users_and_groups#Other_examples_of_user_management" target="_blank" rel="noopener noreferrer">chfn<ExternalLinkIcon/></a>å‘½ä»¤è¿›è¡Œç®¡ç†ã€‚æ­¤å­—æ®µæ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ç•™ç©ºã€‚</p>
</li>
<li>
<p><code v-pre>*directory*</code>ç”±ç™»å½•å‘½ä»¤ç”¨æ¥è®¾ç½®<code v-pre>$HOME</code>ç¯å¢ƒå˜é‡ã€‚å‡ ä¸ªæœåŠ¡ç”¨è‡ªå·±çš„ç”¨æˆ·ä½¿ç”¨<code v-pre>/</code>ï¼Œä½†æ™®é€šç”¨æˆ·ä¸€èˆ¬éƒ½è®¾ç½®åœ¨ä¸€ä¸ªç›®å½•ä¸‹<code v-pre>/home</code>ã€‚</p>
</li>
<li>
<p><code v-pre>*shell*</code>æ˜¯ç”¨æˆ·é»˜è®¤<a href="https://wiki.archlinux.org/title/Command_shell" target="_blank" rel="noopener noreferrer">å‘½ä»¤ shell<ExternalLinkIcon/></a>çš„è·¯å¾„ã€‚è¯¥å­—æ®µæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º<code v-pre>/bin/bash</code>ã€‚</p>
</li>
</ul>
<h2 id="myidea" tabindex="-1"><a class="header-anchor" href="#myidea" aria-hidden="true">#</a> myidea</h2>
<p>åˆ›å»ºä¸€ä¸ªåä¸º sealer çš„ç»„å‘å…¶ä¸­æ·»åŠ ç”¨æˆ·ã€‚ å½“ sealer å®ˆæŠ¤è¿›ç¨‹(docker daemon)å¯åŠ¨æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå¯ç”± sealer ç»„æˆå‘˜è®¿é—®çš„ <code v-pre>Unix</code> å¥—æ¥å­—(Unix socket)ã€‚</p>
<p><strong>Warning</strong> : <code v-pre>docker</code>ç»„æ‹¥æœ‰å’Œæ ¹ç”¨æˆ·ï¼ˆroot userï¼‰åŒç­‰æƒé™ã€‚</p>
<p><strong>kkçš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><a href="https://sourcegraph.com/github.com/kubesphere/kubekey@1f3d7c6f05b84802d5f68bdb0032edd102a5a515/-/blob/pkg/kubernetes/tasks.go" target="_blank" rel="noopener noreferrer">https://sourcegraph.com/github.com/kubesphere/kubekey@1f3d7c6f05b84802d5f68bdb0032edd102a5a515/-/blob/pkg/kubernetes/tasks.go<ExternalLinkIcon/></a></li>
</ul>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SyncKubeConfigToWorker<span class="token punctuation">)</span> <span class="token function">Execute</span><span class="token punctuation">(</span>runtime connector<span class="token punctuation">.</span>Runtime<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> s<span class="token punctuation">.</span>PipelineCache<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>common<span class="token punctuation">.</span>ClusterStatus<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
		cluster <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token operator">*</span>KubernetesStatus<span class="token punctuation">)</span>
		createConfigDirCmd <span class="token operator">:=</span> <span class="token string">"mkdir -p /root/.kube"</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SudoCmd</span><span class="token punctuation">(</span>createConfigDirCmd<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"create .kube dir failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		syncKubeConfigForRootCmd <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"echo '%s' > %s"</span><span class="token punctuation">,</span> cluster<span class="token punctuation">.</span>KubeConfig<span class="token punctuation">,</span> <span class="token string">"/root/.kube/config"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SudoCmd</span><span class="token punctuation">(</span>syncKubeConfigForRootCmd<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"sync kube config for root failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		userConfigDirCmd <span class="token operator">:=</span> <span class="token string">"mkdir -p $HOME/.kube"</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span>userConfigDirCmd<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"user mkdir $HOME/.kube failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		syncKubeConfigForUserCmd <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"echo '%s' > %s"</span><span class="token punctuation">,</span> cluster<span class="token punctuation">.</span>KubeConfig<span class="token punctuation">,</span> <span class="token string">"$HOME/.kube/config"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span>syncKubeConfigForUserCmd<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"sync kube config for normal user failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		chownKubeConfig <span class="token operator">:=</span> <span class="token string">"chown -R (idâˆ’u):(id -g) -R $HOME/.kube"</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span>chownKubeConfig<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		userId<span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token string">"echo $(id -u)"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"get user id failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		userGroupId<span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Cmd</span><span class="token punctuation">(</span><span class="token string">"echo $(id -g)"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"get user group id failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

		chownKubeConfig <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"chown -R %s:%s -R $HOME/.kube"</span><span class="token punctuation">,</span> userId<span class="token punctuation">,</span> userGroupId<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> runtime<span class="token punctuation">.</span><span class="token function">GetRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SudoCmd</span><span class="token punctuation">(</span>chownKubeConfig<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">Wrap</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span><span class="token function">WithStack</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"chown user kube config failed"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>é’ˆå¯¹é—®é¢˜ï¼šsealer version çš„ç‰ˆæœ¬å·é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</p>
</blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>chown -R ç”¨æˆ·å:ç”¨æˆ·ç»„  ç›®å½• 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ä¿®æ”¹ç”¨æˆ·ï¼Œä½¿å…¶å±äºrootç»„ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># ç„¶åä¿®æ”¹ç”¨æˆ·ï¼Œä½¿å…¶å±äºrootç»„ï¼ˆwheelï¼‰ï¼Œå‘½ä»¤å¦‚ä¸‹:</span>
 <span class="token function">usermod</span> <span class="token parameter variable">-g</span> root <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://sm.nsddd.top/sm202302051127027.png" alt="image-20230205112748803"></p>
<p>æˆ‘çš„æ€è·¯æ˜¯å®‰è£… sealer  çš„</p>
<h3 id="sealer-ç»„" tabindex="-1"><a class="header-anchor" href="#sealer-ç»„" aria-hidden="true">#</a> sealer ç»„</h3>
<p>Docker è®¾å®šä¸€ä¸ª docker ç»„æ˜¯ä¸ºäº†æä¾›ä¸€ç§ç®€ä¾¿çš„æ–¹æ³•æ¥æ§åˆ¶å¯¹ Docker çš„è®¿é—®ã€‚</p>
<p>é€šå¸¸ï¼Œä½¿ç”¨ Docker éœ€è¦ root æƒé™ã€‚ä½†æ˜¯ï¼Œå¼€æ”¾ root æƒé™å¸¦æ¥çš„å®‰å…¨é£é™©å¾ˆå¤§ï¼Œå› æ­¤ Docker å¼•å…¥äº†ä¸€ä¸ª docker ç»„æ¥æé«˜å®‰å…¨æ€§ã€‚</p>
<p>è¿™æ„å‘³ç€ï¼Œåªæœ‰åŠ å…¥ docker ç»„çš„ç”¨æˆ·æ‰èƒ½å¤Ÿä½¿ç”¨ Dockerã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ä¸­ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>sudo usermod -aG docker $USER
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol>
<li>
<p>åˆ›å»º Sealer ç»„ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸º Sealer çš„ç»„ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>sudo groupadd Sealer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>æ·»åŠ ç”¨æˆ·ï¼šå°†æ‰€æœ‰å¸Œæœ›å…·æœ‰è®¿é—® Kubernetes é›†ç¾¤å’Œé•œåƒçš„ç”¨æˆ·æ·»åŠ åˆ° Sealer ç»„ä¸­ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ ç”¨æˆ·ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>sudo usermod -aG Sealer &lt;username>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>è®¾ç½®ç›®å½•è®¿é—®æƒé™ï¼šå°† Kubernetes é›†ç¾¤å’Œé•œåƒçš„ç›®å½•çš„è®¿é—®æƒé™è®¾ç½®ä¸º Sealer ç»„ï¼Œä»¥ä¾¿ Sealer ç»„ä¸­çš„ç”¨æˆ·å¯ä»¥è®¿é—®ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ç›®å½•è®¿é—®æƒé™ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> :Sealer <span class="token operator">&lt;</span>directory<span class="token operator">></span>
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> g+rwx <span class="token operator">&lt;</span>directory<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å…¶ä¸­ <code v-pre>&lt;directory&gt;</code> æ˜¯è¦è®¿é—®çš„ç›®å½•ï¼Œ<code v-pre>&lt;username&gt;</code> æ˜¯è¦æ·»åŠ åˆ° Sealer ç»„ä¸­çš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚</p>
</li>
</ol>
<p>å¦‚æœç³»ç»Ÿç”¨æˆ·éœ€è¦ç‰¹å®šçš„ç”¨æˆ·å’Œç»„ IDï¼Œè¯·åœ¨åˆ›å»ºç”¨æˆ·æ—¶ ä½¿ç”¨<code v-pre>-u</code>/<code v-pre>--uid</code>å’Œ<code v-pre>-g</code>/é€‰é¡¹æŒ‡å®šå®ƒä»¬ï¼š<code v-pre>--gid</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment"># useradd -r -u 850 -g 850 -s /usr/bin/nologin ç”¨æˆ·å</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="æ–°æœåŠ¡å™¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æ–°æœåŠ¡å™¨æµ‹è¯•" aria-hidden="true">#</a> æ–°æœåŠ¡å™¨æµ‹è¯•</h2>
<blockquote>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">wget</span> https://github.com/sealerio/sealer/releases/download/v0.9.0/sealer-v0.9.0-linux-amd64.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
<span class="token function">tar</span> zxvf sealer-v0.9.0-linux-amd64.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">mv</span> sealer /usr/bin <span class="token punctuation">;</span> sealer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>
<p><strong>bugï¼šå•èŠ‚ç‚¹ä¹Ÿéœ€è¦IPé—®é¢˜</strong></p>
<p>å•èŠ‚ç‚¹å®‰è£…æé†’ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment">#sudo sealer run docker.io/sealerio/kubernetes:v1.22.15 </span>
<span class="token number">2023</span>-02-05 <span class="token number">16</span>:32:44 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-v0.9.0: you must input master <span class="token function">ip</span> Or use Clusterfile

<span class="token comment">#sudo sealer run docker.io/sealerio/kubernetes:v1.22.15 --masters 10.160.25.43</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>rootç”¨æˆ·å®‰è£…å•èŠ‚ç‚¹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealer run docker.io/sealerio/kubernetes:v1.22.15 <span class="token parameter variable">--masters</span> <span class="token number">10.160</span>.25.43
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>EERORï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token number">2023</span>-02-05 <span class="token number">16</span>:51:36 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-v0.9.0: failed to execute command<span class="token punctuation">(</span>RegistryDomain<span class="token operator">=</span><span class="token string">"sea.hub"</span> <span class="token assign-left variable">RegistryPort</span><span class="token operator">=</span><span class="token string">"5000"</span> <span class="token assign-left variable">RegistryURL</span><span class="token operator">=</span><span class="token string">"sea.hub:5000"</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /var/lib/sealer/data/my-cluster/rootfs/scripts <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> init-registry.sh <span class="token number">5000</span> /var/lib/sealer/data/my-cluster/rootfs/registry sea.hub<span class="token punctuation">)</span> on host<span class="token punctuation">(</span><span class="token number">10.160</span>.25.43<span class="token punctuation">)</span>: error<span class="token punctuation">(</span>exit status <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></blockquote>
<p><strong>ç»™ç›®å½•å’Œç”¨æˆ·æƒé™åï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token number">2023</span>-02-05 <span class="token number">21</span>:19:02 <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> <span class="token punctuation">[</span>root.go:75<span class="token punctuation">]</span> sealer-v0.9.0: cannot <span class="token function">mount</span> using driver overlay <span class="token keyword">in</span> rootless mode. You need to run it <span class="token keyword">in</span> a <span class="token variable"><span class="token variable">`</span>buildah unshare<span class="token variable">`</span></span> session
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è¯·ç»™å…¥æƒé™ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token string">"sealer ALL=(ALL) ALL"</span> <span class="token operator">>></span> /etc/sudoers 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ssh:</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code> sudo cat >> /etc/hosts &lt;&lt;EOF            
10.0.0.235 master01
10.0.0.236 node01
10.0.0.237 node02
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>sealerä¸‰å°æœåŠ¡å™¨æµ‹è¯•ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealer run docker.io/sealerio/kubernetes:v1.22.15 <span class="token punctuation">\</span>
  <span class="token parameter variable">--masters</span> <span class="token number">10.0</span>.0.235 <span class="token punctuation">\</span>
  <span class="token parameter variable">--nodes</span> <span class="token number">10.0</span>.0.236 <span class="token number">10.0</span>.0.237 <span class="token parameter variable">--passwd</span> Sealer.io@123
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>errorï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>2023-02-07 20:08:47 [ERROR] [root.go:75] sealer-v0.9.0: [ssh][110.0.0.236] failed to create ssh session: dial tcp 110.0.0.236:22: i/o timeout
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></blockquote>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '21.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '23.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


