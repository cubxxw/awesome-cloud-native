<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬2èŠ‚-ä½¿ç”¨-sealos-æ­å»º-k8s-helmå­¦ä¹ " tabindex="-1"><a class="header-anchor" href="#ç¬¬2èŠ‚-ä½¿ç”¨-sealos-æ­å»º-k8s-helmå­¦ä¹ " aria-hidden="true">#</a> ç¬¬2èŠ‚ ä½¿ç”¨ sealos æ­å»º k8sï¼Œhelmå­¦ä¹ </h1>
<br>
<div><a href = '1.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '3.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•è®°å½•<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">sealos<ExternalLinkIcon/></a>å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ <ExternalLinkIcon/></a>ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="å…³äºsealosæ­å»ºk8s" tabindex="-1"><a class="header-anchor" href="#å…³äºsealosæ­å»ºk8s" aria-hidden="true">#</a> å…³äºsealosæ­å»ºk8s</h2>
<ul>
<li>[x] <a href="https://docker.nsddd.top/Cloud-Native-k8s/6.html" target="_blank" rel="noopener noreferrer">æ–‡æ¡£åœ°å€<ExternalLinkIcon/></a></li>
</ul>
<h2 id="å…³äºsealos" tabindex="-1"><a class="header-anchor" href="#å…³äºsealos" aria-hidden="true">#</a> å…³äºsealos</h2>
<p><img src="http://sm.nsddd.top/smimage-20221023205145184.png" alt="image-20221023205145184"></p>
<div class="custom-container tip"><p class="custom-container-title">sealoså°±æ˜¯ï¼Ÿ</p>
<p>sealos æ˜¯ç”¨æ¥ç®¡ç†æ•°æ®ä¸­å¿ƒæ‰€æœ‰æœºå™¨çš„äº‘æ“ä½œç³»ç»Ÿï¼Œkubernetes å°±æ˜¯è¿™ä¸ªæ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œsealosä¸Š é¢ä¼šè·‘å„ç§å„æ ·çš„åˆ†å¸ƒå¼åº”ç”¨ã€‚</p>
<ul>
<li>æ—©æœŸå•æœºæ“ä½œç³»ç»Ÿä¹Ÿæ˜¯åˆ†å±‚æ¶æ„ï¼Œåé¢æ‰æ¼”åŒ–æˆä»Šå¤©çš„å®å†…æ ¸å¾®å†…æ ¸æ¶æ„ï¼Œäº‘æ“ä½œç³»ç»Ÿä¹Ÿä¸€å®šä¼šæœ‰ç±»ä¼¼å‘å±•è¶‹åŠ¿ã€‚</li>
<li>ä»¥å‰éƒ½æ˜¯å•æœºåº”ç”¨ï¼Œè€Œç°ä»£åº”ç”¨å‡ ä¹éƒ½æ˜¯åˆ†å¸ƒå¼åº”ç”¨ï¼Œkubernetes å·²ç»æˆä¸ºäº‹å®ä¸Šçš„â€œäº‘æ“ä½œç³»ç»Ÿå†…æ ¸â€ï¼Œèƒ½è®©å†…æ ¸æ™®åŠçš„å‘å‹ç‰ˆå‘¼ä¹‹æ¬²å‡ºã€‚</li>
<li>sealos æŠ›å¼ƒäº† IaaS, åŸºäºäº‘å†…æ ¸çš„é«˜å†…èšè®¾è®¡ï¼Œå†³å®šäº† sealos å¯ä»¥è®©äº‘æ›´ç®€å•ï¼Œæ›´ä¾¿å®œï¼Œä»è€Œåƒ linux å‘è¡Œç‰ˆä¸€æ ·æ™®åŠã€‚</li>
</ul>
</div>
<h2 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> è§£å†³æ–¹æ¡ˆ</h2>
<p><img src="http://sm.nsddd.top/smimage-20221023205623196.png" alt="image-20221023205623196"></p>
<blockquote>
<p>æä¾›ä¸€ä¸ªå¼€æºå¼€æ”¾çš„äº‘æ“ä½œç³»ç»Ÿï¼Œåˆ©ç”¨äº‘åŸç”Ÿçš„èƒ½åŠ›åšä¸€ä¸ªç›®å‰äº‘å‚å•†çš„å¯æ›¿ä»£å“</p>
</blockquote>
<ul>
<li>å¼€æº sealosï¼Œæä¾›å‡ºä¸€ä¸ªæŠ½è±¡çš„äº‘æ“ä½œç³»ç»Ÿï¼Œä¸€åˆ‡çš†åº”ç”¨çš„è®¾è®¡ç†å¿µã€‚</li>
<li>sealos cloud - ç¯ç•Œè‡ªå·±è¿è¡Œçš„ sealos å…¬æœ‰äº‘ç‰ˆæœ¬ï¼ŒæœåŠ¡èƒ½åŠ›å¯¹æ ‡ aws é˜¿é‡Œäº‘ç­‰å…¬æœ‰äº‘</li>
<li>ç”¨æˆ·è‡ªç”±ä¸‹è½½ç¤¾åŒºç‰ˆæˆ–å•†ä¸šç‰ˆæœ¬ sealosï¼Œåœ¨ä»»æ„åœ°æ–¹å¯åŠ¨ä¸€ä¸ªå±äºè‡ªå·±çš„ <code v-pre>sealos cloud</code></li>
</ul>
<blockquote>
<p>åˆ†å¸ƒå¼åº”ç”¨ç”Ÿæ€æ„å»º</p>
</blockquote>
<ul>
<li>å¹¿åº¦ï¼Œå¸¸ç”¨åˆ†å¸ƒå¼è½¯ä»¶å¦‚ <code v-pre>mysql</code> é›†ç¾¤ï¼Œ<code v-pre>redis</code> é›†ç¾¤ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰é€æ­¥è¦†ç›–ï¼Œä¸æ–­æ‰©å±•å¸¸ç”¨åˆ†å¸ƒå¼åº”ç”¨æ•°é‡</li>
<li>æ·±åº¦ï¼Œ<code v-pre>åŸºæœ¬å®‰è£… -&gt; é«˜å¯ç”¨ -&gt; å¯ç›‘æ§ -&gt; è‡ªè¿ç»´ -&gt; é«˜æ€§èƒ½ / å®‰å…¨æ€§ -&gt; GUIç®¡æ§</code>ï¼Œå…­ä¸ªé˜¶æ®µè¡¡é‡ä¸€ä¸ªåˆ†å¸ƒå¼åº”ç”¨æˆç†Ÿåº¦</li>
</ul>
<p>åº”ç”¨åŒ…å«ä¸‰ä¸ªæ¥æºï¼šç¯ç•Œè‡ªç ”åº”ç”¨å¦‚å‡½æ•°è®¡ç®—ï¼Œå¼€æºäºŒæ¬¡å°è£…åº”ç”¨ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨å¦‚ä¸è®¯é£åˆä½œçš„ AI èƒ½åŠ›åº”ç”¨ä¸ <code v-pre>sealos</code> ç»“åˆã€‚</p>
<h2 id="è¿è¡Œä¹‹å" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œä¹‹å" aria-hidden="true">#</a> è¿è¡Œä¹‹å</h2>
<div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p>
<p>ä½ è¿è¡Œèµ·æ¥çš„å¯ä»¥ä¸æ˜¯<code v-pre>kubernetes</code>ï¼Œå¯ä»¥æ˜¯ä¸ª <code v-pre>k0s</code> æˆ–è€…æ˜¯ <code v-pre>k3s</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token comment">#å•ä¸»æœº</span>
$ sealos run labring/kubernetes:v1.25.0 labring/helm:v3.8.2 labring/calico:v3.24.1 <span class="token parameter variable">--single</span>
<span class="token comment"># remove taint</span>
$ kubectl taint <span class="token function">node</span> <span class="token parameter variable">--all</span> node-role.kubernetes.io/control-plane-
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>
<div class="custom-container danger"><p class="custom-container-title">ä½¿ç”¨ docker ä½œä¸º run labring</p>
<p>é»˜è®¤æ˜¯ä½¿ç”¨<code v-pre>kubernetes</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealos run labring/kubernetes-docker:v1.20.5-4.1.3 labring/calico:v3.24.1 <span class="token punctuation">\</span>
     <span class="token parameter variable">--masters</span> <span class="token number">192.168</span>.64.2,192.168.64.22,192.168.64.20 <span class="token punctuation">\</span>
     <span class="token parameter variable">--nodes</span> <span class="token number">192.168</span>.64.21,192.168.64.19 <span class="token parameter variable">-p</span> <span class="token punctuation">[</span>your-ssh-passwd<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code v-pre>sealos</code> ä¸Šé¢è¿è¡Œå¯¹è±¡å­˜å‚¨ã€ç½‘å…³ã€æ•°æ®åº“ç­‰ç­‰ä¸œè¥¿ï¼Œéƒ½å¯ä»¥é€šè¿‡<code v-pre>sealos run</code> ä¸€é”®åœ¨äº‘æ“ä½œç³»ç»Ÿä¸Šé¢<code v-pre>run</code>èµ·æ¥ã€‚</p>
<blockquote>
<p>docker é•œåƒæœ¬è´¨æ˜¯ä¸€å †æ–‡ä»¶ç»„æˆï¼Œé€šè¿‡ <code v-pre>commit</code> æˆ–è€… <code v-pre>dockerfile</code> ä¸€å±‚å±‚å åŠ ï¼Œè€Œ <code v-pre>sealos run</code> å¯ä»¥ <code v-pre>run</code> æ•´ä¸ªé›†ç¾¤é•œåƒï¼Œä¸ç®¡æ˜¯ <code v-pre>Kubernetes</code> é›†ç¾¤ï¼Œ <code v-pre>Mysql</code> é›†ç¾¤ï¼Œ è¿˜æ˜¯ <code v-pre>Redis</code> é›†ç¾¤ã€‚<code v-pre>sealos build</code> å¯ä»¥ build æ•´ä¸ªé›†ç¾¤ã€‚</p>
<ul>
<li><code v-pre>docker</code> æ•°æ®ä¸­å¿ƒä½œä¸ºæ•´ä½“ï¼ˆrunå•æœºæ“ä½œç³»ç»Ÿï¼‰</li>
<li><code v-pre>kubernetes</code> ä½œä¸ºæ“ä½œç³»ç»Ÿ</li>
<li><code v-pre>sealos run</code> å‡ºæ¥çš„éƒ½æ˜¯é›†ç¾¤çš„ï¼Œè¿è¡Œåœ¨ <code v-pre>kubernetes</code> ä¸Š</li>
</ul>
</blockquote>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealos run labring/helm:v3.8.2 <span class="token comment"># install helm</span>
sealos run labring/openebs:v1.9.0 <span class="token comment"># install openebs</span>
sealos run labring/minio-operator:v4.4.16 labring/ingress-nginx:4.1.0 <span class="token punctuation">\</span>
   labring/mysql-operator:8.0.23-14.1 labring/redis-operator:3.1.4 <span class="token comment"># oneliner</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p><code v-pre>labring/ingress-nginx</code>ï¼šè¡¨ç¤ºçš„æ˜¯é›†ç¾¤é•œåƒï¼Œä»–ä»¬æ˜¯å¦‚ä½•è¢«æ‰“åŒ…çš„å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªæ—¶å€™æ¶‰åŠåˆ°äº† <a href="https://www.sealos.io/docs/getting-started/build-example-cloudimage" target="_blank" rel="noopener noreferrer">build an Exmple Cloudmage<ExternalLinkIcon/></a></p>
</blockquote>
<details class="custom-container details"><summary>ä»€ä¹ˆæ—¶å€™éœ€è¦é›†ç¾¤é•œåƒ</summary>
<p>ç”¨æˆ·å¸Œæœ›å¾—åˆ°ä¸€ä¸ªé›†ç¾¤</p>
<p>sealos ä¸ä¼šè®°å½•å¯åŠ¨çš„å®ä¾‹åç§°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å‚æ•°æ¥è®°å½•ä¸‹æ¥ã€‚</p>
</details>
<h3 id="æ„å»ºé•œåƒ" tabindex="-1"><a class="header-anchor" href="#æ„å»ºé•œåƒ" aria-hidden="true">#</a> æ„å»ºé•œåƒ</h3>
<p>ä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨ <code v-pre>helm</code> æ„å»º <code v-pre>nginx</code>-å…¥å£ç¾¤é›†æ˜ åƒã€‚</p>
<blockquote>
<p><code v-pre>helm</code> æœ€æ ¸å¿ƒçš„é—®é¢˜æ˜¯ï¼šæ¨¡æ¿æ¸²æŸ“ï¼Œ<code v-pre>sealos</code> å¯ä»¥é€‰æ‹© <code v-pre>helm</code> ã€‚</p>
</blockquote>
<details class="custom-container details"><summary>helmä»‹ç»</summary>
<p>helmçš„å®˜ç½‘æ–‡æ¡£åœ°å€ï¼š</p>
<ul>
<li><a href="https://docker.nsddd.top/Cloud-Native-k8s/15.html" target="_blank" rel="noopener noreferrer">æ–‡æ¡£åœ°å€<ExternalLinkIcon/></a></li>
</ul>
<p><strong>Helm æ˜¯ä»€ä¹ˆï¼Ÿï¼Ÿ</strong></p>
<p>Helm æ˜¯ Kubernetes çš„åŒ…ç®¡ç†å™¨ã€‚åŒ…ç®¡ç†å™¨ç±»ä¼¼äºæˆ‘ä»¬åœ¨ Ubuntu ä¸­ä½¿ç”¨çš„aptã€Centosä¸­ä½¿ç”¨çš„yum æˆ–è€…Pythonä¸­çš„ pip ä¸€æ ·ï¼Œèƒ½å¿«é€ŸæŸ¥æ‰¾ã€ä¸‹è½½å’Œå®‰è£…è½¯ä»¶åŒ…ã€‚Helm ç”±å®¢æˆ·ç«¯ç»„ä»¶ helm å’ŒæœåŠ¡ç«¯ç»„ä»¶ Tiller ç»„æˆ, èƒ½å¤Ÿå°†ä¸€ç»„K8Sèµ„æºæ‰“åŒ…ç»Ÿä¸€ç®¡ç†, æ˜¯æŸ¥æ‰¾ã€å…±äº«å’Œä½¿ç”¨ä¸ºKubernetesæ„å»ºçš„è½¯ä»¶çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p><strong>Helm è§£å†³äº†ä»€ä¹ˆç—›ç‚¹ï¼Ÿ</strong></p>
<p>åœ¨ Kubernetesä¸­éƒ¨ç½²ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„åº”ç”¨ï¼Œéœ€è¦æ¶‰åŠåˆ°å¾ˆå¤šçš„ Kubernetes èµ„æºçš„å…±åŒåä½œã€‚æ¯”å¦‚ä½ å®‰è£…ä¸€ä¸ª WordPress åšå®¢ï¼Œç”¨åˆ°äº†ä¸€äº› Kubernetes (ä¸‹é¢å…¨éƒ¨ç®€ç§°k8s)çš„ä¸€äº›èµ„æºå¯¹è±¡ï¼ŒåŒ…æ‹¬ Deployment ç”¨äºéƒ¨ç½²åº”ç”¨ã€Service æä¾›æœåŠ¡å‘ç°ã€Secret é…ç½® WordPress çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¯èƒ½è¿˜éœ€è¦ pv å’Œ pvc æ¥æä¾›æŒä¹…åŒ–æœåŠ¡ã€‚å¹¶ä¸” WordPress æ•°æ®æ˜¯å­˜å‚¨åœ¨mariadbé‡Œé¢çš„ï¼Œæ‰€ä»¥éœ€è¦ mariadb å¯åŠ¨å°±ç»ªåæ‰èƒ½å¯åŠ¨ WordPressã€‚è¿™äº› k8s èµ„æºè¿‡äºåˆ†æ•£ï¼Œä¸æ–¹ä¾¿è¿›è¡Œç®¡ç†ï¼Œç›´æ¥é€šè¿‡ kubectl æ¥ç®¡ç†ä¸€ä¸ªåº”ç”¨ï¼Œä½ ä¼šå‘ç°è¿™ååˆ†è›‹ç–¼ã€‚</p>
<p>æ‰€ä»¥æ€»ç»“ä»¥ä¸Šï¼Œæˆ‘ä»¬åœ¨ <code v-pre>k8s</code> ä¸­éƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼Œé€šå¸¸é¢ä¸´ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å¦‚ä½•ç»Ÿä¸€ç®¡ç†ã€é…ç½®å’Œæ›´æ–°è¿™äº›åˆ†æ•£çš„ <code v-pre>k8s</code> çš„åº”ç”¨èµ„æºæ–‡ä»¶</li>
<li>å¦‚ä½•åˆ†å‘å’Œå¤ç”¨ä¸€å¥—åº”ç”¨æ¨¡æ¿</li>
<li>å¦‚ä½•å°†åº”ç”¨çš„ä¸€ç³»åˆ—èµ„æºå½“åšä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†</li>
</ul>
<p><strong>Helm ç›¸å…³ç»„ä»¶åŠæ¦‚å¿µï¼š</strong></p>
<p>Helm åŒ…å«ä¸¤ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯ helm å®¢æˆ·ç«¯ å’Œ Tiller æœåŠ¡å™¨ï¼š</p>
<ul>
<li><strong>helm</strong> æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæœ¬åœ°å¼€å‘åŠç®¡ç†<code v-pre>chart</code>ï¼Œ<code v-pre>chart</code>ä»“åº“ç®¡ç†ç­‰</li>
<li><strong>Tiller</strong> æ˜¯ <code v-pre>Helm</code> çš„æœåŠ¡ç«¯ã€‚<code v-pre>Tiller</code> è´Ÿè´£æ¥æ”¶ <code v-pre>Helm</code> çš„è¯·æ±‚ï¼Œä¸ <code v-pre>k8s</code> çš„ <code v-pre>apiserver</code> äº¤äº’ï¼Œæ ¹æ®<code v-pre>chart</code> æ¥ç”Ÿæˆä¸€ä¸ª <code v-pre>release</code> å¹¶ç®¡ç† <code v-pre>release</code></li>
<li><strong>chart</strong> Helmçš„æ‰“åŒ…æ ¼å¼å«åš<code v-pre>chart</code>ï¼Œæ‰€è°“ <code v-pre>chart</code> å°±æ˜¯ä¸€ç³»åˆ—æ–‡ä»¶, å®ƒæè¿°äº†ä¸€ç»„ç›¸å…³çš„ <code v-pre>k8s</code> é›†ç¾¤èµ„æº</li>
<li><strong>release</strong> ä½¿ç”¨ <code v-pre>helm install</code> å‘½ä»¤åœ¨ <code v-pre>Kubernetes</code> é›†ç¾¤ä¸­éƒ¨ç½²çš„ <code v-pre>Chart</code> ç§°ä¸º <code v-pre>Release</code></li>
<li><code v-pre>Repoistory Helm chart</code> çš„ä»“åº“ï¼Œ<code v-pre>Helm</code> å®¢æˆ·ç«¯é€šè¿‡ <code v-pre>HTTP</code> åè®®æ¥è®¿é—®å­˜å‚¨åº“ä¸­ <code v-pre>chart</code> çš„ç´¢å¼•æ–‡ä»¶å’Œå‹ç¼©åŒ…</li>
</ul>
</details>
<p><strong>Helm åŸç†ï¼š</strong></p>
<p>ä¸‹é¢ä¸¤å¼ å›¾æè¿°äº† Helm çš„å‡ ä¸ªå…³é”®ç»„ä»¶ Helmï¼ˆå®¢æˆ·ç«¯ï¼‰ã€Tillerï¼ˆæœåŠ¡å™¨ï¼‰ã€Repositoryï¼ˆChart è½¯ä»¶ä»“åº“ï¼‰ã€Chartï¼ˆè½¯ä»¶åŒ…ï¼‰ä¹‹é—´çš„å…³ç³»ä»¥åŠå®ƒä»¬ä¹‹é—´å¦‚ä½•é€šä¿¡ã€‚</p>
<p><img src="http://sm.nsddd.top/smimage-20221023214555169.png" alt="image-20221023214555169"></p>
<p><strong>helm ç»„ä»¶é€šä¿¡ï¼š</strong></p>
<p><img src="http://sm.nsddd.top/smimage-20221023214604275.png" alt="image-20221023214604275"></p>
<p><strong>helm æ¶æ„</strong></p>
<p><strong>åˆ›å»ºreleaseï¼š</strong></p>
<ul>
<li><code v-pre>helm</code> å®¢æˆ·ç«¯ä»æŒ‡å®šçš„ç›®å½•æˆ–æœ¬åœ° <code v-pre>tar</code> æ–‡ä»¶æˆ–è¿œç¨‹ <code v-pre>repo</code> ä»“åº“è§£æå‡º <code v-pre>chart</code> çš„ç»“æ„ä¿¡æ¯</li>
<li><code v-pre>helm</code> å®¢æˆ·ç«¯æŒ‡å®šçš„ <code v-pre>chart</code> ç»“æ„å’Œ <code v-pre>values</code> ä¿¡æ¯é€šè¿‡ <code v-pre>gRPC</code> ä¼ é€’ç»™ <code v-pre>Tiller</code></li>
<li><code v-pre>Tiller</code> æœåŠ¡ç«¯æ ¹æ® <code v-pre>chart</code> å’Œ <code v-pre>values</code> ç”Ÿæˆä¸€ä¸ª <code v-pre>release</code></li>
<li><code v-pre>Tiller</code> å°† <code v-pre>install release</code> è¯·æ±‚ç›´æ¥ä¼ é€’ç»™ <code v-pre>kube-apiserver</code></li>
</ul>
<p><strong>åˆ é™¤releaseï¼š</strong></p>
<ul>
<li><code v-pre>helm</code> å®¢æˆ·ç«¯ä»æŒ‡å®šçš„ç›®å½•æˆ–æœ¬åœ° <code v-pre>tar</code> æ–‡ä»¶æˆ–è¿œç¨‹ <code v-pre>repo</code> ä»“åº“è§£æå‡º <code v-pre>chart</code> çš„ç»“æ„ä¿¡æ¯</li>
<li><code v-pre>helm</code> å®¢æˆ·ç«¯æŒ‡å®šçš„ <code v-pre>chart</code> ç»“æ„å’Œ <code v-pre>values</code> ä¿¡æ¯é€šè¿‡ gRPC ä¼ é€’ç»™ Tiller</li>
<li><code v-pre>Tiller</code> æœåŠ¡ç«¯æ ¹æ® <code v-pre>chart</code> å’Œ <code v-pre>values</code> ç”Ÿæˆä¸€ä¸ª <code v-pre>release</code></li>
<li><code v-pre>Tiller</code> å°† <code v-pre>delete release</code> è¯·æ±‚ç›´æ¥ä¼ é€’ç»™ <code v-pre>kube-apiserver</code></li>
</ul>
<p><strong>æ›´æ–°releaseï¼š</strong></p>
<ul>
<li><code v-pre>helm</code> å®¢æˆ·ç«¯å°†éœ€è¦æ›´æ–°çš„ <code v-pre>chart</code> çš„ <code v-pre>release</code> åç§° <code v-pre>chart</code> ç»“æ„å’Œ <code v-pre>value</code> ä¿¡æ¯ä¼ ç»™ <code v-pre>Tiller</code></li>
<li><code v-pre>Tiller</code> å°†æ”¶åˆ°çš„ä¿¡æ¯ç”Ÿæˆæ–°çš„ <code v-pre>release</code>ï¼Œå¹¶åŒæ—¶æ›´æ–°è¿™ä¸ª <code v-pre>release</code> çš„ <code v-pre>history</code></li>
<li><code v-pre>Tiller</code> å°†æ–°çš„ <code v-pre>release</code> ä¼ é€’ç»™ <code v-pre>kube-apiserver</code> è¿›è¡Œæ›´æ–°</li>
</ul>
<h3 id="chart-çš„åŸºæœ¬ç»“æ„" tabindex="-1"><a class="header-anchor" href="#chart-çš„åŸºæœ¬ç»“æ„" aria-hidden="true">#</a> chart çš„åŸºæœ¬ç»“æ„</h3>
<p>Helmçš„æ‰“åŒ…æ ¼å¼å«åšchartï¼Œæ‰€è°“<code v-pre>chart</code>å°±æ˜¯ä¸€ç³»åˆ—æ–‡ä»¶, å®ƒæè¿°äº†ä¸€ç»„ç›¸å…³çš„ k8s é›†ç¾¤èµ„æºã€‚Chartä¸­çš„æ–‡ä»¶å®‰è£…ç‰¹å®šçš„ç›®å½•ç»“æ„ç»„ç»‡, æœ€ç®€å•çš„ <code v-pre>chart</code> ç›®å½•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="http://sm.nsddd.top/smimage-20221023214623073.png" alt="image-20221023214623073"></p>
<p>chart ç»“æ„</p>
<ul>
<li><code v-pre>charts</code> ç›®å½•å­˜æ”¾ä¾èµ–çš„chart</li>
<li><code v-pre>Chart.yaml</code> åŒ…å«Chartçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬chartç‰ˆæœ¬ï¼Œåç§°ç­‰</li>
<li><code v-pre>templates</code> ç›®å½•ä¸‹å­˜æ”¾åº”ç”¨ä¸€ç³»åˆ— k8s èµ„æºçš„ yaml æ¨¡æ¿</li>
<li><code v-pre>_helpers.tpl</code> æ­¤æ–‡ä»¶ä¸­å®šä¹‰ä¸€äº›å¯é‡ç”¨çš„æ¨¡æ¿ç‰‡æ–­ï¼Œæ­¤æ–‡ä»¶ä¸­çš„å®šä¹‰åœ¨ä»»ä½•èµ„æºå®šä¹‰æ¨¡æ¿ä¸­å¯ç”¨</li>
<li><code v-pre>NOTES.txt</code> ä»‹ç»chart éƒ¨ç½²åçš„å¸®åŠ©ä¿¡æ¯ï¼Œå¦‚ä½•ä½¿ç”¨chartç­‰</li>
<li><code v-pre>values.yaml</code> åŒ…å«äº†å¿…è¦çš„å€¼å®šä¹‰ï¼ˆé»˜è®¤å€¼ï¼‰, ç”¨äºå­˜å‚¨ templates ç›®å½•ä¸­æ¨¡æ¿æ–‡ä»¶ä¸­ç”¨åˆ°å˜é‡çš„å€¼</li>
</ul>
<p><strong>å®‰è£…Helmï¼š</strong></p>
<p>Helm æä¾›äº†å‡ ç§å®‰è£…æ–¹å¼ï¼Œæœ¬æ–‡æä¾›ä¸¤ç§å®‰è£…æ–¹å¼ï¼Œæƒ³è¦æŸ¥çœ‹æ›´å¤šå®‰è£…æ–¹å¼ï¼Œè¯·é˜…è¯» Helm çš„<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fdocs.helm.sh%2Fusing_helm%2F%23installing-helm" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<ExternalLinkIcon/></a>ï¼š</p>
<ul>
<li>æ‰‹åŠ¨å®‰è£…æ–¹å¼</li>
</ul>
<div class="language-ruby ext-rb line-numbers-mode"><pre v-pre class="language-ruby"><code>$ ä¸‹è½½ Helm äºŒè¿›åˆ¶æ–‡ä»¶
$ wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>storage<span class="token punctuation">.</span>googleapis<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">-</span>helm<span class="token operator">/</span>helm<span class="token operator">-</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
$ è§£å‹ç¼©
$ tar <span class="token operator">-</span>zxvf helm<span class="token operator">-</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span><span class="token operator">-</span>linux<span class="token operator">-</span>amd64<span class="token punctuation">.</span>tar<span class="token punctuation">.</span>gz
$ å¤åˆ¶ helm äºŒè¿›åˆ¶ åˆ°binç›®å½•ä¸‹
<span class="token variable">$cp</span> linux<span class="token operator">-</span>amd64<span class="token operator">/</span>helm <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token regex-literal"><span class="token regex">/bin/</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>ä½¿ç”¨å®˜æ–¹æä¾›çš„è„šæœ¬ä¸€é”®å®‰è£…</li>
</ul>
<div class="language-ruby ext-rb line-numbers-mode"><pre v-pre class="language-ruby"><code>$ curl https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com<span class="token operator">/</span>kubernetes<span class="token operator">/</span>helm<span class="token operator">/</span>master<span class="token operator">/</span>scripts<span class="token operator">/</span>get <span class="token operator">></span> get_helm<span class="token punctuation">.</span>sh
$ chmod <span class="token number">700</span> get_helm<span class="token punctuation">.</span>sh
$ <span class="token punctuation">.</span><span class="token operator">/</span>get_helm<span class="token punctuation">.</span>sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>ä½ è¿˜å¯ä»¥é€šè¿‡ Helm çš„ <a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2Fhelm%2Fhelm%2Freleases" target="_blank" rel="noopener noreferrer">github<ExternalLinkIcon/></a> é¡¹ç›®ä¸‹æ‰¾åˆ°ä½ æƒ³è¦çš„ Helm ç‰ˆæœ¬çš„äºŒè¿›åˆ¶ï¼Œç„¶åé€šè¿‡æ‰‹åŠ¨å®‰è£…æ–¹å¼ä¸€æ ·å®‰è£…å³å¯</p>
<p><strong>å›½å†…é•œåƒåŠ é€Ÿä¸‹è½½ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">wget</span> https://mirrors.huaweicloud.com/helm/v3.9.2/helm-v3.9.2-linux-386.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> helm-v3.9.2-linux-386.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token function">cp</span>  linux-386/helm /usr/local/bin/ <span class="token operator">&amp;&amp;</span> helm version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></blockquote>
<p><strong>å®‰è£… Tillerï¼š</strong></p>
<p>å®‰è£…å¥½ helm å®¢æˆ·ç«¯åï¼Œå°±å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°† Tiller å®‰è£…åœ¨ kubernetes é›†ç¾¤ä¸­ï¼š</p>
<div class="language-kotlin ext-kt line-numbers-mode"><pre v-pre class="language-kotlin"><code>helm <span class="token keyword">init</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªåœ°æ–¹é»˜è®¤ä½¿ç”¨ â€œ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fkubernetes-charts.storage.googleapis.com" target="_blank" rel="noopener noreferrer">https://kubernetes-charts.storage.googleapis.com<ExternalLinkIcon/></a>â€ ä½œä¸ºç¼ºçœçš„ stable repository çš„åœ°å€ï¼Œä½†ç”±äºå›½å†…æœ‰ä¸€å¼ æ— å½¢çš„å¢™çš„å­˜åœ¨ï¼Œ<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fgoogleapis.com" target="_blank" rel="noopener noreferrer">googleapis.com<ExternalLinkIcon/></a> æ˜¯ä¸èƒ½è®¿é—®çš„ã€‚å¯ä»¥ä½¿ç”¨é˜¿é‡Œäº‘çš„æºæ¥é…ç½®ï¼š</p>
<div class="language-kotlin ext-kt line-numbers-mode"><pre v-pre class="language-kotlin"><code>helm <span class="token keyword">init</span> <span class="token operator">--</span>upgrade <span class="token operator">-</span>i registry<span class="token punctuation">.</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>google_containers<span class="token operator">/</span>tiller<span class="token operator">:</span>v2<span class="token punctuation">.</span><span class="token number">9.1</span>  <span class="token operator">--</span>stable<span class="token operator">-</span>repo<span class="token operator">-</span>url https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>kubernetes<span class="token punctuation">.</span>oss<span class="token operator">-</span>cn<span class="token operator">-</span>hangzhou<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com<span class="token operator">/</span>charts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œä¸Šé¢å‘½ä»¤åï¼Œå¯ä»¥é€šè¿‡ <code v-pre>kubectl get po -n kube-system</code> æ¥æŸ¥çœ‹ <code v-pre>tiller</code> çš„å®‰è£…æƒ…å†µã€‚</p>
<p>ç”±äº <code v-pre>kubernetes</code> ä»1.6 ç‰ˆæœ¬å¼€å§‹åŠ å…¥äº† <code v-pre>RBAC</code> æˆæƒã€‚å½“å‰çš„ <code v-pre>Tiller</code> æ²¡æœ‰å®šä¹‰ç”¨äºæˆæƒçš„ <code v-pre>ServiceAccount</code>ï¼Œ è®¿é—® <code v-pre>API Server</code> æ—¶ä¼šè¢«æ‹’ç»ï¼Œéœ€è¦ç»™ <code v-pre>Tiller</code> åŠ å…¥æˆæƒã€‚</p>
<ul>
<li>åˆ›å»º <code v-pre>Kubernetes</code> çš„æœåŠ¡å¸å·å’Œç»‘å®šè§’è‰²</li>
</ul>
<div class="language-ruby ext-rb line-numbers-mode"><pre v-pre class="language-ruby"><code>$ kubectl create serviceaccount <span class="token operator">-</span><span class="token operator">-</span>namespace kube<span class="token operator">-</span>system tiller                               
serviceaccount <span class="token string-literal"><span class="token string">"tiller"</span></span> created

$ kubectl create clusterrolebinding tiller<span class="token operator">-</span>cluster<span class="token operator">-</span>rule <span class="token operator">-</span><span class="token operator">-</span>clusterrole<span class="token operator">=</span>cluster<span class="token operator">-</span>admin <span class="token operator">-</span><span class="token operator">-</span>serviceaccount<span class="token operator">=</span>kube<span class="token operator">-</span>system<span class="token symbol">:tiller</span>
clusterrolebinding<span class="token punctuation">.</span>rbac<span class="token punctuation">.</span>authorization<span class="token punctuation">.</span>k8s<span class="token punctuation">.</span>io <span class="token string-literal"><span class="token string">"tiller-cluster-rule"</span></span> created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>ç»™ <code v-pre>Tiller</code> çš„ <code v-pre>deployments</code> æ·»åŠ åˆšæ‰åˆ›å»ºçš„ <code v-pre>ServiceAccount</code></li>
</ul>
<div class="language-rust ext-rs line-numbers-mode"><pre v-pre class="language-rust"><code># ç»™ <span class="token class-name">Tiller</span> çš„ deployments æ·»åŠ åˆšæ‰åˆ›å»ºçš„ <span class="token class-name">ServiceAccount</span>
$ kubectl patch deploy <span class="token operator">-</span><span class="token operator">-</span>namespace kube<span class="token operator">-</span>system tiller<span class="token operator">-</span>deploy <span class="token operator">-</span>p '<span class="token punctuation">{</span><span class="token string">"spec"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"template"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"spec"</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">"serviceAccount"</span><span class="token punctuation">:</span><span class="token string">"tiller"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>'
deployment<span class="token punctuation">.</span>extensions <span class="token string">"tiller-deploy"</span> patched
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æŸ¥çœ‹ <code v-pre>Tiller deployments</code> èµ„æºæ˜¯å¦ç»‘å®š <code v-pre>ServiceAccount</code></li>
</ul>
<div class="language-csharp ext-cs line-numbers-mode"><pre v-pre class="language-csharp"><code>$ kubectl <span class="token keyword">get</span> deploy <span class="token operator">-</span>n kube<span class="token operator">-</span>system tiller<span class="token operator">-</span>deploy <span class="token operator">-</span>o yaml <span class="token operator">|</span> grep <span class="token class-name">serviceAccount</span>
serviceAccount<span class="token punctuation">:</span> <span class="token class-name">tiller</span>
serviceAccountName<span class="token punctuation">:</span> tiller
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æŸ¥çœ‹ <code v-pre>Tiller</code> æ˜¯å¦å®‰è£…æˆåŠŸ</li>
</ul>
<div class="language-ruby ext-rb line-numbers-mode"><pre v-pre class="language-ruby"><code>$ helm version 
<span class="token symbol">Client</span><span class="token operator">:</span> <span class="token operator">&amp;</span>version<span class="token punctuation">.</span>Version<span class="token punctuation">{</span><span class="token symbol">SemVer</span><span class="token symbol">:"v2.9.1"</span><span class="token punctuation">,</span> <span class="token symbol">GitCommit</span><span class="token symbol">:"20adb27c7c5868466912eebdf6664e7390ebe710"</span><span class="token punctuation">,</span> <span class="token symbol">GitTreeState</span><span class="token symbol">:"clean"</span><span class="token punctuation">}</span>
<span class="token symbol">Server</span><span class="token operator">:</span> <span class="token operator">&amp;</span>version<span class="token punctuation">.</span>Version<span class="token punctuation">{</span><span class="token symbol">SemVer</span><span class="token symbol">:"v2.9.1"</span><span class="token punctuation">,</span> <span class="token symbol">GitCommit</span><span class="token symbol">:"20adb27c7c5868466912eebdf6664e7390ebe710"</span><span class="token punctuation">,</span> <span class="token symbol">GitTreeState</span><span class="token symbol">:"clean"</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®‰è£…æˆåŠŸåï¼Œå³å¯ä½¿ç”¨ <code v-pre>helm install xxx</code> æ¥å®‰è£… <code v-pre>helm</code> åº”ç”¨ã€‚å¦‚æœéœ€è¦åˆ é™¤ <code v-pre>Tiller</code>ï¼Œå¯ä»¥é€šè¿‡ <code v-pre>kubectl delete deployment tiller-deploy --namespace kube-system</code>  æ¥åˆ é™¤ <code v-pre>Tiller</code> çš„ <code v-pre>deployment</code> æˆ–è€…ä½¿ç”¨ <code v-pre>helm reset</code> æ¥åˆ é™¤ã€‚</p>
<p><strong>ä½¿ç”¨ Helm æ“ä½œ Chartï¼š</strong></p>
<p>è¿™ä¸€èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ helm æ¥æ“ä½œ chartï¼ŒåŒ…æ‹¬åˆ›å»ºã€åˆ é™¤ã€æ‰“åŒ…ã€å®‰è£…ç­‰ä½¿ç”¨ã€‚</p>
<p>å…ˆä»‹ç»ä¸€ä¸‹ Helm çš„æ ¸å¿ƒå‘½ä»¤ï¼š</p>
<ul>
<li>helm create åˆ›å»ºä¸€ä¸ª Chart æ¨¡æ¿</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm create <span class="token builtin class-name">test</span>
Creating <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>helm package æ‰“åŒ…ä¸€ä¸ª Chart æ¨¡æ¿</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm package <span class="token builtin class-name">test</span>                                                                          
Successfully packaged chart and saved it to: /root/test-0.1.0.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>helm search</code> æŸ¥æ‰¾å¯ç”¨çš„ Chart æ¨¡æ¿</li>
</ul>
<div class="language-ruby ext-rb line-numbers-mode"><pre v-pre class="language-ruby"><code>$ helm search nginx                                  
<span class="token constant">NAME</span>                    <span class="token constant">CHART</span> <span class="token constant">VERSION</span>   <span class="token constant">APP</span> <span class="token constant">VERSION</span> <span class="token constant">DESCRIPTION</span>
stable<span class="token operator">/</span>nginx<span class="token operator">-</span>ingress    <span class="token number">0.9</span><span class="token number">.5</span>           <span class="token number">0.10</span><span class="token number">.2</span>      An nginx Ingress controller that uses ConfigMap<span class="token operator">...</span>
stable<span class="token operator">/</span>nginx<span class="token operator">-</span>lego       <span class="token number">0.3</span><span class="token number">.1</span>                       Chart <span class="token keyword">for</span> nginx<span class="token operator">-</span>ingress<span class="token operator">-</span>controller <span class="token keyword">and</span> kube<span class="token operator">-</span>lego
stable<span class="token operator">/</span>gcloud<span class="token operator">-</span>endpoints <span class="token number">0.1</span><span class="token number">.0</span>                       Develop<span class="token punctuation">,</span> deploy<span class="token punctuation">,</span> protect <span class="token keyword">and</span> monitor your APIs <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>helm inspect</code> æŸ¥çœ‹æŒ‡å®š Chart çš„åŸºæœ¬ä¿¡æ¯</li>
</ul>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">appVersion</span><span class="token punctuation">:</span> <span class="token string">"1.0"</span>
<span class="token key atrule">description</span><span class="token punctuation">:</span> A Helm chart for Kubernetes
<span class="token key atrule">name</span><span class="token punctuation">:</span> test
<span class="token key atrule">version</span><span class="token punctuation">:</span> 0.1.0

ç•¥<span class="token punctuation">...</span>(çœç•¥ä¸€å¤§æ®µä¿¡æ¯ï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>helm install</code> æ ¹æ®æŒ‡å®šçš„ Chart éƒ¨ç½²ä¸€ä¸ª Release åˆ° Kubernetes é›†ç¾¤</li>
</ul>
<p><strong>Chart æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<div class="language-css ext-css line-numbers-mode"><pre v-pre class="language-css"><code>wordpress
â”œâ”€â”€ charts
â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.lock
â”œâ”€â”€ requirements.yaml
â”œâ”€â”€ templates
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ externaldb-secrets.yaml
â”‚   â”œâ”€â”€ _helpers.tpl
â”‚   â”œâ”€â”€ ingress.yaml
â”‚   â”œâ”€â”€ NOTES.txt
â”‚   â”œâ”€â”€ pvc.yaml
â”‚   â”œâ”€â”€ secrets.yaml
â”‚   â”œâ”€â”€ svc.yaml
â”‚   â””â”€â”€ tls-secrets.yaml
â””â”€â”€ values.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€ä¸ª wordpress chart å¦‚ä¸Šï¼ˆå»é™¤éƒ¨åˆ† test å’Œ charts ä¾èµ–ï¼‰ï¼Œ åŸºæœ¬ç»“æ„ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>charts å­˜æ”¾å­Chart (Subchart) çš„å®šä¹‰ï¼ŒSubchart æŒ‡çš„æ˜¯å½“å‰ Chart ä¾èµ–çš„ Chart ï¼Œ åœ¨ requirements.yaml ä¸­å®šä¹‰</li>
<li>Chart.yaml åŒ…å« Chart ä¿¡æ¯çš„ YAML æ–‡ä»¶ï¼Œ åŒ…æ‹¬ Chart çš„ç‰ˆæœ¬ã€åç§°ç­‰ï¼Œåœ¨ DCE Helm æ’ä»¶ä¸­è¿˜åŒ…å« Chart çš„ <strong>å›¢é˜Ÿæˆæƒ</strong> ä¿¡æ¯ å’Œ <strong>æ˜¯å¦å…¬å¼€</strong> çš„ä¿¡æ¯</li>
<li>README.md å¯é€‰ï¼šChart çš„ä»‹ç»ä¿¡æ¯ç­‰ï¼ˆè¯¥æ–‡ä»¶å¯¹äºä¸€ä¸ªå¤§å‹ Chart æ¥è¯´ååˆ†é‡è¦ï¼‰</li>
<li><code v-pre>Requirements.yaml</code> å¯é€‰ï¼šåˆ—ä¸¾å½“å‰ Chart çš„éœ€è¦ä¾èµ–çš„ Chart</li>
<li><code v-pre>templates</code>ï¼š
<ul>
<li>è¯¥ç›®å½•ä¸‹å­˜æ”¾ Chart æ‰€æœ‰çš„ K8s èµ„æºå®šä¹‰æ¨¡æ¿ï¼Œé€šå¸¸ä¸åŒçš„èµ„æºæ”¾åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼ŒDCE Helm æ’ä»¶ä¸­è‡ªå®šä¹‰æ¨¡æ¿çš„ K8s èµ„æºç»Ÿä¸€æ”¾åœ¨ all_sources.yaml æ–‡ä»¶ä¸­</li>
<li>_helpers.tpl ï¼Œ é€šå¸¸è¿™ä¸ªæ–‡ä»¶å­˜æ”¾å¯é‡ç”¨çš„æ¨¡æ¿ç‰‡æ®µï¼Œè¯¥æ–‡ä»¶ä¸­çš„å®šä¹‰å¯ä»¥åœ¨ Chart å…¶å®ƒèµ„æºå®šä¹‰æ¨¡æ¿ä¸­ä½¿ç”¨</li>
<li>NOTES.txtï¼Œå¯é€‰ï¼šä¸€æ®µç®€çŸ­ä½¿ç”¨è¯´æ˜çš„æ–‡æœ¬æ–‡ä»¶ï¼Œç”¨äºå®‰è£… Release åæç¤ºç”¨æˆ·ä½¿ç”¨</li>
</ul>
</li>
<li>values.yaml å½“å‰ Chart çš„é»˜è®¤é…ç½®çš„å€¼</li>
</ul>
<h3 id="ç¼–å†™ä¸€ä¸ªç®€å•çš„-chart-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¼–å†™ä¸€ä¸ªç®€å•çš„-chart-ç¤ºä¾‹" aria-hidden="true">#</a> ç¼–å†™ä¸€ä¸ªç®€å•çš„ Chart ç¤ºä¾‹</h3>
<p>æœ¬èŠ‚ä»¥æ„å»ºä¸€ä¸ªåç§°ä¸º <code v-pre>nginx-test Chart</code> ä¸ºç¤ºä¾‹ï¼Œæ¥æè¿°ä¸€ä¸ª <code v-pre>chart</code> å¿…è¦æ¡ä»¶ã€‚
1ã€<code v-pre>Chart.yaml</code> æ–‡ä»¶æ˜¯ ä¸€ä¸ª <code v-pre>chart</code> å¿…è¦æ–‡ä»¶ï¼Œ è¯¥æ–‡ä»¶å¯ä»¥ç®€å•åŒ…æ‹¬ä»¥ä¸‹å­—æ®µï¼ˆå…·ä½“å­—æ®µè¯·å‚è€ƒ<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fhelm.sh%2F" target="_blank" rel="noopener noreferrer">Helmå®˜ç½‘<ExternalLinkIcon/></a>)</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1  (chart çš„APIç‰ˆæœ¬<span class="token punctuation">,</span> æ€»æ˜¯"v1"<span class="token punctuation">,</span> å¿…è¦)
<span class="token key atrule">name</span><span class="token punctuation">:</span> hello     (chart çš„åç§°<span class="token punctuation">,</span> å¿…è¦)
<span class="token key atrule">version</span><span class="token punctuation">:</span> 0.0.1  (chart çš„ç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬å¿…é¡»å¿…è¦éµå¾ª SemVer 2æ ‡å‡†)
<span class="token key atrule">description</span><span class="token punctuation">:</span> A Helm chart for Kubernetes   (chart æ¨¡æ¿çš„ç®€ä»‹æè¿°)
<span class="token punctuation">...</span>
ä¸‹é¢çœç•¥ä¸€äº›å­—æ®µï¼Œé»˜è®¤æƒ…å†µä¸‹æœ‰è¿™å‡ ä¸ªå­—æ®µå®šä¹‰å°±å¯ä»¥äº†
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2ã€values.yaml æ–‡ä»¶æ˜¯ chart çš„å¿…è¦æ–‡ä»¶ï¼Œä»¥ nginx ä¸ºç¤ºä¾‹ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token comment"># Default values for test.</span>
<span class="token comment"># This is a YAML-formatted file.</span>
<span class="token comment"># Declare variables to be passed into your templates.</span>
<span class="token key atrule">replicaCount</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token key atrule">image</span><span class="token punctuation">:</span>
  <span class="token key atrule">repository</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">tag</span><span class="token punctuation">:</span> stable
  <span class="token key atrule">pullPolicy</span><span class="token punctuation">:</span> IfNotPresent
<span class="token key atrule">service</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token comment"># kubernetes.io/ingress.class: nginx</span>
    <span class="token comment"># kubernetes.io/tls-acme: "true"</span>
  <span class="token key atrule">path</span><span class="token punctuation">:</span> /
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> chart<span class="token punctuation">-</span>example.local
  <span class="token key atrule">tls</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment">#  - secretName: chart-example-tls</span>
  <span class="token comment">#    hosts:</span>
  <span class="token comment">#      - chart-example.local</span>

<span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment"># We usually recommend not to specify default resources and to leave this as a conscious</span>
  <span class="token comment"># choice for the user. This also increases chances charts run on environments with little</span>
  <span class="token comment"># resources, such as Minikube. If you do want to specify resources, uncomment the following</span>
  <span class="token comment"># lines, adjust them as necessary, and remove the curly braces after 'resources:'.</span>
  <span class="token comment"># limits:</span>
  <span class="token comment">#  cpu: 100m</span>
  <span class="token comment">#  memory: 128Mi</span>
  <span class="token comment"># requests:</span>
  <span class="token comment">#  cpu: 100m</span>
  <span class="token comment">#  memory: 128Mi</span>

<span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token key atrule">tolerations</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token key atrule">affinity</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»ç¤ºä¾‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<code v-pre>values.yaml</code> ä¸­å®šä¹‰äº†ä¸€äº›å½“å‰<code v-pre>chart</code> çš„ä¸€äº›é»˜è®¤å€¼ï¼Œç”¨äº <code v-pre>templates</code> ä¸‹çš„ K8s èµ„æº yaml æ¸²æŸ“æ—¶å¡«å……é»˜è®¤å€¼ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨ helm install æ¥éƒ¨ç½²ä¸€ä¸ª Release , å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŒ‡å®šä¸€ä»½yaml æ–‡ä»¶ä½œä¸ºå¡«å……å€¼ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ helm <span class="token function">install</span> <span class="token parameter variable">--values</span><span class="token operator">=</span>myvals.yaml nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3ã€åˆ›å»º templates ä¸‹çš„æ¨¡æ¿æ–‡ä»¶ï¼Œ ç”¨äºç”Ÿæˆ <code v-pre>Kubernetes</code> èµ„æºæ¸…å•(manifests) å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token comment"># nginx-test/templates/deployments.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1beta2
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.fullname" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.name" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.chart" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Service <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.replicaCount <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.name" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.name" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Chart.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">"{{ .Values.image.repository }}:{{ .Values.image.tag }}"</span>
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.image.pullPolicy <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> http
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml .Values.resources <span class="token punctuation">|</span> indent 12 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.nodeSelector <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.affinity <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> with .Values.tolerations <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span> toYaml . <span class="token punctuation">|</span> indent 8 <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
    
<span class="token comment"># nginx-test/templates/service.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.fullname" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.name" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">chart</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.chart" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">heritage</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Service <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.service.type <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Values.service.port <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> http 
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
      <span class="token key atrule">name</span><span class="token punctuation">:</span> http
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.name" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">release</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> .Release.Name <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢å®šä¹‰äº† ä¸€ä¸ª <code v-pre>deployments.yaml</code> å’Œ <code v-pre>service.yaml</code> èµ„æºæ–‡ä»¶ï¼Œé‡Œé¢ä½¿ç”¨ <code v-pre>{{ }}</code> ç¬¦å·çš„æ˜¯ <code v-pre>Go</code> æ¨¡æ¿è¯­è¨€çš„æ ‡å‡†ã€‚å…¶ä¸­å¯ä»¥é€šè¿‡ï¼š</p>
<ul>
<li><code v-pre>.Values</code> å¯¹è±¡è®¿é—® <code v-pre>values.yaml</code> æ–‡ä»¶çš„å†…å®¹ï¼Œ å‰é¢çš„dot(.) è¡¨ç¤ºä»é¡¶å±‚å‘½åç©ºé—´å¼€å§‹ï¼Œæ‰¾åˆ° Values å¯¹è±¡(ä¸‹åŒ)</li>
<li><code v-pre>.Release</code>ã€<code v-pre>.Chart</code> å¼€å¤´çš„é¢„å®šä¹‰å€¼å¯ç”¨äºä»»ä½•çš„æ¨¡æ¿ä¸­</li>
<li><code v-pre>.Chart</code> å¯¹è±¡ç”¨æ¥è®¿é—® <code v-pre>Chart.yaml</code> æ–‡ä»¶çš„å†…å®¹</li>
<li><code v-pre>.Release</code> å¯¹è±¡æ˜¯ Helmçš„å†…ç½®å¯¹è±¡ä¹‹ä¸€ï¼Œ ä½¿ç”¨ Helm å®‰è£…ä¸€ä¸ª release æ—¶ï¼Œç”± Tiller åˆ†é… release çš„åç§°</li>
</ul>
<p>4ã€å‘½åæ¨¡æ¿(_helper.tpl) ï¼šå¯ä»¥ä»ä¸Šé¢çœ‹åˆ°æœ‰ <code v-pre>{{ template &quot;nginx-test.fullname&quot; . }}</code> å®šä¹‰ã€‚è¯¥å®šä¹‰ç”± <code v-pre>_helper.tpl</code> æ–‡ä»¶å®šä¹‰çš„å­—æ®µæ¥å®ç°ï¼Œæ¯”å¦‚ä¸‹é¢ä¸€ä¸ª <code v-pre>_helper.tpl</code>ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token key atrule">/* vim</span><span class="token punctuation">:</span> <span class="token key atrule">set filetype=mustache</span><span class="token punctuation">:</span> <span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Expand the name of the chart.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define "nginx<span class="token punctuation">-</span>test.name" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> default .Chart.Name .Values.nameOverride <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix "<span class="token punctuation">-</span>" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Create a default fully qualified app name.
We truncate at 63 chars because some Kubernetes name fields are limited to this (by the DNS naming spec).
If release name contains chart name it will be used as a full name.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define "nginx<span class="token punctuation">-</span>test.fullname" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> if .Values.fullnameOverride <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> .Values.fullnameOverride <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix "<span class="token punctuation">-</span>" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> else <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> $name <span class="token punctuation">:</span>= default .Chart.Name .Values.nameOverride <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> if contains $name .Release.Name <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> .Release.Name <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix "<span class="token punctuation">-</span>" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> else <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> printf "%s<span class="token punctuation">-</span>%s" .Release.Name $name <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix "<span class="token punctuation">-</span>" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token punctuation">{</span>/*
Create chart name and version as used by the chart label.
<span class="token important">*/</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define "nginx<span class="token punctuation">-</span>test.chart" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> printf "%s<span class="token punctuation">-</span>%s" .Chart.Name .Chart.Version <span class="token punctuation">|</span> replace "+" "_" <span class="token punctuation">|</span> trunc 63 <span class="token punctuation">|</span> trimSuffix "<span class="token punctuation">-</span>" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥æ¨¡æ¿å®šä¹‰äº† &quot;nginx-test.name&quot;ã€&quot;nginx-test.fullname&quot;ã€&quot;nginx-test.chart&quot; ç­‰å¯é‡ç”¨æ¨¡æ¿éƒ¨åˆ†ï¼Œå½“æ¨¡æ¿å¼•æ“è¯»å–è¯¥æ–‡ä»¶æ—¶ï¼Œå®ƒå­˜å‚¨å¯¹ nginx-test.nameç­‰çš„å¼•ç”¨ï¼Œ ç›´åˆ°è°ƒç”¨ template &quot;nginx-test.name&quot; ä¸ºæ­¢ã€‚ç„¶åæŠŠå€¼æ¸²æŸ“åˆ°æ¨¡æ¿ä¸­ã€‚</p>
<p>æ³¨æ„ <code v-pre>{{ template &quot;nginx-test.chart&quot; . }}</code> åé¢æœ‰ä¸ª<code v-pre>dot(.)</code>ï¼Œè¿™æ˜¯å› ä¸ºä¸€ä¸ªå·²å‘½åçš„æ¨¡æ¿ï¼ˆç”¨äºåˆ›å»º <code v-pre>define</code>) è¢«æ¸²æŸ“æ—¶ï¼Œå®ƒå°†æ¥æ”¶ç”±è¯¥ <code v-pre>template</code> è°ƒç”¨ä¼ å…¥çš„èŒƒå›´<code v-pre>ï¼ˆscope)</code>ã€‚æ²¡æœ‰èŒƒå›´ä¼ å…¥ï¼Œåœ¨æ¨¡æ¿ä¸­æ— æ³•è®¿é—®ä»»ä½•å†…å®¹ï¼Œå› æ­¤åœ¨ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> define "nginx<span class="token punctuation">-</span>test.chart" <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
è¿™é‡Œé¢çš„ .Chart å°†æ— æ³•è®¿é—®ï¼Œå¯¼è‡´åœ¨æ¨¡æ¿ä¸­æ— æ³•çœ‹åˆ°å†…å®¹ï¼Œå› ä¸ºè¿™é‡Œå€¼ä¸ºç©º
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">-</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å› æ­¤åœ¨æ¨¡æ¿ä¸­å°† èŒƒå›´(scope) ä¼ å…¥å³å¯æ­£å¸¸ä½¿ç”¨ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token comment"># nginx-test/templates/service.yaml</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> template "nginx<span class="token punctuation">-</span>test.fullname" . <span class="token punctuation">}</span><span class="token punctuation">}</span>
  åœ¨æœ«å°¾ä¼ é€’äº† . è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ .Values æˆ–è€… .Chart æˆ–å…¶å®ƒèŒƒå›´(scope)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>5ã€Chart ä¾èµ–ï¼ˆrequirements.yaml)ï¼šæ¯”å¦‚ <code v-pre>WordPress Chart</code> ä¾èµ–äº mariadb Chartï¼Œ ä¸‹é¢æ˜¯ WordPress çš„ä¾èµ–(requirements.yaml)ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mariadb
  <span class="token key atrule">version</span><span class="token punctuation">:</span> 5.x.x
  <span class="token key atrule">repository</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//kubernetes<span class="token punctuation">-</span>charts.storage.googleapis.com/
  <span class="token key atrule">condition</span><span class="token punctuation">:</span> mariadb.enabled
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> wordpress<span class="token punctuation">-</span>database
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥æ–‡ä»¶åˆ—ä¸¾å½“å‰ Chart æ‰€æœ‰çš„ ä¾èµ–ï¼ˆsubchart)ã€‚æœ‰å‡ ä¸ªå­—æ®µæ˜¯å¿…è¦çš„ï¼š</p>
<ul>
<li>name: ä¾èµ– Chart çš„åç§°ï¼ˆå¿…è¦ï¼‰</li>
<li>version: ä¾èµ– Chart çš„ç‰ˆæœ¬å·ï¼ˆå¿…è¦ï¼‰</li>
<li>repository: ä¾èµ– Chart çš„å­˜å‚¨åº“å®Œæ•´URLï¼Œå¿…é¡»é€šè¿‡ helm repo add æ·»åŠ  repositoryï¼ˆå­˜å‚¨åº“ï¼‰åˆ°æœ¬åœ°</li>
</ul>
<h2 id="clusterfileæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#clusterfileæ–‡ä»¶" aria-hidden="true">#</a> Clusterfileæ–‡ä»¶</h2>
<blockquote>
<p>å½“æˆ‘ä»¬ä½¿ç”¨ <code v-pre>sealos</code> å¯åŠ¨ä¸€ä¸ªé›†ç¾¤é•œåƒçš„æ—¶å€™æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ª <code v-pre>Clusterfile</code> æ–‡ä»¶ã€‚</p>
</blockquote>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@VM-4-3-ubuntu:~/.sealos/default# cat Clusterfile 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><details class="custom-container details"><summary>å±•å¼€</summary>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code>root@VM<span class="token punctuation">-</span>4<span class="token punctuation">-</span>3<span class="token punctuation">-</span>ubuntu<span class="token punctuation">:</span>~/.sealos/default<span class="token comment"># cat Clusterfile </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps.sealos.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">"2022-10-20T13:12:33Z"</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ips</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 10.0.4.3<span class="token punctuation">:</span><span class="token number">22</span>
    <span class="token key atrule">roles</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> master
    <span class="token punctuation">-</span> amd64
  <span class="token key atrule">image</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
  <span class="token punctuation">-</span> labring/helm<span class="token punctuation">:</span>v3.8.2
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
  <span class="token punctuation">-</span> labring/helm<span class="token punctuation">:</span>v3.8.2
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
  <span class="token punctuation">-</span> labring/calico<span class="token punctuation">:</span>v3.24.1
  <span class="token punctuation">-</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
  <span class="token key atrule">ssh</span><span class="token punctuation">:</span>
    <span class="token key atrule">passwd</span><span class="token punctuation">:</span> <span class="token string">'[your-ssh-passwd]'</span>
    <span class="token key atrule">pk</span><span class="token punctuation">:</span> /root/.ssh/id_rsa
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> root
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lastHeartbeatTime</span><span class="token punctuation">:</span> <span class="token string">"2022-11-03T11:10:06Z"</span>
    <span class="token key atrule">message</span><span class="token punctuation">:</span> Applied to cluster successfully
    <span class="token key atrule">reason</span><span class="token punctuation">:</span> Ready
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ApplyClusterSuccess
  <span class="token key atrule">mounts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">criData</span><span class="token punctuation">:</span> /var/lib/containerd
      <span class="token key atrule">registryConfig</span><span class="token punctuation">:</span> /etc/registry
      <span class="token key atrule">registryData</span><span class="token punctuation">:</span> /var/lib/registry
      <span class="token key atrule">registryDomain</span><span class="token punctuation">:</span> sealos.hub
      <span class="token key atrule">registryPassword</span><span class="token punctuation">:</span> passw0rd
      <span class="token key atrule">registryPort</span><span class="token punctuation">:</span> <span class="token string">"5000"</span>
      <span class="token key atrule">registryUsername</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/kubernetes<span class="token punctuation">:</span>v1.25.0
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">auth</span><span class="token punctuation">:</span> auth.sh
      <span class="token key atrule">check</span><span class="token punctuation">:</span> check.sh $registryData
      <span class="token key atrule">clean</span><span class="token punctuation">:</span> clean.sh $criData
      <span class="token key atrule">clean-registry</span><span class="token punctuation">:</span> clean<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/labring/lvscare<span class="token punctuation">:</span>v4.1.3
      <span class="token key atrule">init</span><span class="token punctuation">:</span> init.sh $registryDomain $registryPort
      <span class="token key atrule">init-registry</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
      <span class="token key atrule">sealos.io.type</span><span class="token punctuation">:</span> rootfs
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v1.25.0
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/d6743e52e7bd4635107a4e7b586892dd505c9f5e4c5d040f16004f571934bb33/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>a26bij8e
    <span class="token key atrule">type</span><span class="token punctuation">:</span> rootfs
  <span class="token punctuation">-</span> <span class="token key atrule">cmd</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> cp opt/helm /usr/bin/
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/helm<span class="token punctuation">:</span>v3.8.2
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/a673232bd58b472065d8741c307394e0371b0b8e5e4c199e7e1c3f5df05285d0/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>7bztc4cy
    <span class="token key atrule">type</span><span class="token punctuation">:</span> application
  <span class="token punctuation">-</span> <span class="token key atrule">cmd</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> kubectl create namespace tigera<span class="token punctuation">-</span>operator
    <span class="token punctuation">-</span> helm install calico charts/calico <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace tigera<span class="token punctuation">-</span>operator
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/calico<span class="token punctuation">:</span>v3.24.1
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/89823056d3a1c3d2daaa7d4c90e3a50c03ff82cb70dfed0ec22b06307a875411/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>orerq6tp
    <span class="token key atrule">type</span><span class="token punctuation">:</span> application
  <span class="token punctuation">-</span> <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">criData</span><span class="token punctuation">:</span> /var/lib/docker
      <span class="token key atrule">criDockerdData</span><span class="token punctuation">:</span> /var/lib/cri<span class="token punctuation">-</span>dockerd
      <span class="token key atrule">registryConfig</span><span class="token punctuation">:</span> /etc/registry
      <span class="token key atrule">registryData</span><span class="token punctuation">:</span> /var/lib/registry
      <span class="token key atrule">registryDomain</span><span class="token punctuation">:</span> sealos.hub
      <span class="token key atrule">registryPassword</span><span class="token punctuation">:</span> passw0rd
      <span class="token key atrule">registryPort</span><span class="token punctuation">:</span> <span class="token string">"5000"</span>
      <span class="token key atrule">registryUsername</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">imageName</span><span class="token punctuation">:</span> labring/kubernetes<span class="token punctuation">-</span>docker<span class="token punctuation">:</span>v1.20.5<span class="token punctuation">-</span>4.1.3
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">auth</span><span class="token punctuation">:</span> auth.sh $registryDomain $registryPort $registryUsername $registryPassword
      <span class="token key atrule">check</span><span class="token punctuation">:</span> check.sh $registryData
      <span class="token key atrule">clean</span><span class="token punctuation">:</span> clean.sh $criData $criDockerdData
      <span class="token key atrule">clean-registry</span><span class="token punctuation">:</span> clean<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/labring/lvscare<span class="token punctuation">:</span>v4.1.3
      <span class="token key atrule">init</span><span class="token punctuation">:</span> init.sh
      <span class="token key atrule">init-registry</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>registry.sh $registryData $registryConfig
      <span class="token key atrule">io.buildah.version</span><span class="token punctuation">:</span> 1.25.0<span class="token punctuation">-</span>dev
      <span class="token key atrule">sealos.io.type</span><span class="token punctuation">:</span> rootfs
      <span class="token key atrule">sealos.io.version</span><span class="token punctuation">:</span> v1beta1
      <span class="token key atrule">version</span><span class="token punctuation">:</span> v1.20.5
    <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> /var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/merged
    <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>km12aep7
    <span class="token key atrule">type</span><span class="token punctuation">:</span> rootfs
  <span class="token key atrule">phase</span><span class="token punctuation">:</span> ClusterSuccess
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<p>æˆ‘ä»¬è¿›å…¥ <code v-pre>/var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/</code> ç›®å½•ï¼ˆè¿™é‡Œé¢å°±æ˜¯ rootfsï¼‰ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> /var/lib/containers/storage/overlay/4af662552ff4c7c5b2fa7ca9995664911e72528ad964f0c181a7f5d718716e2d/merged
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>**è¿™ä¸ªé‡Œé¢å°±æœ‰æ‰€æœ‰æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢æœ‰å®‰è£… <code v-pre>k8s</code> æ‰€æœ‰çš„ä¾èµ– **</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>ca9995664911e72528ad964f0c181a7f5d718716e2d/merged<span class="token comment"># ls</span>
bin  cri  etc  images  Kubefile  opt  README.md  registry  scripts  statics
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>bin</code> å¸¦ç€ä¸€äº›é›†ç¾¤éœ€è¦çš„ <code v-pre>kubeadm</code> ã€<code v-pre>kubelet</code></li>
<li><code v-pre>images</code> é‡Œé¢æ–‡ä»¶ä¸­æœ‰ <code v-pre>docker</code> é•œåƒåˆ—è¡¨å’Œåœ°å€ï¼ˆè½¬k8sé›†ç¾¤éœ€è¦çš„ï¼Œä¼šè‡ªåŠ¨æ‹‰å–ä¸‹é¢çš„~ï¼‰</li>
<li><code v-pre>etcd</code> å„ç§é…ç½®æ–‡ä»¶</li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>/merged<span class="token comment"># cat images/shim/DefaultI</span>
mageList 
k8s.gcr.io/kube-apiserver:v1.20.5
k8s.gcr.io/kube-controller-manager:v1.20.5
k8s.gcr.io/kube-scheduler:v1.20.5
k8s.gcr.io/kube-proxy:v1.20.5
k8s.gcr.io/pause:3.2
k8s.gcr.io/etcd:3.4.13-0
k8s.gcr.io/coredns:1.7.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ‰€ä»¥ <code v-pre>sealos run</code> çš„æ—¶å€™å…ˆæ‰¾<code v-pre>sealos</code> é•œåƒä»“åº“ä¸­çš„ã€‚</strong></p>
<p><strong>æ„å»ºå½“å‰é›†ç¾¤é•œåƒï¼š</strong></p>
<div class="language-docker ext-docker line-numbers-mode"><pre v-pre class="language-docker"><code>ca9995664911e72528ad964f0c181a7f5d718716e2d/merged# cat Kubefile 
<span class="token instruction"><span class="token keyword">FROM</span> scratch</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> sealos</span>
<span class="token instruction"><span class="token keyword">LABEL</span> init=<span class="token string">"init.sh"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> version=<span class="token string">"v1.20.5"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> image=<span class="token string">"ghcr.io/labring/lvscare:v4.1.3"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> clean=<span class="token string">"clean.sh \$criData \$criDockerdData"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> check=<span class="token string">"check.sh \$registryData"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> init-registry=<span class="token string">"init-registry.sh \$registryData \$registryConfig"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> clean-registry=<span class="token string">"clean-registry.sh \$registryData \$registryConfig"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> auth=<span class="token string">"auth.sh \$registryDomain \$registryPort \$registryUsername \$registryPassword"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> sealos.io.type=<span class="token string">"rootfs"</span></span>
<span class="token instruction"><span class="token keyword">LABEL</span> sealos.io.version=<span class="token string">"v1beta1"</span></span>
<span class="token instruction"><span class="token keyword">ENV</span> criData=/var/lib/docker</span>
<span class="token instruction"><span class="token keyword">ENV</span> criDockerdData=/var/lib/cri-dockerd</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryData=/var/lib/registry</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryConfig=/etc/registry</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryDomain=sealos.hub</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryPort=5000</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryUsername=admin</span>
<span class="token instruction"><span class="token keyword">ENV</span> registryPassword=passw0rd</span>
<span class="token instruction"><span class="token keyword">COPY</span> . .</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æˆ‘ä»¬å¯ä»¥ç›´æ¥ build å‡ºä¸€ä¸ªé•œåƒï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>sealos build <span class="token parameter variable">-t</span> calico:latest <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬ä¼šæŠŠ <code v-pre>calica</code> ä¾èµ–çš„æ‰€æœ‰é•œåƒæ‹‰å–ä¸‹æ¥ï¼Œæ”¾åˆ° <code v-pre>registry</code> ç›®å½•ä¸‹é¢ã€‚</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '1.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '3.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


