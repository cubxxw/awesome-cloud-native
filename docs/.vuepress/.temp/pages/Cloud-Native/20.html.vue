<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬20èŠ‚-æ–°ä¼šè®®æ”¹å˜basefs" tabindex="-1"><a class="header-anchor" href="#ç¬¬20èŠ‚-æ–°ä¼šè®®æ”¹å˜basefs" aria-hidden="true">#</a> ç¬¬20èŠ‚ æ–°ä¼šè®®æ”¹å˜basefs</h1>
<div><a href = '19.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '21.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•è®°å½•<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">sealos<ExternalLinkIcon/></a>å¼€æºé¡¹ç›®çš„å­¦ä¹ è¿‡ç¨‹ã€‚<a href="https://github.com/3293172751/sealos" target="_blank" rel="noopener noreferrer">k8s,dockerå’Œäº‘åŸç”Ÿçš„å­¦ä¹ <ExternalLinkIcon/></a>ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="å¼€å§‹" tabindex="-1"><a class="header-anchor" href="#å¼€å§‹" aria-hidden="true">#</a> å¼€å§‹</h2>
<ul>
<li>add image spec definition <a href="https://github.com/sealerio/sealer/pull/1915" target="_blank" rel="noopener noreferrer">#1915<ExternalLinkIcon/></a></li>
<li>New design for basefs <a href="https://github.com/sealerio/sealer/pull/1909" target="_blank" rel="noopener noreferrer">#1909<ExternalLinkIcon/></a></li>
<li>sealer new doc <a href="https://github.com/sealerio/sealer.cool/issues/15" target="_blank" rel="noopener noreferrer">sealerio/sealer.cool#15<ExternalLinkIcon/></a></li>
<li>More detail about How to implement image policy for sealer using Kyverno <a href="https://github.com/sealerio/sealer/issues/1899" target="_blank" rel="noopener noreferrer">#1899<ExternalLinkIcon/></a></li>
<li>sealer CI e2e-test by using github action <a href="https://github.com/sealerio/sealer/issues/1633" target="_blank" rel="noopener noreferrer">#1633<ExternalLinkIcon/></a></li>
</ul>
<hr>
<p><strong>å…³äºbasefs çš„è®¾è®¡ï¼š</strong></p>
<ul>
<li><a href="https://github.com/sealerio/basefs" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/basefs<ExternalLinkIcon/></a></li>
</ul>
<h2 id="å…³äºrootfsçš„å®‰æ’" tabindex="-1"><a class="header-anchor" href="#å…³äºrootfsçš„å®‰æ’" aria-hidden="true">#</a> å…³äºrootfsçš„å®‰æ’</h2>
<ul>
<li><a href="https://github.com/sealerio/sealer/pull/1909" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/pull/1909<ExternalLinkIcon/></a></li>
</ul>
<h3 id="æè¿°" tabindex="-1"><a class="header-anchor" href="#æè¿°" aria-hidden="true">#</a> æè¿°</h3>
<p>ç­¾å­—äººï¼šhuaiyou <a href="https://mail.google.com/mail/?view=cm&amp;fs=1&amp;tf=1&amp;to=huaiyou.cyz@alibaba-inc.com" target="_blank" rel="noopener noreferrer">huaiyou.cyz@alibaba-inc.com<ExternalLinkIcon/></a></p>
<p>ä¸ºäº†æ–¹ä¾¿åŸºç¡€é•œåƒåˆ¶ä½œè€…çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ sealer çš„ rootfs å®šä¹‰è¿›è¡Œè§„èŒƒã€‚</p>
<p><strong>æˆ‘ä¸»è¦åšäº†ä»¥ä¸‹è®¾è®¡ï¼š</strong></p>
<ol>
<li>bin ç­‰å’Œ plugins çš„ç”¨é€”åŸºæœ¬ç›¸åŒï¼Œåªæ˜¯æ˜ç¡®äº†ä½¿ç”¨æ–¹æ³•ã€‚</li>
<li>é˜æ˜ Metadataã€README.md å’Œ imageList çš„ç”¨é€”ã€‚</li>
<li>æ–°å¢ yamls å’Œ charts ä¸¤ä¸ªç›®å½•ï¼Œä¸ºç”¨æˆ·æä¾›æ›´çµæ´»æ‰©å±•åŸºç¡€é•œåƒçš„èƒ½åŠ›ã€‚</li>
<li>æœ€åæ˜ç¡®äº†scriptsä¸‹ä¸åŒè„šæœ¬çš„ç”¨é€”ã€‚</li>
</ol>
<p>ä¸ºäº†æ–¹ä¾¿åŸºç¡€é•œåƒåˆ¶ä½œè€…çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ ‡å‡†åŒ– sealer çš„ rootfs çš„å®šä¹‰ã€‚</p>
<p>æˆ‘ä¸»è¦åšäº†ä»¥ä¸‹è®¾è®¡ï¼š</p>
<ol>
<li><code v-pre>bin</code>ï¼Œ<code v-pre>etc</code>ï¼Œ<code v-pre>plugins</code> è¿™å‡ ä¸ªç›®å½•çš„ä½¿ç”¨åŸºæœ¬ä¸å˜ï¼Œåªæ˜¯æ˜ç¡®äº†ä½¿ç”¨æ–¹å¼ã€‚</li>
<li>æ˜ç¡®å®š <code v-pre>scripts</code> ä¸‹çš„ä¸åŒè„šæœ¬çš„ç”¨é€”ã€‚</li>
</ol>
<h3 id="è®¾è®¡è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡è§„èŒƒ" aria-hidden="true">#</a> è®¾è®¡è§„èŒƒ</h3>
<ul>
<li><a href="https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md" target="_blank" rel="noopener noreferrer">https://github.com/sealerio/sealer/blob/ec9d2b561eaa20ff59bea28303669b3da0d7c4dd/docs/api/cloudrootfs.md<ExternalLinkIcon/></a></li>
</ul>
<h2 id="cloud-rootfs" tabindex="-1"><a class="header-anchor" href="#cloud-rootfs" aria-hidden="true">#</a> cloud rootfs</h2>
<p>cloud rootfs will package all the dependencies refers to the kubernetes cluster requirements</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code><span class="token punctuation">.</span>
â”œâ”€â”€ bin # binaries will be installed at all nodes' <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin
â”‚   â”œâ”€â”€ conntrack
â”‚   â”œâ”€â”€ containerd<span class="token operator">-</span>rootless<span class="token operator">-</span>setuptool<span class="token punctuation">.</span>sh
â”‚   â”œâ”€â”€ containerd<span class="token operator">-</span>rootless<span class="token punctuation">.</span>sh
â”‚   â”œâ”€â”€ crictl
â”‚   â”œâ”€â”€ kubeadm
â”‚   â”œâ”€â”€ kubectl
â”‚   â”œâ”€â”€ kubelet
â”‚   â”œâ”€â”€ nerdctl
â”‚   â”œâ”€â”€ kubelet<span class="token operator">-</span>pre<span class="token operator">-</span>start<span class="token punctuation">.</span>sh
â”‚   â”œâ”€â”€ helm
â”‚   â””â”€â”€ seautil
â”œâ”€â”€ etc # configs will be put into all nodes' sealer<span class="token operator">-</span>rootfs
â”‚   â”œâ”€â”€ <span class="token number">10</span><span class="token operator">-</span>kubeadm<span class="token punctuation">.</span>conf
â”‚   â”œâ”€â”€ daemon<span class="token punctuation">.</span>json
â”‚   â”œâ”€â”€ docker<span class="token punctuation">.</span>service
â”‚   â”œâ”€â”€ audit<span class="token operator">-</span>policy<span class="token punctuation">.</span>yml
â”‚   â”œâ”€â”€ kubeadm<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml
â”‚   â”œâ”€â”€ kubeadm<span class="token operator">-</span>config<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>tmpl # a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>tmpl will be rendered using envs and rename to a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c
â”‚   â””â”€â”€ kubelet<span class="token punctuation">.</span>service
â”œâ”€â”€ plugins # plugins can run on some hooks<span class="token punctuation">,</span> such as pre<span class="token operator">-</span>init<span class="token operator">-</span>host<span class="token punctuation">,</span> post<span class="token operator">-</span>install<span class="token punctuation">,</span> see more in the plugins documentation
â”‚   â””â”€â”€ disk_init_shell_plugin<span class="token punctuation">.</span>yaml
â”œâ”€â”€ scripts # scripts can use all ClusterFile's env as Linux env variables
â”‚   â”œâ”€â”€ init<span class="token operator">-</span>kube<span class="token punctuation">.</span>sh # initialize kube<span class="token operator">*</span> binaries on target hosts
â”‚   â”œâ”€â”€ clean<span class="token operator">-</span>kube<span class="token punctuation">.</span>sh # remove kube<span class="token operator">*</span> binaries from target hosts
â”‚   â”œâ”€â”€ init<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>sh # initialize container runtime binaries on target hosts
â”‚   â”œâ”€â”€ clean<span class="token operator">-</span>container<span class="token operator">-</span>runtime<span class="token punctuation">.</span>sh # remove container runtime binaries on target hosts
â”‚   â””â”€â”€ init<span class="token operator">-</span>registry<span class="token punctuation">.</span>sh # initialize registry on local registry's deploy<span class="token operator">-</span>hosts
â””â”€â”€ applications # applications put here
â”‚   â”œâ”€â”€ redis
â”‚   â””â”€â”€ mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Using cloud rootfs to build a base cloudImage:</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>FROM scratch
COPY <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
sealer build <span class="token parameter variable">-t</span> kuberntes:v1.18.3 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hooks" tabindex="-1"><a class="header-anchor" href="#hooks" aria-hidden="true">#</a> Hooks</h2>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>FROM kubernetes:1.18.3
COPY preHook.sh /scripts/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>preHook.sh will execute after init.sh before kubeadm init master0</p>
<h2 id="registry" tabindex="-1"><a class="header-anchor" href="#registry" aria-hidden="true">#</a> Registry</h2>
<p>registry container name must be 'sealer-registry'</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '19.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '21.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


