<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬26èŠ‚-helm-æ•™ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬26èŠ‚-helm-æ•™ç¨‹" aria-hidden="true">#</a> ç¬¬26èŠ‚ helm æ•™ç¨‹</h1>
<div><a href = '25.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '27.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<nav class="table-of-contents"><ul><li><router-link to="#helmä»‹ç»">helmä»‹ç»</router-link></li><li><router-link to="#k3s-helm">k3s helm</router-link><ul><li><router-link to="#è‡ªåŠ¨éƒ¨ç½²-helm-charts">è‡ªåŠ¨éƒ¨ç½² Helm charts</router-link></li><li><router-link to="#ä½¿ç”¨-helm-crd">ä½¿ç”¨ Helm CRD</router-link></li><li><router-link to="#helmchart-å­—æ®µå®šä¹‰">HelmChart å­—æ®µå®šä¹‰</router-link></li><li><router-link to="#ä½¿ç”¨-helmchartconfig-è‡ªå®šä¹‰æ‰“åŒ…çš„ç»„ä»¶">ä½¿ç”¨ HelmChartConfig è‡ªå®šä¹‰æ‰“åŒ…çš„ç»„ä»¶</router-link></li></ul></li><li><router-link to="#v2-vs-v3">v2 vs v3</router-link><ul><li><router-link to="#åŒºåˆ«å¯¹æ¯”">åŒºåˆ«å¯¹æ¯”</router-link></li></ul></li><li><router-link to="#helm-controller">Helm Controller</router-link></li><li><router-link to="#helmå®‰è£…">helmå®‰è£…</router-link><ul><li><router-link to="#ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£…">ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£…</router-link></li><li><router-link to="#ä½¿ç”¨è„šæœ¬å®‰è£…">ä½¿ç”¨è„šæœ¬å®‰è£…</router-link></li></ul></li><li><router-link to="#é…ç½®helmæº">é…ç½®helmæº</router-link></li><li><router-link to="#å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹</router-link><ul><li><router-link to="#å’Œdockerä¸€æ ·-æœç´¢å¯ç”¨çš„åŒ…">å’Œdockerä¸€æ ·ï¼Œæœç´¢å¯ç”¨çš„åŒ…ï¼š</router-link></li><li><router-link to="#helmåŒ…æ‹‰å–">helmåŒ…æ‹‰å–</router-link></li><li><router-link to="#å®‰è£…é›†ç¾¤é•œåƒ">å®‰è£…é›†ç¾¤é•œåƒ</router-link></li></ul></li><li><router-link to="#helm-é…ç½®å®‰è£…é›†ç¾¤">helm é…ç½®å®‰è£…é›†ç¾¤</router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<h2 id="helmä»‹ç»" tabindex="-1"><a class="header-anchor" href="#helmä»‹ç»" aria-hidden="true">#</a> helmä»‹ç»</h2>
<div class="custom-container tip"><p class="custom-container-title">æç¤º</p>
<p>ä½¿ç”¨ <code v-pre>Helm</code> æˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„å°±æ­å»ºå‡ºæ¥ <code v-pre>MongoDB</code> / <code v-pre>MySQL</code> å‰¯æœ¬é›†ç¾¤ï¼Œ<code v-pre>YAML</code> æ–‡ä»¶åˆ«äººéƒ½ç»™æˆ‘ä»¬å†™å¥½äº†ï¼Œç›´æ¥ä½¿ç”¨ã€‚</p>
<p><code v-pre>helm</code>çš„ä½œç”¨å°±æ˜¯æŠŠè®¸å¤šçš„èµ„æºå®šä¹‰ æ¯”å¦‚<code v-pre>svc</code>ï¼Œ<code v-pre>deployment</code>ï¼Œä¸€æ¬¡æ€§é€šè¿‡å…¨éƒ¨å®šä¹‰å¥½ï¼Œæ”¾åœ¨æºé‡Œç»Ÿä¸€ç®¡ç†ï¼Œè¿™æ ·å¾ˆå®¹æ˜“åœ¨å…¶ä»–æœºå™¨ä¸Šéƒ¨ç½²ï¼Œä¸ªäººç†è§£è¿™ä¸ªç±»ä¼¼äºè‡ªåŠ¨åŒ–è¿ç»´ä¸­<code v-pre>ansible</code>ä¸­çš„è§’è‰²æ¦‚å¿µï¼Œå‰ç«¯é¡¹ç›®ä¸­çš„<code v-pre>npm</code>åŒ…ç®¡ç†å·¥å…·,åç«¯é¡¹ç›®ä¸­çš„<code v-pre>maven</code>ç­‰æ„å»ºå·¥å…·ä¸€æ ·ï¼Œç±»æ¯”<code v-pre>Ansible</code>ä½¿ç”¨è§’è‰²æ¥æ•´åˆ<code v-pre>playbook.yaml</code>è¾¾åˆ°å¤ç”¨æ€§ã€‚åŒæ ·çš„ï¼Œä½¿ç”¨<code v-pre>helm</code>ç”¨äºæ•´åˆk8sä¸­çš„èµ„æºå¯¹è±¡<code v-pre>yaml</code>æ–‡ä»¶ï¼Œå®ç°å¤ç”¨æ€§,åŒæ—¶è®²èµ„æºæ–‡ä»¶çš„å‚æ•°ï¼Œå’Œå‚æ•°å€¼é€šè¿‡<code v-pre>temple</code>å’Œ<code v-pre>value</code>è¿›è¡Œäº†åˆ†ç¦»ã€‚</p>
<ul>
<li><a href="https://helm.sh/zh/" target="_blank" rel="noopener noreferrer">å®˜ç½‘<ExternalLinkIcon/></a></li>
<li><a href="https://artifacthub.io/" target="_blank" rel="noopener noreferrer">åº”ç”¨ä¸­å¿ƒ<ExternalLinkIcon/></a></li>
</ul>
</div>
<h2 id="k3s-helm" tabindex="-1"><a class="header-anchor" href="#k3s-helm" aria-hidden="true">#</a> k3s helm</h2>
<p>K3s ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„é…ç½®å°±å¯ä»¥ä½¿ç”¨ Helm å‘½ä»¤è¡Œå·¥å…·ã€‚åªè¦ç¡®ä¿ä½ å·²ç»æŒ‰ç…§<a href="http://docs.rancher.cn/docs/k3s/cluster-access/_index/" target="_blank" rel="noopener noreferrer">é›†ç¾¤è®¿é—®<ExternalLinkIcon/></a>ä¸€èŠ‚æ­£ç¡®è®¾ç½®äº†ä½ çš„ kubeconfigã€‚ K3s é€šè¿‡ rancher/helm-release CRD ä½¿ä¼ ç»Ÿçš„ Kubernetes èµ„æºæ¸…å•å’Œ Helm Charts éƒ¨ç½²æ›´åŠ å®¹æ˜“ã€‚</p>
<h3 id="è‡ªåŠ¨éƒ¨ç½²-helm-charts" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨éƒ¨ç½²-helm-charts" aria-hidden="true">#</a> è‡ªåŠ¨éƒ¨ç½² Helm charts</h3>
<p>åœ¨<code v-pre>/var/lib/rancher/k3s/server/manifests</code>ä¸­æ‰¾åˆ°çš„ä»»ä½• Kubernetes æ¸…å•å°†ä»¥ç±»ä¼¼<code v-pre>kubectl apply</code>çš„æ–¹å¼è‡ªåŠ¨éƒ¨ç½²åˆ° K3sã€‚ä»¥è¿™ç§æ–¹å¼éƒ¨ç½²çš„ manifests æ˜¯ä½œä¸º AddOn è‡ªå®šä¹‰èµ„æºæ¥ç®¡ç†çš„ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ<code v-pre>kubectl get addon -A</code>æ¥æŸ¥çœ‹ã€‚ä½ ä¼šå‘ç°æ‰“åŒ…ç»„ä»¶çš„ AddOnsï¼Œå¦‚ CoreDNSã€Local-Storageã€Traefik ç­‰ã€‚AddOns æ˜¯ç”±éƒ¨ç½²æ§åˆ¶å™¨è‡ªåŠ¨åˆ›å»ºçš„ï¼Œå¹¶æ ¹æ®å®ƒä»¬åœ¨ manifests ç›®å½•ä¸‹çš„æ–‡ä»¶åå‘½åã€‚</p>
<p>ä¹Ÿå¯ä»¥å°† Helm Chart ä½œä¸º AddOns éƒ¨ç½²ã€‚K3s åŒ…æ‹¬ä¸€ä¸ª<a href="https://github.com/rancher/helm-controller/" target="_blank" rel="noopener noreferrer">Helm Controller<ExternalLinkIcon/></a>ï¼Œå®ƒä½¿ç”¨ HelmChart Custom Resource Definition(CRD)ç®¡ç† Helm Chartã€‚</p>
<h3 id="ä½¿ç”¨-helm-crd" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-helm-crd" aria-hidden="true">#</a> ä½¿ç”¨ Helm CRD</h3>
<p><a href="https://github.com/rancher/helm-controller#helm-controller" target="_blank" rel="noopener noreferrer">HelmChart CRD<ExternalLinkIcon/></a>æ•è·äº†å¤§å¤šæ•°ä½ é€šå¸¸ä¼šä¼ é€’ç»™<code v-pre>helm</code>å‘½ä»¤è¡Œå·¥å…·çš„é€‰é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä»é»˜è®¤çš„ Chart èµ„æºåº“ä¸­éƒ¨ç½² Grafanaï¼Œè¦†ç›–ä¸€äº›é»˜è®¤çš„ Chart å€¼ã€‚è¯·æ³¨æ„ï¼ŒHelmChart èµ„æºæœ¬èº«åœ¨ <code v-pre>kube-system</code> å‘½åç©ºé—´ï¼Œä½† Chart èµ„æºå°†è¢«éƒ¨ç½²åˆ° <code v-pre>monitoring</code> å‘½åç©ºé—´ã€‚</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> helm.cattle.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HelmChart
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">chart</span><span class="token punctuation">:</span> stable/grafana
  <span class="token key atrule">targetNamespace</span><span class="token punctuation">:</span> monitoring
  <span class="token key atrule">set</span><span class="token punctuation">:</span>
    <span class="token key atrule">adminPassword</span><span class="token punctuation">:</span> <span class="token string">"NotVerySafePassword"</span>
  <span class="token key atrule">valuesContent</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span>
      <span class="token key atrule">tag</span><span class="token punctuation">:</span> master
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">GF_EXPLORE_ENABLED</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">adminUser</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">sidecar</span><span class="token punctuation">:</span>
      <span class="token key atrule">datasources</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="helmchart-å­—æ®µå®šä¹‰" tabindex="-1"><a class="header-anchor" href="#helmchart-å­—æ®µå®šä¹‰" aria-hidden="true">#</a> HelmChart å­—æ®µå®šä¹‰</h3>
<table>
<thead>
<tr>
<th style="text-align:left">å­—æ®µ</th>
<th style="text-align:left">é»˜è®¤å€¼</th>
<th style="text-align:left">æè¿°</th>
<th style="text-align:left">Helm Argument / Flag Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">name</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">Helm Chart åç§°</td>
<td style="text-align:left">NAME</td>
</tr>
<tr>
<td style="text-align:left">spec.chart</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">ä»“åº“ä¸­çš„ Helm Chart åç§°ï¼Œæˆ–å®Œæ•´çš„ HTTPS URLï¼ˆ.tgzï¼‰ã€‚</td>
<td style="text-align:left">CHART</td>
</tr>
<tr>
<td style="text-align:left">spec.targetNamespace</td>
<td style="text-align:left">default</td>
<td style="text-align:left">Helm Chart ç›®æ ‡å‘½åç©ºé—´</td>
<td style="text-align:left"><code v-pre>--namespace</code></td>
</tr>
<tr>
<td style="text-align:left">spec.version</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">Helm Chart ç‰ˆæœ¬(ä»ç‰ˆæœ¬åº“å®‰è£…æ—¶ä½¿ç”¨çš„ç‰ˆæœ¬å·)</td>
<td style="text-align:left"><code v-pre>--version</code></td>
</tr>
<tr>
<td style="text-align:left">spec.repo</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">Helm Chart ç‰ˆæœ¬åº“ URL åœ°å€</td>
<td style="text-align:left"><code v-pre>--repo</code></td>
</tr>
<tr>
<td style="text-align:left">spec.helmVersion</td>
<td style="text-align:left">v3</td>
<td style="text-align:left">Helm çš„ç‰ˆæœ¬å·ï¼Œå¯é€‰å€¼ä¸º <code v-pre>v2</code> å’Œ<code v-pre>v3</code>ï¼Œé»˜è®¤å€¼ä¸º <code v-pre>v3</code></td>
<td style="text-align:left">N/A</td>
</tr>
<tr>
<td style="text-align:left">spec.set</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">è¦†ç›–ç®€å•çš„é»˜è®¤ Chart å€¼ã€‚è¿™äº›å€¼ä¼˜å…ˆäºé€šè¿‡ valuesContent è®¾ç½®çš„é€‰é¡¹ã€‚</td>
<td style="text-align:left"><code v-pre>--set</code> / <code v-pre>--set-string</code></td>
</tr>
<tr>
<td style="text-align:left">spec.jobImage</td>
<td style="text-align:left"></td>
<td style="text-align:left">æŒ‡å®šå®‰è£… helm chart æ—¶è¦ä½¿ç”¨çš„é•œåƒã€‚å¦‚ï¼šrancher/klipper-helm:v0.3.0ã€‚</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">spec.valuesContent</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">é€šè¿‡ YAML æ–‡ä»¶å†…å®¹è¦†ç›–å¤æ‚çš„é»˜è®¤ Chart å€¼ã€‚</td>
<td style="text-align:left"><code v-pre>--values</code></td>
</tr>
<tr>
<td style="text-align:left">spec.chartContent</td>
<td style="text-align:left">N/A</td>
<td style="text-align:left">Base64 ç¼–ç çš„ Chart å­˜æ¡£.tgz - è¦†ç›– spec.chartã€‚</td>
<td style="text-align:left">CHART</td>
</tr>
</tbody>
</table>
<p>æ”¾åœ¨<code v-pre>/var/lib/rancher/k3s/server/static/</code>ä¸­çš„å†…å®¹å¯ä»¥é€šè¿‡ Kubernetes APIServer ä»é›†ç¾¤å†…åŒ¿åè®¿é—®ã€‚è¿™ä¸ª URL å¯ä»¥ä½¿ç”¨<code v-pre>spec.chart</code>å­—æ®µä¸­çš„ç‰¹æ®Šå˜é‡<code v-pre>%{KUBERNETES_API}%</code>è¿›è¡Œæ¨¡æ¿åŒ–ã€‚ä¾‹å¦‚ï¼Œæ‰“åŒ…åçš„ Traefik ç»„ä»¶ä»<code v-pre>https://%{KUBERNETES_API}%/static/charts/traefik-1.81.0.tgz</code>åŠ è½½å…¶ Chartã€‚</p>
<h3 id="ä½¿ç”¨-helmchartconfig-è‡ªå®šä¹‰æ‰“åŒ…çš„ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-helmchartconfig-è‡ªå®šä¹‰æ‰“åŒ…çš„ç»„ä»¶" aria-hidden="true">#</a> ä½¿ç”¨ HelmChartConfig è‡ªå®šä¹‰æ‰“åŒ…çš„ç»„ä»¶</h3>
<p>ä¸ºäº†å…è®¸è¦†ç›–ä½œä¸º HelmChartsï¼ˆå¦‚ Traefikæˆ–å…¶ä»–é€šè¿‡helm crd éƒ¨ç½²çš„åº”ç”¨ï¼‰éƒ¨ç½²çš„æ‰“åŒ…ç»„ä»¶çš„å€¼ï¼Œä» v1.19.0+k3s1 å¼€å§‹çš„ K3s ç‰ˆæœ¬æ”¯æŒé€šè¿‡ HelmChartConfig CRD éƒ¨ç½²ã€‚HelmChartConfig èµ„æºå¿…é¡»ä¸å…¶å¯¹åº”çš„ HelmChart çš„åç§°å’Œå‘½åç©ºé—´ç›¸åŒ¹é…ï¼Œå¹¶æ”¯æŒæä¾›é¢å¤–çš„ &quot;valuesContent&quot;ï¼Œå®ƒä½œä¸ºä¸€ä¸ªé¢å¤–çš„å€¼æ–‡ä»¶ä¼ é€’ç»™<code v-pre>helm</code>å‘½ä»¤ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> HelmChart çš„<code v-pre>spec.set</code>å€¼è¦†ç›–äº† HelmChart å’Œ HelmChartConfig çš„<code v-pre>spec.valuesContent</code>è®¾ç½®ã€‚</p>
</blockquote>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> helm.cattle.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> HelmChartConfig
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> grafana
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">valuesContent</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    <span class="token key atrule">service</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦è‡ªå®šä¹‰æ‰“åŒ…åçš„ Traefik å…¥å£é…ç½®ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code v-pre>/var/lib/rancher/k3s/server/manifests/traefik-config.yaml</code>çš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶å¡«å……ä¸ºä»¥ä¸‹å†…å®¹ã€‚</p>
<details class="custom-container details"><summary>å‘½ä»¤é€ŸæŸ¥</summary>
<p>helmå¸¸ç”¨å‘½ä»¤ï¼š</p>
<p>1ã€æŸ¥çœ‹æœåŠ¡çŠ¶æ€</p>
<p><code v-pre>service httpd status</code></p>
<p>2ã€å¯åŠ¨æœåŠ¡</p>
<p><code v-pre>service httpd start</code></p>
<p>3ã€åœæ­¢æœåŠ¡</p>
<p><code v-pre>service httpd stop</code></p>
<p>4ã€é‡å¯æœåŠ¡</p>
<p><code v-pre>service httpd restart</code></p>
<p>5ã€é‡è½½é…ç½®æ–‡ä»¶</p>
<p><code v-pre>service httpd reload</code></p>
<p>6ã€æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ</p>
<p><code v-pre>netstat -tunlp</code></p>
<p>7ã€æŸ¥çœ‹httpdè¿›ç¨‹</p>
<p><code v-pre>ps -ef | grep httpd</code></p>
<p>8ã€æŸ¥çœ‹httpdç‰ˆæœ¬</p>
<p><code v-pre>httpd -v</code></p>
<p>9ã€æŸ¥çœ‹httpdé…ç½®æ–‡ä»¶</p>
<p><code v-pre>httpd -V</code></p>
<p>10ã€æŸ¥çœ‹httpdæ¨¡å—</p>
<p><code v-pre>httpd -l</code></p>
<p>11ã€æŸ¥çœ‹httpdæ¨¡å—è¯¦ç»†ä¿¡æ¯</p>
<p><code v-pre>httpd -M</code></p>
<p>12ã€æŸ¥çœ‹httpdå®‰è£…è·¯å¾„</p>
<p><code v-pre>httpd -V | grep SERVER_CONFIG_FILE</code></p>
<p>13ã€æŸ¥çœ‹httpdé”™è¯¯æ—¥å¿—</p>
<p><code v-pre>cat /var/log/httpd/error_log</code></p>
<p>14ã€æŸ¥çœ‹httpdè®¿é—®æ—¥å¿—</p>
<p><code v-pre>cat /var/log/httpd/access_log</code></p>
<p>15ã€æŸ¥çœ‹httpdé…ç½®æ–‡ä»¶</p>
<p><code v-pre>cat /etc/httpd/conf/httpd.conf</code></p>
<p>16ã€æŸ¥çœ‹httpdé…ç½®æ–‡ä»¶ä¸­çš„æ¨¡å—</p>
<p><code v-pre>cat /etc/httpd/conf/httpd.conf | grep LoadModule</code></p>
<p>17ã€æŸ¥çœ‹httpdé…ç½®æ–‡ä»¶ä¸­çš„è™šæ‹Ÿä¸»æœº</p>
<p><code v-pre>cat /etc/httpd/conf/httpd.conf | grep VirtualHost</code></p>
<p>18ã€æŸ¥çœ‹httpdé…ç½®æ–‡ä»¶ä¸­çš„ç›‘å¬ç«¯å£</p>
<p><code v-pre>cat /etc/httpd/conf/httpd.conf | grep Listen</code></p>
</details>
<div class="custom-container danger"><p class="custom-container-title">hemlè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
<p>æˆ‘ä»¬éƒ¨ç½²åº”ç”¨ï¼Ÿ</p>
<p><code v-pre>k8s</code> ä¸Šçš„åº”ç”¨å¯¹è±¡ï¼Œéƒ½æ˜¯ç”±ç‰¹å®šçš„èµ„æºæè¿°ç»„æˆï¼Œ åŒ…æ‹¬ <code v-pre>deployment</code>ã€<code v-pre>service</code> ç­‰ï¼Œéƒ½ä¿å­˜åœ¨å„è‡ªæ–‡ä»¶ä¸­æˆ–è€…é›†æˆåˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡ <code v-pre>kubectl apply -f</code> éƒ¨ç½²</p>
<blockquote>
<p><strong>æˆ‘ä»¬éƒ¨ç½²å°çš„åº”ç”¨ç¨‹åºè‚¯å®šæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯éƒ¨ç½²ä¸€ä¸ªå¤æ‚çš„åº”ç”¨ç®¡ç† <code v-pre>yaml</code> æ–‡ä»¶ï¼Œå¯èƒ½å°±æœ‰äº›éº»çƒ¦ã€‚</strong></p>
</blockquote>
<p><strong>æˆ‘ä»¬éœ€è¦ï¼š</strong></p>
<ol>
<li>å¦‚ä½•å°†è¿™äº›æœåŠ¡ä½œä¸ºä¸€ä¸ªæ•´ä½“ç®¡ç†</li>
<li>è¿™äº›èµ„æºæ–‡ä»¶å¦‚ä½•é«˜æ•ˆå¤ç”¨</li>
<li>ä¸æ”¯æŒåº”ç”¨çº§åˆ«çš„ç‰ˆæœ¬ç®¡ç†</li>
</ol>
</div>
<p>helmå°±èƒ½è§£å†³è¿™äº›é—®é¢˜ï¼Œå®ƒå°±ç±»ä¼¼äºLinuxä¸­çš„<code v-pre>yum</code>åŒ…æˆ–è€…<code v-pre>apt</code>åŒ…ã€‚</p>
<div class="custom-container tip"><p class="custom-container-title">æç¤º</p>
<ul>
<li><a href="https://github.com/helm/helm" target="_blank" rel="noopener noreferrer">å¼€æºé¡¹ç›®åœ°å€<ExternalLinkIcon/></a></li>
</ul>
<p>Helm æ˜¯ Kubernetes çš„é¦–é€‰åŒ…ç®¡ç†å·¥å…·ã€‚Helm Chart ä¸º Kubernetes YAML æ¸…å•æ–‡ä»¶æä¾›äº†æ¨¡æ¿åŒ–è¯­æ³•ã€‚é€šè¿‡ Helmï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¯é…ç½®çš„éƒ¨ç½²ï¼Œè€Œä¸ä»…ä»…æ˜¯ä½¿ç”¨é™æ€æ–‡ä»¶ã€‚æœ‰å…³åˆ›å»ºè‡ªå·±çš„éƒ¨ç½²ç›®å½•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://helm.sh/docs/intro/quickstart/" target="_blank" rel="noopener noreferrer">Helm å¿«é€Ÿå…¥é—¨<ExternalLinkIcon/></a>ã€‚</p>
<p>K3s ä¸éœ€è¦ä»»ä½•ç‰¹æ®Šçš„é…ç½®å°±å¯ä»¥ä½¿ç”¨ Helm å‘½ä»¤è¡Œå·¥å…·ã€‚åªè¦ç¡®ä¿ä½ å·²ç»æŒ‰ç…§<a href="https://docs.rancher.cn/docs/k3s/cluster-access/_index" target="_blank" rel="noopener noreferrer">é›†ç¾¤è®¿é—®<ExternalLinkIcon/></a>ä¸€èŠ‚æ­£ç¡®è®¾ç½®äº†ä½ çš„ kubeconfigã€‚ K3s åŒ…å«äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œé€šè¿‡<a href="https://docs.rancher.cn/docs/k3s/helm/_index#%E4%BD%BF%E7%94%A8-helm-crd" target="_blank" rel="noopener noreferrer">rancher/helm-release CRD<ExternalLinkIcon/></a>ï¼Œä½¿ä¼ ç»Ÿçš„ Kubernetes èµ„æºæ¸…å•å’Œ Helm Charts éƒ¨ç½²æ›´åŠ å®¹æ˜“ã€‚</p>
</div>
<h2 id="v2-vs-v3" tabindex="-1"><a class="header-anchor" href="#v2-vs-v3" aria-hidden="true">#</a> v2 vs v3</h2>
<p><strong>ç®€å•æ¥è¯´ï¼ŒHelmå°±æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹éƒ¨ç½²k8såº”ç”¨çš„å·¥å…·</strong></p>
<div class="custom-container tip"><p class="custom-container-title">helm v3 vs v2ç‰¹æ€§</p>
<p>å¦å¤–ï¼Œå¸¸ç”¨çš„Helmç‰ˆæœ¬æœ‰v2è·Ÿv3ï¼ŒHelm v3åŒºåˆ«äºv2ä¸»è¦æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>ç§»é™¤äº†Tiller(from SA to kubeconfig)</li>
<li>ä¸‰æ–¹ä¼šè°ˆ (Three-way Strategic merge patch)</li>
<li>ä½¿ç”¨Secretä½œä¸ºé»˜è®¤å­˜å‚¨</li>
</ul>
</div>
<h3 id="åŒºåˆ«å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#åŒºåˆ«å¯¹æ¯”" aria-hidden="true">#</a> åŒºåˆ«å¯¹æ¯”</h3>
<p><strong>1ã€ç§»é™¤äº†Tiller(from SA to kubeconfig)</strong></p>
<p>åŸæ¥Helm v2éœ€è¦åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²<code v-pre>Tiller</code>ï¼ˆ<code v-pre>Tiller</code> ç”¨äºæ¥æ”¶ Helm çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ® <code v-pre>Chart</code> ç”Ÿæˆ Kubernetes çš„éƒ¨ç½²æ–‡ä»¶ï¼‰ï¼Œ<code v-pre>Tiller pod</code> æ ¹æ®è‡ªèº«SAæƒé™éƒ¨ç½²åº”ç”¨ã€‚å¹¶ä¸”åœ¨å¤šç§Ÿæˆ·ç¯å¢ƒä¸‹ï¼Œä¸ºäº†è¿›è¡Œæƒé™ç®¡ç†éœ€è¦éƒ¨ç½²å¤šä¸ª<code v-pre>Tiller</code>ã€‚</p>
<p><img src="http://sm.nsddd.top/smwebp" alt="img">åœ¨ Helm v3 ä¸­ï¼ŒTiller è¢«ç§»é™¤äº†ã€‚<strong>æ–°çš„ Helm å®¢æˆ·ç«¯ä¼šåƒ kubectl å‘½ä»¤ä¸€æ ·ï¼Œè¯»å–æœ¬åœ°çš„ kubeconfig æ–‡ä»¶ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨ kubeconfig ä¸­é¢„å…ˆå®šä¹‰å¥½çš„SAæƒé™æ¥è¿›è¡Œä¸€ç³»åˆ—æ“ä½œã€‚è¿™æ ·åšæ³•å³ç®€å•ï¼Œåˆå®‰å…¨ã€‚</strong></p>
<p><strong>2ã€ä¸‰æ–¹ä¼šè°ˆ (Three-way Strategic merge patch)</strong></p>
<p>ä¼šå…¼å®¹é€šè¿‡ç¬¬ä¸‰æ–¹ä¿®æ”¹çš„å±æ€§ï¼ˆå¦‚é€šè¿‡kubectl editä¿®æ”¹çš„å±æ€§ï¼Œåœ¨helm upgradeæ—¶ä¼šè€ƒè™‘è¿›å»ï¼‰</p>
<p><img src="http://sm.nsddd.top/smwebp2" alt="img"></p>
<p><strong>3ã€ä½¿ç”¨Secretä½œä¸ºé»˜è®¤å­˜å‚¨</strong></p>
<p><strong>4ã€crd-install hookè¿ç§»åˆ°äº†crds/è·¯å¾„ç­‰</strong></p>
<details class="custom-container details"><summary>ä»€ä¹ˆæ˜¯CRDï¼Ÿ</summary>
<p>CRD(Custom Resource Define) è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼Œæ˜¯åœ¨k8sé«˜ç‰ˆæœ¬ï¼ˆv1.7+ï¼‰ä¸Šæ–°å¢åŠ çš„æ–°ç‰¹æ€§ï¼Œä¸ºäº†æé«˜æ‹“å±•æ€§ï¼Œè®©å¼€å‘è€…å¯ä»¥è‡ªå·±å»å®šä¹‰k8sèµ„æºå¯¹è±¡ã€‚</p>
<p>å®é™…è¿è¡Œæ—¶æ˜¯ä»¥CRï¼ˆCustom Resourseè‡ªå®šä¹‰èµ„æºï¼‰å…·ä½“å®ä¾‹è¿›è¡Œå‘ˆç°ã€‚</p>
<p><strong>å½“å‰å·²ç»å­˜åœ¨çš„å®˜æ–¹èµ„æºï¼š</strong></p>
<ul>
<li><code v-pre>Pod</code>ï¼šæ˜¯ä¸€ç§é›†åˆäº†å¤šä¸ªåº”ç”¨å®¹å™¨ã€å­˜å‚¨èµ„æºã€ä¸“ç”¨IPåŠæ”¯æ’‘å®¹å™¨è¿è¡Œå…¶ä»–é…ç½®é€‰é¡¹çš„é€»è¾‘ç»„ä»¶ï¼Œæ˜¯k8séƒ¨ç½²å•å…ƒå’ŒåŸå­è¿è¡Œå•å…ƒï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªè¿è¡Œå¤šä¸ªåº”ç”¨ç¨‹åºçš„å•ä¸€è¿è¡Œå®ä¾‹ï¼Œé€šè¿‡å…±äº«èµ„æºç›¸äº’è”ç³»çš„åº”ç”¨å®¹å™¨ã€‚é€šä¿—çš„è®²ï¼Œpodæ˜¯ä¸€ä¸ªç‰©ç†ä¸»æœºæˆ–VMä¸»æœºï¼Œpodä¸­çš„åº”ç”¨å®¹å™¨å°±æ˜¯ä¸»æœºä¸Šçš„è¿›ç¨‹ï¼Œå½¼æ­¤éš”ç¦»ã€‚</li>
<li><code v-pre>ReplicaSet</code>ï¼šå®šä¹‰ä¸€ç»„ä»»ä½•æ—¶å€™éƒ½å¤„äºè¿è¡ŒçŠ¶æ€çš„podå‰¯æœ¬çš„ç¨³å®šé›†åˆèµ„æºï¼Œä¿è¯è¿è¡ŒæŒ‡å®šæ•°é‡çš„ã€å®Œå…¨ç›¸åŒçš„podçš„å¯ç”¨æ€§ã€‚</li>
<li><code v-pre>ReplicationController</code>ï¼šè·ŸReplicaSetæ˜¯ä¸€æ ·çš„ï¼Œç¡®ä¿åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰ç‰¹å®šæ•°é‡çš„ Pod å‰¯æœ¬å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ æ¢å¥è¯è¯´ï¼ŒReplicationController ç¡®ä¿ä¸€ä¸ª Pod æˆ–ä¸€ç»„åŒç±»çš„ Pod æ€»æ˜¯å¯ç”¨çš„ã€‚ä½†æ˜¯æ›´æ¨èä½¿ç”¨ReplicaSetçš„Deploymentå»å»ºç«‹å‰¯æœ¬ã€‚</li>
<li><code v-pre>Deployment</code>ï¼šè¯¥å¯¹è±¡æ˜¯ç”¨æ¥æè¿°podå’ŒReplicaSetå‰¯æœ¬çš„ç›®æ ‡çŠ¶æ€ï¼Œå¹¶æ›´æ–°ä»–ä»¬ä¸ç¬¦åˆæœŸæœ›æ—¶çš„çŠ¶æ€ã€‚</li>
<li><code v-pre>StatefulSet</code>ï¼šè¯¥èµ„æºå¯¹è±¡ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨podçš„å·¥ä½œè´Ÿè½½ï¼Œæ”¯æŒpodé›†åˆçš„éƒ¨ç½²å’Œæ‰©å®¹ã€ç¼©å®¹ã€‚</li>
<li><code v-pre>DaemonSet</code>ï¼šè¯¥å¯¹è±¡ç”¨æ¥ç¡®ä¿å…¨éƒ¨æˆ–è€…éƒ¨åˆ†èŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ªpodå‰¯æœ¬ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li><code v-pre>Job</code>ï¼šè¯¥å¯¹è±¡ç”¨æ¥æ‰§è¡Œç›®æ ‡çŠ¶æ€çš„podå‰¯æœ¬çš„ä¸€ä¸ªä»»åŠ¡ï¼Œç›¸å½“äºä¸€ä¸ªç›‘å¬ä»»åŠ¡ï¼Œå®æ—¶æ§åˆ¶podå‰¯æœ¬è¾¾åˆ°æœŸæœ›çŠ¶æ€ã€‚</li>
<li><code v-pre>CronJob</code>ï¼šè¿™æ˜¯ä¸€ä¸ªæœ‰æ—¶é—´å‘¨æœŸçš„Jobã€‚</li>
<li><code v-pre>HorizontalPodAutoscaling</code>ï¼šè¯¥å¯¹è±¡ä¸ºpodæ°´å¹³è‡ªåŠ¨æ‰©ç¼©ï¼Œè‡ªåŠ¨æ›´æ–°å·¥ä½œè´Ÿè½½èµ„æºï¼ˆDeploymentå’ŒStatefulSetï¼‰ï¼Œç›®çš„æ˜¯è‡ªåŠ¨æ‰©ç¼©å·¥ä½œè´Ÿè½½ä»¥æ»¡è¶³éœ€æ±‚ã€‚</li>
<li><code v-pre>Node</code>ï¼šèŠ‚ç‚¹æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºæˆ–è€…ç‰©ç†æœºï¼ŒèŠ‚ç‚¹ä¸Šè¿è¡Œpodæ‰€éœ€çš„å®¹å™¨ã€‚</li>
<li><code v-pre>Namespace</code>ï¼šå‘½åç©ºé—´ï¼Œæ˜¯ä¸€ç§æœºåˆ¶ï¼Œå°†åŒä¸€é›†ç¾¤çš„èµ„æºåˆ’åˆ†ä¸€ä¸ªç›¸äº’éš”ç¦»çš„ç»„ã€‚</li>
<li><code v-pre>Service</code>ï¼šå°±æ˜¯è¿è¡Œåœ¨podä¸Šçš„æä¾›æœåŠ¡çš„ç»„ä»¶ï¼Œå¦‚å¾®æœåŠ¡ç»„ä»¶ã€‚</li>
<li><code v-pre>Ingress</code>ï¼šæ˜¯å„ä¸ªæœåŠ¡serviceç›¸äº’è®¿é—®çš„ä¸€ä¸ªä¸­é—´è·¯ç”±ç®¡ç†å™¨ï¼Œå¯ä»¥å®ç°æµé‡æ§åˆ¶ç­‰ã€‚</li>
<li><code v-pre>Label</code>ï¼šä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰æ ‡ç­¾ï¼Œç”¨äºæ ‡ç­¾é€‰æ‹©å™¨å¯ä»¥é«˜æ•ˆåœ°æŸ¥è¯¢å’Œç›‘å¬k8så¯¹è±¡ã€‚</li>
<li><code v-pre>CustomResourceDefinition</code>ï¼šç”¨äºå¼€å‘è€…è‡ªå®šä¹‰çš„èµ„æºå¯¹è±¡ã€‚</li>
</ul>
</details>
<p><strong>å¦‚ä½•ä½¿ç”¨CRDï¼š</strong></p>
<p>CRD èµ„æºå¯ä»¥åŠ¨æ€æ³¨å†Œåˆ°é›†ç¾¤ä¸­ï¼Œæ³¨å†Œå®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ kubectl æ¥åˆ›å»ºè®¿é—®è¿™ä¸ªè‡ªå®šä¹‰çš„èµ„æºå¯¹è±¡ï¼Œç±»ä¼¼äºæ“ä½œ Pod ä¸€æ ·ã€‚</p>
<h2 id="helm-controller" tabindex="-1"><a class="header-anchor" href="#helm-controller" aria-hidden="true">#</a> Helm Controller</h2>
<p>Helm Controllerå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªCRD Controllerï¼Œç®¡ç†çš„æ˜¯HelmChartç±»å‹çš„CRD API</p>
<p><img src="http://sm.nsddd.top/sm23094781.png" alt="img"></p>
<p><strong>è®¾è®¡åŸç†ï¼š</strong></p>
<p>1ã€<code v-pre>Helm-controller</code> è¿è¡Œåœ¨<code v-pre>master</code>èŠ‚ç‚¹å¹¶<code v-pre>list/watch HelmChart CRD</code>å¯¹è±¡</p>
<p>2ã€<code v-pre>CRD onChange</code>æ—¶æ‰§è¡Œ<code v-pre>Job</code>æ›´æ–°</p>
<p>3ã€<code v-pre>Job Container</code>ä½¿ç”¨<code v-pre>rancher/kilipper-helm</code>ä¸º<code v-pre>entrypoint</code></p>
<p>4ã€<code v-pre>Killper-helm</code>å†…ç½®<code v-pre>helm cli</code>ï¼Œå¯ä»¥å®‰è£…/å‡çº§/åˆ é™¤å¯¹åº”çš„<code v-pre>chart</code></p>
<h2 id="helmå®‰è£…" tabindex="-1"><a class="header-anchor" href="#helmå®‰è£…" aria-hidden="true">#</a> helmå®‰è£…</h2>
<h3 id="ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£…" aria-hidden="true">#</a> ç”¨äºŒè¿›åˆ¶ç‰ˆæœ¬å®‰è£…</h3>
<p>æ¯ä¸ªHelm <a href="https://github.com/helm/helm/releases" target="_blank" rel="noopener noreferrer">ç‰ˆæœ¬<ExternalLinkIcon/></a>éƒ½æä¾›äº†å„ç§æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œè¿™äº›ç‰ˆæœ¬å¯ä»¥æ‰‹åŠ¨ä¸‹è½½å’Œå®‰è£…ã€‚</p>
<ol>
<li>ä¸‹è½½ <a href="https://github.com/helm/helm/releases" target="_blank" rel="noopener noreferrer">éœ€è¦çš„ç‰ˆæœ¬<ExternalLinkIcon/></a></li>
<li>è§£å‹(<code v-pre>tar -zxvf helm-v3.0.0-linux-amd64.tar.gz</code>)</li>
<li>åœ¨è§£å‹ç›®ä¸­æ‰¾åˆ°<code v-pre>helm</code>ç¨‹åºï¼Œç§»åŠ¨åˆ°éœ€è¦çš„ç›®å½•ä¸­(<code v-pre>mv linux-amd64/helm /usr/local/bin/helm</code>)</li>
</ol>
<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå®¢æˆ·ç«¯ç¨‹åºå¹¶ <a href="https://helm.sh/zh/docs/intro/quickstart/#%E5%88%9D%E5%A7%8B%E5%8C%96" target="_blank" rel="noopener noreferrer">æ·»åŠ ç¨³å®šä»“åº“<ExternalLinkIcon/></a>: <code v-pre>helm help</code>.</p>
<p><strong>æ³¨æ„</strong> é’ˆå¯¹Linux AMD64ï¼ŒHelmçš„è‡ªåŠ¨æµ‹è¯•åªæœ‰åœ¨CircleCiæ„å»ºå’Œå‘å¸ƒæ—¶æ‰ä¼šæ‰§è¡Œã€‚æµ‹è¯•å…¶ä»–æ“ä½œç³»ç»Ÿæ˜¯ç¤¾åŒºé’ˆå¯¹ç³»ç»Ÿé—®é¢˜è¯·æ±‚Helmçš„è´£ä»»ã€‚</p>
<h3 id="ä½¿ç”¨è„šæœ¬å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨è„šæœ¬å®‰è£…" aria-hidden="true">#</a> ä½¿ç”¨è„šæœ¬å®‰è£…</h3>
<p>Helmç°åœ¨æœ‰ä¸ªå®‰è£…è„šæœ¬å¯ä»¥è‡ªåŠ¨æ‹‰å–æœ€æ–°çš„Helmç‰ˆæœ¬å¹¶åœ¨ <a href="https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3" target="_blank" rel="noopener noreferrer">æœ¬åœ°å®‰è£…<ExternalLinkIcon/></a>ã€‚</p>
<p>æ‚¨å¯ä»¥è·å–è¿™ä¸ªè„šæœ¬å¹¶åœ¨æœ¬åœ°æ‰§è¡Œã€‚å®ƒè‰¯å¥½çš„æ–‡æ¡£ä¼šè®©æ‚¨åœ¨æ‰§è¡Œä¹‹å‰çŸ¥é“è„šæœ¬éƒ½åšäº†ä»€ä¹ˆã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> <span class="token parameter variable">-o</span> get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
$ <span class="token function">chmod</span> <span class="token number">700</span> get_helm.sh
$ ./get_helm.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details">
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@cubmaster01:/workspces/runtime/ingress-nginx<span class="token comment"># ./helm.sh </span>
Downloading https://get.helm.sh/helm-v3.10.2-linux-amd64.tar.gz
Verifying checksum<span class="token punctuation">..</span>. Done.
Preparing to <span class="token function">install</span> helm into /usr/local/bin
helm installed into /usr/local/bin/helm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<p>å¦‚æœæƒ³ç›´æ¥æ‰§è¡Œå®‰è£…ï¼Œè¿è¡Œ</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">curl</span> https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 <span class="token operator">|</span> <span class="token function">bash</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="é…ç½®helmæº" tabindex="-1"><a class="header-anchor" href="#é…ç½®helmæº" aria-hidden="true">#</a> é…ç½®helmæº</h2>
<p><strong>ä½¿ç”¨helméœ€è¦é…ç½®yamlæº,å¸¸è§çš„æœ‰é˜¿é‡Œã€‚å¾®è½¯ï¼Œå’ŒGithubä¸Šçš„æº</strong></p>
<ul>
<li>é˜¿é‡Œäº‘çš„æº https://apphub.aliyuncs.com</li>
<li>å¾®è½¯<code v-pre>azure</code>çš„æº http://mirror.azure.cn/kubernetes/charts/</li>
</ul>
<p><strong>æŸ¥çœ‹æ‰€æœ‰çš„æºï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm repo list  <span class="token comment">#æŸ¥çœ‹æ‰€ä»¥çš„æº</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æ·»åŠ æŒ‡å®šçš„æºï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm repo <span class="token function">add</span> azure http://mirror.azure.cn/kubernetes/charts/

helm repo <span class="token function">add</span> aliyun https://apphub.aliyuncs.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æŸ¥çœ‹é…ç½®çš„å­˜å‚¨åº“ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm search repo stable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>åˆ é™¤;</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm repo remove aliyun
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">æœç´¢</p>
<p>å®ƒä¼šæœç´¢å½“å‰ä»“åº“æ‰€åŒ¹é…çš„æ‰€æœ‰é•œåƒæºï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm search 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div>
<h2 id="å¿«é€Ÿä¸Šæ‰‹" tabindex="-1"><a class="header-anchor" href="#å¿«é€Ÿä¸Šæ‰‹" aria-hidden="true">#</a> å¿«é€Ÿä¸Šæ‰‹</h2>
<div class="custom-container warning"><p class="custom-container-title">helmå¸¸è§ç”¨æ³•ï¼š</p>
<p>Helmçš„å¸¸è§ç”¨æ³•ï¼ŒåŒ…æ‹¬æœç´¢Chartã€å®‰è£…Chartã€è‡ªå®šä¹‰Charté…ç½®ã€æ›´æ–°æˆ–å›æ»šReleaseã€åˆ é™¤Releaseã€åˆ›å»ºè‡ªå®šä¹‰Chartã€æ­å»ºç§æœ‰ä»“åº“ç­‰</p>
</div>
<p><strong>æ£€æµ‹ç‰ˆæœ¬çš„å®‰è£…ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@VM-4-3-ubuntu:~<span class="token comment"># helm version</span>
version.BuildInfo<span class="token punctuation">{</span>Version:<span class="token string">"v3.9.2"</span>, GitCommit:<span class="token string">"1addefbfe665c350f4daf868a9adc5600cc064fd"</span>, GitTreeState:<span class="token string">"clean"</span>, GoVersion:<span class="token string">"go1.17.12"</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å’Œdockerä¸€æ ·-æœç´¢å¯ç”¨çš„åŒ…" tabindex="-1"><a class="header-anchor" href="#å’Œdockerä¸€æ ·-æœç´¢å¯ç”¨çš„åŒ…" aria-hidden="true">#</a> å’Œdockerä¸€æ ·ï¼Œæœç´¢å¯ç”¨çš„åŒ…ï¼š</h3>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm search  repo mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="helmåŒ…æ‹‰å–" tabindex="-1"><a class="header-anchor" href="#helmåŒ…æ‹‰å–" aria-hidden="true">#</a> helmåŒ…æ‹‰å–</h3>
<p>å®‰è£…chartå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®‰è£…ï¼Œä¹Ÿå¯ä»¥æ‹‰å–åˆ°æœ¬åœ°ä¹‹åå®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å‘½åè¡Œå®‰è£…</p>
<ul>
<li>æœ¬åœ°çš„Chartå‹ç¼©åŒ…(helm install mysql-1.6.4.tgz)</li>
<li>ä¸€ä¸ªChartç›®å½•(helm install mysql/)</li>
<li>ä¸€ä¸ªå®Œæ•´çš„URL(helm install https://example.com/charts/mysql-1.6.4.tgz)</li>
</ul>
<p><strong>chartåŒ…æ‹‰å–ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm pull azure/mysql --version=1.6.4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://sm.nsddd.top/smimage-20221104202213778.png" alt="image-20221104202213778"></p>
<p><strong>helm installï¼šå®‰è£…Chartï¼š</strong></p>
<blockquote>
<p>è¿™ä¸ªå‘½ä»¤æ˜¯ç›´æ¥æ‹‰å–å®‰è£…ï¼Œè€Œä¸Šé¢çš„æ˜¯å¯ä»¥å®ç°ç¦»çº¿å®‰è£…çš„~</p>
</blockquote>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm <span class="token function">install</span> db azure/mysql <span class="token parameter variable">--version</span><span class="token operator">=</span><span class="token number">1.6</span>.4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æ‹‰å–çš„chartåŒ…è¯¦ç»†ä¿¡æ¯ï¼Œé€šè¿‡è§£å‹ä¹‹åæŸ¥çœ‹ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>tar -zxvf mysql-1.6.4.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://sm.nsddd.top/smimage-20221104203359659.png" alt="image-20221104203359659"></p>
<p><strong>å…³é”®æ–‡ä»¶ï¼š</strong></p>
<p><img src="http://sm.nsddd.top/smimage-20221104203553063.png" alt="image-20221104203553063"></p>
<p><strong>å¯¹äºä¸‹è½½å¥½çš„<code v-pre>yaml</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹åä½¿ç”¨<code v-pre>helm package</code>é‡æ–°æ‰“åŒ…</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">rm</span> <span class="token parameter variable">-rf</span> mysql-1.6.4.tgz <span class="token operator">&amp;&amp;</span> helm package  mysql/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>æ­¤æ—¶ <code v-pre>mysql</code> ä¼šè¢«é‡æ–°æ‰“åŒ…æˆ <code v-pre>tar</code></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@VM-4-3-ubuntu:~/helm<span class="token comment"># ls</span>
mysql  mysql-1.6.4.tgz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>
<p><strong>ä¸‹é¢æˆ‘ä»¬ä¿®æ”¹chartä¸­çš„å¯¹åº”é•œåƒä¸ºå·²ç»ä¸‹è½½å¥½çš„mysqlå’Œbusyboxé•œåƒï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>ansible <span class="token number">192.168</span>.26.82 <span class="token parameter variable">-m</span> shell <span class="token parameter variable">-a</span> <span class="token string">"docker images | grep mysql"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>é€šè¿‡ä¿®å¥½çš„yamlæ–‡ä»¶åˆ›å»ºchart</strong>ï¼Œ <strong>ä½¿ç”¨<code v-pre>helm ls</code>æŸ¥çœ‹å½“å‰è¿è¡Œçš„chart</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>helm ls
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨<code v-pre>helm install</code>è¿è¡ŒChart</strong></p>
<blockquote>
<p><strong>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰çš„é‚£ä¸ªmysq chartæ¥å®‰è£…ä¸€ä¸ªmysql</strong></p>
</blockquote>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> mysql/ <span class="token operator">&amp;&amp;</span> helm <span class="token function">install</span> mydb <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>æŸ¥çœ‹æ˜¯å¦æ˜¯å¦è¿è¡ŒæˆåŠŸmydbçš„podå’ŒSVC</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl  get pods
kubectl  get svc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å®‰è£…ä¸€ä¸ªmysqlå®¢æˆ·ç«¯æµ‹è¯•OKï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>yum <span class="token function">install</span>  mariadb <span class="token parameter variable">-y</span>
mysql <span class="token parameter variable">-h10.107.17.103</span> <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-ptesting</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…é›†ç¾¤é•œåƒ" tabindex="-1"><a class="header-anchor" href="#å®‰è£…é›†ç¾¤é•œåƒ" aria-hidden="true">#</a> å®‰è£…é›†ç¾¤é•œåƒ</h3>
<p><strong>Add repositoryï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm repo <span class="token function">add</span> redis https://spy86.github.io/redis
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>Install chartï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm <span class="token function">install</span> my-redis redis/redis <span class="token parameter variable">--version</span> <span class="token number">0.1</span>.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ä½¿ç”¨ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>helm repo <span class="token function">add</span> bitnami https://charts.bitnami.com/bitnami
helm <span class="token function">install</span> my-mongo bitnami/mongodb

<span class="token comment"># æŒ‡å®šå¯†ç å’Œæ¶æ„</span>
helm <span class="token function">install</span> my-mongo bitnami/mongodb <span class="token parameter variable">--set</span> <span class="token assign-left variable">architecture</span><span class="token operator">=</span><span class="token string">"replicaset"</span>,auth.rootPassword<span class="token operator">=</span><span class="token string">"mongopass"</span>

<span class="token comment"># åˆ é™¤</span>
helm <span class="token function">ls</span>
helm delete my-mongo

<span class="token comment"># æŸ¥çœ‹å¯†ç </span>
kubectl get secret my-mongo-mongodb <span class="token parameter variable">-o</span> json
kubectl get secret my-mongo-mongodb <span class="token parameter variable">-o</span> yaml <span class="token operator">></span> secret.yaml

<span class="token comment"># ä¸´æ—¶è¿è¡Œä¸€ä¸ªåŒ…å« mongo client çš„ debian ç³»ç»Ÿ</span>
kubectl run mongodb-client <span class="token parameter variable">--rm</span> <span class="token parameter variable">--tty</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">--restart</span><span class="token operator">=</span><span class="token string">'Never'</span> <span class="token parameter variable">--image</span> docker.io/bitnami/mongodb:4.4.10-debian-10-r20 <span class="token parameter variable">--command</span> -- <span class="token function">bash</span>

<span class="token comment"># è¿›å» mongodb</span>
mongo <span class="token parameter variable">--host</span> <span class="token string">"my-mongo-mongodb"</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span> mongopass

<span class="token comment"># ä¹Ÿå¯ä»¥è½¬å‘é›†ç¾¤é‡Œçš„ç«¯å£åˆ°å®¿ä¸»æœºè®¿é—® mongodb</span>
kubectl port-forward svc/my-mongo-mongodb <span class="token number">27017</span>:27018
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="helm-é…ç½®å®‰è£…é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#helm-é…ç½®å®‰è£…é›†ç¾¤" aria-hidden="true">#</a> helm é…ç½®å®‰è£…é›†ç¾¤</h2>
<p><strong>helm å®‰è£…è¿‡ç¨‹ä¸­æœ‰ä¸¤ç§æ–¹å¼ä¼ é€’æ•°æ®ï¼š</strong></p>
<ul>
<li><code v-pre>-f(æˆ–--values)</code>ï¼šä½¿ç”¨ YAML æ–‡ä»¶è¦†ç›–é»˜è®¤é…ç½®ã€‚å¯ä»¥æŒ‡å®šå¤šæ¬¡ï¼Œä¼˜å…ˆä½¿ç”¨æœ€å³è¾¹çš„æ–‡ä»¶ã€‚</li>
<li><code v-pre>--set</code> ï¼šé€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼å¯¹æŒ‡å®šé¡¹è¿›è¡Œè¦†ç›–</li>
</ul>
<div class="custom-container danger"><p class="custom-container-title">æ³¨æ„</p>
<p>å¦‚æœåŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼ï¼Œåˆ™ <code v-pre>--set</code> ä¸­çš„å€¼ä¼šè¢«åˆå¹¶åˆ° <code v-pre>-f</code> ä¸­ï¼Œä½†æ˜¯ <code v-pre>â€“set</code> ä¸­çš„å€¼ä¼˜å…ˆçº§æ›´é«˜</p>
</div>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '25.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '27.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


