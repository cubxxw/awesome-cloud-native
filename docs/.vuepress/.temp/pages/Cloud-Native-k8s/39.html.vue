<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬-39-èŠ‚-å…³äº-kubernetes-çš„ä¸€äº›ç–‘é—®-4" tabindex="-1"><a class="header-anchor" href="#ç¬¬-39-èŠ‚-å…³äº-kubernetes-çš„ä¸€äº›ç–‘é—®-4" aria-hidden="true">#</a> ç¬¬ 39 èŠ‚ å…³äº Kubernetes çš„ä¸€äº›ç–‘é—® 4</h1>
<div><a href = '38.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '40.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="pod-api-å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#pod-api-å­—æ®µ" aria-hidden="true">#</a> Pod API å­—æ®µ</h2>
<p>Pod æ˜¯ Kubernetes ä¸­æœ€å°çš„éƒ¨ç½²å•ä½ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚Pod API å­—æ®µä¸»è¦åŒ…æ‹¬ï¼š</p>
<ul>
<li><code v-pre>apiVersion</code>ï¼šPod API çš„ç‰ˆæœ¬ã€‚</li>
<li><code v-pre>kind</code>ï¼šå¯¹è±¡ç±»å‹ï¼Œè¿™é‡Œæ˜¯ Podã€‚</li>
<li><code v-pre>metadata</code>ï¼šå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ç­‰ã€‚</li>
<li><code v-pre>spec</code>ï¼šPod è§„èŒƒï¼Œæè¿°äº† Pod åº”å¦‚ä½•è¿è¡Œã€‚</li>
<li><code v-pre>status</code>ï¼šPod çŠ¶æ€ï¼ŒåŒ…æ‹¬ IP åœ°å€ã€å®¹å™¨çŠ¶æ€ç­‰ã€‚</li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ Pod API å¯¹è±¡ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">codeapiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>pod
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo Hello Kubernetes! &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">phase</span><span class="token punctuation">:</span> Running
  <span class="token key atrule">conditions</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> Ready
      <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="kubernetesæºç çš„å“ªä¸ªä½ç½®" tabindex="-1"><a class="header-anchor" href="#kubernetesæºç çš„å“ªä¸ªä½ç½®" aria-hidden="true">#</a> Kubernetesæºç çš„å“ªä¸ªä½ç½®</h2>
<p>åœ¨ Kubernetes æºç ä¸­ï¼ŒPod çš„å®šä¹‰ä½äº <code v-pre>pkg/api/v1/pod.go</code> æ–‡ä»¶ä¸­ï¼Œå®ƒæ˜¯ç”±ä¸€ä¸ªåä¸º <code v-pre>Pod</code> çš„ç»“æ„ä½“è¡¨ç¤ºçš„ã€‚è¿™ä¸ªç»“æ„ä½“å®šä¹‰äº† Pod çš„æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ <code v-pre>apiVersion</code>ã€<code v-pre>kind</code>ã€<code v-pre>metadata</code> å’Œ <code v-pre>spec</code> ç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯ <code v-pre>Pod</code> ç»“æ„ä½“çš„å®šä¹‰ï¼š</p>
<div class="language-go ext-go line-numbers-mode"><pre v-pre class="language-go"><code>codetype Pod <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// Standard object's metadata.</span>
        <span class="token comment">// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span>
        <span class="token comment">// +optional</span>
        metav1<span class="token punctuation">.</span>ObjectMeta <span class="token string">`json:"metadata,omitempty" protobuf:"bytes,1,opt,name=metadata"`</span>

        <span class="token comment">// Specification of the desired behavior of the pod.</span>
        <span class="token comment">// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span>
        <span class="token comment">// +optional</span>
        Spec PodSpec <span class="token string">`json:"spec,omitempty" protobuf:"bytes,2,opt,name=spec"`</span>

        <span class="token comment">// Most recently observed status of the pod.</span>
        <span class="token comment">// This data may not be up to date.</span>
        <span class="token comment">// Populated by the system.</span>
        <span class="token comment">// Read-only.</span>
        <span class="token comment">// More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span>
        <span class="token comment">// +optional</span>
        Status PodStatus <span class="token string">`json:"status,omitempty" protobuf:"bytes,3,opt,name=status"`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="deamonset" tabindex="-1"><a class="header-anchor" href="#deamonset" aria-hidden="true">#</a> DeamonSet</h2>
<p>DaemonSet æ˜¯ Kubernetes ä¸­çš„ä¸€ç§è°ƒåº¦å™¨ï¼Œå®ƒèƒ½ä¿è¯æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œä¸€ä¸ªæŒ‡å®šçš„ Podã€‚è¿™å¯¹äºä¸€äº›å…¨å±€æœåŠ¡ï¼ˆå¦‚æ—¥å¿—æ”¶é›†ã€ç›‘æ§ç­‰ï¼‰å¾ˆæœ‰ç”¨ã€‚</p>
<p>å½“èŠ‚ç‚¹åŠ å…¥æˆ–ç¦»å¼€é›†ç¾¤æ—¶ï¼ŒDaemonSet ä¼šè‡ªåŠ¨åœ¨æ–°èŠ‚ç‚¹ä¸Šåˆ›å»ºæˆ–é”€æ¯ Podã€‚æ­¤å¤–ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹ä¸­çš„ Pod å› æ•…éšœè€Œé€€å½¹ï¼ŒDaemonSet ä¹Ÿä¼šåœ¨è¯¥èŠ‚ç‚¹ä¸Šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ Podã€‚</p>
<p>ä½¿ç”¨ DaemonSet å¯ä»¥ç¡®ä¿é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€æŒ‡å®šçš„ Podï¼Œè¿™å¯¹äºæä¾›å…¨å±€æœåŠ¡å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>ç¤ºä¾‹ DaemonSet API å¯¹è±¡ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">codeapiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>daemonset
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
        <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo Hello Kubernetes! &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>DaemonSet API å¯¹è±¡åŒ…å«ä»¥ä¸‹å‡ ä¸ªä¸»è¦å­—æ®µï¼š</p>
<ul>
<li><code v-pre>apiVersion</code>ï¼šAPI çš„ç‰ˆæœ¬ã€‚</li>
<li><code v-pre>kind</code>ï¼šå¯¹è±¡ç±»å‹ï¼Œè¿™é‡Œæ˜¯ DaemonSetã€‚</li>
<li><code v-pre>metadata</code>ï¼šå…ƒæ•°æ®ï¼ŒåŒ…æ‹¬åç§°ã€å‘½åç©ºé—´ã€æ ‡ç­¾ç­‰ã€‚</li>
<li><code v-pre>spec</code>ï¼šDaemonSet è§„èŒƒï¼Œæè¿°äº† DaemonSet åº”å¦‚ä½•è¿è¡Œã€‚å®ƒåŒ…æ‹¬äº†ä¸¤ä¸ªå­—æ®µï¼š
<ul>
<li><code v-pre>selector</code>ï¼šé€‰æ‹©å™¨ï¼Œæè¿°äº†å“ªäº›èŠ‚ç‚¹åº”è¯¥è¿è¡Œ DaemonSet ä¸­çš„ Podã€‚</li>
<li><code v-pre>template</code>ï¼šPod æ¨¡æ¿ï¼Œæè¿°äº† DaemonSet ä¸­çš„ Pod åº”è¯¥å¦‚ä½•è¿è¡Œã€‚</li>
</ul>
</li>
</ul>
<h2 id="å£°æ˜å¼-api" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼-api" aria-hidden="true">#</a> å£°æ˜å¼ API</h2>
<p>åœ¨ Kubernetes ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å£°æ˜å¼ API æ¥æè¿°æˆ‘ä»¬å¸Œæœ›é›†ç¾¤ä¸­è¿è¡Œä»€ä¹ˆã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ YAML æˆ– JSON æ ¼å¼æ¥å£°æ˜æˆ‘ä»¬å¸Œæœ›è¿è¡Œçš„åº”ç”¨ç¨‹åºã€æœåŠ¡ã€éƒ¨ç½²ã€è°ƒåº¦å™¨ç­‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å£°æ˜å¼ API å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ª Deploymentï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">codeapiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
        <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo Hello Kubernetes! &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl</code> å‘½ä»¤æ¥å°†è¿™ä¸ªå£°æ˜å¼ API å¯¹è±¡å‘é€åˆ° Kubernetes é›†ç¾¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>Copy code
kubectl apply -f deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ ·ï¼ŒKubernetes å°±ä¼šæ ¹æ®å£°æ˜å¼ API å¯¹è±¡ä¸­çš„æè¿°åˆ›å»º Deployment å’Œç›¸åº”çš„ Podã€‚</p>
<p>åœ¨ Deployment ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl rollout</code> å‘½ä»¤æ¥è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬è½»æ¾åœ°å®ç°æ»šåŠ¨å‡çº§æˆ–å›æ»šã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å‡çº§ Deployment ä¸­çš„åº”ç”¨ç¨‹åºï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>Copy code
kubectl set image deployment/myapp-deployment myapp-container=myapp:v2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå°† Deployment ä¸­çš„æ‰€æœ‰ Pod çš„é•œåƒæ›´æ–°ä¸º <code v-pre>myapp:v2</code>ã€‚Kubernetes ä¼šè‡ªåŠ¨åœ¨æ–°çš„ Pod å¯åŠ¨å¹¶å°±ç»ªä¹‹å‰åœæ­¢æ—§çš„ Podï¼Œä»è€Œå®ç°æ»šåŠ¨å‡çº§ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>Copy code
kubectl rollout undo deployment/myapp-deployment
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šå°† Deployment æ»šåŠ¨å›ä¸Šä¸€ä¸ªç‰ˆæœ¬ã€‚</p>
<p>åœ¨èƒŒåï¼ŒKubernetes ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code v-pre>ControllerRevision</code> çš„èµ„æºæ¥è·Ÿè¸ª Deployment çš„æ¯ä¸ªç‰ˆæœ¬ã€‚æ¯å½“æˆ‘ä»¬ä½¿ç”¨ <code v-pre>kubectl rollout</code> å‘½ä»¤è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ—¶ï¼ŒKubernetes éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ <code v-pre>ControllerRevision</code> è®°å½•ï¼Œä»è€Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚</p>
<h2 id="kubectl-create-å’Œ-kubectl-apply-å‘½ä»¤æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#kubectl-create-å’Œ-kubectl-apply-å‘½ä»¤æœ‰ä»€ä¹ˆåŒºåˆ«" aria-hidden="true">#</a> kubectl create å’Œ kubectl apply å‘½ä»¤æœ‰ä»€ä¹ˆåŒºåˆ«</h2>
<p><code v-pre>kubectl create</code> å’Œ <code v-pre>kubectl apply</code> å‘½ä»¤éƒ½å¯ä»¥ç”¨æ¥åœ¨ Kubernetes é›†ç¾¤ä¸­åˆ›å»ºèµ„æºã€‚ä½†æ˜¯ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤çš„è¡Œä¸ºç•¥æœ‰ä¸åŒã€‚</p>
<ul>
<li><code v-pre>kubectl create</code> å‘½ä»¤æ˜¯ç”¨æ¥æ–°å»ºèµ„æºçš„ã€‚å¦‚æœåœ¨æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œé›†ç¾¤ä¸­å·²ç»å­˜åœ¨åŒåçš„èµ„æºï¼Œåˆ™ä¼šæŠ¥é”™ã€‚</li>
<li><code v-pre>kubectl apply</code> å‘½ä»¤æ˜¯ç”¨æ¥æ›´æ–°èµ„æºçš„ã€‚å¦‚æœåœ¨æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ï¼Œé›†ç¾¤ä¸­å·²ç»å­˜åœ¨åŒåçš„èµ„æºï¼Œåˆ™ä¼šæ›´æ–°èµ„æºçš„é…ç½®ã€‚å¦‚æœä¸å­˜åœ¨åŒåçš„èµ„æºï¼Œåˆ™ä¼šæ–°å»ºèµ„æºã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ–°å»ºèµ„æºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl create</code></p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ–°å»ºèµ„æºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl create</code> å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ–°å»º Deployment èµ„æºï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl create <span class="token parameter variable">-f</span> deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤å‘½ä»¤ä¼šä» deployment.yaml æ–‡ä»¶ä¸­è¯»å– Deployment é…ç½®ï¼Œå¹¶åœ¨é›†ç¾¤ä¸­æ–°å»º Deploymentã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ›´æ–°å·²å­˜åœ¨çš„èµ„æºï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl apply</code> å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ›´æ–° Deployment èµ„æºï¼š</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>kubectl apply -f deployment.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤å‘½ä»¤ä¼šä» deployment.yaml æ–‡ä»¶ä¸­è¯»å– Deployment é…ç½®ï¼Œå¦‚æœé›†ç¾¤ä¸­å·²ç»å­˜åœ¨åŒåçš„ Deploymentï¼Œåˆ™ä¼šæ›´æ–° Deployment çš„é…ç½®ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šæ–°å»º Deploymentã€‚</p>
<p>ä»åº•å±‚æ¥çœ‹ï¼Œ<code v-pre>kubectl create</code> å’Œ <code v-pre>kubectl apply</code> å‘½ä»¤çš„å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<ul>
<li><code v-pre>kubectl create</code> å‘½ä»¤æ˜¯é€šè¿‡å‘ Kubernetes API æœåŠ¡å‘é€ HTTP POST è¯·æ±‚æ¥åˆ›å»ºèµ„æºçš„ã€‚åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šå°†èµ„æºçš„é…ç½®ä»¥ JSON æˆ– YAML æ ¼å¼å‘é€ç»™ API æœåŠ¡ã€‚API æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚ä¸­åŒ…å«çš„èµ„æºé…ç½®ï¼Œç„¶ååœ¨é›†ç¾¤ä¸­æ–°å»ºèµ„æºã€‚</li>
<li><code v-pre>kubectl apply</code> å‘½ä»¤ä¹Ÿæ˜¯é€šè¿‡å‘ Kubernetes API æœåŠ¡å‘é€ HTTP POST è¯·æ±‚æ¥åˆ›å»ºæˆ–æ›´æ–°èµ„æºçš„ã€‚ä½†æ˜¯ï¼Œå®ƒçš„å®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚åœ¨å‘é€è¯·æ±‚æ—¶ï¼Œä¼šå°†èµ„æºçš„é…ç½®ä»¥ JSON æˆ– YAML æ ¼å¼å‘é€ç»™ API æœåŠ¡ã€‚API æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œä¼šè§£æè¯·æ±‚ä¸­åŒ…å«çš„èµ„æºé…ç½®ï¼Œç„¶åæ£€æŸ¥é›†ç¾¤ä¸­æ˜¯å¦å·²ç»å­˜åœ¨åŒåçš„èµ„æºã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šæ›´æ–°èµ„æºçš„é…ç½®ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨é›†ç¾¤ä¸­æ–°å»ºèµ„æºã€‚</li>
</ul>
<h2 id="patchæ“ä½œ" tabindex="-1"><a class="header-anchor" href="#patchæ“ä½œ" aria-hidden="true">#</a> patchæ“ä½œ</h2>
<p><strong>âš ï¸ æ³¨æ„ï¼Œpatch æ“ä½œæ˜¯å£°æ˜å¼ API çš„å…³é”®ï¼Œ<code v-pre>Kubectl apply</code> å¯ä»¥ç†è§£ä¸ºæ˜¯æ‰§è¡Œäº†ä¸€ä¸ªå¯¹åŸæœ‰API å¯¹è±¡çš„ PATCH cao'zuo</strong></p>
<p>åœ¨ Kubernetes ä¸­ï¼Œpatch æ“ä½œæ˜¯ç”¨æ¥æ›´æ–°èµ„æºçš„é…ç½®çš„ã€‚å®ƒå¯ä»¥è®©æˆ‘ä»¬åªä¿®æ”¹èµ„æºçš„éƒ¨åˆ†å­—æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªèµ„æºçš„é…ç½®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ patch æ“ä½œæ¥ä¿®æ”¹ Deployment çš„å‰¯æœ¬æ•°é‡ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ•´ä¸ª Deployment çš„é…ç½®ã€‚è¿™æ ·åšå¯ä»¥èŠ‚çœæ—¶é—´ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥å‡å°‘ç½‘ç»œæµé‡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl patch</code> å‘½ä»¤æ¥æ‰§è¡Œ patch æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¿®æ”¹ Deployment çš„å‰¯æœ¬æ•°é‡ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl patch deployment myapp-deployment <span class="token parameter variable">-p</span> <span class="token string">'{"spec":{"replicas": 3}}'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤å‘½ä»¤ä¼šå°† Deployment çš„å‰¯æœ¬æ•°é‡ä¿®æ”¹ä¸º 3ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>patch æ“ä½œä¸ä¼šæ¸…é™¤èµ„æºçš„å­—æ®µ</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ patch æ“ä½œä¿®æ”¹èµ„æºçš„æŸä¸ªå­—æ®µï¼Œè€Œä¸æŒ‡å®šè¯¥å­—æ®µçš„å€¼ï¼Œåˆ™è¯¥å­—æ®µçš„å€¼ä¸ä¼šè¢«æ¸…é™¤ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¿®æ”¹ Deployment çš„å‰¯æœ¬æ•°é‡ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl patch deployment myapp-deployment <span class="token parameter variable">-p</span> <span class="token string">'{"spec":{"replicas": null}}'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­¤å‘½ä»¤ä¼šå°è¯•å°† Deployment çš„å‰¯æœ¬æ•°é‡è®¾ç½®ä¸º nullï¼Œä½†æ˜¯ç”±äº Deployment çš„å‰¯æœ¬æ•°é‡æ˜¯å¿…å¡«å­—æ®µï¼Œæ‰€ä»¥è¿™æ¡å‘½ä»¤ä¼šå¤±è´¥ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›æ¸…é™¤èµ„æºçš„æŸä¸ªå­—æ®µï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code v-pre>kubectl edit</code> å‘½ä»¤ã€‚</p>
<p><code v-pre>kubectl edit</code> å‘½ä»¤ä¼šæ‰“å¼€èµ„æºçš„ç¼–è¾‘ç•Œé¢ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹èµ„æºçš„é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥å°†è¦æ¸…é™¤çš„å­—æ®µè®¾ç½®ä¸º nullï¼Œç„¶åä¿å­˜å³å¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ¸…é™¤ Deployment çš„å‰¯æœ¬æ•°é‡å­—æ®µï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl edit deployment myapp-deployment
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ¡å‘½ä»¤ä¼šæ‰“å¼€ Deployment çš„ç¼–è¾‘ç•Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥å°†å‰¯æœ¬æ•°é‡å­—æ®µè®¾ç½®ä¸º nullï¼Œç„¶åä¿å­˜å³å¯ã€‚</p>
<h2 id="å£°æ˜å¼-api-çš„ä¸€äº›å·¥ä½œåŸç†" tabindex="-1"><a class="header-anchor" href="#å£°æ˜å¼-api-çš„ä¸€äº›å·¥ä½œåŸç†" aria-hidden="true">#</a> å£°æ˜å¼ API çš„ä¸€äº›å·¥ä½œåŸç†</h2>
<p>åœ¨Kubernetesä¸­ï¼ŒAPIå¯¹è±¡å­˜å‚¨åœ¨etcdæ•°æ®åº“ä¸­ã€‚åœ¨etcdä¸­ï¼Œæ¯ä¸ªAPIå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„ï¼Œç”¨äºæ ‡è¯†å¯¹è±¡æ‰€åœ¨çš„ä½ç½®ã€‚è¿™ä¸ªè·¯å¾„é€šå¸¸åŒ…å«å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>å‘½åç©ºé—´ï¼šAPIå¯¹è±¡æ‰€å±çš„å‘½åç©ºé—´ã€‚</li>
<li>èµ„æºç±»å‹ï¼šAPIå¯¹è±¡çš„ç±»å‹ï¼Œä¾‹å¦‚Podã€Serviceã€Deploymentç­‰ã€‚</li>
<li>èµ„æºåç§°ï¼šAPIå¯¹è±¡çš„åç§°ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¦‚æœè¦æè¿°ä¸€ä¸ªåä¸º&quot;my-pod&quot;çš„Podå¯¹è±¡ï¼Œå®ƒä½äºåä¸º&quot;default&quot;çš„å‘½åç©ºé—´ä¸­ï¼Œé‚£ä¹ˆå®ƒåœ¨etcdä¸­çš„å®Œæ•´è·¯å¾„å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>/registry/pods/default/my-pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™ä¸ªè·¯å¾„ä¸­çš„å„ä¸ªéƒ¨åˆ†åˆ†åˆ«è¡¨ç¤ºå‘½åç©ºé—´ï¼ˆdefaultï¼‰ã€èµ„æºç±»å‹ï¼ˆpodsï¼‰å’Œèµ„æºåç§°ï¼ˆmy-podï¼‰ã€‚</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '38.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '40.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


