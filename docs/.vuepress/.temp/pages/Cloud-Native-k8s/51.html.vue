<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬51èŠ‚-controller-manager" tabindex="-1"><a class="header-anchor" href="#ç¬¬51èŠ‚-controller-manager" aria-hidden="true">#</a> ç¬¬51èŠ‚  Controller Manager</h1>
<div><a href = '50.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '52.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h3 id="æ§åˆ¶å™¨å¤„ç†æµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨å¤„ç†æµç¨‹" aria-hidden="true">#</a> æ§åˆ¶å™¨å¤„ç†æµç¨‹</h3>
<p><img src="http://sm.nsddd.top/sm202303081726112.png" alt="img"></p>
<h3 id="informer-çš„å†…éƒ¨å·¥ä½œæœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#informer-çš„å†…éƒ¨å·¥ä½œæœºåˆ¶" aria-hidden="true">#</a> informer çš„å†…éƒ¨å·¥ä½œæœºåˆ¶</h3>
<p><img src="http://sm.nsddd.top/sm202303081727144.png" alt="image-20230308172739991"></p>
<h3 id="æ§åˆ¶å™¨çš„ååŒæµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ§åˆ¶å™¨çš„ååŒæµç¨‹" aria-hidden="true">#</a> æ§åˆ¶å™¨çš„ååŒæµç¨‹</h3>
<p><img src="http://sm.nsddd.top/sm202303081726666.jpeg" alt="img"></p>
<h3 id="é€šç”¨-controller" tabindex="-1"><a class="header-anchor" href="#é€šç”¨-controller" aria-hidden="true">#</a> é€šç”¨ controller</h3>
<p>è¿›å…¥åˆ° kube-controller-manager pod ä¸­æ‰§è¡Œ <code v-pre>kube-controller-manager -h</code> å‘½ä»¤æ¥æŸ¥è¯¢é»˜è®¤å¯ç”¨çš„ controllerã€‚</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>kubectl -n kube-system exec -it kube-controller-manager-cadmin -- kube-controller-manager -h
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¸¸è§ controller å¦‚ä¸‹ï¼š</p>
<ul>
<li>Job Controllerï¼šå¤„ç† job</li>
<li>Pod AutoScalerï¼šå¤„ç† pod çš„è‡ªåŠ¨ç¼©å®¹/æ‰©å®¹ã€‚</li>
<li>RelicaSetï¼šä¾æ® Replicaset Spec åˆ›å»º Podã€‚</li>
<li>Service Controllerï¼šä¸º LoadBalancer type çš„ service åˆ›å»º LB VIPã€‚</li>
<li>ServiceAccount Controllerï¼šç¡®ä¿ serviceaccount åœ¨å½“å‰ namespace å­˜åœ¨ã€‚</li>
<li>StatefulSet Controllerï¼šå¤„ç† statefulse tä¸­çš„ podã€‚</li>
<li>Volume Controller: ä¾æ® PV spec åˆ›å»º volumeã€‚</li>
<li>Resource quota Controllerï¼šåœ¨ç”¨æˆ·ä½¿ç”¨èµ„æºä¹‹åï¼Œæ›´æ–°çŠ¶æ€ã€‚</li>
<li>Namespace Controllerï¼šä¿è¯ namespace åˆ é™¤æ—¶ï¼Œè¯¥ namespace ä¸‹çš„æ‰€æœ‰èµ„æºéƒ½å…ˆè¢«åˆ é™¤</li>
<li>Replication Controllerï¼šåˆ›å»º RC åï¼Œè´Ÿè´£åˆ›å»º podã€‚</li>
<li>Node Controllerï¼šç»´æŠ¤ node çŠ¶æ€ï¼Œå¤„ç† evict è¯·æ±‚ç­‰ã€‚</li>
<li>Daemon Controllerï¼šä¾æ® damonset åˆ›å»º podã€‚</li>
<li>Deployment Controllerï¼šä¾æ® deployment spec åˆ›å»º replicasetã€‚</li>
<li>Endpoint Controllerï¼šä¾æ® service spec åˆ›å»º endpoint,ä¾æ® podip æ›´æ–° endpointã€‚</li>
<li>Garbage Collectorï¼šå¤„ç†çº§è”åˆ é™¤ï¼Œæ¯”å¦‚åˆ é™¤ deployment çš„åŒæ—¶åˆ é™¤ replicaset ä»¥åŠ podã€‚</li>
<li>CronJob Controllerï¼šå¤„ç†cronjobã€‚</li>
</ul>
<h3 id="cloud-controller-manager" tabindex="-1"><a class="header-anchor" href="#cloud-controller-manager" aria-hidden="true">#</a> cloud controller manager</h3>
<p><strong>ä»€ä¹ˆæ—¶å€™éœ€è¦cloud controller manager?</strong></p>
<p>Cloud Controller Manager è‡ª Kubernetes1.6 å¼€å§‹ï¼Œä» kube-controller-manager ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä¸»è¦å› ä¸º Cloud Controller Manager å¾€å¾€éœ€è¦è·Ÿä¼ä¸š cloud åšæ·±åº¦é›†æˆï¼Œrelease cycle è·Ÿ Kubernetes ç›¸å¯¹ç‹¬ç«‹ã€‚ ä¸ Kubernetes æ ¸å¿ƒç®¡ç†ç»„ä»¶ä¸€èµ·å‡çº§æ˜¯ä¸€ä»¶è´¹æ—¶è´¹åŠ›çš„äº‹ã€‚</p>
<p>é€šå¸¸ cloud controller manager éœ€è¦:</p>
<ul>
<li>è®¤è¯æˆæƒï¼šä¼ä¸š cloud å¾€å¾€éœ€è¦è®¤è¯ä¿¡æ¯ï¼ŒKubernetes è¦ä¸ Cloud API é€šä¿¡ï¼Œéœ€è¦è·å– cloud ç³»ç»Ÿé‡Œçš„ ServiceAccount;</li>
<li>Cloud controller manager æœ¬èº«ä½œä¸ºä¸€ä¸ªç”¨æˆ·æ€çš„ component, éœ€è¦åœ¨ Kubernetes ä¸­æœ‰æ­£ç¡®çš„ RBAC è®¾ç½®ï¼Œè·å¾—èµ„æºæ“ä½œæƒé™;</li>
<li>é«˜å¯ç”¨ï¼šéœ€è¦é€šè¿‡ leader election æ¥ç¡®ä¿ cloud controller manger é«˜å¯ç”¨ã€‚</li>
</ul>
<p>cloud controller manager æ˜¯ä»è€ç‰ˆæœ¬çš„ APIServer åˆ†ç¦»å‡ºæ¥çš„ã€‚ Kube-APIServer å’Œ kube-controller-manager ä¸­ä¸€å®šä¸èƒ½æŒ‡å®š cloud-provider,å¦åˆ™ä¼šåŠ è½½å†…ç½®çš„ cloud controller managerã€‚</p>
<p>Kubelet è¦é…ç½® --cloud-provider=externalã€‚</p>
<p>Cloud Controller Manage rä¸»è¦æ”¯æŒ:</p>
<ul>
<li>Node controllerï¼š
<ul>
<li>è®¿é—® cloud API,æ¥æ›´æ–° node çŠ¶æ€;</li>
<li>åœ¨ cloud åˆ é™¤è¯¥èŠ‚ç‚¹ä»¥åï¼Œä» kubernetes åˆ é™¤ node;</li>
</ul>
</li>
<li>Service controllerï¼šè´Ÿè´£é…ç½®ä¸º loadbalancer ç±»å‹çš„æœåŠ¡é…ç½®LB VIP;</li>
<li>Route Controllerï¼šåœ¨ cloud ç¯å¢ƒé…ç½®è·¯ç”±;</li>
</ul>
<p>å¯ä»¥è‡ªå®šä¹‰ä»»ä½•éœ€è¦çš„ Cloud Controllerã€‚</p>
<p>éœ€è¦å®šåˆ¶çš„ Cloud Controller</p>
<ul>
<li>Ingress controller;</li>
<li>Service Controller;</li>
<li>è‡ªä¸»ç ”å‘çš„controller ,æ¯”å¦‚ä¹‹å‰æåˆ°çš„:
<ul>
<li>RBAC controller;</li>
<li>Account controllerã€‚</li>
</ul>
</li>
</ul>
<h4 id="æ¥è‡ªç”Ÿäº§çš„ç»éªŒ" tabindex="-1"><a class="header-anchor" href="#æ¥è‡ªç”Ÿäº§çš„ç»éªŒ" aria-hidden="true">#</a> æ¥è‡ªç”Ÿäº§çš„ç»éªŒ</h4>
<p>ä¿æŠ¤å¥½ controller manager çš„ kubeconfig:</p>
<ul>
<li>æ­¤ kubeconfig æ‹¥æœ‰æ‰€æœ‰èµ„æºçš„æ‰€æœ‰æ“ä½œæƒé™ï¼Œé˜²æ­¢æ™®é€šç”¨æˆ·é€šè¿‡ <code v-pre>kubectl exec kube-controller-manager ca</code>t è·å–è¯¥æ–‡ä»¶ã€‚</li>
<li>ç”¨æˆ·å¯èƒ½åšä»»ä½•ä½ æƒ³è±¡ä¸åˆ°çš„æ“ä½œï¼Œç„¶åæ¥æ‰¾ä½  support.</li>
</ul>
<p>Pod evict å IP å‘ç”Ÿå˜åŒ–ï¼Œä½† endpoint ä¸­çš„ address æ›´æ–°å¤±è´¥:</p>
<ul>
<li>åˆ†æ stacktrace å‘ç° endpoint åœ¨æ›´æ–° LoadBalancer æ—¶è°ƒç”¨ gophercloud è¿æ¥ hang ä½ï¼Œå¯¼è‡´ endpoint worker çº¿ç¨‹å…¨éƒ¨å¡æ­»ã€‚</li>
</ul>
<h3 id="ç¡®ä¿-scheduler-å’Œ-controller-çš„é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#ç¡®ä¿-scheduler-å’Œ-controller-çš„é«˜å¯ç”¨" aria-hidden="true">#</a> ç¡®ä¿ scheduler å’Œ controller çš„é«˜å¯ç”¨</h3>
<p>Leader Election Kubenetes æä¾›åŸºäº configmap å’Œ endpoint çš„ leader electionç±»åº“ã€‚</p>
<blockquote>
<p>æ–°ç‰ˆæœ¬æä¾›äº†æ›´è½»é‡çº§çš„ lease å¯¹è±¡ã€‚</p>
</blockquote>
<p>Kubernetes é‡‡ç”¨ leader election æ¨¡å¼å¯åŠ¨ component åï¼Œä¼šåˆ›å»ºå¯¹åº” endpoint,å¹¶æŠŠå½“å‰çš„ leader ä¿¡æ¯ annotate åˆ° endponit ä¸Šã€‚</p>
<blockquote>
<p>å’ŒåŸºäº etcd çš„åˆ†å¸ƒå¼é”å·®ä¸å¤šï¼Œå¾ˆç±»ä¼¼ã€‚</p>
</blockquote>
<p><img src="http://sm.nsddd.top/sm202303081727954.png" alt="image-20230308172716820"></p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '50.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '52.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


