<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬23èŠ‚-kubeconfig-token" tabindex="-1"><a class="header-anchor" href="#ç¬¬23èŠ‚-kubeconfig-token" aria-hidden="true">#</a> ç¬¬23èŠ‚ Kubeconfig &amp;&amp; token</h1>
<div><a href = '22.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '24.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<nav class="table-of-contents"><ul><li><router-link to="#å‰è¨€">å‰è¨€</router-link></li><li><router-link to="#å‘½ä»¤å‚æ•°">å‘½ä»¤å‚æ•°</router-link></li><li><router-link to="#ä½¿ç”¨-kubeconfig-æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—®">ä½¿ç”¨ kubeconfig æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—®</router-link></li><li><router-link to="#æ”¯æŒå¤šé›†ç¾¤ã€å¤šç”¨æˆ·ã€å¤šè®¤è¯æœºåˆ¶">æ”¯æŒå¤šé›†ç¾¤ã€å¤šç”¨æˆ·ã€å¤šè®¤è¯æœºåˆ¶</router-link></li><li><router-link to="#ä¸Šä¸‹æ–‡-context">ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰</router-link></li><li><router-link to="#kubeconfig-ç¯å¢ƒå˜é‡">KUBECONFIG ç¯å¢ƒå˜é‡</router-link></li><li><router-link to="#åˆå¹¶-kubeconfig-æ–‡ä»¶">åˆå¹¶ kubeconfig æ–‡ä»¶</router-link></li><li><router-link to="#æ–‡ä»¶å¼•ç”¨">æ–‡ä»¶å¼•ç”¨</router-link></li><li><router-link to="#kubeconfig-ä¸¤ç§å®ç°æ–¹å¼">kubeconfig ä¸¤ç§å®ç°æ–¹å¼</router-link></li><li><router-link to="#ä»£ç†">ä»£ç†</router-link></li><li><router-link to="#å®šä¹‰é›†ç¾¤-ç”¨æˆ·å’Œ-context">å®šä¹‰é›†ç¾¤ï¼Œç”¨æˆ·å’Œ context</router-link></li><li><router-link to="#ç”Ÿæˆkubeconfigçš„é…ç½®æ­¥éª¤">ç”Ÿæˆkubeconfigçš„é…ç½®æ­¥éª¤</router-link></li><li><router-link to="#end-é“¾æ¥">END é“¾æ¥</router-link></li></ul></nav>
<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2>
<div class="custom-container tip"><p class="custom-container-title">æç¤º</p>
<p>åœ¨å‰é¢å®‰è£…k3s &amp; k8s ä¸­ï¼Œæˆ‘ä»¬è®¤è¯†äº† kubeconfigï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯¹è¿™ä¸ªä¸œè¥¿å¾ˆé™Œç”Ÿ</p>
<p>æˆ–è®¸ï¼Œæˆ‘ä»¬å¿…é¡»ç†Ÿæ‚‰ä»–æ‰å¯ä»¥åšæ›´å¤šæœ‰æ„ä¹‰çš„work</p>
<p>åœ¨å¼€å¯äº† TLS çš„é›†ç¾¤ä¸­ï¼Œæ¯å½“ä¸é›†ç¾¤äº¤äº’çš„æ—¶å€™å°‘ä¸äº†çš„æ˜¯<a href="https://cloud.tencent.com/solution/tb-digitalid?from=10680" target="_blank" rel="noopener noreferrer">èº«ä»½è®¤è¯<ExternalLinkIcon/></a>ï¼Œä½¿ç”¨ kubeconfigï¼ˆå³è¯ä¹¦ï¼‰ å’Œ token ä¸¤ç§è®¤è¯æ–¹å¼æ˜¯æœ€ç®€å•ä¹Ÿæœ€é€šç”¨çš„è®¤è¯æ–¹å¼ã€‚</p>
</div>
<details class="custom-container details"><summary>é’ˆå¯¹ä¸€æ¬¡ Kubeconfig é—®é¢˜çš„è®°å½•</summary>
<ul>
<li><a href="https://headworq.org/en/how-to-connect-to-kubernetes/#" target="_blank" rel="noopener noreferrer">å…³äºè¿™æ¬¡é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ<ExternalLinkIcon/></a></li>
</ul>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>èµµä¸½é¢–
 ä»Šå¤© ä¸­åˆ <span class="token number">12</span>:18
Ladies and gentlemen, after the agent <span class="token function">node</span> deployment, my k3s prompts such an error. What is the cause




<span class="token number">23</span> æ¡å›å¤
æ–°å¢åŠŸèƒ½


icsy7867
  <span class="token number">26</span> åˆ†é’Ÿå‰
It shouldn<span class="token string">'t be talking to port 8080.  But 6443.  This usually means kubectl doesn'</span>t have access to the yaml conf.
åŒæ—¶å‘é€è‡³é¢‘é“


èµµä¸½é¢–
  <span class="token number">25</span> åˆ†é’Ÿå‰
Sorry, I don<span class="token string">'t quite understand the k3s configuration, which files should I modify?


icsy7867
  25 åˆ†é’Ÿå‰
Did you move the config to the location you specified?


icsy7867
  25 åˆ†é’Ÿå‰
And check the permissions
ä»…å¯¹ä½ å¯è§


Slackbot
  24 åˆ†é’Ÿå‰
/etc/rancher/k3s/config.yamléæœ‰æ•ˆå‘½ä»¤ã€‚åœ¨ Slack ä¸­ï¼Œæ‰€æœ‰ä»¥ "/" å­—ç¬¦å¼€å§‹çš„æ¶ˆæ¯éƒ½è¢«è§£æä¸ºå‘½ä»¤ã€‚
å¦‚æœä½ å°è¯•å‘é€æ¶ˆæ¯è€Œä¸æ˜¯è¿è¡Œå‘½ä»¤ï¼Œè¯·å°è¯•åœ¨ "/" å‰åŠ ç©ºæ ¼ã€‚


èµµä¸½é¢–
  24 åˆ†é’Ÿå‰
/etc/rancher/k3s/config.yaml 


èµµä¸½é¢–
  24 åˆ†é’Ÿå‰
This is the position?


icsy7867
  20 åˆ†é’Ÿå‰
Or k3s.yaml.  not next to a computer


icsy7867
  19 åˆ†é’Ÿå‰
Or is it in that directory you specified?  If so try to export that path so kubectl knows where to look


èµµä¸½é¢–
  19 åˆ†é’Ÿå‰
image.png
 
image.png




èµµä¸½é¢–
  18 åˆ†é’Ÿå‰
I didn'</span>t use <span class="token string">'K3S_CONFIG_FILE'</span> to specify it


èµµä¸½é¢–
  <span class="token number">18</span> åˆ†é’Ÿå‰
Where should it go?


èµµä¸½é¢–
  <span class="token number">16</span> åˆ†é’Ÿå‰
Even though I specify its location, it seems to be blank
image.png
 
image.png


icsy7867
  <span class="token number">16</span> åˆ†é’Ÿå‰
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/rancher/k3s/k3s.yaml


icsy7867
  <span class="token number">16</span> åˆ†é’Ÿå‰
Try running this


icsy7867
  <span class="token number">14</span> åˆ†é’Ÿå‰
And <span class="token keyword">then</span> kubectl get nodes


èµµä¸½é¢–
  <span class="token number">13</span> åˆ†é’Ÿå‰
Thank you very much <span class="token keyword">for</span> your answer. Are you the maintainer of the k3s community


icsy7867
  <span class="token number">11</span> åˆ†é’Ÿå‰
Nope.  Just someone <span class="token function">who</span> has stumbled around playing with k3s and happened to see your message :å¾®ç¬‘:


èµµä¸½é¢–
  <span class="token number">9</span> åˆ†é’Ÿå‰
Nice to meet you. What you met is a junior undergraduate student from China. There is an assignment about k3s


icsy7867
  <span class="token number">5</span> åˆ†é’Ÿå‰
Neat<span class="token operator">!</span>


icsy7867
  <span class="token number">5</span> åˆ†é’Ÿå‰
Nice to meet you


icsy7867
  <span class="token number">5</span> åˆ†é’Ÿå‰
And here<span class="token string">'s a good link
https://headworq.org/en/how-to-connect-to-kubernetes/
headworqheadworq
3 ways to connect to your K3s Kubernetes Cluster
In this article I'</span>ll show you three Kubernetes Clients â€“ Kubectl, Lens and Kubenav.
<span class="token number">2021</span> å¹´ <span class="token number">1</span> æœˆ <span class="token number">18</span> æ—¥ <span class="token punctuation">(</span><span class="token number">557</span> kB<span class="token punctuation">)</span>
https://headworq.org/en/how-to-connect-to-kubernetes/



icsy7867
  <span class="token number">4</span> åˆ†é’Ÿå‰
The problem was kubectl was looking <span class="token keyword">for</span> a config file, couldn't <span class="token function">find</span> one and tried a basic setup.


èµµä¸½é¢–
  <span class="token operator">&lt;</span> <span class="token number">1</span> åˆ†é’Ÿå‰
yep, great article, thanks so much <span class="token keyword">for</span> your <span class="token builtin class-name">help</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<h2 id="å‘½ä»¤å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤å‚æ•°" aria-hidden="true">#</a> å‘½ä»¤å‚æ•°</h2>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config SUBCOMMAND

é€‰é¡¹
      <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> ä½¿ç”¨ç‰¹å®šçš„é…ç½®æ–‡ä»¶ã€‚

ç»§æ‰¿è‡ªçˆ¶å‘½ä»¤çš„é€‰é¡¹
      --alsologtostderr<span class="token punctuation">[</span><span class="token operator">=</span>false<span class="token punctuation">]</span>: åŒæ—¶è¾“å‡ºæ—¥å¿—åˆ°æ ‡å‡†é”™è¯¯æ§åˆ¶å°å’Œæ–‡ä»¶ã€‚
      --api-version<span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> å’ŒæœåŠ¡ç«¯äº¤äº’ä½¿ç”¨çš„APIç‰ˆæœ¬ã€‚
      --certificate-authority<span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> ç”¨ä»¥è¿›è¡Œè®¤è¯æˆæƒçš„.certæ–‡ä»¶è·¯å¾„ã€‚
      --client-certificate<span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> TLSä½¿ç”¨çš„å®¢æˆ·ç«¯è¯ä¹¦è·¯å¾„ã€‚
      --client-key<span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> TLSä½¿ç”¨çš„å®¢æˆ·ç«¯å¯†é’¥è·¯å¾„ã€‚
      <span class="token parameter variable">--cluster</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> æŒ‡å®šä½¿ç”¨çš„kubeconfigé…ç½®æ–‡ä»¶ä¸­çš„é›†ç¾¤åã€‚
      <span class="token parameter variable">--context</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> æŒ‡å®šä½¿ç”¨çš„kubeconfigé…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒåã€‚
      --insecure-skip-tls-verify<span class="token punctuation">[</span><span class="token operator">=</span>false<span class="token punctuation">]</span>: å¦‚æœä¸ºtrueï¼Œå°†ä¸ä¼šæ£€æŸ¥æœåŠ¡å™¨å‡­è¯çš„æœ‰æ•ˆæ€§ï¼Œè¿™ä¼šå¯¼è‡´ä½ çš„HTTPSé“¾æ¥å˜å¾—ä¸å®‰å…¨ã€‚
      <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> å‘½ä»¤è¡Œè¯·æ±‚ä½¿ç”¨çš„é…ç½®æ–‡ä»¶è·¯å¾„ã€‚
      --log-backtrace-at<span class="token operator">=</span>:0: å½“æ—¥å¿—é•¿åº¦è¶…è¿‡å®šä¹‰çš„è¡Œæ•°æ—¶ï¼Œå¿½ç•¥å †æ ˆä¿¡æ¯ã€‚
      --log-dir<span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> å¦‚æœä¸ä¸ºç©ºï¼Œå°†æ—¥å¿—æ–‡ä»¶å†™å…¥æ­¤ç›®å½•ã€‚
      --log-flush-frequency<span class="token operator">=</span>5s: åˆ·æ–°æ—¥å¿—çš„æœ€å¤§æ—¶é—´é—´éš”ã€‚
      --logtostderr<span class="token punctuation">[</span><span class="token operator">=</span>true<span class="token punctuation">]</span>: è¾“å‡ºæ—¥å¿—åˆ°æ ‡å‡†é”™è¯¯æ§åˆ¶å°ï¼Œä¸è¾“å‡ºåˆ°æ–‡ä»¶ã€‚
      --match-server-version<span class="token punctuation">[</span><span class="token operator">=</span>false<span class="token punctuation">]</span>: è¦æ±‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç‰ˆæœ¬åŒ¹é…ã€‚
      <span class="token parameter variable">--namespace</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> å¦‚æœä¸ä¸ºç©ºï¼Œå‘½ä»¤å°†ä½¿ç”¨æ­¤namespaceã€‚
      <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> API Serverè¿›è¡Œç®€å•è®¤è¯ä½¿ç”¨çš„å¯†ç ã€‚
  -s, <span class="token parameter variable">--server</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> Kubernetes API Serverçš„åœ°å€å’Œç«¯å£å·ã€‚
      <span class="token parameter variable">--stderrthreshold</span><span class="token operator">=</span><span class="token number">2</span>: é«˜äºæ­¤çº§åˆ«çš„æ—¥å¿—å°†è¢«è¾“å‡ºåˆ°é”™è¯¯æ§åˆ¶å°ã€‚
      <span class="token parameter variable">--token</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> è®¤è¯åˆ°API Serverä½¿ç”¨çš„ä»¤ç‰Œã€‚
      <span class="token parameter variable">--user</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> æŒ‡å®šä½¿ç”¨çš„kubeconfigé…ç½®æ–‡ä»¶ä¸­çš„ç”¨æˆ·åã€‚
      <span class="token parameter variable">--username</span><span class="token operator">=</span><span class="token string">""</span><span class="token builtin class-name">:</span> API Serverè¿›è¡Œç®€å•è®¤è¯ä½¿ç”¨çš„ç”¨æˆ·åã€‚
      <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">0</span>: æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„çº§åˆ«ã€‚
      <span class="token parameter variable">--vmodule</span><span class="token operator">=</span>: æŒ‡å®šè¾“å‡ºæ—¥å¿—çš„æ¨¡å—ï¼Œæ ¼å¼å¦‚ä¸‹ï¼špattern<span class="token operator">=</span>Nï¼Œä½¿ç”¨é€—å·åˆ†éš”ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨-kubeconfig-æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—®" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-kubeconfig-æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—®" aria-hidden="true">#</a> ä½¿ç”¨ kubeconfig æ–‡ä»¶ç»„ç»‡é›†ç¾¤è®¿é—®</h2>
<p>ä½¿ç”¨ kubeconfig æ–‡ä»¶æ¥ç»„ç»‡æœ‰å…³é›†ç¾¤ã€ç”¨æˆ·ã€å‘½åç©ºé—´å’Œèº«ä»½éªŒè¯æœºåˆ¶çš„ä¿¡æ¯ã€‚<code v-pre>kubectl</code>å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ kubeconfig æ–‡ä»¶æ¥æŸ¥æ‰¾é€‰æ‹©é›†ç¾¤å’Œä¸é›†ç¾¤çš„ API æœåŠ¡å™¨é€šä¿¡æ‰€éœ€çš„ä¿¡æ¯ã€‚</p>
<div class="custom-container danger"><p class="custom-container-title">è­¦å‘Š</p>
<p>**æ³¨æ„ï¼š**ç”¨äºé…ç½®å¯¹é›†ç¾¤çš„è®¿é—®çš„æ–‡ä»¶ç§°ä¸º<em>kubeconfig æ–‡ä»¶</em>ã€‚è¿™æ˜¯å¼•ç”¨é…ç½®æ–‡ä»¶çš„é€šç”¨æ–¹å¼ã€‚è¿™å¹¶ä¸æ„å‘³ç€æœ‰ä¸€ä¸ªåä¸º<code v-pre>kubeconfig</code>.</p>
<p>**è­¦å‘Šï¼š**ä»…ä½¿ç”¨æ¥è‡ªå¯ä¿¡æ¥æºçš„ kubeconfig æ–‡ä»¶ã€‚ä½¿ç”¨ç‰¹åˆ¶çš„ kubeconfig æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æ¶æ„ä»£ç æ‰§è¡Œæˆ–æ–‡ä»¶æš´éœ²ã€‚å¦‚æœæ‚¨å¿…é¡»ä½¿ç”¨ä¸å—ä¿¡ä»»çš„ kubeconfig æ–‡ä»¶ï¼Œè¯·å…ˆä»”ç»†æ£€æŸ¥å®ƒï¼Œå°±åƒæ£€æŸ¥ shell è„šæœ¬ä¸€æ ·ã€‚</p>
</div>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code v-pre>kubectl</code>æŸ¥æ‰¾ç›®å½•ä¸­å‘½å<code v-pre>config</code>çš„<code v-pre>$HOME/.kube</code>æ–‡ä»¶ã€‚<code v-pre>KUBECONFIG</code>æ‚¨å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡æˆ–è®¾ç½® <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl/" target="_blank" rel="noopener noreferrer"><code v-pre>--kubeconfig</code><ExternalLinkIcon/></a>æ ‡å¿—æ¥æŒ‡å®šå…¶ä»– kubeconfig æ–‡ä»¶ã€‚</p>
<h2 id="æ”¯æŒå¤šé›†ç¾¤ã€å¤šç”¨æˆ·ã€å¤šè®¤è¯æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#æ”¯æŒå¤šé›†ç¾¤ã€å¤šç”¨æˆ·ã€å¤šè®¤è¯æœºåˆ¶" aria-hidden="true">#</a> æ”¯æŒå¤šé›†ç¾¤ã€å¤šç”¨æˆ·ã€å¤šè®¤è¯æœºåˆ¶<a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/#supporting-multiple-clusters-users-and-authentication-mechanisms" target="_blank" rel="noopener noreferrer"> <ExternalLinkIcon/></a></h2>
<p>å‡è®¾æ‚¨æœ‰å¤šä¸ªé›†ç¾¤ï¼Œå¹¶ä¸”æ‚¨çš„ç”¨æˆ·å’Œç»„ä»¶ä»¥å¤šç§æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>æ­£åœ¨è¿è¡Œçš„ kubelet å¯èƒ½ä¼šä½¿ç”¨è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
<li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä»¤ç‰Œè¿›è¡Œèº«ä»½éªŒè¯ã€‚</li>
<li>ç®¡ç†å‘˜å¯èƒ½æ‹¥æœ‰ä»–ä»¬æä¾›ç»™å„ä¸ªç”¨æˆ·çš„è¯ä¹¦é›†ã€‚</li>
</ul>
<p>ä½¿ç”¨ kubeconfig æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç»„ç»‡é›†ç¾¤ã€ç”¨æˆ·å’Œå‘½åç©ºé—´ã€‚æ‚¨è¿˜å¯ä»¥å®šä¹‰ä¸Šä¸‹æ–‡ä»¥åœ¨é›†ç¾¤å’Œåç§°ç©ºé—´ä¹‹é—´å¿«é€Ÿè½»æ¾åœ°åˆ‡æ¢ã€‚</p>
<blockquote>
<p><code v-pre>kubectl config use-context</code> å‘½ä»¤å¿«é€Ÿåœ°åœ¨é›†ç¾¤ä¹‹é—´è¿›è¡Œåˆ‡æ¢ã€‚</p>
</blockquote>
<h2 id="ä¸Šä¸‹æ–‡-context" tabindex="-1"><a class="header-anchor" href="#ä¸Šä¸‹æ–‡-context" aria-hidden="true">#</a> ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰</h2>
<p>é€šè¿‡ kubeconfig æ–‡ä»¶ä¸­çš„ <em>context</em> å…ƒç´ ï¼Œä½¿ç”¨ç®€ä¾¿çš„åç§°æ¥å¯¹è®¿é—®å‚æ•°è¿›è¡Œåˆ†ç»„ã€‚ æ¯ä¸ª context éƒ½æœ‰ä¸‰ä¸ªå‚æ•°ï¼šclusterã€namespace å’Œ userã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code v-pre>kubectl</code> å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨ <strong>å½“å‰ä¸Šä¸‹æ–‡</strong> ä¸­çš„å‚æ•°ä¸é›†ç¾¤è¿›è¡Œé€šä¿¡ã€‚</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config use-context
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="kubeconfig-ç¯å¢ƒå˜é‡" tabindex="-1"><a class="header-anchor" href="#kubeconfig-ç¯å¢ƒå˜é‡" aria-hidden="true">#</a> KUBECONFIG ç¯å¢ƒå˜é‡</h2>
<p><code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡åŒ…å«ä¸€ä¸ª kubeconfig æ–‡ä»¶åˆ—è¡¨ã€‚ å¯¹äº Linux å’Œ Macï¼Œåˆ—è¡¨ä»¥å†’å·åˆ†éš”ã€‚å¯¹äº Windowsï¼Œåˆ—è¡¨ä»¥åˆ†å·åˆ†éš”ã€‚ <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡ä¸æ˜¯å¿…è¦çš„ã€‚ å¦‚æœ <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œ<code v-pre>kubectl</code> ä½¿ç”¨é»˜è®¤çš„ kubeconfig æ–‡ä»¶ï¼Œ<code v-pre>$HOME/.kube/config</code>ã€‚</p>
<p>å¦‚æœ <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡å­˜åœ¨ï¼Œ<code v-pre>kubectl</code> ä½¿ç”¨ <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡ä¸­åˆ—ä¸¾çš„æ–‡ä»¶åˆå¹¶åçš„æœ‰æ•ˆé…ç½®ã€‚</p>
<h2 id="åˆå¹¶-kubeconfig-æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#åˆå¹¶-kubeconfig-æ–‡ä»¶" aria-hidden="true">#</a> åˆå¹¶ kubeconfig æ–‡ä»¶</h2>
<p>è¦æŸ¥çœ‹é…ç½®ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@iZbp1evo5cnwagauz3w188Z ~<span class="token punctuation">]</span><span class="token comment"># kubectl config view</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
    <span class="token key atrule">certificate-authority-data</span><span class="token punctuation">:</span> DATA+OMITTED
    <span class="token key atrule">server</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//apiserver.cluster.local<span class="token punctuation">:</span><span class="token number">6443</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span> kubernetes
    <span class="token key atrule">user</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>admin
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>admin@kubernetes
<span class="token key atrule">current-context</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>admin@kubernetes
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Config
<span class="token key atrule">preferences</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>admin
  <span class="token key atrule">user</span><span class="token punctuation">:</span>
    <span class="token key atrule">client-certificate-data</span><span class="token punctuation">:</span> REDACTED
    <span class="token key atrule">client-key-data</span><span class="token punctuation">:</span> REDACTED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚å‰æ‰€è¿°ï¼Œè¾“å‡ºå¯èƒ½æ¥è‡ª kubeconfig æ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½æ˜¯åˆå¹¶å¤šä¸ª kubeconfig æ–‡ä»¶çš„ç»“æœã€‚</p>
<p><strong>ä»¥ä¸‹æ˜¯ <code v-pre>kubectl</code> åœ¨åˆå¹¶ kubeconfig æ–‡ä»¶æ—¶ä½¿ç”¨çš„è§„åˆ™ã€‚</strong></p>
<p>å¦‚æœè®¾ç½®äº† <code v-pre>--kubeconfig</code> å‚æ•°ï¼Œåˆ™ä»…ä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶ã€‚ä¸è¿›è¡Œåˆå¹¶ã€‚æ­¤å‚æ•°åªèƒ½ä½¿ç”¨ä¸€æ¬¡ã€‚</p>
<p>å¦åˆ™ï¼Œå¦‚æœè®¾ç½®äº† <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡ï¼Œå°†å®ƒç”¨ä½œåº”åˆå¹¶çš„æ–‡ä»¶åˆ—è¡¨ã€‚æ ¹æ®ä»¥ä¸‹è§„åˆ™åˆå¹¶ <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡ä¸­åˆ—å‡ºçš„æ–‡ä»¶ï¼š</p>
<ul>
<li>å¿½ç•¥ç©ºæ–‡ä»¶åã€‚</li>
<li>å¯¹äºå†…å®¹æ— æ³•ååºåˆ—åŒ–çš„æ–‡ä»¶ï¼Œäº§ç”Ÿé”™è¯¯ä¿¡æ¯ã€‚</li>
<li>ç¬¬ä¸€ä¸ªè®¾ç½®ç‰¹å®šå€¼æˆ–è€…æ˜ å°„é”®çš„æ–‡ä»¶å°†ç”Ÿæ•ˆã€‚</li>
<li>æ°¸è¿œä¸ä¼šæ›´æ”¹å€¼æˆ–è€…æ˜ å°„é”®ã€‚ç¤ºä¾‹ï¼šä¿ç•™ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä»¥è®¾ç½® <code v-pre>current-context</code>ã€‚ç¤ºä¾‹ï¼šå¦‚æœä¸¤ä¸ªæ–‡ä»¶éƒ½æŒ‡å®šäº† <code v-pre>red-user</code>ï¼Œåˆ™ä»…ä½¿ç”¨ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„ <code v-pre>red-user</code> ä¸­çš„å€¼ã€‚å³ä½¿ç¬¬äºŒä¸ªæ–‡ä»¶åœ¨ <code v-pre>red-user</code> ä¸‹æœ‰éå†²çªæ¡ç›®ï¼Œä¹Ÿè¦ä¸¢å¼ƒå®ƒä»¬ã€‚</li>
</ul>
<p>æœ‰å…³è®¾ç½® <code v-pre>KUBECONFIG</code> ç¯å¢ƒå˜é‡çš„ç¤ºä¾‹ï¼Œè¯·å‚é˜… <a href="https://kubernetes.io/zh-cn/docs/tasks/access-application-cluster/configure-access-multiple-clusters/#set-the-kubeconfig-environment-variable" target="_blank" rel="noopener noreferrer">è®¾ç½® KUBECONFIG ç¯å¢ƒå˜é‡<ExternalLinkIcon/></a>ã€‚</p>
<p>å¦åˆ™ï¼Œä½¿ç”¨é»˜è®¤çš„ kubeconfig æ–‡ä»¶ï¼Œ <code v-pre>$HOME/.kube/config</code>ï¼Œä¸è¿›è¡Œåˆå¹¶ã€‚</p>
<p><strong>æ ¹æ®æ­¤é“¾ä¸­çš„ç¬¬ä¸€ä¸ªåŒ¹é…ç¡®å®šè¦ä½¿ç”¨çš„ä¸Šä¸‹æ–‡:</strong></p>
<ol>
<li>å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨ <code v-pre>--context</code> å‘½ä»¤è¡Œå‚æ•°ã€‚</li>
<li>ä½¿ç”¨åˆå¹¶çš„ kubeconfig æ–‡ä»¶ä¸­çš„ <code v-pre>current-context</code>ã€‚</li>
</ol>
<p><strong>è¿™ç§åœºæ™¯ä¸‹å…è®¸ç©ºä¸Šä¸‹æ–‡:</strong></p>
<p>ç¡®å®šé›†ç¾¤å’Œç”¨æˆ·ã€‚æ­¤æ—¶ï¼Œå¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰ä¸Šä¸‹æ–‡ã€‚æ ¹æ®æ­¤é“¾ä¸­çš„ç¬¬ä¸€ä¸ªåŒ¹é…ç¡®å®šé›†ç¾¤å’Œç”¨æˆ·ï¼Œè¿™å°†è¿è¡Œä¸¤æ¬¡ï¼šä¸€æ¬¡ç”¨äºç”¨æˆ·ï¼Œä¸€æ¬¡ç”¨äºé›†ç¾¤ã€‚</p>
<ol>
<li>å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼š<code v-pre>--user</code> æˆ–è€… <code v-pre>--cluster</code>ã€‚</li>
<li>å¦‚æœä¸Šä¸‹æ–‡éç©ºï¼Œä»ä¸Šä¸‹æ–‡ä¸­è·å–ç”¨æˆ·æˆ–é›†ç¾¤ã€‚</li>
</ol>
<p><strong>è¿™ç§åœºæ™¯ä¸‹ç”¨æˆ·å’Œé›†ç¾¤å¯ä»¥ä¸ºç©º:</strong></p>
<p>ç¡®å®šè¦ä½¿ç”¨çš„å®é™…é›†ç¾¤ä¿¡æ¯ã€‚æ­¤æ—¶ï¼Œå¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰é›†ç¾¤ä¿¡æ¯ã€‚åŸºäºæ­¤é“¾æ„å»ºæ¯ä¸ªé›†ç¾¤ä¿¡æ¯ï¼›ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ä¼šè¢«é‡‡ç”¨ï¼š</p>
<ol>
<li>å¦‚æœå­˜åœ¨ï¼š<code v-pre>--server</code>ã€<code v-pre>--certificate-authority</code> å’Œ <code v-pre>--insecure-skip-tls-verify</code>ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚</li>
<li>å¦‚æœåˆå¹¶çš„ kubeconfig æ–‡ä»¶ä¸­å­˜åœ¨é›†ç¾¤ä¿¡æ¯å±æ€§ï¼Œåˆ™ä½¿ç”¨å®ƒä»¬ã€‚</li>
<li>å¦‚æœæ²¡æœ‰ server é…ç½®ï¼Œåˆ™é…ç½®æ— æ•ˆã€‚</li>
</ol>
<p>ç¡®å®šè¦ä½¿ç”¨çš„å®é™…ç”¨æˆ·ä¿¡æ¯ã€‚ä½¿ç”¨ä¸é›†ç¾¤ä¿¡æ¯ç›¸åŒçš„è§„åˆ™æ„å»ºç”¨æˆ·ä¿¡æ¯ï¼Œä½†æ¯ä¸ªç”¨æˆ·åªå…è®¸ä¸€ç§èº«ä»½è®¤è¯æŠ€æœ¯ï¼š</p>
<ol>
<li>å¦‚æœå­˜åœ¨ï¼š<code v-pre>--client-certificate</code>ã€<code v-pre>--client-key</code>ã€<code v-pre>--username</code>ã€<code v-pre>--password</code> å’Œ <code v-pre>--token</code>ï¼Œä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ã€‚</li>
<li>ä½¿ç”¨åˆå¹¶çš„ kubeconfig æ–‡ä»¶ä¸­çš„ <code v-pre>user</code> å­—æ®µã€‚</li>
<li>å¦‚æœå­˜åœ¨ä¸¤ç§å†²çªæŠ€æœ¯ï¼Œåˆ™é…ç½®æ— æ•ˆã€‚</li>
<li>å¯¹äºä»ç„¶ç¼ºå¤±çš„ä»»ä½•ä¿¡æ¯ï¼Œä½¿ç”¨å…¶å¯¹åº”çš„é»˜è®¤å€¼ï¼Œå¹¶å¯èƒ½æç¤ºè¾“å…¥èº«ä»½è®¤è¯ä¿¡æ¯ã€‚</li>
</ol>
<h2 id="æ–‡ä»¶å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#æ–‡ä»¶å¼•ç”¨" aria-hidden="true">#</a> æ–‡ä»¶å¼•ç”¨</h2>
<p>kubeconfig æ–‡ä»¶ä¸­çš„æ–‡ä»¶å’Œè·¯å¾„å¼•ç”¨æ˜¯ç›¸å¯¹äº kubeconfig æ–‡ä»¶çš„ä½ç½®ã€‚ å‘½ä»¤è¡Œä¸Šçš„æ–‡ä»¶å¼•ç”¨æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•çš„ã€‚ åœ¨ <code v-pre>$HOME/.kube/config</code> ä¸­ï¼Œç›¸å¯¹è·¯å¾„æŒ‰ç›¸å¯¹è·¯å¾„å­˜å‚¨ï¼Œç»å¯¹è·¯å¾„æŒ‰ç»å¯¹è·¯å¾„å­˜å‚¨ã€‚</p>
<h2 id="kubeconfig-ä¸¤ç§å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#kubeconfig-ä¸¤ç§å®ç°æ–¹å¼" aria-hidden="true">#</a> kubeconfig ä¸¤ç§å®ç°æ–¹å¼</h2>
<ol>
<li>åˆ›å»º Kubeconfig æ–‡ä»¶
<ol>
<li>ç”³è¯·è¯ä¹¦</li>
<li>åˆ›å»º kuberconfig æ–‡ä»¶</li>
<li>éªŒè¯ kuberconfig æ–‡ä»¶</li>
</ol>
</li>
<li>æ‰‹åŠ¨å¤åˆ¶è¯ä¹¦
<ol>
<li>é›†ç¾¤ç¯å¢ƒ</li>
<li>é…ç½®æ–¹æ³•</li>
</ol>
</li>
</ol>
<h2 id="ä»£ç†" tabindex="-1"><a class="header-anchor" href="#ä»£ç†" aria-hidden="true">#</a> ä»£ç†</h2>
<p>ä½ å¯ä»¥åœ¨ <code v-pre>kubeconfig</code> æ–‡ä»¶ä¸­ï¼Œä¸ºæ¯ä¸ªé›†ç¾¤é…ç½® <code v-pre>proxy-url</code> æ¥è®© <code v-pre>kubectl</code> ä½¿ç”¨ä»£ç†ï¼Œä¾‹å¦‚ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>apiVersion: v1
kind: Config

clusters:
- cluster:
    proxy-url: http://proxy.example.org:3128
    server: https://k8s.example.org/k8s/clusters/c-xxyyzz
  name: development

users:
- name: developer

contexts:
- context:
  name: development
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®šä¹‰é›†ç¾¤-ç”¨æˆ·å’Œ-context" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰é›†ç¾¤-ç”¨æˆ·å’Œ-context" aria-hidden="true">#</a> å®šä¹‰é›†ç¾¤ï¼Œç”¨æˆ·å’Œ context</h2>
<p>å‡è®¾ç”¨æˆ·æœ‰ä¸¤ä¸ªé›†ç¾¤ï¼Œä¸€ä¸ªç”¨äºæ­£å¼å¼€å‘å·¥ä½œï¼Œä¸€ä¸ªç”¨äºå…¶å®ƒä¸´æ—¶ç”¨é€”ï¼ˆscratchï¼‰ã€‚ åœ¨ <code v-pre>development</code> é›†ç¾¤ä¸­ï¼Œå‰ç«¯å¼€å‘è€…åœ¨åä¸º <code v-pre>frontend</code> çš„åå­—ç©ºé—´ä¸‹å·¥ä½œï¼Œ å­˜å‚¨å¼€å‘è€…åœ¨åä¸º <code v-pre>storage</code> çš„åå­—ç©ºé—´ä¸‹å·¥ä½œã€‚åœ¨ <code v-pre>scratch</code> é›†ç¾¤ä¸­ï¼Œ å¼€å‘äººå‘˜å¯èƒ½åœ¨é»˜è®¤åå­—ç©ºé—´ä¸‹å·¥ä½œï¼Œä¹Ÿå¯èƒ½è§†æƒ…å†µåˆ›å»ºé™„åŠ çš„åå­—ç©ºé—´ã€‚ è®¿é—®å¼€å‘é›†ç¾¤éœ€è¦é€šè¿‡è¯ä¹¦è¿›è¡Œè®¤è¯ã€‚ è®¿é—®å…¶å®ƒä¸´æ—¶ç”¨é€”çš„é›†ç¾¤éœ€è¦é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œè®¤è¯ã€‚</p>
<p>åˆ›å»ºåä¸º <code v-pre>config-exercise</code> çš„ç›®å½•ã€‚åœ¨ <code v-pre>config-exercise</code> ç›®å½•ä¸­ï¼Œåˆ›å»ºåä¸º <code v-pre>config-demo</code> çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹ä¸ºï¼š</p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Config
<span class="token key atrule">preferences</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token key atrule">clusters</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> development
<span class="token punctuation">-</span> <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> scratch

<span class="token key atrule">users</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> developer
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> experimenter

<span class="token key atrule">contexts</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>frontend
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev<span class="token punctuation">-</span>storage
<span class="token punctuation">-</span> <span class="token key atrule">context</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> exp<span class="token punctuation">-</span>scratch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®æ–‡ä»¶æè¿°äº†é›†ç¾¤ã€ç”¨æˆ·åå’Œä¸Šä¸‹æ–‡ã€‚<code v-pre>config-demo</code> æ–‡ä»¶ä¸­å«æœ‰æè¿°ä¸¤ä¸ªé›†ç¾¤ã€ ä¸¤ä¸ªç”¨æˆ·å’Œä¸‰ä¸ªä¸Šä¸‹æ–‡çš„æ¡†æ¶ã€‚</p>
<p>è¿›å…¥ <code v-pre>config-exercise</code> ç›®å½•ã€‚è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå°†é›†ç¾¤è¯¦ç»†ä¿¡æ¯æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span>config-demo set-cluster development <span class="token parameter variable">--server</span><span class="token operator">=</span>https://1.2.3.4 --certificate-authority<span class="token operator">=</span>fake-ca-file
kubectl config <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span>config-demo set-cluster scratch <span class="token parameter variable">--server</span><span class="token operator">=</span>https://5.6.7.8 --insecure-skip-tls-verify
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">**æ³¨æ„ï¼š**</p>
<p>å°†å¯†ç ä¿å­˜åˆ° Kubernetes å®¢æˆ·ç«¯é…ç½®ä¸­æœ‰é£é™©ã€‚ ä¸€ä¸ªè¾ƒå¥½çš„æ›¿ä»£æ–¹å¼æ˜¯ä½¿ç”¨å‡­æ®æ’ä»¶å¹¶å•ç‹¬ä¿å­˜è¿™äº›å‡­æ®ã€‚ å‚é˜… <a href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins" target="_blank" rel="noopener noreferrer">client-go å‡­æ®æ’ä»¶<ExternalLinkIcon/></a></p>
</div>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span>config-demo set-credentials developer --client-certificate<span class="token operator">=</span>fake-cert-file --client-key<span class="token operator">=</span>fake-key-seefile
kubectl config <span class="token parameter variable">--kubeconfig</span><span class="token operator">=</span>config-demo set-credentials experimenter <span class="token parameter variable">--username</span><span class="token operator">=</span>exp <span class="token parameter variable">--password</span><span class="token operator">=</span>some-password
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>::: tip<strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>è¦åˆ é™¤ç”¨æˆ·ï¼Œå¯ä»¥è¿è¡Œ <code v-pre>kubectl --kubeconfig=config-demo config unset users.&lt;name&gt;</code></li>
<li>è¦åˆ é™¤é›†ç¾¤ï¼Œå¯ä»¥è¿è¡Œ <code v-pre>kubectl --kubeconfig=config-demo config unset clusters.&lt;name&gt;</code></li>
<li>è¦åˆ é™¤ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥è¿è¡Œ <code v-pre>kubectl --kubeconfig=config-demo config unset contexts.&lt;name&gt;</code>
:::</li>
</ul>
<h2 id="ç”Ÿæˆkubeconfigçš„é…ç½®æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ç”Ÿæˆkubeconfigçš„é…ç½®æ­¥éª¤" aria-hidden="true">#</a> ç”Ÿæˆkubeconfigçš„é…ç½®æ­¥éª¤</h2>
<p><strong>å®šä¹‰å˜é‡ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>export KUBE_APISERVER="https://172.20.0.2:6443" 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è®¾ç½®é›†ç¾¤å‚æ•°ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config set-cluster kubernetes   --certificate-authority<span class="token operator">=</span>/etc/kubernetes/ssl/ca.pem   --embed-certs<span class="token operator">=</span>true   <span class="token parameter variable">--server</span><span class="token operator">=</span><span class="token variable">${KUBE_APISERVER}</span>   <span class="token comment">#å¯ä»¥æŒ‡å®šè·¯å¾„kubeconfig=/root/config.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>è¯´æ˜ï¼šé›†ç¾¤å‚æ•°ä¸»è¦è®¾ç½®äº†æ‰€éœ€è¦è®¿é—®çš„é›†ç¾¤çš„ä¿¡æ¯ã€‚ä½¿ç”¨ <code v-pre>set-cluster</code> è®¾ç½®äº†éœ€è¦è®¿é—®çš„é›†ç¾¤ï¼Œå¦‚ä¸Šä¸º <code v-pre>kubernetes</code>ï¼›<code v-pre>--certificate-authority</code>è®¾ç½®äº†è¯¥é›†ç¾¤çš„å…¬é’¥ï¼›<code v-pre>--embed-certs</code>ä¸º <code v-pre>true</code> è¡¨ç¤ºå°† <code v-pre>--certificate-authority</code> è¯ä¹¦å†™å…¥åˆ° <code v-pre>kubeconfig</code> ä¸­ï¼›<code v-pre>--server</code>åˆ™è¡¨ç¤ºè¯¥é›†ç¾¤çš„ kube-apiserver åœ°å€ã€‚</p>
</blockquote>
<p><strong>è®¾ç½®å®¢æˆ·ç«¯è®¤è¯å‚æ•°ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config set-credentials admin   --client-certificate<span class="token operator">=</span>/etc/kubernetes/ssl/admin.pem   --embed-certs<span class="token operator">=</span>true   --client-key<span class="token operator">=</span>/etc/kubernetes/ssl/admin-key.pem <span class="token comment">#å¯ä»¥æŒ‡å®šè·¯å¾„kubeconfig=/root/config.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>è¯´æ˜ï¼šç”¨æˆ·å‚æ•°ä¸»è¦è®¾ç½®ç”¨æˆ·çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ç”¨æˆ·è¯ä¹¦ã€‚å¦‚ä¸Šçš„ç”¨æˆ·åä¸ºadminï¼Œè¯ä¹¦ä¸ºï¼š/etc/kubernetes/ssl/admin.pemï¼Œç§é’¥ä¸ºï¼š/etc/kubernetes/ssl/admin-key.pemã€‚æ³¨æ„å®¢æˆ·ç«¯çš„è¯ä¹¦é¦–å…ˆè¦ç»è¿‡é›†ç¾¤CAçš„ç­¾ç½²ï¼Œå¦åˆ™ä¸ä¼šè¢«é›†ç¾¤è®¤å¯ã€‚æ­¤å¤„ä½¿ç”¨çš„æ˜¯caè®¤è¯æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨tokenè®¤è¯ï¼Œå¦‚kubeletçš„ TLS Boostrapæœºåˆ¶ä¸‹çš„bootstrappingä½¿ç”¨çš„å°±æ˜¯tokenè®¤è¯æ–¹å¼ã€‚</p>
</blockquote>
<p><strong>è®¾ç½®ä¸Šä¸‹æ–‡å‚æ•°ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config set-context kubernetes   <span class="token parameter variable">--cluster</span><span class="token operator">=</span>kubernetes   <span class="token parameter variable">--user</span><span class="token operator">=</span>admin <span class="token comment">#å¯ä»¥æŒ‡å®šè·¯å¾„kubeconfig=/root/config.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>è¯´æ˜ï¼šä¸Šä¸‹æ–‡å‚æ•°å°†<strong>é›†ç¾¤å‚æ•°</strong>å’Œ<strong>ç”¨æˆ·å‚æ•°</strong>å…³è”èµ·æ¥ã€‚å¦‚ä¸Šé¢çš„ä¸Šä¸‹æ–‡åç§°ä¸ºkubenetesï¼Œé›†ç¾¤ä¸ºkubenetesï¼Œç”¨æˆ·ä¸ºadminï¼Œè¡¨ç¤ºä½¿ç”¨adminçš„ç”¨æˆ·å‡­è¯æ¥è®¿é—®kubenetesé›†ç¾¤çš„defaultå‘½åç©ºé—´ï¼Œä¹Ÿå¯ä»¥å¢åŠ --namspaceæ¥æŒ‡å®šè®¿é—®çš„å‘½åç©ºé—´ã€‚</p>
</blockquote>
<p><strong>è®¾ç½®é»˜è®¤ä¸Šä¸‹æ–‡</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>kubectl config use-context kubernetes  <span class="token comment">#å¯ä»¥æŒ‡å®šè·¯å¾„kubeconfig=/root/config.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote>
<p>è¯´æ˜ï¼šæœ€åä½¿ç”¨kubectl config use-context kubernetesæ¥ä½¿ç”¨åä¸ºkubenetesçš„ç¯å¢ƒé¡¹æ¥ä½œä¸ºé…ç½®ã€‚å¦‚æœé…ç½®äº†å¤šä¸ªç¯å¢ƒé¡¹ï¼Œå¯é€šè¿‡åˆ‡æ¢ä¸åŒçš„ç¯å¢ƒé¡¹åå­—æ¥è®¿é—®åˆ°ä¸åŒçš„é›†ç¾¤ç¯å¢ƒã€‚</p>
</blockquote>
<p>é»˜è®¤ç”Ÿæˆçš„ <code v-pre>kubeconfig</code> è¢«ä¿å­˜åˆ° <code v-pre>~/.kube/config</code> æ–‡ä»¶</p>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '22.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '24.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


