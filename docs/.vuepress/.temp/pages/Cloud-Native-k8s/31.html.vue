<template><div><ul>
<li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<ExternalLinkIcon/></a></li>
</ul>
<h1 id="ç¬¬31èŠ‚-kubernetes-çš„ç¼–è¯‘å’Œè°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#ç¬¬31èŠ‚-kubernetes-çš„ç¼–è¯‘å’Œè°ƒè¯•" aria-hidden="true">#</a> ç¬¬31èŠ‚ kubernetes çš„ç¼–è¯‘å’Œè°ƒè¯•</h1>
<div><a href = '30.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '32.md' style='float: right'>  â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div>
<br>
<blockquote>
<p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<ExternalLinkIcon/></a></p>
</blockquote>
<hr>
<p>[TOC]</p>
<h2 id="ç¼–è¯‘å¯åŠ¨æœ¬åœ°å•èŠ‚ç‚¹é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘å¯åŠ¨æœ¬åœ°å•èŠ‚ç‚¹é›†ç¾¤" aria-hidden="true">#</a> ç¼–è¯‘å¯åŠ¨æœ¬åœ°å•èŠ‚ç‚¹é›†ç¾¤ï¼š</h2>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/src/k8s.io/kubernetes
<span class="token comment"># ç¼–è¯‘å•ä¸ªç»„å»ºï¼šsudo make WHAT="cmd/kube-apiserver"  </span>
<span class="token comment"># ç¼–è¯‘æ‰€æœ‰ç»„ä»¶ï¼šsudo make all  </span>
<span class="token comment"># å¯åŠ¨æœ¬åœ°å•èŠ‚ç‚¹é›†ç¾¤ï¼š sudo ./hack/local-up-cluster.sh  </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container warning"><p class="custom-container-title">local-up-cluster è„šæœ¬</p>
<p><code v-pre>./hack/local-up-cluster.sh  </code> è„šæœ¬æ˜¯ kubernetes ç¤¾åŒºæ„å»ºçš„æ–¹ä¾¿å¼€å‘è€…çš„è„šæœ¬ã€‚</p>
<p>å®ƒçš„ä½œç”¨æ˜¯ç¼–è¯‘å‡ºæ‰€æœ‰éœ€è¦ç¼–è¯‘çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åœ¨å½“å‰çš„æœºå™¨ä¸Šè·‘ä¸€ä¸ªå•èŠ‚ç‚¹çš„é›†ç¾¤ã€‚</p>
<ul>
<li>
<p>ç¼–è¯‘å•ä¸ªç»„å»ºï¼š<code v-pre>sudo make WHAT=&quot;cmd/kube-apiserver&quot;</code></p>
</li>
<li>
<p>ç¼–è¯‘æ‰€æœ‰ç»„ä»¶ï¼š<code v-pre>sudo make all</code></p>
</li>
<li>
<p>å¯åŠ¨æœ¬åœ°å•èŠ‚ç‚¹é›†ç¾¤ï¼š <code v-pre>sudo ./hack/local-up-cluster.sh</code></p>
</li>
</ul>
</div>
<h2 id="ç¬¬ä¸€æ¬¡å¯åŠ¨å•èŠ‚ç‚¹é›†ç¾¤åˆ†æ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ¬¡å¯åŠ¨å•èŠ‚ç‚¹é›†ç¾¤åˆ†æ" aria-hidden="true">#</a> ç¬¬ä¸€æ¬¡å¯åŠ¨å•èŠ‚ç‚¹é›†ç¾¤åˆ†æ</h2>
<p>è®°å½•ç¬¬ä¸€æ¬¡å¯åŠ¨ä½†é›†ç¾¤çš„çŠ¶æ€åˆ†æï¼š</p>
<p>timeï¼šå¤§æ¦‚ç­‰äº† 20 - 30 åˆ†é’Ÿï¼ˆå¯ä»¥å…ˆå–ä¸¤æ¯å’–å•¡â˜•ï¼‰</p>
<h3 id="å®‰è£…ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ç»†èŠ‚" aria-hidden="true">#</a> å®‰è£…ç»†èŠ‚</h3>
<p><strong>å¼€å§‹æ—¶é—´ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes# date
Thu 01 Dec 2022 06:45:33 AM UTC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>details å±•å¼€ğŸ”½</summary>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes<span class="token comment"># sudo ./hack/local-up-cluster.sh</span>
make: Entering directory <span class="token string">'/root/go/src/k8s.io/kubernetes'</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/root/go/src/k8s.io/kubernetes'</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:45:46<span class="token punctuation">]</span> Building go targets <span class="token keyword">for</span> linux/amd64
    k8s.io/kubernetes/hack/make-rules/helpers/go2make <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:45:50<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> KUBE
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:29<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> AGGREGATOR
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:31<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> APIEXTENSIONS
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:34<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> CODEGEN
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:36<span class="token punctuation">]</span> Generating openapi code <span class="token keyword">for</span> SAMPLEAPISERVER
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/root/go/src/k8s.io/kubernetes'</span>
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:46:39<span class="token punctuation">]</span> Building go targets <span class="token keyword">for</span> linux/amd64
    k8s.io/kubernetes/cmd/kubectl <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-apiserver <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-controller-manager <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/cloud-controller-manager <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kubelet <span class="token punctuation">(</span>non-static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-proxy <span class="token punctuation">(</span>static<span class="token punctuation">)</span>
    k8s.io/kubernetes/cmd/kube-scheduler <span class="token punctuation">(</span>static<span class="token punctuation">)</span>

make: Leaving directory <span class="token string">'/root/go/src/k8s.io/kubernetes'</span>
API SERVER secure port is free, proceeding<span class="token punctuation">..</span>.
Detected <span class="token function">host</span> and ready to start services.  Doing some housekeeping first<span class="token punctuation">..</span>.
Using GO_OUT /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64
Starting services now<span class="token operator">!</span>
Starting etcd
etcd --advertise-client-urls http://127.0.0.1:2379 --data-dir /tmp/tmp.ZA6EXyPPss --listen-client-urls http://127.0.0.1:2379 --log-level<span class="token operator">=</span>warn <span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token string">"/tmp/etcd.log"</span> <span class="token operator">></span>/dev/null
Waiting <span class="token keyword">for</span> etcd to come up.
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:58:54<span class="token punctuation">]</span> On try <span class="token number">2</span>, etcd: <span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"health"</span><span class="token builtin class-name">:</span><span class="token string">"true"</span>,<span class="token string">"reason"</span><span class="token builtin class-name">:</span><span class="token string">""</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">"header"</span>:<span class="token punctuation">{</span><span class="token string">"cluster_id"</span><span class="token builtin class-name">:</span><span class="token string">"14841639068965178418"</span>,<span class="token string">"member_id"</span><span class="token builtin class-name">:</span><span class="token string">"10276657743932975437"</span>,<span class="token string">"revision"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span>,<span class="token string">"raft_term"</span><span class="token builtin class-name">:</span><span class="token string">"2"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
writing new private key to <span class="token string">'/var/run/kubernetes/server-ca.key'</span>
-----
Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
writing new private key to <span class="token string">'/var/run/kubernetes/client-ca.key'</span>
-----
Generating a RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>+++++
writing new private key to <span class="token string">'/var/run/kubernetes/request-header-ca.key'</span>
-----
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">189366430448716360665414597641985438063348873322</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">190125437621142035036292880957413679793726301630</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">606668605759100598551725540945577297218224811054</span>
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:54 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">635150309675323248743719255558829775631435343029</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">502583423540832867136826540974772275871393658467</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">712098371673773073639809258966059598612266254784</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">254427577071095149538770795047596258056763227355</span>
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:58:55 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">583900352045971716923710917507647330423197506650</span>
Waiting <span class="token keyword">for</span> apiserver to come up
+++ <span class="token punctuation">[</span><span class="token number">1201</span> 06:59:03<span class="token punctuation">]</span> On try <span class="token number">6</span>, apiserver: <span class="token builtin class-name">:</span> ok
clusterrolebinding.rbac.authorization.k8s.io/kube-apiserver-kubelet-admin created
clusterrolebinding.rbac.authorization.k8s.io/kubelet-csr created
Cluster <span class="token string">"local-up-cluster"</span> set.
use <span class="token string">'kubectl --kubeconfig=/var/run/kubernetes/admin-kube-aggregator.kubeconfig'</span> to use the aggregated API server
serviceaccount/coredns created
clusterrole.rbac.authorization.k8s.io/system:coredns created
clusterrolebinding.rbac.authorization.k8s.io/system:coredns created
configmap/coredns created
deployment.apps/coredns created
service/kube-dns created
coredns addon successfully deployed.
Checking CNI Installation at /opt/cni/bin
WARNING <span class="token builtin class-name">:</span> The kubelet is configured to not fail even <span class="token keyword">if</span> swap is enabled<span class="token punctuation">;</span> production deployments should disable swap unless testing NodeSwap feature.
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:59:07 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">396503892652732852810951929324414744717912185576</span>
kubelet <span class="token punctuation">(</span> <span class="token number">27489</span> <span class="token punctuation">)</span> is running.
<span class="token function">wait</span> kubelet ready
No resources found
No resources found
No resources found
No resources found
No resources found
No resources found
<span class="token number">127.0</span>.0.1   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   1s    v1.24.0-dirty
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generate received request
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> received CSR
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> generating key: rsa-2048
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> encoded CSR
<span class="token number">2022</span>/12/01 06:59:22 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> signed certificate with serial number <span class="token number">270579443091576203614576860806582064911709216666</span>
Create default storage class <span class="token keyword">for</span> 
storageclass.storage.k8s.io/standard created
Local Kubernetes cluster is running. Press Ctrl-C to shut it down.

Logs:
  /tmp/kube-apiserver.log
  /tmp/kube-controller-manager.log
  
  /tmp/kube-proxy.log
  /tmp/kube-scheduler.log
  /tmp/kubelet.log

To start using your cluster, you can <span class="token function">open</span> up another terminal/tab and run:

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/var/run/kubernetes/admin.kubeconfig
  cluster/kubectl.sh

Alternatively, you can <span class="token function">write</span> to the default kubeconfig:

  <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBERNETES_PROVIDER</span><span class="token operator">=</span>local

  cluster/kubectl.sh config set-cluster <span class="token builtin class-name">local</span> <span class="token parameter variable">--server</span><span class="token operator">=</span>https://localhost:6443 --certificate-authority<span class="token operator">=</span>/var/run/kubernetes/server-ca.crt
  cluster/kubectl.sh config set-credentials myself --client-key<span class="token operator">=</span>/var/run/kubernetes/client-admin.key --client-certificate<span class="token operator">=</span>/var/run/kubernetes/client-admin.crt
  cluster/kubectl.sh config set-context <span class="token builtin class-name">local</span> <span class="token parameter variable">--cluster</span><span class="token operator">=</span>local <span class="token parameter variable">--user</span><span class="token operator">=</span>myself
  cluster/kubectl.sh config use-context <span class="token builtin class-name">local</span>
  cluster/kubectl.sh

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details>
<p><strong>ç»“æŸæ—¶é—´ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes# date
Thu 01 Dec 2022 07:04:00 AM UTC
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åœæ­¢" tabindex="-1"><a class="header-anchor" href="#åœæ­¢" aria-hidden="true">#</a> åœæ­¢</h3>
<p><strong>stopï¼š<code v-pre>ctrl + c</code></strong></p>
<h3 id="æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—" aria-hidden="true">#</a> æ—¥å¿—</h3>
<p><strong>Logsï¼š</strong></p>
<ul>
<li><code v-pre>/tmp/kube-apiserver.log</code></li>
<li><code v-pre>/tmp/kube-controller-manager.log</code></li>
<li><code v-pre>/tmp/kube-proxy.log</code></li>
<li><code v-pre>/tmp/kube-scheduler.log</code></li>
<li><code v-pre>/tmp/kubelet.log</code></li>
</ul>
<h3 id="test-ç¼–å†™-pod-yaml" tabindex="-1"><a class="header-anchor" href="#test-ç¼–å†™-pod-yaml" aria-hidden="true">#</a> testï¼šç¼–å†™ pod.yaml</h3>
<p><strong>åˆ›å»ºæ–‡ä»¶å¹¶ç¼–å†™å†…å®¹ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>mkdir ~/go-yaml; cd ~/go-yaml
vim pod.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¾“å…¥ä»¥ä¸‹ï¼š</strong></p>
<div class="language-yaml ext-yml line-numbers-mode"><pre v-pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
  <span class="token key atrule">namespaces</span><span class="token punctuation">:</span> default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span> 
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
    <span class="token key atrule">command</span><span class="token punctuation">:</span> 
  	  <span class="token punctuation">-</span> sleep
  	  <span class="token punctuation">-</span> <span class="token string">"3600"</span>
  	<span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åˆ›å»ºå®ƒï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>cluster/kubectl.sh create -f ~/go-yaml/pod.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>è·å–ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>cluster/kubectl.sh get pod
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>ç»†èŠ‚ï¼š</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>cluster/kubectl.sh describe pod busybox
cluster/kubectl.sh describe node
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å†æ¬¡è¿è¡Œè„šæœ¬" tabindex="-1"><a class="header-anchor" href="#å†æ¬¡è¿è¡Œè„šæœ¬" aria-hidden="true">#</a> å†æ¬¡è¿è¡Œè„šæœ¬</h3>
<div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p>
<p>æˆ‘ä»¬ä¸€èˆ¬å†æ¬¡è¿è¡Œçš„æ—¶å€™ï¼Œç¼–è¯‘æˆ <code v-pre>exe</code> çš„åŠ¨ä½œä¹Ÿæ˜¯è¢«ç¼“å­˜äº†ï¼Œä¸ä¼šå†ç”Ÿæˆï¼Œæ‰€ä»¥ä¿®æ”¹å debug åˆ é™¤ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">make</span> clean
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div>
<h2 id="å¼€å¯æœ¬åœ°debugåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#å¼€å¯æœ¬åœ°debugåŠŸèƒ½" aria-hidden="true">#</a> å¼€å¯æœ¬åœ°debugåŠŸèƒ½</h2>
<div class="custom-container tip"><p class="custom-container-title">éœ€è¦å¼€å¯ debug</p>
<p>ä¸€èˆ¬ç¼–è¯‘å•ä¸ªç»„å»ºï¼Œæˆ–è€…æ˜¯ç¼–è¯‘æ‰€æœ‰çš„ç»„ä»¶ï¼Œéƒ½éœ€è¦å¼€å¯ debug è°ƒè¯•ã€‚</p>
<p>æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½æŠŠ debug èƒ½åŠ› build è¿‡å»ã€‚</p>
</div>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code><span class="token builtin class-name">cd</span> <span class="token variable">$GOPATH</span>/src/k8s.io/kubernetes
<span class="token comment"># kubernetes goç¼–è¯‘æ–‡ä»¶</span>
<span class="token function">sudo</span> <span class="token function">vim</span> ./hack/lib/golang.sh
<span class="token comment"># æŸ¥æ‰¾build_binaries()å‡½æ•° viè¯­æ³•</span>
?build_binaries<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰¾åˆ°ä¸€ä¸‹bebugåˆ¤æ–­-æ³¨é‡Š-ä¸€ç›´å¼€å¯debugèƒ½åŠ›" tabindex="-1"><a class="header-anchor" href="#æ‰¾åˆ°ä¸€ä¸‹bebugåˆ¤æ–­-æ³¨é‡Š-ä¸€ç›´å¼€å¯debugèƒ½åŠ›" aria-hidden="true">#</a> æ‰¾åˆ°ä¸€ä¸‹bebugåˆ¤æ–­ï¼Œæ³¨é‡Šï¼Œä¸€ç›´å¼€å¯debugèƒ½åŠ›</h3>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">"all=-trimpath=<span class="token variable">${trimroot}</span> <span class="token variable">${GOGCFLAGS<span class="token operator">:-</span>}</span>"</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${DBG<span class="token operator">:-</span>}</span>"</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Debugging - disable optimizations and inlining.</span>
        <span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${gogcflags}</span> -N -l"</span>
    <span class="token keyword">fi</span>

    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">"all=<span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span> <span class="token variable">${GOLDFLAGS<span class="token operator">:-</span>}</span>"</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">"<span class="token variable">${DBG<span class="token operator">:-</span>}</span>"</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token comment"># Not debugging - disable symbols and DWARF.</span>
        <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${goldflags}</span> -s -w"</span>
    <span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨é‡Šåˆ¤æ–­ï¼Œå°†debugç›´æ¥æ”¾åœ¨ä¸‹é¢ï¼Œ å†ä¿å­˜å³å¯ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">"all=-trimpath=<span class="token variable">${trimroot}</span> <span class="token variable">${GOGCFLAGS<span class="token operator">:-</span>}</span>"</span>
    <span class="token comment"># if [[ "${DBG:-}" == 1 ]]; then</span>
    <span class="token comment">#     # Debugging - disable optimizations and inlining.</span>
    <span class="token comment">#     gogcflags="${gogcflags} -N -l"</span>
    <span class="token comment"># fi</span>
	<span class="token assign-left variable">gogcflags</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${gogcflags}</span> -N -l"</span>
    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">"all=<span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span> <span class="token variable">${GOLDFLAGS<span class="token operator">:-</span>}</span>"</span>
    <span class="token comment"># if [[ "${DBG:-}" != 1 ]]; then</span>
    <span class="token comment">#     # Not debugging - disable symbols and DWARF.</span>
    <span class="token comment">#     goldflags="${goldflags} -s -w"</span>
    <span class="token comment"># fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è§‚å¯Ÿæ­¤æ—¶çš„è¿›ç¨‹ï¼š</strong></p>
<p><img src="http://sm.nsddd.top/smimage-20221201140939729.png" alt="image-20221201140939729"></p>
<h2 id="delve-è°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#delve-è°ƒè¯•" aria-hidden="true">#</a> delve è°ƒè¯•</h2>
<p><strong>æˆ–è®¸ä½ å¯ä»¥é€‰æ‹© GDBï¼Œæˆ–è®¸ä¹Ÿæœ‰ä¸€ä¸ªæ›´é€‚åˆçš„æ–¹å¼ï¼šgo-delve:</strong></p>
<div class="custom-container tip"><p class="custom-container-title">æç¤º</p>
<ul>
<li><a href="https://docker.nsddd.top/Cloud-Native/14.html" target="_blank" rel="noopener noreferrer">delve<ExternalLinkIcon/></a></li>
</ul>
</div>
<h3 id="ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ€§" aria-hidden="true">#</a> ç‰¹æ€§</h3>
<ul>
<li>æœ¬åœ°è°ƒè¯• å’Œ è¿œç¨‹è°ƒè¯•</li>
<li>ç®€å•æ˜“ç”¨ï¼Œå¼€æº</li>
</ul>
<h2 id="å¯åŠ¨æœ¬åœ°é›†ç¾¤ä»è€Œ-debug-ä»¥-api-server-ä¸ºä¾‹" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æœ¬åœ°é›†ç¾¤ä»è€Œ-debug-ä»¥-api-server-ä¸ºä¾‹" aria-hidden="true">#</a> å¯åŠ¨æœ¬åœ°é›†ç¾¤ä»è€Œ Debug - ä»¥ API Server ä¸ºä¾‹</h2>
<div class="custom-container tip"><p class="custom-container-title">æç¤º</p>
<p>æ­£å¥½ä¹‹å‰çš„ API server è¯ä¹¦å‡ºç°äº†é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜çš„åœ°å€ ISSUEï¼š</p>
<ul>
<li><a href="https://github.com/kubernetes/kubernetes/issues/114222" target="_blank" rel="noopener noreferrer">ã€An error occurred attempting to install kubernetes learningã€‘ #114222<ExternalLinkIcon/></a></li>
</ul>
</div>
<h3 id="ç¼–è¯‘å‚æ•°" tabindex="-1"><a class="header-anchor" href="#ç¼–è¯‘å‚æ•°" aria-hidden="true">#</a> ç¼–è¯‘å‚æ•°</h3>
<ul>
<li>
<p>ä¿®æ”¹ <code v-pre>hack/lib/golang.sh</code> æ–‡ä»¶ï¼Œä»è€Œä½¿å¾—ç¼–è¯‘å™¨ä¸å»ä¼˜åŒ–æ‰æ”¯æŒçš„ debug ä¿¡æ¯</p>
</li>
<li>
<p>ç¦æ­¢ <code v-pre>-w</code> ã€<code v-pre>-s</code> ä¿ç•™æ–‡ä»¶åï¼Œè¡Œå·</p>
</li>
<li>
<p>åŠ ä¸Š <code v-pre>-gcflags= &quot;all=-N -l&quot;</code> ï¼Œç¦æ­¢ä¼˜åŒ–å’Œå†…è”ã€‚</p>
</li>
</ul>
<p>åœ¨<code v-pre>k8s.io/kubernetes/hack/lib/golang.sh</code>ä¸­è®¾ç½®äº†<code v-pre>-s -w</code>é€‰é¡¹æ¥ç¦ç”¨ç¬¦å·è¡¨ä»¥åŠdebugä¿¡æ¯ï¼Œå› æ­¤åœ¨ç¼–è¯‘ <code v-pre>Kubernetes</code> ç»„ä»¶è¿›è¡Œè¿œç¨‹è°ƒè¯•æ—¶éœ€è¦å»æ‰è¿™ä¸¤ä¸ªé™åˆ¶ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>-    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${GOLDFLAGS=-s -w}</span> <span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span>"</span>
+    <span class="token comment">#goldflags="${GOLDFLAGS=-s -w} $(kube::version::ldflags)"</span>
+    <span class="token assign-left variable">goldflags</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${GOLDFLAGS<span class="token operator">:-</span>}</span> <span class="token variable"><span class="token variable">$(</span>kube::version::ldflags<span class="token variable">)</span></span>"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯åŠ¨æœ¬åœ°é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨æœ¬åœ°é›†ç¾¤" aria-hidden="true">#</a> å¯åŠ¨æœ¬åœ°é›†ç¾¤</h3>
<p>å¦‚æœéœ€è¦ï¼Œç”¨ <code v-pre>make clean</code> æ¸…é™¤æœªç¼–è¯‘çš„å¯æ‰§è¡Œç¨‹åºã€‚é€šè¿‡ <code v-pre>hack/local-up-cluster.sh</code> è„šæœ¬å¯åŠ¨æœ¬åœ°é›†ç¾¤ã€‚</p>
<h3 id="é‡å¯-api-server" tabindex="-1"><a class="header-anchor" href="#é‡å¯-api-server" aria-hidden="true">#</a> é‡å¯ API Server</h3>
<p><strong>å¦‚æœè¦è°ƒè¯• API Server ï¼Œå…ˆå…³é—­å…¶è¿›ç¨‹ï¼Œå†ä»¥ dlv å¯åŠ¨ã€‚</strong></p>
<p>âš ï¸ ä¸ºä»€ä¹ˆè¦é‡å¯ï¼Œå› ä¸º go çš„ debug ä¾é  dlvï¼Œæ‰€ä»¥éœ€è¦ç”¨ dlv åŒ…è¢±å†å¯åŠ¨ä¸‹ã€‚</p>
<h3 id="è¿æ¥-debug-server" tabindex="-1"><a class="header-anchor" href="#è¿æ¥-debug-server" aria-hidden="true">#</a> è¿æ¥ Debug Server</h3>
<p>é€šè¿‡ delve è¿æ¥ debug server å¹¶ä¸”å¼€å§‹è°ƒè¯•ã€‚</p>
<h3 id="æ€æ­»-api-server-è°ƒè¯•" tabindex="-1"><a class="header-anchor" href="#æ€æ­»-api-server-è°ƒè¯•" aria-hidden="true">#</a> æ€æ­» Api Server è°ƒè¯•</h3>
<p><strong>æŸ¥çœ‹ Api Server çš„åº”ç”¨ç¨‹åºå’Œåé¢çš„å‚æ•°ï¼Œè¿™ä¸ªå¾ˆé‡è¦ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>root@cubmaster01:~/go/src/k8s.io/kubernetes<span class="token comment">#  ps -ef | grep kube-apiserver</span>
root       <span class="token number">27052</span>    <span class="token number">8091</span> <span class="token number">10</span> 06:58 pts/0    00:00:43 /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64/kube-apiserver --authorization-mode<span class="token operator">=</span>Node,RBAC  --cloud-provider<span class="token operator">=</span> --cloud-config<span class="token operator">=</span>   <span class="token parameter variable">--v</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--vmodule</span><span class="token operator">=</span> --audit-policy-file<span class="token operator">=</span>/tmp/kube-audit-policy-file --audit-log-path<span class="token operator">=</span>/tmp/kube-apiserver-audit.log --authorization-webhook-config-file<span class="token operator">=</span> --authentication-token-webhook-config-file<span class="token operator">=</span> --cert-dir<span class="token operator">=</span>/var/run/kubernetes --egress-selector-config-file<span class="token operator">=</span>/tmp/kube_egress_selector_configuration.yaml --client-ca-file<span class="token operator">=</span>/var/run/kubernetes/client-ca.crt --kubelet-client-certificate<span class="token operator">=</span>/var/run/kubernetes/client-kube-apiserver.crt --kubelet-client-key<span class="token operator">=</span>/var/run/kubernetes/client-kube-apiserver.key --service-account-key-file<span class="token operator">=</span>/tmp/kube-serviceaccount.key --service-account-lookup<span class="token operator">=</span>true --service-account-issuer<span class="token operator">=</span>https://kubernetes.default.svc --service-account-jwks-uri<span class="token operator">=</span>https://kubernetes.default.svc/openid/v1/jwks --service-account-signing-key-file<span class="token operator">=</span>/tmp/kube-serviceaccount.key --enable-admission-plugins<span class="token operator">=</span>NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,Priority,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction --disable-admission-plugins<span class="token operator">=</span> --admission-control-config-file<span class="token operator">=</span> --bind-address<span class="token operator">=</span><span class="token number">0.0</span>.0.0 --secure-port<span class="token operator">=</span><span class="token number">6443</span> --tls-cert-file<span class="token operator">=</span>/var/run/kubernetes/serving-kube-apiserver.crt --tls-private-key-file<span class="token operator">=</span>/var/run/kubernetes/serving-kube-apiserver.key --storage-backend<span class="token operator">=</span>etcd3 --storage-media-type<span class="token operator">=</span>application/vnd.kubernetes.protobuf --etcd-servers<span class="token operator">=</span>http://127.0.0.1:2379 --service-cluster-ip-range<span class="token operator">=</span><span class="token number">10.0</span>.0.0/24 --feature-gates<span class="token operator">=</span>AllAlpha<span class="token operator">=</span>false --external-hostname<span class="token operator">=</span>localhost --requestheader-username-headers<span class="token operator">=</span>X-Remote-User --requestheader-group-headers<span class="token operator">=</span>X-Remote-Group --requestheader-extra-headers-prefix<span class="token operator">=</span>X-Remote-Extra- --requestheader-client-ca-file<span class="token operator">=</span>/var/run/kubernetes/request-header-ca.crt --requestheader-allowed-names<span class="token operator">=</span>system:auth-proxy --proxy-client-cert-file<span class="token operator">=</span>/var/run/kubernetes/client-auth-proxy.crt --proxy-client-key-file<span class="token operator">=</span>/var/run/kubernetes/client-auth-proxy.key --cors-allowed-origins<span class="token operator">=</span>/127.0.0.1<span class="token punctuation">(</span>:<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">)</span>?$,/localhost<span class="token punctuation">(</span>:<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>+<span class="token punctuation">)</span>?$
root       <span class="token number">33017</span>    <span class="token number">9251</span>  <span class="token number">0</span> 07:05 pts/1    00:00:00 <span class="token function">grep</span> <span class="token parameter variable">--color</span><span class="token operator">=</span>auto kube-apiserver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€æ­»</strong></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>kill -9 {api-server PID}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å¯åŠ¨ï¼š</strong></p>
<p>åˆ›å»ºæ—¥å¿—ä¿¡æ¯ä¿å­˜ç›®å½•ï¼š<code v-pre>mkdir -p /root/kubelog/delve-log </code></p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>sudo dlv  --headless exec /root/go/src/k8s.io/kubernetes/_output/local/bin/linux/amd64/kube-apiserver --listen=127.0.0.1:2345 --api-version=2 --log --log-output=debugger,gdbwire,lidbout,debuglineerr,rpc,dap,fncall,minidump --log-dest=/root/kubelog/delve-log/log -- --authorization-mode=Node,RBAC  --cloud-provider= --cloud-config=   --v=3 --vmodule= --audit-policy-file=/tmp/kube-audit-policy-file --audit-log-path=/tmp/kube-apiserver-audit.log --authorization-webhook-config-file= --authentication-token-webhook-config-file= --cert-dir=/var/run/kubernetes --egress-selector-config-file=/tmp/kube_egress_selector_configuration.yaml --client-ca-file=/var/run/kubernetes/client-ca.crt --kubelet-client-certificate=/var/run/kubernetes/client-kube-apiserver.crt --kubelet-client-key=/var/run/kubernetes/client-kube-apiserver.key --service-account-key-file=/tmp/kube-serviceaccount.key --service-account-lookup=true --service-account-issuer=https://kubernetes.default.svc --service-account-jwks-uri=https://kubernetes.default.svc/openid/v1/jwks --service-account-signing-key-file=/tmp/kube-serviceaccount.key --enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,DefaultStorageClass,DefaultTolerationSeconds,Priority,MutatingAdmissionWebhook,ValidatingAdmissionWebhook,ResourceQuota,NodeRestriction --disable-admission-plugins= --admission-control-config-file= --bind-address=0.0.0.0 --secure-port=6443 --tls-cert-file=/var/run/kubernetes/serving-kube-apiserver.crt --tls-private-key-file=/var/run/kubernetes/serving-kube-apiserver.key --storage-backend=etcd3 --storage-media-type=application/vnd.kubernetes.protobuf --etcd-servers=http://127.0.0.1:2379 --service-cluster-ip-range=10.0.0.0/24 --feature-gates=AllAlpha=false --external-hostname=localhost --requestheader-username-headers=X-Remote-User --requestheader-group-headers=X-Remote-Group --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-client-ca-file=/var/run/kubernetes/request-header-ca.crt --requestheader-allowed-names=system:auth-proxy --proxy-client-cert-file=/var/run/kubernetes/client-auth-proxy.crt --proxy-client-key-file=/var/run/kubernetes/client-auth-proxy.key --cors-allowed-origins="/127.0.0.1(:[0-9]+)?$,/localhost(:[0-9]+)?$"
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>å¦ä¸€å°æœºå™¨è¿æ¥ï¼š</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>dlv connect localhost:2345
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="vscode-è¿œç¨‹è°ƒè¯•æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#vscode-è¿œç¨‹è°ƒè¯•æ–¹æ¡ˆ" aria-hidden="true">#</a> vscode è¿œç¨‹è°ƒè¯•æ–¹æ¡ˆ</h2>
<div class="language-json ext-json line-numbers-mode"><pre v-pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ </span>
    <span class="token comment">// æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚</span>
    <span class="token comment">// æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Connect to server"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"go"</span><span class="token punctuation">,</span>
            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"attach"</span><span class="token punctuation">,</span>
            <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"remote"</span><span class="token punctuation">,</span>
            <span class="token comment">// "remotePath": "${workspaceFolder}",</span>
            <span class="token property">"port"</span><span class="token operator">:</span> <span class="token number">2345</span><span class="token punctuation">,</span>
            <span class="token property">"host"</span><span class="token operator">:</span> <span class="token string">"192.168.71.130"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>åœ¨è¿œç¨‹å¯åŠ¨ API Serverï¼š</strong></p>
<blockquote>
<p>å’Œä¸Šé¢çš„å¯åŠ¨ä¸€æ ·ï¼š</p>
</blockquote>
<h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2>
<ul><li><div><a href = '30.md' style='float:left'>â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”—  </a><a href = '32.md' style='float: right'>  ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul>
<ul>
<li>
<p><RouterLink to="/">â“‚ï¸å›åˆ°ç›®å½•ğŸ </RouterLink></p>
</li>
<li>
<p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><ExternalLinkIcon/></a>)</p>
</li>
<li>
<p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<ExternalLinkIcon/></a></p>
</li>
</ul>
</div></template>


