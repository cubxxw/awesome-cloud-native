# OpenIM çš„ API æ¥å£è®¾è®¡

## é—®é¢˜

æˆ‘ä»¬ç›®å‰ä½¿ç”¨ç±»ä¼¼ http restful çš„æ–¹å¼è¿›è¡Œå¯¹å¤–å¯¹å†…æä¾›æœåŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ API ç®¡ç†å…¶å®æ˜¯æ¯”è¾ƒæ··ä¹±çš„ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µ:

1. æš´éœ²ç»™ web çš„ apiï¼šæœ‰ä½¿ç”¨ swagger çš„ï¼Œæœ‰åœ¨æ–‡æ¡£å¹³å°ä¸Šå†™æ–‡æ¡£çš„ï¼Œè¿˜æœ‰æ²¡æœ‰å†™æ–‡æ¡£çš„
2. æš´éœ²ç»™å…¶ä»–æœåŠ¡è°ƒç”¨çš„ api: æœ‰æ³¨å†Œåˆ°å†…éƒ¨çš„æ¥å£ç½‘å…³çš„ï¼Œä½†æ˜¯å†…éƒ¨çš„æ¥å£ç½‘å…³ä¸Šæœ‰çš„æœ‰å‚æ•°ï¼Œæœ‰çš„æ²¡æœ‰ï¼Œæ²¡æœ‰è¿”å›å€¼å®šä¹‰

æ‰€ä»¥å°±å­˜åœ¨å¾ˆå¤šé—®é¢˜:

1. æƒ³è¦æ¥å£ä¸çŸ¥é“ä»å“ªå„¿æ‰¾ï¼Œåªèƒ½åˆ°å¤„é—®äºº
2. æœ‰æ—¶å€™ä»å†…éƒ¨ç½‘å…³å¹³å°ä¸Šæ‰¾åˆ°æ¥å£ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆè°ƒç”¨ï¼Œæ²¡æœ‰å†™ä»»ä½•å‚æ•°ï¼Œæœ‰çš„å†™äº†è¿˜æœ‰å¯èƒ½æ˜¯é”™çš„
3. æœ‰çš„å‹æ ¹æ²¡æœ‰æ¥å£æ–‡æ¡£ï¼Œå¯¹æ¥çš„åŒå­¦ä¹Ÿæ²¡æœ‰æ—¶é—´å†™ï¼Œç„¶åè®©ä½ ç›´æ¥çœ‹ä»£ç 
4. æœ‰çš„å¯¹æ¥åŒå­¦æ‰”ç»™ä½ ä¸€ä¸ªæ¥å£æ–‡æ¡£ï¼Œç„¶åè¯•äº†åŠå¤©å‘ç°ï¼Œæœ‰é—®é¢˜ï¼Œæ²Ÿé€šæ’æŸ¥ä¹‹åå‘ç°æ–‡æ¡£å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº† ï¼ï¼ï¼



## æ–¹æ³•

åˆ©ç”¨ protobuf æ¥å®šä¹‰æ¥å£çš„æ–¹å¼éå¸¸ä»¤äººå¿ƒåŠ¨ï¼Œå› ä¸º protobuf å½“ä¸­åŒ…å«äº†æ¥å£çš„å‡½æ•°ç­¾åï¼Œå…¥å‚å’Œè¿”å›å€¼åŒæ—¶è¿˜æ”¯æŒæ³¨é‡Šï¼Œå°±æ˜¯ä¸€ä»½å¤©ç„¶çš„æ–‡æ¡£ï¼ŒåŒæ—¶ä¹Ÿä¸ç”¨æ‹…å¿ƒå‡ºç°ä»£ç æ›´æ–°äº†ä½†æ˜¯æ–‡æ¡£æ²¡æœ‰æ›´æ–°çš„æƒ…å†µï¼Œå› ä¸ºå®ƒæ—¢æ˜¯æ–‡æ¡£ä¹Ÿæ˜¯ä»£ç ï¼ŒæœåŠ¡ç«¯ä¹Ÿéœ€è¦ä½¿ç”¨ï¼Œæ‰€ä»¥ä»£ç æ›´æ–°ä¹‹åæ–‡æ¡£ä¹Ÿä¸€å®šä¼šæ›´æ–°ã€‚è‡ªç„¶è€Œç„¶çš„å°±å°‘äº†å¾ˆå¤šæ²Ÿé€šçš„æˆæœ¬ã€‚

![api å®šä¹‰æ–¹å¼ (1).jpg](http://sm.nsddd.top/sm202311081708323.jpeg)

å¦‚ä¸Šå›¾æ‰€ç¤ºäºæ­¤åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ protobuf æ–‡ä»¶ç”Ÿæˆå¯¹åº”è¯­è¨€çš„å®¢æˆ·ç«¯ä»£ç ï¼Œå°±ä¸ç”¨æ¯ä¸ªé¡¹ç›®éƒ½å»ç»´æŠ¤ä¸€å¥— sdk äº†ï¼ŒåŒæ—¶æˆ‘ä»¬ä½¿ç”¨æ¥å£ç”Ÿæˆä»£ç ï¼Œåœ¨ go å½“ä¸­å¯ä»¥ä½¿ç”¨ gomock éå¸¸æ–¹ä¾¿çš„å¯¹ä»£ç è¿›è¡Œ mockã€‚

å‚è€ƒé¡¹ç›®ï¼š

+ [googleapis/googleapis](https://github.com/googleapis/googleapis)
+ [istio/api](https://github.com/istio/api) 



### API Project

ä½¿ç”¨ protobuf å®šä¹‰æ¥å£å¯ä»¥è§£å†³æˆ‘ä»¬æ‰¾åˆ° api æ–‡æ¡£ä¹‹åï¼Œæ–‡æ¡£ä¸å‡†ç¡®ï¼Œç¼ºå¤±çš„é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬åº”è¯¥å¦‚ä½•æ‰¾åˆ°æˆ‘ä»¬çš„ api å‘¢ï¼Ÿæˆ‘ä»¬ç”Ÿæˆå‡ºçš„ api æ–‡ä»¶è°ƒç”¨æ–¹åº”è¯¥å¦‚ä½•å¼•ç”¨å‘¢ï¼Ÿéš¾é“æˆ‘ä»¬ç»™æ¯ä¸ªè°ƒç”¨æ–¹éƒ½å»å¼€ä¸€ä¸ªé¡¹ç›®çš„æƒé™ä¹ˆï¼Ÿé‚£æ˜æ˜¾æ˜¯ä¸å¤ªè¡Œçš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹çœ‹æˆ‘ä»¬ api è¯¥å¦‚ä½•ç®¡ç†å’Œç»„ç»‡ã€‚

ç»Ÿä¸€å­˜æ”¾ api å®šä¹‰æ–‡æ¡£ï¼Œç„¶åé€šè¿‡ ci/cd ç”Ÿæˆå¯¹åº”çš„å®¢æˆ·ç«¯ä»£ç æ”¾åˆ°å„ä¸ªè¯­è¨€çš„å­ä»“åº“å½“ä¸­

![image-20231108171738096](http://sm.nsddd.top/sm202311081717157.png)

å·¥ä½œæµç¨‹å¦‚ä¸Šå›¾æ‰€ç¤º

+ å¼€å‘åŒå­¦ä¿®æ”¹äº† proto æ–‡ä»¶å®šä¹‰ä¹‹å push åˆ°å¯¹åº”çš„ä¸šåŠ¡åº”ç”¨ä»“åº“å½“ä¸­
+ ç„¶åè§¦å‘ cicd æµç¨‹å°† proto æ–‡ä»¶å¤åˆ¶åˆ° api project å½“ä¸­
  + é¦–å…ˆä¼šå¯¹ proto æ–‡ä»¶è¿›è¡Œé™æ€ä»£ç åˆ†æï¼ŒæŸ¥çœ‹æ˜¯å¦ç¬¦åˆè§„èŒƒ
  + ç„¶å clone api project åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯
  + ç„¶å push ä»£ç ï¼Œåˆ›å»ºä¸€ä¸ª merge request è¯·æ±‚
+ ç„¶åæˆ‘ä»¬å¯¹åº”è´Ÿè´£çš„åŒå­¦æ”¶åˆ° code review çš„é€šçŸ¥ä¹‹åè¿›è¡Œ code reviewï¼Œæ²¡æœ‰é—®é¢˜å°±ä¼šåˆå¹¶åˆ° api project çš„ä¸»åˆ†æ”¯å½“ä¸­äº†
+ ç„¶åå°±ä¼šè§¦å‘ cicd ç”Ÿæˆå¯¹åº”è¯­è¨€çš„å®¢æˆ·ç«¯ä»£ç ï¼Œpush åˆ°å¯¹åº”çš„å„ä¸ªå­ä»“åº“å½“ä¸­äº†



### API Project Layout

æˆ‘ä»¬çš„ api é¡¹ç›®æ˜¯å¦‚ä½•å®šä¹‰çš„å‘¢ï¼Ÿçœ‹ä¸‹å›¾
![Frame 1 (2).jpg](http://sm.nsddd.top/sm202311081726561.jpeg)

+ é¦–å…ˆæ˜¯åœ¨ä¸šåŠ¡é¡¹ç›®å½“ä¸­ï¼Œæˆ‘ä»¬é¡¶å±‚ä¼šæœ‰ä¸€ä¸ª api ç›®å½•
  + åœ¨ api ç›®å½•å½“ä¸­æˆ‘ä»¬ä¼šæŒ‰ç…§ product `name/app name/ç‰ˆæœ¬å·/app.proto` çš„æ–¹å¼è¿›è¡Œç»„ç»‡
  + å…·ä½“æ€ä¹ˆç»„ç»‡å¯èƒ½æ¯ä¸ªå…¬å¸éƒ½ä¸å¤ªä¸€æ ·ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´å°±æ˜¯åº”ç”¨çš„ å”¯ä¸€åç§°+ç‰ˆæœ¬å· æ¥è¿›è¡Œä¸€ä¸ªåŒºåˆ†
+ åœ¨ api project å½“ä¸­å’Œä¸šåŠ¡åº”ç”¨ç±»ä¼¼ï¼Œä¹Ÿæœ‰ä¸€ä¸ª api ç›®å½•ï¼Œé€šè¿‡ä¸Šå›¾çš„ä¸¤ä¸ªæ¡†å°±å¯ä»¥å‘ç°è¿™æ˜¯ä¸€æ¨¡ä¸€æ ·çš„
  + é™¤æ­¤ä¹‹å¤– `api project` è¿˜æœ‰ç”¨äºæ³¨è§£çš„ `annotations` æ–‡ä»¶å¤¹
  + æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹çš„å¼•ç”¨ï¼Œä¾‹å¦‚ `googleapis` å½“ä¸­çš„ä¸€äº› `proto` æ–‡ä»¶



## API å…¼å®¹æ€§å¼€å‘

éšç€åº”ç”¨çš„ä¸æ–­å¼€å‘ï¼Œä¸šåŠ¡çš„ä¸æ–­å‘å±•æˆ‘ä»¬çš„ api è‚¯å®šä¼šä¸æ–­çš„è¿›è¡Œä¿®æ”¹ï¼Œåœ¨ä¿®æ”¹ api çš„æ—¶å€™è€ƒè™‘ api çš„å…¼å®¹æ€§å°±ä¼šå¾ˆé‡è¦äº†ï¼Œå¦‚æœæˆ‘ä»¬åšäº†ä¸€äº›ç ´åæ€§çš„å˜æ›´å°±æœ‰å¯èƒ½ä¼šå¯¼è‡´ä¾èµ–æˆ‘ä»¬çš„æœåŠ¡æˆ–è€…æ˜¯å®¢æˆ·ç«¯æŠ¥é”™ï¼Œè¿™æ ·å°±ä¼šå¸¦æ¥äº‹æ•…ã€‚



#### å‘ä¸‹å…¼å®¹çš„å˜æ›´

+ æ–°å¢æ¥å£
+ æ–°å¢å‚æ•°å­—æ®µ
+ æ–°å¢è¿”å›å­—æ®µ
  + åœ¨ä¸æ”¹å˜å…¶ä»–å“åº”å­—æ®µçš„è¡Œä¸ºçš„å‰æä¸‹ï¼Œéèµ„æºï¼ˆä¾‹å¦‚ï¼ŒListBooksResponseï¼‰çš„å“åº”æ¶ˆæ¯å¯ä»¥æ‰©å±•è€Œä¸å¿…ç ´åå®¢æˆ·ç«¯çš„å…¼å®¹æ€§ã€‚å³ä½¿ä¼šå¼•å…¥å†—ä½™ï¼Œå…ˆå‰åœ¨å“åº”ä¸­å¡«å……çš„ä»»ä½•å­—æ®µåº”ç»§ç»­ä½¿ç”¨ç›¸åŒçš„è¯­ä¹‰å¡«å……ã€‚

ä¸€èˆ¬è€Œè¨€æ–°å¢éƒ½æ˜¯ç›¸å¯¹å®‰å…¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯æ–°å¢å­—æ®µä¸èƒ½æ”¹å˜æˆ‘ä»¬åŸæœ¬çš„é€»è¾‘ï¼Œå¦‚æœæ”¹å˜äº† api çš„é€»è¾‘ï¼Œé‚£å°±ä¸ä¸€å®šå®‰å…¨äº†



#### å‘ä¸‹ä¸å…¼å®¹çš„å˜æ›´ï¼ˆç ´åæ€§å˜æ›´ï¼‰

+ åˆ é™¤æˆ–é‡å‘½åæœåŠ¡ï¼Œå­—æ®µï¼Œæ–¹æ³•æˆ–æšä¸¾å€¼
  + åœ¨åšè¿™ç§ä¿®æ”¹çš„æ—¶å€™éœ€è¦ä¿®æ”¹æˆ‘ä»¬ api çš„ç‰ˆæœ¬å·ï¼Œå¸¸è§æœ‰ä¸¤ç§æ–¹å¼
  + å¦‚æœåªæœ‰å¾ˆå°‘çš„ api å˜åŠ¨å¯ä»¥åˆ›å»ºä¸€ä¸ª `XXXV2` çš„æ–¹æ³•
  + å¦‚æœå˜åŠ¨çš„ api æ¯”è¾ƒå¤šï¼Œå¯ä»¥ç›´æ¥æ–°å¯ä¸€ä¸ª `v2` çš„åŒ…
+ ä¿®æ”¹å­—æ®µçš„ç±»å‹
  + ä¸¥ç¦ä¿®æ”¹å­—æ®µçš„ç±»å‹ï¼Œä¿®æ”¹å­—æ®µçš„ç±»å‹å¯èƒ½ä¼šå¯¼è‡´å®¢æˆ·ç«¯å´©æºƒ
+ ä¿®æ”¹ç°æœ‰è¯·æ±‚çš„å¯è§è¡Œä¸º
+ ç»™èµ„æºæ¶ˆæ¯æ·»åŠ  è¯»å–/å†™å…¥ å­—æ®µ



### API å‘½åè§„èŒƒ

#### åŒ…å

| äº§å“å   | product                       |
| -------- | ----------------------------- |
| åº”ç”¨å   | app                           |
| ç‰ˆæœ¬å·   | v1                            |
| åŒ…å     | `product.app.v1`              |
| ç›®å½•ç»“æ„ | `api/product/app/v1/xx.proto` |

#### API å®šä¹‰

+ å‘½åè§„åˆ™ï¼šæ–¹æ³• + èµ„æº
+ æ ‡å‡†æ–¹æ³•ï¼šå‚è€ƒ Google API è®¾è®¡æŒ‡å—

| **æ ‡å‡†æ–¹æ³•** | **HTTP æ˜ å°„**  |
| ------------ | -------------- |
| List         | GET            |
| Get          | GET            |
| Update       | PUT æˆ–è€… PATCH |
| Create       | POST           |
| Delete       | DELETE         |

é™¤äº†æ ‡å‡†çš„ä¹Ÿæœ‰ä¸€äº›éæ ‡å‡†çš„ï¼Œä¾‹å¦‚åŒæ­¥æ•°æ®å¯èƒ½ä¼šç”¨ `Sync` ç­‰ï¼Œä¸è¿‡å¤§éƒ¨åˆ†çš„ api åº”è¯¥éƒ½æ˜¯æ ‡å‡†çš„



#### ç¤ºä¾‹

```go
// api/product/app/v1/blog.proto

syntax = "proto3";

package product.app.v1;

import "google/api/annotations.proto";

// blog service is a blog demo
service BlogService {

	rpc GetArticles(GetArticlesReq) returns (GetArticlesResp) {
		option (google.api.http) = {
			get: "/v1/articles"
			additional_bindings {
				get: "/v1/author/{author_id}/articles"
			}
		};
	}
}
```

æ³¨æ„ï¼Œä¸€èˆ¬è€Œè¨€æˆ‘ä»¬åº”è¯¥ä¸ºæ¯ä¸ªæ¥å£éƒ½åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ messageï¼Œä¸ºäº†åé¢æ‰©å±•ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ Empty çš„è¯åç»­å°±æ²¡æœ‰åŠæ³•æ–°å¢å­—æ®µäº†



### API Error

å…ˆè¯´æˆ‘ä»¬å½“å‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä¸€ç›´ç”¨çš„ http ç„¶åæˆ‘ä»¬è¿”å›æ˜¯ä½¿ç”¨çš„ä¸‹é¢è¿™ç§æ ¼å¼ï¼Œç„¶å http code ç»Ÿä¸€è¿”å› 200

```yaml
{
  "code": 1,
  "msg": "xxx",
  "data": {}
}
```

è¿™ç§åšæ³•å°±å­˜åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼Œåšç›‘æ§çš„æ—¶å€™ä¸å¤ªå¥½åšï¼Œå¾ˆå¤šç°æˆçš„ä¸œè¥¿æ²¡æœ‰åŠæ³•ç›´æ¥ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½è¿”å›çš„æˆåŠŸã€‚

å‚ç…§ google çš„é”™è¯¯å®šä¹‰ï¼Œå°† http code å’Œ grpc é”™è¯¯ç è¿›è¡Œæ˜ å°„ï¼Œè¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯

ä½†æ˜¯è¿™æ ·è¿˜æ˜¯ä¸è¡Œï¼Œå› ä¸ºè¿™æ ·å¾ˆå¤šä¸šåŠ¡é”™è¯¯ä¿¡æ¯æ— æ³•åŒºåˆ†ï¼Œæ¯›è€å¸ˆä»–ä»¬çš„ kratos v2 çš„åšæ³•æ˜¯åšäº†ä¸¤å±‚ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è¿›è¡Œå®šä¹‰

```go
message Status {
  // é”™è¯¯ç ï¼Œè·Ÿ grpc-status ä¸€è‡´ï¼Œå¹¶ä¸”åœ¨HTTPä¸­å¯æ˜ å°„æˆ http-status
  int32 code = 1;
  // é”™è¯¯åŸå› ï¼Œå®šä¹‰ä¸ºä¸šåŠ¡åˆ¤å®šé”™è¯¯ç 
  string reason = 2;
  // é”™è¯¯ä¿¡æ¯ï¼Œä¸ºç”¨æˆ·å¯è¯»çš„ä¿¡æ¯ï¼Œå¯ä½œä¸ºç”¨æˆ·æç¤ºå†…å®¹
  string message = 3;
  // é”™è¯¯è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥é™„åŠ è‡ªå®šä¹‰çš„ä¿¡æ¯åˆ—è¡¨
  repeated google.protobuf.Any details = 4;
}
```

å’Œæˆ‘ä»¬å½“å‰çš„æ–¹å¼å·®ä¸å¤ªå¤šï¼Œä½†æ˜¯æˆ‘ä»¬æ˜¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šè¿”å›äº† http codeï¼Œå‰©ä¸‹çš„å­—æ®µè¿˜æ˜¯å’ŒåŸæ¥ä¿æŒä¸€è‡´



## Gin è·¯ç”±æ³¨å†Œ

ğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š

```go
package main

import "github.com/gin-gonic/gin"

func handler(ctx *gin.Context) {
	// get params
	params := struct {
		Msg string `json:"msg"`
	}{}
	ctx.BindQuery(&params)

	// ä¸šåŠ¡é€»è¾‘

	// è¿”å›æ•°æ®
	ctx.JSON(200, gin.H{
		"message": params.Msg,
	})
}

func main() {
	r := gin.Default()
	r.GET("/ping", handler)
	r.Run() // ç›‘å¬å¹¶åœ¨ 0.0.0.0:8080 ä¸Šå¯åŠ¨æœåŠ¡
}
```

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå¯ä»¥å‘ç° gin æ³¨å†Œè·¯ç”±éœ€è¦ä¸€ä¸ª `func (ctx *gin.Context)` ç­¾åçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸€èˆ¬åšä¸‰ä»¶äº‹ï¼Œè·å–å‚æ•°ï¼Œè°ƒç”¨ä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨ gin çš„æ–¹æ³•è¿”å› http response



#### grpc server interface

å…ˆçœ‹ä¸€ä¸‹ proto æ–‡ä»¶ä¸­çš„ rpc å®šä¹‰ï¼Œä¸€èˆ¬å°±æ˜¯åŒ…å«ä¸€ä¸ªå‚æ•°å’Œä¸€ä¸ªè¿”å›å€¼çš„å‡½æ•°

```go
// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}
```

ç„¶åçœ‹ grpc ç”Ÿæˆçš„æ¥å£ï¼Œå…¶å®å’Œ proto æ–‡ä»¶ä¸€ä¸€å¯¹åº”ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ª context å’Œ error

```go
type GreeterServer interface {
	// Sends a greeting
	SayHello(context.Context, *HelloRequest) (*HelloReply, error)
	mustEmbedUnimplementedGreeterServer()
}
```

æ‰€ä»¥é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬è®© service å±‚å®ç°ç±»ä¼¼ `GreeterServer` æ¥å£å°±è¡Œäº†ï¼Œé‚£æˆ‘ä»¬ä»£ç ç”Ÿæˆå™¨è¦æ€ä¹ˆå†™æ‰èƒ½å¤Ÿåº”ç”¨åˆ° http ä¸Šå‘¢ï¼Ÿ



#### æ¦‚è¦æ–¹æ¡ˆ

1. æˆ‘ä»¬éœ€è¦ä» proto æ–‡ä»¶ä¸­å¾—çŸ¥ http methodï¼Œhttp path çš„ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬æ‰çŸ¥é“è¦æ³¨å†Œåˆ°å“ªä¸ªè·¯ç”±ä¸Š

   1. è¿™ä¸ªå¯ä»¥é€šè¿‡ `google/api/annotations.proto` ä¸º rpc æ–¹æ³•æ·»åŠ  Option å®ç°
   2. æˆ–è€…æ˜¯é€šè¿‡å‡½æ•°ç­¾åæ¥çº¦å®šï¼Œæˆ‘ä»¬çº¦å®šæ–¹æ³•åä½¿ç”¨é©¼å³°æ–¹å¼å‘½åï¼Œé¦–ä¸ªå•è¯æ˜¯ http method æˆ–è€…æ˜¯ http method çš„æ˜ å°„ï¼Œå¦‚æœéƒ½ä¸æ˜¯é»˜è®¤é‡‡ç”¨ post
      1. `"GET", "FIND", "QUERY", "LIST", "SEARCH"` â€“> `GET`
      2. `"POST", "CREATE"` â€“> `POST`
      3. `"PUT", "UPDATE"` â€“> `PUT`
      4. `"DELETE"` â€“> `DELETE`

2. æˆ‘ä»¬éœ€è¦æ„å»º

   ```
   func handler(ctx *gin.Context)
   ```

   å‡½æ•°ç”¨äºæ³¨å†Œè·¯ç”±

   1. å‡½æ•°å†…éœ€è¦å¤„ç†å‚æ•°ï¼Œç”¨äºè°ƒç”¨ service å±‚çš„ä»£ç 
   2. è°ƒç”¨ service å±‚çš„ä»£ç ç»“æŸä¹‹åï¼Œå°†è¿”å›å€¼è°ƒç”¨ gin ç›¸å…³æ–¹æ³•è¿”å›

æ‰€ä»¥æˆ‘ä»¬æœ€åç”Ÿæˆçš„ä»£ç å¤§æ¦‚åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
type GreeterService struct {
	server GreeterHTTPServer
	router gin.IRouter
}

// ç”Ÿæˆçš„ gin.HandlerFunc
// ç”±äº HandlerFunc ç­¾åçš„é™åˆ¶ï¼Œä¸èƒ½ä»å‚æ•°ä¼ é€’ service æ¥å£è¿›æ¥
// æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª Struct æ‰˜ç®¡ service æ•°æ®
func (s *GreeterService) SayHello(ctx *gin.Context) {
	var in HelloRequest

	if err := ctx.ShouldBindJSON(âˆˆ); err != nil {
		// è¿”å›å‚æ•°é”™è¯¯
		return
	}

	// è°ƒç”¨ä¸šåŠ¡é€»è¾‘
	out, err := s.server.(GreeterHTTPServer).SayHello(ctx, âˆˆ)
	if err != nil {
		// è¿”å›é”™è¯¯ç»“æœ
		return
	}

	// è¿”å›æˆåŠŸç»“æœ
	ctx.JSON(200, out)
	return
}

// è·¯ç”±æ³¨å†Œï¼Œé¦–å…ˆéœ€è¦ gin.IRouter æ¥å£ç”¨äºæ³¨å†Œ
// å…¶æ¬¡éœ€è¦è·å–åˆ° SayHello æ–¹æ³•å¯¹åº”çš„ http method å’Œ path
func (s *GreeterService) RegisterService() {
	s.router.Handle("GET", "/hello", s.SayHello)
}
```

