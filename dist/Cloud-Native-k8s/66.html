<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/img/1.jpg"><title>ç¬¬66èŠ‚ CRD | ä½ å¥½</title><meta name="description" content="é“¾å­¦ç¤¾è‡´åŠ›äºæ‰“é€ å‡ºåŒºå—é“¾å»ä¸­å¿ƒåŒ–çš„å­¦ä¹ å¹³å°">
    <link rel="modulepreload" href="/assets/app.74e47ba8.js"><link rel="modulepreload" href="/assets/66.html.10656664.js"><link rel="modulepreload" href="/assets/66.html.3fa6a626.js"><link rel="prefetch" href="/assets/index.html.c499f25b.js"><link rel="prefetch" href="/assets/1.html.f9754f70.js"><link rel="prefetch" href="/assets/10.html.b7ebfc66.js"><link rel="prefetch" href="/assets/11.html.2e4c4099.js"><link rel="prefetch" href="/assets/12.html.693741b8.js"><link rel="prefetch" href="/assets/13.html.2dae1833.js"><link rel="prefetch" href="/assets/14.html.a87633d9.js"><link rel="prefetch" href="/assets/15.html.88e104a0.js"><link rel="prefetch" href="/assets/16.html.8930277d.js"><link rel="prefetch" href="/assets/17.html.8ade317c.js"><link rel="prefetch" href="/assets/18.html.3b6fe606.js"><link rel="prefetch" href="/assets/19.html.19b0e452.js"><link rel="prefetch" href="/assets/2.html.5e046ae0.js"><link rel="prefetch" href="/assets/20.html.537d64f6.js"><link rel="prefetch" href="/assets/21.html.9eba97d7.js"><link rel="prefetch" href="/assets/22.html.eb5ddb66.js"><link rel="prefetch" href="/assets/23.html.2aa6b813.js"><link rel="prefetch" href="/assets/24.html.1abb586c.js"><link rel="prefetch" href="/assets/25.html.129b8aee.js"><link rel="prefetch" href="/assets/26.html.f00952bd.js"><link rel="prefetch" href="/assets/27.html.bb3833c5.js"><link rel="prefetch" href="/assets/28.html.de76c576.js"><link rel="prefetch" href="/assets/29.html.efa508a0.js"><link rel="prefetch" href="/assets/3.html.754e03c5.js"><link rel="prefetch" href="/assets/30.html.bb990189.js"><link rel="prefetch" href="/assets/31.html.220881c1.js"><link rel="prefetch" href="/assets/32.html.02e7faad.js"><link rel="prefetch" href="/assets/33.html.70a27ed8.js"><link rel="prefetch" href="/assets/34.html.63c44337.js"><link rel="prefetch" href="/assets/35.html.93b92893.js"><link rel="prefetch" href="/assets/36.html.89cba95a.js"><link rel="prefetch" href="/assets/37.html.66af0e85.js"><link rel="prefetch" href="/assets/38.html.7b92954e.js"><link rel="prefetch" href="/assets/39.html.db6ff7c5.js"><link rel="prefetch" href="/assets/4.html.71361f7b.js"><link rel="prefetch" href="/assets/40.html.6a94f9a7.js"><link rel="prefetch" href="/assets/41.html.c302f271.js"><link rel="prefetch" href="/assets/42.html.42f70d7c.js"><link rel="prefetch" href="/assets/43.html.5ee2a21b.js"><link rel="prefetch" href="/assets/44.html.9dc19608.js"><link rel="prefetch" href="/assets/45.html.65a00f64.js"><link rel="prefetch" href="/assets/46.html.3f216863.js"><link rel="prefetch" href="/assets/47.html.771bca91.js"><link rel="prefetch" href="/assets/48.html.c9fdb58d.js"><link rel="prefetch" href="/assets/49.html.2cd1d985.js"><link rel="prefetch" href="/assets/5.html.89e9822a.js"><link rel="prefetch" href="/assets/50.html.494b0ca7.js"><link rel="prefetch" href="/assets/51.html.51a4ea70.js"><link rel="prefetch" href="/assets/52.html.7fbf333e.js"><link rel="prefetch" href="/assets/53.html.3d3c9f66.js"><link rel="prefetch" href="/assets/54.html.c41944b8.js"><link rel="prefetch" href="/assets/55.html.6cac9530.js"><link rel="prefetch" href="/assets/56.html.f3d1621a.js"><link rel="prefetch" href="/assets/57.html.3fb6f308.js"><link rel="prefetch" href="/assets/58.html.e98a53c6.js"><link rel="prefetch" href="/assets/59.html.efc1a270.js"><link rel="prefetch" href="/assets/6.html.7f20f46a.js"><link rel="prefetch" href="/assets/60.html.895494dd.js"><link rel="prefetch" href="/assets/61.html.4fff4e8f.js"><link rel="prefetch" href="/assets/62.html.7f0dc57f.js"><link rel="prefetch" href="/assets/63.html.d3d63fbd.js"><link rel="prefetch" href="/assets/64.html.d81518de.js"><link rel="prefetch" href="/assets/65.html.5a2a423c.js"><link rel="prefetch" href="/assets/66.html.09006efe.js"><link rel="prefetch" href="/assets/67.html.c44147c4.js"><link rel="prefetch" href="/assets/68.html.5123bdda.js"><link rel="prefetch" href="/assets/69.html.709fcbfa.js"><link rel="prefetch" href="/assets/7.html.73107fb7.js"><link rel="prefetch" href="/assets/70.html.d5175b4e.js"><link rel="prefetch" href="/assets/71.html.5c7276ad.js"><link rel="prefetch" href="/assets/72.html.be0505f9.js"><link rel="prefetch" href="/assets/73.html.945cee02.js"><link rel="prefetch" href="/assets/74.html.ed0427d0.js"><link rel="prefetch" href="/assets/75.html.22eaa4c1.js"><link rel="prefetch" href="/assets/76.html.83a60559.js"><link rel="prefetch" href="/assets/77.html.6a485035.js"><link rel="prefetch" href="/assets/78.html.5184af63.js"><link rel="prefetch" href="/assets/79.html.f31f80ee.js"><link rel="prefetch" href="/assets/8.html.0592d8bf.js"><link rel="prefetch" href="/assets/80.html.71fe2de3.js"><link rel="prefetch" href="/assets/81.html.674b9f45.js"><link rel="prefetch" href="/assets/82.html.84a9da67.js"><link rel="prefetch" href="/assets/83.html.f9366f23.js"><link rel="prefetch" href="/assets/84.html.077d9bdc.js"><link rel="prefetch" href="/assets/85.html.afe84b99.js"><link rel="prefetch" href="/assets/86.html.0cab34db.js"><link rel="prefetch" href="/assets/87.html.f2d70c50.js"><link rel="prefetch" href="/assets/88.html.3842a471.js"><link rel="prefetch" href="/assets/89.html.bd36ae29.js"><link rel="prefetch" href="/assets/9.html.8b1df622.js"><link rel="prefetch" href="/assets/90.html.59d1af05.js"><link rel="prefetch" href="/assets/91.html.bff9db18.js"><link rel="prefetch" href="/assets/92.html.8d1d3932.js"><link rel="prefetch" href="/assets/93.html.2e25826f.js"><link rel="prefetch" href="/assets/94.html.3bf21ffb.js"><link rel="prefetch" href="/assets/95.html.703f578c.js"><link rel="prefetch" href="/assets/96.html.b168fbc0.js"><link rel="prefetch" href="/assets/97.html.9a9e7eb7.js"><link rel="prefetch" href="/assets/98.html.dba9b839.js"><link rel="prefetch" href="/assets/99.html.403135da.js"><link rel="prefetch" href="/assets/index.html.90f79834.js"><link rel="prefetch" href="/assets/TODO.html.830317c3.js"><link rel="prefetch" href="/assets/1.html.9e750f7a.js"><link rel="prefetch" href="/assets/10.html.e77e0455.js"><link rel="prefetch" href="/assets/11.html.7e785902.js"><link rel="prefetch" href="/assets/12.html.1599a54d.js"><link rel="prefetch" href="/assets/13.html.70628749.js"><link rel="prefetch" href="/assets/14.html.c9cd2ca2.js"><link rel="prefetch" href="/assets/15.html.df743cd2.js"><link rel="prefetch" href="/assets/16.html.5bb25047.js"><link rel="prefetch" href="/assets/17.html.6874d49f.js"><link rel="prefetch" href="/assets/18.html.65b90de4.js"><link rel="prefetch" href="/assets/19.html.dde6b661.js"><link rel="prefetch" href="/assets/2.html.e1274803.js"><link rel="prefetch" href="/assets/20.html.0fe80452.js"><link rel="prefetch" href="/assets/21.html.f85d8468.js"><link rel="prefetch" href="/assets/22.html.0afb63ed.js"><link rel="prefetch" href="/assets/23.html.acd56ad8.js"><link rel="prefetch" href="/assets/24.html.f874b480.js"><link rel="prefetch" href="/assets/25.html.e020387b.js"><link rel="prefetch" href="/assets/26.html.ccbed0cc.js"><link rel="prefetch" href="/assets/27.html.148446d1.js"><link rel="prefetch" href="/assets/28.html.a94af5c0.js"><link rel="prefetch" href="/assets/29.html.aa33eff4.js"><link rel="prefetch" href="/assets/3.html.cac76b28.js"><link rel="prefetch" href="/assets/30.html.6c68425a.js"><link rel="prefetch" href="/assets/31.html.9b16aa42.js"><link rel="prefetch" href="/assets/32.html.f56e1ab6.js"><link rel="prefetch" href="/assets/33.html.450fcdf8.js"><link rel="prefetch" href="/assets/34.html.7f5edde4.js"><link rel="prefetch" href="/assets/35.html.b9867f79.js"><link rel="prefetch" href="/assets/36.html.614ee854.js"><link rel="prefetch" href="/assets/37.html.2d010e5c.js"><link rel="prefetch" href="/assets/38.html.db03c609.js"><link rel="prefetch" href="/assets/39.html.dae7a11d.js"><link rel="prefetch" href="/assets/4.html.d793bb26.js"><link rel="prefetch" href="/assets/40.html.f1b53d8e.js"><link rel="prefetch" href="/assets/41.html.f71f97a0.js"><link rel="prefetch" href="/assets/42.html.8af2270a.js"><link rel="prefetch" href="/assets/43.html.aeab5555.js"><link rel="prefetch" href="/assets/44.html.ca417de8.js"><link rel="prefetch" href="/assets/45.html.26989a52.js"><link rel="prefetch" href="/assets/46.html.48fe7270.js"><link rel="prefetch" href="/assets/47.html.3e47ee65.js"><link rel="prefetch" href="/assets/48.html.d08a8b7f.js"><link rel="prefetch" href="/assets/49.html.1c55cdc2.js"><link rel="prefetch" href="/assets/5.html.f58f6203.js"><link rel="prefetch" href="/assets/50.html.581cdfdd.js"><link rel="prefetch" href="/assets/51.html.143c32e9.js"><link rel="prefetch" href="/assets/52.html.7488aa3f.js"><link rel="prefetch" href="/assets/53.html.df9bfd27.js"><link rel="prefetch" href="/assets/54.html.97e0befc.js"><link rel="prefetch" href="/assets/55.html.9f2e0fc4.js"><link rel="prefetch" href="/assets/56.html.832dc435.js"><link rel="prefetch" href="/assets/57.html.55b5f82f.js"><link rel="prefetch" href="/assets/58.html.f97be2b4.js"><link rel="prefetch" href="/assets/59.html.c2454b9d.js"><link rel="prefetch" href="/assets/6.html.2b7b8ad3.js"><link rel="prefetch" href="/assets/60.html.5867f9c4.js"><link rel="prefetch" href="/assets/61.html.1e8bbff2.js"><link rel="prefetch" href="/assets/62.html.ce4e8457.js"><link rel="prefetch" href="/assets/63.html.b668ae9a.js"><link rel="prefetch" href="/assets/64.html.875cd724.js"><link rel="prefetch" href="/assets/65.html.53b86f35.js"><link rel="prefetch" href="/assets/67.html.3fefb232.js"><link rel="prefetch" href="/assets/68.html.6b3eacef.js"><link rel="prefetch" href="/assets/69.html.13709c4e.js"><link rel="prefetch" href="/assets/7.html.44323637.js"><link rel="prefetch" href="/assets/70.html.1b09fdec.js"><link rel="prefetch" href="/assets/71.html.fc91e357.js"><link rel="prefetch" href="/assets/72.html.3ed54957.js"><link rel="prefetch" href="/assets/73.html.3269221e.js"><link rel="prefetch" href="/assets/74.html.d36867b2.js"><link rel="prefetch" href="/assets/75.html.8b1ecf89.js"><link rel="prefetch" href="/assets/76.html.6edcd166.js"><link rel="prefetch" href="/assets/77.html.e7635ab7.js"><link rel="prefetch" href="/assets/78.html.0de8f8e0.js"><link rel="prefetch" href="/assets/79.html.b84c0c1d.js"><link rel="prefetch" href="/assets/8.html.fbdd9051.js"><link rel="prefetch" href="/assets/80.html.72b53b23.js"><link rel="prefetch" href="/assets/81.html.2df80b97.js"><link rel="prefetch" href="/assets/82.html.ad487a1e.js"><link rel="prefetch" href="/assets/83.html.c2f31839.js"><link rel="prefetch" href="/assets/84.html.8f08ca4d.js"><link rel="prefetch" href="/assets/85.html.58986e20.js"><link rel="prefetch" href="/assets/86.html.b208cc40.js"><link rel="prefetch" href="/assets/87.html.c3518680.js"><link rel="prefetch" href="/assets/88.html.4987ffcc.js"><link rel="prefetch" href="/assets/89.html.ba926430.js"><link rel="prefetch" href="/assets/9.html.1b790a84.js"><link rel="prefetch" href="/assets/90.html.21f82605.js"><link rel="prefetch" href="/assets/91.html.b7301274.js"><link rel="prefetch" href="/assets/92.html.3662bc0c.js"><link rel="prefetch" href="/assets/93.html.e2ac0831.js"><link rel="prefetch" href="/assets/94.html.02d9e407.js"><link rel="prefetch" href="/assets/95.html.10a9639a.js"><link rel="prefetch" href="/assets/96.html.62960ce9.js"><link rel="prefetch" href="/assets/97.html.d0ab9bbe.js"><link rel="prefetch" href="/assets/98.html.89ca1b0b.js"><link rel="prefetch" href="/assets/99.html.5143f23b.js"><link rel="prefetch" href="/assets/index.html.43f40a16.js"><link rel="prefetch" href="/assets/1.html.bd959b6e.js"><link rel="prefetch" href="/assets/10.html.ae2469e0.js"><link rel="prefetch" href="/assets/11.html.cf3c12f9.js"><link rel="prefetch" href="/assets/12.html.a0411a0f.js"><link rel="prefetch" href="/assets/13.html.2caa0b00.js"><link rel="prefetch" href="/assets/14.html.381371db.js"><link rel="prefetch" href="/assets/15.html.e47b1665.js"><link rel="prefetch" href="/assets/16.html.30b1bf5d.js"><link rel="prefetch" href="/assets/17.html.073b9d56.js"><link rel="prefetch" href="/assets/18.html.8c025525.js"><link rel="prefetch" href="/assets/19.html.f06d2ea4.js"><link rel="prefetch" href="/assets/2.html.c24a2383.js"><link rel="prefetch" href="/assets/20.html.9e702c70.js"><link rel="prefetch" href="/assets/21.html.087be0ef.js"><link rel="prefetch" href="/assets/22.html.67972d7c.js"><link rel="prefetch" href="/assets/23.html.7f287dfd.js"><link rel="prefetch" href="/assets/24.html.e8034405.js"><link rel="prefetch" href="/assets/25.html.8bdb4208.js"><link rel="prefetch" href="/assets/26.html.52f08579.js"><link rel="prefetch" href="/assets/27.html.16632077.js"><link rel="prefetch" href="/assets/28.html.6d11f2d1.js"><link rel="prefetch" href="/assets/29.html.059e6730.js"><link rel="prefetch" href="/assets/3.html.b3db0053.js"><link rel="prefetch" href="/assets/30.html.a53b02db.js"><link rel="prefetch" href="/assets/31.html.0b37e7ce.js"><link rel="prefetch" href="/assets/32.html.cea0c777.js"><link rel="prefetch" href="/assets/33.html.ff558a34.js"><link rel="prefetch" href="/assets/34.html.e8b4b97e.js"><link rel="prefetch" href="/assets/35.html.cb802a9c.js"><link rel="prefetch" href="/assets/36.html.a719dfcb.js"><link rel="prefetch" href="/assets/37.html.d139e2b1.js"><link rel="prefetch" href="/assets/38.html.89fc986d.js"><link rel="prefetch" href="/assets/39.html.f9fda674.js"><link rel="prefetch" href="/assets/4.html.0f09f509.js"><link rel="prefetch" href="/assets/40.html.8a6f76c5.js"><link rel="prefetch" href="/assets/41.html.da32683f.js"><link rel="prefetch" href="/assets/42.html.19b82696.js"><link rel="prefetch" href="/assets/43.html.d3c5a1fb.js"><link rel="prefetch" href="/assets/44.html.37c86fd1.js"><link rel="prefetch" href="/assets/45.html.49d43e8d.js"><link rel="prefetch" href="/assets/46.html.c897c137.js"><link rel="prefetch" href="/assets/47.html.9fc11c19.js"><link rel="prefetch" href="/assets/48.html.61399716.js"><link rel="prefetch" href="/assets/49.html.4bff12f5.js"><link rel="prefetch" href="/assets/5.html.c137122b.js"><link rel="prefetch" href="/assets/6.html.082624e8.js"><link rel="prefetch" href="/assets/7.html.a4ae3c8b.js"><link rel="prefetch" href="/assets/8.html.9f5571b9.js"><link rel="prefetch" href="/assets/9.html.9d8ed5f6.js"><link rel="prefetch" href="/assets/1.html.fefabf1f.js"><link rel="prefetch" href="/assets/10.html.a591fdaf.js"><link rel="prefetch" href="/assets/11.html.f0c58879.js"><link rel="prefetch" href="/assets/12.html.6174ec90.js"><link rel="prefetch" href="/assets/13.html.181888e9.js"><link rel="prefetch" href="/assets/14.html.7b106669.js"><link rel="prefetch" href="/assets/15.html.c0e4acaa.js"><link rel="prefetch" href="/assets/16.html.7a3ba1ea.js"><link rel="prefetch" href="/assets/17.html.7a0b131d.js"><link rel="prefetch" href="/assets/18.html.a9e5ae4a.js"><link rel="prefetch" href="/assets/19.html.f9a1dad0.js"><link rel="prefetch" href="/assets/2.html.47656e60.js"><link rel="prefetch" href="/assets/20.html.7990e495.js"><link rel="prefetch" href="/assets/21.html.10de0a75.js"><link rel="prefetch" href="/assets/22.html.ccdeb6c4.js"><link rel="prefetch" href="/assets/23.html.371d6681.js"><link rel="prefetch" href="/assets/24.html.1e3b14eb.js"><link rel="prefetch" href="/assets/25.html.ce330676.js"><link rel="prefetch" href="/assets/26.html.d044406f.js"><link rel="prefetch" href="/assets/27.html.ccc926f6.js"><link rel="prefetch" href="/assets/28.html.49f5cbc7.js"><link rel="prefetch" href="/assets/29.html.f44fb171.js"><link rel="prefetch" href="/assets/3.html.44eda9ad.js"><link rel="prefetch" href="/assets/30.html.71962bb9.js"><link rel="prefetch" href="/assets/31.html.05d73e5f.js"><link rel="prefetch" href="/assets/32.html.e98a73d9.js"><link rel="prefetch" href="/assets/33.html.55b3c6fb.js"><link rel="prefetch" href="/assets/34.html.5146048c.js"><link rel="prefetch" href="/assets/35.html.51cb1df4.js"><link rel="prefetch" href="/assets/36.html.dea92735.js"><link rel="prefetch" href="/assets/37.html.4987df3a.js"><link rel="prefetch" href="/assets/38.html.94359779.js"><link rel="prefetch" href="/assets/39.html.e9fb19b6.js"><link rel="prefetch" href="/assets/4.html.11bb9c93.js"><link rel="prefetch" href="/assets/40.html.12ce2063.js"><link rel="prefetch" href="/assets/41.html.17b39dbf.js"><link rel="prefetch" href="/assets/42.html.737c2f7f.js"><link rel="prefetch" href="/assets/43.html.4aa549bb.js"><link rel="prefetch" href="/assets/44.html.461dd21b.js"><link rel="prefetch" href="/assets/45.html.f7fa8b44.js"><link rel="prefetch" href="/assets/46.html.0c1c3d86.js"><link rel="prefetch" href="/assets/47.html.7a6006c3.js"><link rel="prefetch" href="/assets/48.html.876530ae.js"><link rel="prefetch" href="/assets/49.html.93195ef1.js"><link rel="prefetch" href="/assets/5.html.d52a2513.js"><link rel="prefetch" href="/assets/50.html.ae771c42.js"><link rel="prefetch" href="/assets/6.html.6207e399.js"><link rel="prefetch" href="/assets/7.html.60b74bd7.js"><link rel="prefetch" href="/assets/8.html.4ebadc89.js"><link rel="prefetch" href="/assets/9.html.38305fea.js"><link rel="prefetch" href="/assets/k8s_011.html.a02b632d.js"><link rel="prefetch" href="/assets/k8s_012.html.43d51b72.js"><link rel="prefetch" href="/assets/k8s_013.html.ec5b47f7.js"><link rel="prefetch" href="/assets/k8s_014.html.f6d97c90.js"><link rel="prefetch" href="/assets/k8s_015.html.e0a1919b.js"><link rel="prefetch" href="/assets/k8s_016.html.3974eb6c.js"><link rel="prefetch" href="/assets/k8s_017.html.75871624.js"><link rel="prefetch" href="/assets/k8s_018.html.12099bf7.js"><link rel="prefetch" href="/assets/k8s_019.html.056e3a37.js"><link rel="prefetch" href="/assets/k8s_020.html.81fc58d1.js"><link rel="prefetch" href="/assets/k8s_021.html.28a3099b.js"><link rel="prefetch" href="/assets/k8s_022.html.bd4c9467.js"><link rel="prefetch" href="/assets/k8s_023.html.ffd7194a.js"><link rel="prefetch" href="/assets/k8s_024.html.3422943c.js"><link rel="prefetch" href="/assets/k8s_025.html.29b4b1e1.js"><link rel="prefetch" href="/assets/k8s_026.html.37a39c28.js"><link rel="prefetch" href="/assets/k8s_027.html.ffb2e25f.js"><link rel="prefetch" href="/assets/k8s_028.html.d98c6ad6.js"><link rel="prefetch" href="/assets/k8s_029.html.ca41febf.js"><link rel="prefetch" href="/assets/k8s_030.html.9902d045.js"><link rel="prefetch" href="/assets/README (copy).html.e4b91025.js"><link rel="prefetch" href="/assets/index.html.32aff7af.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.608ebeeb.js"><link rel="prefetch" href="/assets/1.html.88a40607.js"><link rel="prefetch" href="/assets/10.html.fcce0139.js"><link rel="prefetch" href="/assets/11.html.7c251fee.js"><link rel="prefetch" href="/assets/12.html.f2dce26a.js"><link rel="prefetch" href="/assets/13.html.9952b6b5.js"><link rel="prefetch" href="/assets/14.html.19bdc8b5.js"><link rel="prefetch" href="/assets/15.html.43cefb57.js"><link rel="prefetch" href="/assets/16.html.48b07248.js"><link rel="prefetch" href="/assets/17.html.fc234feb.js"><link rel="prefetch" href="/assets/18.html.933f2409.js"><link rel="prefetch" href="/assets/19.html.290f8980.js"><link rel="prefetch" href="/assets/2.html.a75b7b00.js"><link rel="prefetch" href="/assets/20.html.51b80a8c.js"><link rel="prefetch" href="/assets/21.html.5ea47d53.js"><link rel="prefetch" href="/assets/22.html.1a2a07ac.js"><link rel="prefetch" href="/assets/23.html.34e5d3ab.js"><link rel="prefetch" href="/assets/24.html.1861b7f6.js"><link rel="prefetch" href="/assets/25.html.d09bf736.js"><link rel="prefetch" href="/assets/26.html.ce46f446.js"><link rel="prefetch" href="/assets/27.html.185f1c1a.js"><link rel="prefetch" href="/assets/28.html.c971a7ab.js"><link rel="prefetch" href="/assets/29.html.f26ab282.js"><link rel="prefetch" href="/assets/3.html.55baaeb9.js"><link rel="prefetch" href="/assets/30.html.781f2970.js"><link rel="prefetch" href="/assets/31.html.dad47034.js"><link rel="prefetch" href="/assets/32.html.ff0e0a1f.js"><link rel="prefetch" href="/assets/33.html.50d81e98.js"><link rel="prefetch" href="/assets/34.html.6415e137.js"><link rel="prefetch" href="/assets/35.html.d9a5f3bc.js"><link rel="prefetch" href="/assets/36.html.e38e0669.js"><link rel="prefetch" href="/assets/37.html.1eb14b1c.js"><link rel="prefetch" href="/assets/38.html.dc201b5f.js"><link rel="prefetch" href="/assets/39.html.69164b91.js"><link rel="prefetch" href="/assets/4.html.4d55e3c3.js"><link rel="prefetch" href="/assets/40.html.479525d5.js"><link rel="prefetch" href="/assets/41.html.248697cc.js"><link rel="prefetch" href="/assets/42.html.499fea52.js"><link rel="prefetch" href="/assets/43.html.5278ef85.js"><link rel="prefetch" href="/assets/44.html.e6e7ed21.js"><link rel="prefetch" href="/assets/45.html.df3be3c8.js"><link rel="prefetch" href="/assets/46.html.0303ac0a.js"><link rel="prefetch" href="/assets/47.html.a0574f65.js"><link rel="prefetch" href="/assets/48.html.59a31dc3.js"><link rel="prefetch" href="/assets/49.html.ed67fd99.js"><link rel="prefetch" href="/assets/5.html.0d66e5be.js"><link rel="prefetch" href="/assets/50.html.9c0efcb8.js"><link rel="prefetch" href="/assets/51.html.4c31082e.js"><link rel="prefetch" href="/assets/52.html.af6a622a.js"><link rel="prefetch" href="/assets/53.html.bdceee13.js"><link rel="prefetch" href="/assets/54.html.f85ce84d.js"><link rel="prefetch" href="/assets/55.html.9338d813.js"><link rel="prefetch" href="/assets/56.html.d5b08337.js"><link rel="prefetch" href="/assets/57.html.ed02c1ce.js"><link rel="prefetch" href="/assets/58.html.d1d5c164.js"><link rel="prefetch" href="/assets/59.html.c83885c6.js"><link rel="prefetch" href="/assets/6.html.a57b694d.js"><link rel="prefetch" href="/assets/60.html.4bd6699b.js"><link rel="prefetch" href="/assets/61.html.618132aa.js"><link rel="prefetch" href="/assets/62.html.74f1fd91.js"><link rel="prefetch" href="/assets/63.html.38411132.js"><link rel="prefetch" href="/assets/64.html.073be347.js"><link rel="prefetch" href="/assets/65.html.97b02f4d.js"><link rel="prefetch" href="/assets/66.html.81a62c79.js"><link rel="prefetch" href="/assets/67.html.6bffc307.js"><link rel="prefetch" href="/assets/68.html.e80ff98f.js"><link rel="prefetch" href="/assets/69.html.4d106d19.js"><link rel="prefetch" href="/assets/7.html.4b49fdc5.js"><link rel="prefetch" href="/assets/70.html.9d7e3291.js"><link rel="prefetch" href="/assets/71.html.5b53562f.js"><link rel="prefetch" href="/assets/72.html.8799b5f4.js"><link rel="prefetch" href="/assets/73.html.cfae468b.js"><link rel="prefetch" href="/assets/74.html.353c3317.js"><link rel="prefetch" href="/assets/75.html.1f0f6012.js"><link rel="prefetch" href="/assets/76.html.454b0f8f.js"><link rel="prefetch" href="/assets/77.html.5f7eb787.js"><link rel="prefetch" href="/assets/78.html.718b8edd.js"><link rel="prefetch" href="/assets/79.html.c98d99cc.js"><link rel="prefetch" href="/assets/8.html.3d4eafcb.js"><link rel="prefetch" href="/assets/80.html.69f258df.js"><link rel="prefetch" href="/assets/81.html.3b6f7382.js"><link rel="prefetch" href="/assets/82.html.7ea88c8c.js"><link rel="prefetch" href="/assets/83.html.4211823d.js"><link rel="prefetch" href="/assets/84.html.ec7a69aa.js"><link rel="prefetch" href="/assets/85.html.3c124d59.js"><link rel="prefetch" href="/assets/86.html.e6e0a219.js"><link rel="prefetch" href="/assets/87.html.60f70323.js"><link rel="prefetch" href="/assets/88.html.6dca072c.js"><link rel="prefetch" href="/assets/89.html.0926b01b.js"><link rel="prefetch" href="/assets/9.html.39aed675.js"><link rel="prefetch" href="/assets/90.html.25e72da3.js"><link rel="prefetch" href="/assets/91.html.35aacf49.js"><link rel="prefetch" href="/assets/92.html.50118924.js"><link rel="prefetch" href="/assets/93.html.ab3b2c4a.js"><link rel="prefetch" href="/assets/94.html.f00bcd9d.js"><link rel="prefetch" href="/assets/95.html.5ecc2ae1.js"><link rel="prefetch" href="/assets/96.html.df7d70ec.js"><link rel="prefetch" href="/assets/97.html.d33d9387.js"><link rel="prefetch" href="/assets/98.html.3b0d46b4.js"><link rel="prefetch" href="/assets/99.html.29ecdf75.js"><link rel="prefetch" href="/assets/index.html.adb29673.js"><link rel="prefetch" href="/assets/TODO.html.dd08fc3c.js"><link rel="prefetch" href="/assets/1.html.6ebdbe41.js"><link rel="prefetch" href="/assets/10.html.4da3613f.js"><link rel="prefetch" href="/assets/11.html.ccaf0410.js"><link rel="prefetch" href="/assets/12.html.a789977b.js"><link rel="prefetch" href="/assets/13.html.413b7165.js"><link rel="prefetch" href="/assets/14.html.b496f6b9.js"><link rel="prefetch" href="/assets/15.html.30ec4473.js"><link rel="prefetch" href="/assets/16.html.12e84011.js"><link rel="prefetch" href="/assets/17.html.4bd24599.js"><link rel="prefetch" href="/assets/18.html.b425e7a0.js"><link rel="prefetch" href="/assets/19.html.8094e216.js"><link rel="prefetch" href="/assets/2.html.b2cba4ce.js"><link rel="prefetch" href="/assets/20.html.094b0a48.js"><link rel="prefetch" href="/assets/21.html.4409e7c1.js"><link rel="prefetch" href="/assets/22.html.059ae27f.js"><link rel="prefetch" href="/assets/23.html.0dec66fb.js"><link rel="prefetch" href="/assets/24.html.28c01df3.js"><link rel="prefetch" href="/assets/25.html.49808102.js"><link rel="prefetch" href="/assets/26.html.3c10d33c.js"><link rel="prefetch" href="/assets/27.html.bcb36ec2.js"><link rel="prefetch" href="/assets/28.html.71f0bd29.js"><link rel="prefetch" href="/assets/29.html.a73e9979.js"><link rel="prefetch" href="/assets/3.html.ca14d217.js"><link rel="prefetch" href="/assets/30.html.f64f3176.js"><link rel="prefetch" href="/assets/31.html.e2ac035e.js"><link rel="prefetch" href="/assets/32.html.15ad4001.js"><link rel="prefetch" href="/assets/33.html.97db5451.js"><link rel="prefetch" href="/assets/34.html.a90a1c06.js"><link rel="prefetch" href="/assets/35.html.40435872.js"><link rel="prefetch" href="/assets/36.html.5ffbcf17.js"><link rel="prefetch" href="/assets/37.html.09ccaff1.js"><link rel="prefetch" href="/assets/38.html.98fd42a5.js"><link rel="prefetch" href="/assets/39.html.0f5b4ae0.js"><link rel="prefetch" href="/assets/4.html.69082f12.js"><link rel="prefetch" href="/assets/40.html.c52ffb4e.js"><link rel="prefetch" href="/assets/41.html.fa6e4904.js"><link rel="prefetch" href="/assets/42.html.feebd808.js"><link rel="prefetch" href="/assets/43.html.157bf45d.js"><link rel="prefetch" href="/assets/44.html.e94c1252.js"><link rel="prefetch" href="/assets/45.html.10d617b8.js"><link rel="prefetch" href="/assets/46.html.30dd662b.js"><link rel="prefetch" href="/assets/47.html.4fb2c876.js"><link rel="prefetch" href="/assets/48.html.2d3c17e9.js"><link rel="prefetch" href="/assets/49.html.df4e28f0.js"><link rel="prefetch" href="/assets/5.html.688d3ef3.js"><link rel="prefetch" href="/assets/50.html.704cfff4.js"><link rel="prefetch" href="/assets/51.html.936f6dfa.js"><link rel="prefetch" href="/assets/52.html.23c50d96.js"><link rel="prefetch" href="/assets/53.html.dd5d77ef.js"><link rel="prefetch" href="/assets/54.html.8856de27.js"><link rel="prefetch" href="/assets/55.html.3946e1e1.js"><link rel="prefetch" href="/assets/56.html.a22f78ce.js"><link rel="prefetch" href="/assets/57.html.130668b1.js"><link rel="prefetch" href="/assets/58.html.c6811887.js"><link rel="prefetch" href="/assets/59.html.71485dc5.js"><link rel="prefetch" href="/assets/6.html.ed9ea220.js"><link rel="prefetch" href="/assets/60.html.6ad2a1d6.js"><link rel="prefetch" href="/assets/61.html.ae9aa941.js"><link rel="prefetch" href="/assets/62.html.a7c99763.js"><link rel="prefetch" href="/assets/63.html.3fca0373.js"><link rel="prefetch" href="/assets/64.html.c93b7c1b.js"><link rel="prefetch" href="/assets/65.html.b0aef73d.js"><link rel="prefetch" href="/assets/67.html.c149d68b.js"><link rel="prefetch" href="/assets/68.html.dd9b82df.js"><link rel="prefetch" href="/assets/69.html.42064910.js"><link rel="prefetch" href="/assets/7.html.670d9b9f.js"><link rel="prefetch" href="/assets/70.html.998fd8b0.js"><link rel="prefetch" href="/assets/71.html.db8a6e31.js"><link rel="prefetch" href="/assets/72.html.f55e31c0.js"><link rel="prefetch" href="/assets/73.html.ef384a9e.js"><link rel="prefetch" href="/assets/74.html.7ada53f3.js"><link rel="prefetch" href="/assets/75.html.4485efe9.js"><link rel="prefetch" href="/assets/76.html.8355208b.js"><link rel="prefetch" href="/assets/77.html.a2809629.js"><link rel="prefetch" href="/assets/78.html.e186acfc.js"><link rel="prefetch" href="/assets/79.html.8a19b6a9.js"><link rel="prefetch" href="/assets/8.html.06e52f70.js"><link rel="prefetch" href="/assets/80.html.6bc0380a.js"><link rel="prefetch" href="/assets/81.html.75778e0b.js"><link rel="prefetch" href="/assets/82.html.4e23fa8e.js"><link rel="prefetch" href="/assets/83.html.93368f78.js"><link rel="prefetch" href="/assets/84.html.11989147.js"><link rel="prefetch" href="/assets/85.html.518e934c.js"><link rel="prefetch" href="/assets/86.html.3d673e99.js"><link rel="prefetch" href="/assets/87.html.7fc86314.js"><link rel="prefetch" href="/assets/88.html.3a94e626.js"><link rel="prefetch" href="/assets/89.html.fe1a5c86.js"><link rel="prefetch" href="/assets/9.html.46f516dd.js"><link rel="prefetch" href="/assets/90.html.f9708ba2.js"><link rel="prefetch" href="/assets/91.html.b04c98d2.js"><link rel="prefetch" href="/assets/92.html.30db238e.js"><link rel="prefetch" href="/assets/93.html.5403ccc7.js"><link rel="prefetch" href="/assets/94.html.630d2875.js"><link rel="prefetch" href="/assets/95.html.ad480d24.js"><link rel="prefetch" href="/assets/96.html.22b707cc.js"><link rel="prefetch" href="/assets/97.html.9b7966c3.js"><link rel="prefetch" href="/assets/98.html.c28ecfbe.js"><link rel="prefetch" href="/assets/99.html.f6c92a53.js"><link rel="prefetch" href="/assets/index.html.ff59f615.js"><link rel="prefetch" href="/assets/1.html.e6887b48.js"><link rel="prefetch" href="/assets/10.html.6fff47fa.js"><link rel="prefetch" href="/assets/11.html.aec9ff04.js"><link rel="prefetch" href="/assets/12.html.b812b2d1.js"><link rel="prefetch" href="/assets/13.html.4f849ca4.js"><link rel="prefetch" href="/assets/14.html.f5717fcf.js"><link rel="prefetch" href="/assets/15.html.82515dae.js"><link rel="prefetch" href="/assets/16.html.031c43af.js"><link rel="prefetch" href="/assets/17.html.04d06e12.js"><link rel="prefetch" href="/assets/18.html.2e4e21e6.js"><link rel="prefetch" href="/assets/19.html.ae3b3d38.js"><link rel="prefetch" href="/assets/2.html.b8bc32d2.js"><link rel="prefetch" href="/assets/20.html.194fe838.js"><link rel="prefetch" href="/assets/21.html.28b796a1.js"><link rel="prefetch" href="/assets/22.html.b5f7f661.js"><link rel="prefetch" href="/assets/23.html.0bc1ff32.js"><link rel="prefetch" href="/assets/24.html.c402406c.js"><link rel="prefetch" href="/assets/25.html.c9983ad5.js"><link rel="prefetch" href="/assets/26.html.6567eb92.js"><link rel="prefetch" href="/assets/27.html.8f4369af.js"><link rel="prefetch" href="/assets/28.html.8ece1352.js"><link rel="prefetch" href="/assets/29.html.d07d1833.js"><link rel="prefetch" href="/assets/3.html.f3a3f742.js"><link rel="prefetch" href="/assets/30.html.095d879b.js"><link rel="prefetch" href="/assets/31.html.238234a7.js"><link rel="prefetch" href="/assets/32.html.9fbe9c40.js"><link rel="prefetch" href="/assets/33.html.ff405f24.js"><link rel="prefetch" href="/assets/34.html.0145b0e0.js"><link rel="prefetch" href="/assets/35.html.9560c38a.js"><link rel="prefetch" href="/assets/36.html.a686473f.js"><link rel="prefetch" href="/assets/37.html.af22c4c0.js"><link rel="prefetch" href="/assets/38.html.6005381b.js"><link rel="prefetch" href="/assets/39.html.21760929.js"><link rel="prefetch" href="/assets/4.html.d1951523.js"><link rel="prefetch" href="/assets/40.html.3b84d22a.js"><link rel="prefetch" href="/assets/41.html.7697dac5.js"><link rel="prefetch" href="/assets/42.html.cb850631.js"><link rel="prefetch" href="/assets/43.html.45d7e2cd.js"><link rel="prefetch" href="/assets/44.html.fb2b0de1.js"><link rel="prefetch" href="/assets/45.html.6cbe7fbc.js"><link rel="prefetch" href="/assets/46.html.233b511b.js"><link rel="prefetch" href="/assets/47.html.a3127fcd.js"><link rel="prefetch" href="/assets/48.html.2cdfcc8d.js"><link rel="prefetch" href="/assets/49.html.faea9dd8.js"><link rel="prefetch" href="/assets/5.html.174e6b8c.js"><link rel="prefetch" href="/assets/6.html.54610a8c.js"><link rel="prefetch" href="/assets/7.html.b738785f.js"><link rel="prefetch" href="/assets/8.html.cd19da8e.js"><link rel="prefetch" href="/assets/9.html.5455bc07.js"><link rel="prefetch" href="/assets/1.html.1f281760.js"><link rel="prefetch" href="/assets/10.html.e86e1789.js"><link rel="prefetch" href="/assets/11.html.53e9669e.js"><link rel="prefetch" href="/assets/12.html.0cbb739d.js"><link rel="prefetch" href="/assets/13.html.4704afda.js"><link rel="prefetch" href="/assets/14.html.e765b32d.js"><link rel="prefetch" href="/assets/15.html.816a5732.js"><link rel="prefetch" href="/assets/16.html.48bfbd09.js"><link rel="prefetch" href="/assets/17.html.361613b7.js"><link rel="prefetch" href="/assets/18.html.8bdb5301.js"><link rel="prefetch" href="/assets/19.html.c3f90eaf.js"><link rel="prefetch" href="/assets/2.html.d990de0a.js"><link rel="prefetch" href="/assets/20.html.cfa04582.js"><link rel="prefetch" href="/assets/21.html.78f29ce4.js"><link rel="prefetch" href="/assets/22.html.9bc3bf83.js"><link rel="prefetch" href="/assets/23.html.bd3728ea.js"><link rel="prefetch" href="/assets/24.html.ef948e1e.js"><link rel="prefetch" href="/assets/25.html.8180ecee.js"><link rel="prefetch" href="/assets/26.html.0f2a71c1.js"><link rel="prefetch" href="/assets/27.html.43a8dcee.js"><link rel="prefetch" href="/assets/28.html.aa546132.js"><link rel="prefetch" href="/assets/29.html.e94c9bf3.js"><link rel="prefetch" href="/assets/3.html.af4eca93.js"><link rel="prefetch" href="/assets/30.html.6fae2867.js"><link rel="prefetch" href="/assets/31.html.3b222288.js"><link rel="prefetch" href="/assets/32.html.76c0a02c.js"><link rel="prefetch" href="/assets/33.html.88de0af0.js"><link rel="prefetch" href="/assets/34.html.082c69e0.js"><link rel="prefetch" href="/assets/35.html.cffbcf75.js"><link rel="prefetch" href="/assets/36.html.d0ef599b.js"><link rel="prefetch" href="/assets/37.html.20b47dc8.js"><link rel="prefetch" href="/assets/38.html.eae00876.js"><link rel="prefetch" href="/assets/39.html.f2852943.js"><link rel="prefetch" href="/assets/4.html.3205710b.js"><link rel="prefetch" href="/assets/40.html.32588561.js"><link rel="prefetch" href="/assets/41.html.26cbc3d4.js"><link rel="prefetch" href="/assets/42.html.1c6bd5a3.js"><link rel="prefetch" href="/assets/43.html.209265e8.js"><link rel="prefetch" href="/assets/44.html.c94cf430.js"><link rel="prefetch" href="/assets/45.html.3052721e.js"><link rel="prefetch" href="/assets/46.html.b9c19857.js"><link rel="prefetch" href="/assets/47.html.735be1f1.js"><link rel="prefetch" href="/assets/48.html.7279cb81.js"><link rel="prefetch" href="/assets/49.html.bb74c9b7.js"><link rel="prefetch" href="/assets/5.html.af52fd80.js"><link rel="prefetch" href="/assets/50.html.3c11c079.js"><link rel="prefetch" href="/assets/6.html.a8fe399f.js"><link rel="prefetch" href="/assets/7.html.65306ec3.js"><link rel="prefetch" href="/assets/8.html.b8cfae69.js"><link rel="prefetch" href="/assets/9.html.16048595.js"><link rel="prefetch" href="/assets/k8s_011.html.7be2148e.js"><link rel="prefetch" href="/assets/k8s_012.html.2d073fcf.js"><link rel="prefetch" href="/assets/k8s_013.html.9ce0e665.js"><link rel="prefetch" href="/assets/k8s_014.html.96833daf.js"><link rel="prefetch" href="/assets/k8s_015.html.7853b5ae.js"><link rel="prefetch" href="/assets/k8s_016.html.47ad85ff.js"><link rel="prefetch" href="/assets/k8s_017.html.c0545c72.js"><link rel="prefetch" href="/assets/k8s_018.html.6432d80f.js"><link rel="prefetch" href="/assets/k8s_019.html.d3216668.js"><link rel="prefetch" href="/assets/k8s_020.html.5bd137cf.js"><link rel="prefetch" href="/assets/k8s_021.html.29f69d1f.js"><link rel="prefetch" href="/assets/k8s_022.html.905e7640.js"><link rel="prefetch" href="/assets/k8s_023.html.08c0039f.js"><link rel="prefetch" href="/assets/k8s_024.html.882c5de0.js"><link rel="prefetch" href="/assets/k8s_025.html.7b268a0a.js"><link rel="prefetch" href="/assets/k8s_026.html.b611b2c1.js"><link rel="prefetch" href="/assets/k8s_027.html.036a3496.js"><link rel="prefetch" href="/assets/k8s_028.html.a13855d4.js"><link rel="prefetch" href="/assets/k8s_029.html.e2404d91.js"><link rel="prefetch" href="/assets/k8s_030.html.79829405.js"><link rel="prefetch" href="/assets/README (copy).html.5339b027.js"><link rel="prefetch" href="/assets/index.html.a06bf9dd.js"><link rel="prefetch" href="/assets/404.html.3362fc8c.js">
    <link rel="stylesheet" href="/assets/style.57cbcbfb.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="åˆ‡æ¢ä¾§è¾¹æ " aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">ä½ å¥½</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤µå…³äºæˆ‘"><span class="title">ğŸ¤µå…³äºæˆ‘</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤µå…³äºæˆ‘"><span class="title">ğŸ¤µå…³äºæˆ‘</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" target="_self" aria-label="Githubä»“åº“"><!--[--><!--]--> Githubä»“åº“ <!----><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" target="_self" aria-label="æˆ‘çš„åšå®¢"><!--[--><!--]--> æˆ‘çš„åšå®¢ <!----><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="çŸ¥ä¹"><!--[--><!--]--> çŸ¥ä¹ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="â›“ï¸é“¾å­¦ç¤¾ç»„ç»‡"><!--[--><!--]--> â›“ï¸é“¾å­¦ç¤¾ç»„ç»‡ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="ğŸ é¦–é¡µ"><!--[--><!--]--> ğŸ é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://go.nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="ğŸ“šGoè¯­è¨€å­¦ä¹ "><!--[--><!--]--> ğŸ“šGoè¯­è¨€å­¦ä¹  <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/Cloud-Native-k8s/" class="router-link-active" aria-label="âš¡ k8så­¦ä¹ ç¯‡"><!--[--><!--]--> âš¡ k8så­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/markdown/" class="" aria-label="âš¡ dockerå­¦ä¹ ç¯‡"><!--[--><!--]--> âš¡ dockerå­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Cloud-Native/" class="" aria-label="ğŸ„â€â™‚ï¸ äº‘åŸç”Ÿå­¦ä¹ ç¯‡"><!--[--><!--]--> ğŸ„â€â™‚ï¸ äº‘åŸç”Ÿå­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-docker" rel="noopener noreferrer" target="_blank" aria-label="æŸ¥çœ‹æºç "><!--[--><!--]--> æŸ¥çœ‹æºç  <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="åˆ‡æ¢é¢œè‰²æ¨¡å¼"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><div id="docsearch-container"></div></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="ğŸ¤µå…³äºæˆ‘"><span class="title">ğŸ¤µå…³äºæˆ‘</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="ğŸ¤µå…³äºæˆ‘"><span class="title">ğŸ¤µå…³äºæˆ‘</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/3293172751/cs-awesome-Block_Chain" target="_self" aria-label="Githubä»“åº“"><!--[--><!--]--> Githubä»“åº“ <!----><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="http://nsddd.top" target="_self" aria-label="æˆ‘çš„åšå®¢"><!--[--><!--]--> æˆ‘çš„åšå®¢ <!----><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://www.zhihu.com/people/3293172751" rel="noopener noreferrer" target="_blank" aria-label="çŸ¥ä¹"><!--[--><!--]--> çŸ¥ä¹ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com/C-UB/" rel="noopener noreferrer" target="_blank" aria-label="â›“ï¸é“¾å­¦ç¤¾ç»„ç»‡"><!--[--><!--]--> â›“ï¸é“¾å­¦ç¤¾ç»„ç»‡ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/" class="" aria-label="ğŸ é¦–é¡µ"><!--[--><!--]--> ğŸ é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://go.nsddd.top" rel="noopener noreferrer" target="_blank" aria-label="ğŸ“šGoè¯­è¨€å­¦ä¹ "><!--[--><!--]--> ğŸ“šGoè¯­è¨€å­¦ä¹  <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a href="/Cloud-Native-k8s/" class="router-link-active" aria-label="âš¡ k8så­¦ä¹ ç¯‡"><!--[--><!--]--> âš¡ k8så­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/markdown/" class="" aria-label="âš¡ dockerå­¦ä¹ ç¯‡"><!--[--><!--]--> âš¡ dockerå­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/Cloud-Native/" class="" aria-label="ğŸ„â€â™‚ï¸ äº‘åŸç”Ÿå­¦ä¹ ç¯‡"><!--[--><!--]--> ğŸ„â€â™‚ï¸ äº‘åŸç”Ÿå­¦ä¹ ç¯‡ <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/3293172751/awesome-docker" rel="noopener noreferrer" target="_blank" aria-label="æŸ¥çœ‹æºç "><!--[--><!--]--> æŸ¥çœ‹æºç  <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="ğŸ å›åˆ°ä¸»é¡µ"><!--[--><!--]--> ğŸ å›åˆ°ä¸»é¡µ <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item sidebar-heading" href="https://xxw.nsddd.top/s/wRSz" rel="noopener noreferrer" target="_blank" aria-label="ğŸ’±ä¸ªäººäº‘ç›˜åœ°å€"><!--[--><!--]--> ğŸ’±ä¸ªäººäº‘ç›˜åœ°å€ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">âš¡ k8säº‘åŸç”Ÿå­¦ä¹ ç¯‡ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/Cloud-Native-k8s/1.html" class="sidebar-item" aria-label="ç¬¬1èŠ‚ äº‘å¹³å°"><!--[--><!--]--> ç¬¬1èŠ‚ äº‘å¹³å° <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/2.html" class="sidebar-item" aria-label="ç¬¬2èŠ‚ dockerå®ç”¨æ“ä½œ"><!--[--><!--]--> ç¬¬2èŠ‚ dockerå®ç”¨æ“ä½œ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/3.html" class="sidebar-item" aria-label="ç¬¬3èŠ‚ dockerä¸‰é©¾é©¬è½¦"><!--[--><!--]--> ç¬¬3èŠ‚ dockerä¸‰é©¾é©¬è½¦ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/4.html" class="sidebar-item" aria-label="ç¬¬4èŠ‚ kubernetes(k8s)æ•™ç¨‹"><!--[--><!--]--> ç¬¬4èŠ‚ kubernetes(k8s)æ•™ç¨‹ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/5.html" class="sidebar-item" aria-label="ç¬¬5èŠ‚ é›†ç¾¤æ­å»º"><!--[--><!--]--> ç¬¬5èŠ‚ é›†ç¾¤æ­å»º <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/6.html" class="sidebar-item" aria-label="ç¬¬6èŠ‚ sealosæ­å»ºk8s"><!--[--><!--]--> ç¬¬6èŠ‚ sealosæ­å»ºk8s <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/7.html" class="sidebar-item" aria-label="ç¬¬7èŠ‚ k8såœ¨çº¿å®éªŒå­¦ä¹ å¹³å°"><!--[--><!--]--> ç¬¬7èŠ‚ k8såœ¨çº¿å®éªŒå­¦ä¹ å¹³å° <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/8.html" class="sidebar-item" aria-label="ç¬¬8èŠ‚ å›¾å½¢ç•Œé¢å’Œå‘½åç©ºé—´"><!--[--><!--]--> ç¬¬8èŠ‚ å›¾å½¢ç•Œé¢å’Œå‘½åç©ºé—´ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/9.html" class="sidebar-item" aria-label="ç¬¬9èŠ‚ Pod"><!--[--><!--]--> ç¬¬9èŠ‚ Pod <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/10.html" class="sidebar-item" aria-label="ç¬¬10èŠ‚ Deployment"><!--[--><!--]--> ç¬¬10èŠ‚ Deployment <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/11.html" class="sidebar-item" aria-label="ç¬¬11èŠ‚ service"><!--[--><!--]--> ç¬¬11èŠ‚ service <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/12.html" class="sidebar-item" aria-label="ç¬¬12èŠ‚ Ingress"><!--[--><!--]--> ç¬¬12èŠ‚ Ingress <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/13.html" class="sidebar-item" aria-label="ç¬¬13èŠ‚ å­˜å‚¨æŠ½è±¡"><!--[--><!--]--> ç¬¬13èŠ‚ å­˜å‚¨æŠ½è±¡ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/14.html" class="sidebar-item" aria-label="ç¬¬14èŠ‚ k3s"><!--[--><!--]--> ç¬¬14èŠ‚ k3s <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/15.html" class="sidebar-item" aria-label="ç¬¬15èŠ‚ k3s è¡¥å……"><!--[--><!--]--> ç¬¬15èŠ‚ k3s è¡¥å…… <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/16.html" class="sidebar-item" aria-label="Treafik LB"><!--[--><!--]--> Treafik LB <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/17.html" class="sidebar-item" aria-label="ç¬¬17èŠ‚ Service LB"><!--[--><!--]--> ç¬¬17èŠ‚ Service LB <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/18.html" class="sidebar-item" aria-label="ç¬¬18èŠ‚kubernetes API è®¿é—®æ§åˆ¶"><!--[--><!--]--> ç¬¬18èŠ‚kubernetes API è®¿é—®æ§åˆ¶ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/19.html" class="sidebar-item" aria-label="ç¬¬19èŠ‚  StatefulSet"><!--[--><!--]--> ç¬¬19èŠ‚  StatefulSet <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/20.html" class="sidebar-item" aria-label="ç¬¬19èŠ‚  StatefulSet"><!--[--><!--]--> ç¬¬19èŠ‚  StatefulSet <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/21.html" class="sidebar-item" aria-label="ç¬¬21èŠ‚ Minikube å’Œ Kind"><!--[--><!--]--> ç¬¬21èŠ‚ Minikube å’Œ Kind <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/22.html" class="sidebar-item" aria-label="ç¬¬22èŠ‚ è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨"><!--[--><!--]--> ç¬¬22èŠ‚ è¿è¡Œæœ‰çŠ¶æ€åº”ç”¨ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/23.html" class="sidebar-item" aria-label="ç¬¬23èŠ‚ Kubeconfig &amp;&amp; token"><!--[--><!--]--> ç¬¬23èŠ‚ Kubeconfig &amp;&amp; token <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/24.html" class="sidebar-item" aria-label="ç¬¬24èŠ‚ ETCD"><!--[--><!--]--> ç¬¬24èŠ‚ ETCD <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/25.html" class="sidebar-item" aria-label="ç¬¬25èŠ‚ raft ç®—æ³•"><!--[--><!--]--> ç¬¬25èŠ‚ raft ç®—æ³• <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/26.html" class="sidebar-item" aria-label="ç¬¬26èŠ‚ helm æ•™ç¨‹"><!--[--><!--]--> ç¬¬26èŠ‚ helm æ•™ç¨‹ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/27.html" class="sidebar-item" aria-label="ç¬¬27èŠ‚ k3s è¡¥å……ï¼ˆé«˜çº§ï¼‰"><!--[--><!--]--> ç¬¬27èŠ‚ k3s è¡¥å……ï¼ˆé«˜çº§ï¼‰ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/28.html" class="sidebar-item" aria-label="ç¬¬28èŠ‚ Linuxç³»ç»Ÿç§»æ¤ï¼Œåˆ†åŒºï¼Œrootfs"><!--[--><!--]--> ç¬¬28èŠ‚ Linuxç³»ç»Ÿç§»æ¤ï¼Œåˆ†åŒºï¼Œrootfs <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/29.html" class="sidebar-item" aria-label="ç¬¬29èŠ‚ CloudNative / Kubernetes å­¦ä¹ èµ„æºæ•´ç†"><!--[--><!--]--> ç¬¬29èŠ‚ CloudNative / Kubernetes å­¦ä¹ èµ„æºæ•´ç† <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/30.html" class="sidebar-item" aria-label="ç¬¬30èŠ‚ K8s å¼€å‘ç¯å¢ƒæ­å»º"><!--[--><!--]--> ç¬¬30èŠ‚ K8s å¼€å‘ç¯å¢ƒæ­å»º <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/31.html" class="sidebar-item" aria-label="ç¬¬31èŠ‚ kubernetes çš„ç¼–è¯‘å’Œè°ƒè¯•"><!--[--><!--]--> ç¬¬31èŠ‚ kubernetes çš„ç¼–è¯‘å’Œè°ƒè¯• <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/32.html" class="sidebar-item" aria-label="ç¬¬32èŠ‚ kubernetes ç›®å½•ç»“æ„"><!--[--><!--]--> ç¬¬32èŠ‚ kubernetes ç›®å½•ç»“æ„ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/33.html" class="sidebar-item" aria-label="ç¬¬33èŠ‚ Postmanè¯·æ±‚Server"><!--[--><!--]--> ç¬¬33èŠ‚ Postmanè¯·æ±‚Server <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/34.html" class="sidebar-item" aria-label="ç¬¬34èŠ‚ API Server"><!--[--><!--]--> ç¬¬34èŠ‚ API Server <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/35.html" class="sidebar-item" aria-label="ç¬¬35èŠ‚ client-go å†™ k8s æ§åˆ¶å™¨"><!--[--><!--]--> ç¬¬35èŠ‚ client-go å†™ k8s æ§åˆ¶å™¨ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/36.html" class="sidebar-item" aria-label="ç¬¬ 36 èŠ‚ ä¸€äº›ç–‘é—®"><!--[--><!--]--> ç¬¬ 36 èŠ‚ ä¸€äº›ç–‘é—® <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/37.html" class="sidebar-item" aria-label="ç¬¬ 37 èŠ‚ ä¸€äº›ç–‘é—®å’Œè§£ç­” 2"><!--[--><!--]--> ç¬¬ 37 èŠ‚ ä¸€äº›ç–‘é—®å’Œè§£ç­” 2 <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/38.html" class="sidebar-item" aria-label="ç¬¬38èŠ‚ ä¸€äº›ç–‘é—®å’Œè§£ç­”3"><!--[--><!--]--> ç¬¬38èŠ‚ ä¸€äº›ç–‘é—®å’Œè§£ç­”3 <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/39.html" class="sidebar-item" aria-label="ç¬¬ 39 èŠ‚ å…³äº Kubernetes çš„ä¸€äº›ç–‘é—® 4"><!--[--><!--]--> ç¬¬ 39 èŠ‚ å…³äº Kubernetes çš„ä¸€äº›ç–‘é—® 4 <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/40.html" class="sidebar-item" aria-label="ç¬¬40èŠ‚ Istio"><!--[--><!--]--> ç¬¬40èŠ‚ Istio <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/41.html" class="sidebar-item" aria-label="ç¬¬41èŠ‚ ä»£ç ç”Ÿæˆ"><!--[--><!--]--> ç¬¬41èŠ‚ ä»£ç ç”Ÿæˆ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/42.html" class="sidebar-item" aria-label="ç¬¬ 42 èŠ‚ Kubernetes çš„å¤šç§Ÿæˆ·"><!--[--><!--]--> ç¬¬ 42 èŠ‚ Kubernetes çš„å¤šç§Ÿæˆ· <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/43.html" class="sidebar-item" aria-label="ç¬¬43èŠ‚ kubernetes çš„è´¡çŒ®å­¦ä¹ "><!--[--><!--]--> ç¬¬43èŠ‚ kubernetes çš„è´¡çŒ®å­¦ä¹  <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/44.html" class="sidebar-item" aria-label="ç¬¬44èŠ‚ kubernetes èµ„æºå†…éƒ¨ç‰ˆæœ¬å’Œå¤–éƒ¨ç‰ˆæœ¬"><!--[--><!--]--> ç¬¬44èŠ‚ kubernetes èµ„æºå†…éƒ¨ç‰ˆæœ¬å’Œå¤–éƒ¨ç‰ˆæœ¬ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/45.html" class="sidebar-item" aria-label="ç¬¬45èŠ‚ namespace é€šä¿¡é—®é¢˜"><!--[--><!--]--> ç¬¬45èŠ‚ namespace é€šä¿¡é—®é¢˜ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/46.html" class="sidebar-item" aria-label="ç¬¬46èŠ‚ æ·±æŒ–å®¹å™¨åº•å±‚æŠ€æœ¯"><!--[--><!--]--> ç¬¬46èŠ‚ æ·±æŒ–å®¹å™¨åº•å±‚æŠ€æœ¯ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/47.html" class="sidebar-item" aria-label="ç¬¬47èŠ‚ Kubernetes æ¦‚å¿µä»¥åŠæ¶æ„"><!--[--><!--]--> ç¬¬47èŠ‚ Kubernetes æ¦‚å¿µä»¥åŠæ¶æ„ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/48.html" class="sidebar-item" aria-label="ç¬¬48èŠ‚ æ·±å…¥ç†è§£Kubernetesæ§åˆ¶å¹³é¢ç»„ä»¶ï¼šETCD"><!--[--><!--]--> ç¬¬48èŠ‚ æ·±å…¥ç†è§£Kubernetesæ§åˆ¶å¹³é¢ç»„ä»¶ï¼šETCD <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/49.html" class="sidebar-item" aria-label="ç¬¬49èŠ‚ æ·±å…¥ç†è§£ Kube-APIServer"><!--[--><!--]--> ç¬¬49èŠ‚ æ·±å…¥ç†è§£ Kube-APIServer <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/50.html" class="sidebar-item" aria-label="ç¬¬50èŠ‚ Kubernetes æ§åˆ¶å¹³é¢ï¼šè°ƒåº¦å™¨"><!--[--><!--]--> ç¬¬50èŠ‚ Kubernetes æ§åˆ¶å¹³é¢ï¼šè°ƒåº¦å™¨ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/51.html" class="sidebar-item" aria-label="ç¬¬51èŠ‚  Controller Manager"><!--[--><!--]--> ç¬¬51èŠ‚  Controller Manager <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/52.html" class="sidebar-item" aria-label="ç¬¬52èŠ‚ kubectl"><!--[--><!--]--> ç¬¬52èŠ‚ kubectl <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/53.html" class="sidebar-item" aria-label="ç¬¬53èŠ‚ CRIã€CNIã€CSI åº•å±‚åˆ¨æ"><!--[--><!--]--> ç¬¬53èŠ‚ CRIã€CNIã€CSI åº•å±‚åˆ¨æ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/54.html" class="sidebar-item" aria-label="ç¬¬54èŠ‚ Kubernetes ç”Ÿå‘½å‘¨æœŸç®¡ç†å’ŒæœåŠ¡å‘ç°"><!--[--><!--]--> ç¬¬54èŠ‚ Kubernetes ç”Ÿå‘½å‘¨æœŸç®¡ç†å’ŒæœåŠ¡å‘ç° <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/55.html" class="sidebar-item" aria-label="ç¬¬55èŠ‚ æœåŠ¡å‘ç°"><!--[--><!--]--> ç¬¬55èŠ‚ æœåŠ¡å‘ç° <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/56.html" class="sidebar-item" aria-label="ç¬¬56èŠ‚ service"><!--[--><!--]--> ç¬¬56èŠ‚ service <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/57.html" class="sidebar-item" aria-label="ç¬¬57èŠ‚ kube-proxy"><!--[--><!--]--> ç¬¬57èŠ‚ kube-proxy <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/58.html" class="sidebar-item" aria-label="ç¬¬58èŠ‚ Kubernetes ç½‘ç»œ"><!--[--><!--]--> ç¬¬58èŠ‚ Kubernetes ç½‘ç»œ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/59.html" class="sidebar-item" aria-label="ç¬¬59èŠ‚ CoreDNS å’Œ Ingress"><!--[--><!--]--> ç¬¬59èŠ‚ CoreDNS å’Œ Ingress <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/60.html" class="sidebar-item" aria-label="ç¬¬60èŠ‚ ç”Ÿäº§åŒ–é›†ç¾¤çš„ç®¡ç†"><!--[--><!--]--> ç¬¬60èŠ‚ ç”Ÿäº§åŒ–é›†ç¾¤çš„ç®¡ç† <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/61.html" class="sidebar-item" aria-label="ç¬¬61èŠ‚ èŠ‚ç‚¹èµ„æºç®¡ç†ã€å¼‚å¸¸æ£€æµ‹ä»¥åŠå¸¸è§é—®é¢˜æ’æŸ¥"><!--[--><!--]--> ç¬¬61èŠ‚ èŠ‚ç‚¹èµ„æºç®¡ç†ã€å¼‚å¸¸æ£€æµ‹ä»¥åŠå¸¸è§é—®é¢˜æ’æŸ¥ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/62.html" class="sidebar-item" aria-label="ç¬¬62èŠ‚ Istio é«˜çº§æµé‡ç®¡ç†"><!--[--><!--]--> ç¬¬62èŠ‚ Istio é«˜çº§æµé‡ç®¡ç† <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/63.html" class="sidebar-item" aria-label="ç¬¬63èŠ‚ Prometheus å’Œ Grafana æ—¥å¿—æ”¶é›†æ–¹æ¡ˆ"><!--[--><!--]--> ç¬¬63èŠ‚ Prometheus å’Œ Grafana æ—¥å¿—æ”¶é›†æ–¹æ¡ˆ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/64.html" class="sidebar-item" aria-label="ç¬¬64èŠ‚ kubeadmæ¦‚è¿°ã€åŸç†ã€ä»¥åŠéƒ¨åˆ†æºç é˜…è¯»"><!--[--><!--]--> ç¬¬64èŠ‚ kubeadmæ¦‚è¿°ã€åŸç†ã€ä»¥åŠéƒ¨åˆ†æºç é˜…è¯» <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/65.html" class="sidebar-item" aria-label="ç¬¬65èŠ‚ eBPF åˆ¨æä»¥åŠæºç å­¦ä¹ "><!--[--><!--]--> ç¬¬65èŠ‚ eBPF åˆ¨æä»¥åŠæºç å­¦ä¹  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="ç¬¬66èŠ‚ CRD"><!--[--><!--]--> ç¬¬66èŠ‚ CRD <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#å‰è¨€" class="router-link-active router-link-exact-active sidebar-item" aria-label="å‰è¨€"><!--[--><!--]--> å‰è¨€ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#installation-kubebuilder" class="router-link-active router-link-exact-active sidebar-item" aria-label="installation kubebuilder"><!--[--><!--]--> installation kubebuilder <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#create-a-project" class="router-link-active router-link-exact-active sidebar-item" aria-label="create a project"><!--[--><!--]--> create a project <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#create-an-api" class="router-link-active router-link-exact-active sidebar-item" aria-label="create an API"><!--[--><!--]--> create an API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#cr-éƒ¨ç½²" class="router-link-active router-link-exact-active sidebar-item" aria-label="CR éƒ¨ç½²"><!--[--><!--]--> CR éƒ¨ç½² <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#guestbook-ç”Ÿæˆçš„ä»£ç å’Œç»“æ„" class="router-link-active router-link-exact-active sidebar-item" aria-label="guestbook ç”Ÿæˆçš„ä»£ç å’Œç»“æ„"><!--[--><!--]--> guestbook ç”Ÿæˆçš„ä»£ç å’Œç»“æ„ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#groups-versions-kinds-and-resources" class="router-link-active router-link-exact-active sidebar-item" aria-label="groups, versions, kinds, and resources"><!--[--><!--]--> groups, versions, kinds, and resources <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#controller" class="router-link-active router-link-exact-active sidebar-item" aria-label="controller"><!--[--><!--]--> controller <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#client-go" class="router-link-active router-link-exact-active sidebar-item" aria-label="Client-go"><!--[--><!--]--> Client-go <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#sample-controller" class="router-link-active router-link-exact-active sidebar-item" aria-label="sample-controller"><!--[--><!--]--> sample-controller <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Cloud-Native-k8s/66.html#end-é“¾æ¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="END é“¾æ¥"><!--[--><!--]--> END é“¾æ¥ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/Cloud-Native-k8s/67.html" class="sidebar-item" aria-label="ç¬¬67èŠ‚"><!--[--><!--]--> ç¬¬67èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/68.html" class="sidebar-item" aria-label="ç¬¬68èŠ‚"><!--[--><!--]--> ç¬¬68èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/69.html" class="sidebar-item" aria-label="ç¬¬69èŠ‚"><!--[--><!--]--> ç¬¬69èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/70.html" class="sidebar-item" aria-label="ç¬¬70èŠ‚"><!--[--><!--]--> ç¬¬70èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/71.html" class="sidebar-item" aria-label="ç¬¬71èŠ‚"><!--[--><!--]--> ç¬¬71èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/72.html" class="sidebar-item" aria-label="ç¬¬72èŠ‚"><!--[--><!--]--> ç¬¬72èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/73.html" class="sidebar-item" aria-label="ç¬¬73èŠ‚"><!--[--><!--]--> ç¬¬73èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/74.html" class="sidebar-item" aria-label="ç¬¬74èŠ‚"><!--[--><!--]--> ç¬¬74èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/75.html" class="sidebar-item" aria-label="ç¬¬75èŠ‚"><!--[--><!--]--> ç¬¬75èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/76.html" class="sidebar-item" aria-label="ç¬¬76èŠ‚"><!--[--><!--]--> ç¬¬76èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/77.html" class="sidebar-item" aria-label="ç¬¬77èŠ‚"><!--[--><!--]--> ç¬¬77èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/78.html" class="sidebar-item" aria-label="ç¬¬78èŠ‚"><!--[--><!--]--> ç¬¬78èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/79.html" class="sidebar-item" aria-label="ç¬¬79èŠ‚"><!--[--><!--]--> ç¬¬79èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/80.html" class="sidebar-item" aria-label="ç¬¬80èŠ‚"><!--[--><!--]--> ç¬¬80èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/81.html" class="sidebar-item" aria-label="ç¬¬81èŠ‚"><!--[--><!--]--> ç¬¬81èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/82.html" class="sidebar-item" aria-label="ç¬¬82èŠ‚"><!--[--><!--]--> ç¬¬82èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/83.html" class="sidebar-item" aria-label="ç¬¬83èŠ‚"><!--[--><!--]--> ç¬¬83èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/84.html" class="sidebar-item" aria-label="ç¬¬84èŠ‚"><!--[--><!--]--> ç¬¬84èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/85.html" class="sidebar-item" aria-label="ç¬¬85èŠ‚"><!--[--><!--]--> ç¬¬85èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/86.html" class="sidebar-item" aria-label="ç¬¬86èŠ‚"><!--[--><!--]--> ç¬¬86èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/87.html" class="sidebar-item" aria-label="ç¬¬87èŠ‚"><!--[--><!--]--> ç¬¬87èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/88.html" class="sidebar-item" aria-label="ç¬¬88èŠ‚"><!--[--><!--]--> ç¬¬88èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/89.html" class="sidebar-item" aria-label="ç¬¬89èŠ‚"><!--[--><!--]--> ç¬¬89èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/90.html" class="sidebar-item" aria-label="ç¬¬90èŠ‚"><!--[--><!--]--> ç¬¬90èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/91.html" class="sidebar-item" aria-label="ç¬¬91èŠ‚"><!--[--><!--]--> ç¬¬91èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/92.html" class="sidebar-item" aria-label="ç¬¬92èŠ‚"><!--[--><!--]--> ç¬¬92èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/93.html" class="sidebar-item" aria-label="ç¬¬93èŠ‚"><!--[--><!--]--> ç¬¬93èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/94.html" class="sidebar-item" aria-label="ç¬¬94èŠ‚"><!--[--><!--]--> ç¬¬94èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/95.html" class="sidebar-item" aria-label="ç¬¬95èŠ‚"><!--[--><!--]--> ç¬¬95èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/96.html" class="sidebar-item" aria-label="ç¬¬96èŠ‚"><!--[--><!--]--> ç¬¬96èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/97.html" class="sidebar-item" aria-label="ç¬¬97èŠ‚"><!--[--><!--]--> ç¬¬97èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/98.html" class="sidebar-item" aria-label="ç¬¬98èŠ‚"><!--[--><!--]--> ç¬¬98èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/99.html" class="sidebar-item" aria-label="ç¬¬99èŠ‚"><!--[--><!--]--> ç¬¬99èŠ‚ <!--[--><!--]--></a><!----></li><li><a href="/Cloud-Native-k8s/100.md" class="sidebar-item" aria-label="100.md"><!--[--><!--]--> 100.md <!--[--><!--]--></a><!----></li><li><a class="external-link sidebar-item" href="https://nsddd.top/archives/contributors" rel="noopener noreferrer" target="_blank" aria-label="ğŸ’å¦‚ä½•å‚ä¸è´¡çŒ®ï¼Ÿ"><!--[--><!--]--> ğŸ’å¦‚ä½•å‚ä¸è´¡çŒ®ï¼Ÿ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><ul><li><a href="http://nsddd.top" target="_blank" rel="noopener noreferrer">author<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h1 id="ç¬¬66èŠ‚-crd" tabindex="-1"><a class="header-anchor" href="#ç¬¬66èŠ‚-crd" aria-hidden="true">#</a> ç¬¬66èŠ‚ CRD</h1><div><a href="65.md" style="float:left;">â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”— </a><a href="67.md" style="float:right;"> â¬‡ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div><br><blockquote><p>â¤ï¸ğŸ’•ğŸ’•æ–°æ—¶ä»£æ‹¥æŠ±äº‘åŸç”Ÿï¼Œäº‘åŸç”Ÿå…·æœ‰ç¯å¢ƒç»Ÿä¸€ã€æŒ‰éœ€ä»˜è´¹ã€å³å¼€å³ç”¨ã€ç¨³å®šæ€§å¼ºç‰¹ç‚¹ã€‚Myblog:<a href="http://nsddd.top/" target="_blank" rel="noopener noreferrer">http://nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><hr><p>[TOC]</p><h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2><p>sealos ä½¿ç”¨äº†å¤§é‡çš„ CRD å¯¹å…¶æ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CRD æ¥ Kubernetes</p><ul><li><a href="https://github.com/kubernetes-sigs/kubebuilder" target="_blank" rel="noopener noreferrer">kubebuilder<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://book.kubebuilder.io/" target="_blank" rel="noopener noreferrer">å®˜æ–¹å­¦ä¹ æ–‡æ¡£<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿™é‡Œæœ‰ä¸€ä»½å®˜æ–¹ CRD <a href="https://github.com/kubernetes/sample-controller" target="_blank" rel="noopener noreferrer">æ¡ˆä¾‹ ~<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>CRDæ˜¯Kubernetesä¸ºæé«˜å¯æ‰©å±•æ€§ï¼Œè®©å¼€å‘è€…å»è‡ªå®šä¹‰èµ„æºï¼ˆå¦‚Deploymentï¼ŒStatefulSetç­‰ï¼‰çš„ä¸€ç§æ–¹æ³•ã€‚</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Operator=CRD+Controller
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>CRDä»…ä»…æ˜¯èµ„æºçš„å®šä¹‰ï¼Œè€ŒControllerå¯ä»¥å»ç›‘å¬CRDçš„CRUDäº‹ä»¶æ¥æ·»åŠ è‡ªå®šä¹‰ä¸šåŠ¡é€»è¾‘ã€‚</p><p>å¦‚æœè¯´åªæ˜¯å¯¹CRDå®ä¾‹è¿›è¡Œ <code>CRUD</code> çš„è¯ï¼Œä¸éœ€è¦ <code>Controller</code> ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œåªæ˜¯åªæœ‰æ•°æ®ï¼Œæ²¡æœ‰é’ˆå¯¹æ•°æ®çš„æ“ä½œã€‚</p><h3 id="é¡¹ç›®-demo" tabindex="-1"><a class="header-anchor" href="#é¡¹ç›®-demo" aria-hidden="true">#</a> é¡¹ç›® demo</h3><p>reviewï¼š<a href="https://github.com/muzi502" target="_blank" rel="noopener noreferrer">@muzi502<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>author: <a href="https://github.com/cubxxw" target="_blank" rel="noopener noreferrer">@cubxxw<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>è¿™ç¯‡æ–‡ç« å°†å‚è€ƒå„ä¸ªåšå®¢å’Œ kubebuilder å®˜æ–¹æ–‡æ¡£ ä»¥åŠ <a href="https://github.com/kubernetes/sample-controller" target="_blank" rel="noopener noreferrer">kubernetes/sample-controller<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¿›è¡Œå­¦ä¹ ï¼Œæœ€åå®è·µä¸€ä¸ªé¡¹ç›®çš„æ­¥éª¤ï¼Œå¯¹é™æ€åšå®¢ï¼ˆ<a href="https://docker.nsddd.top/" target="_blank" rel="noopener noreferrer">docker.nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æˆ–è€… <a href="https://go.nsddd.top/" target="_blank" rel="noopener noreferrer">go.nsddd.top<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>) è¿›è¡Œ CRDï¼Œå½¢æˆå­¦ä¹ é—­ç¯~</p><ol><li>åˆ›å»ºè‡ªå®šä¹‰APIå¯¹è±¡ï¼ˆCustom Resource Definitionï¼‰ï¼Œåä¸ºBlogï¼›</li><li>ç”¨ä»£ç ç”Ÿæˆå·¥å…·ç”Ÿæˆinformerå’Œclientç›¸å…³ä»£ç ï¼›</li><li>åˆ›å»ºå¹¶è¿è¡Œè‡ªå®šä¹‰æ§åˆ¶å™¨ï¼Œk8sç¯å¢ƒä¸­æ‰€æœ‰ Blog ç›¸å…³çš„&quot;å¢ã€åˆ ã€æ”¹&quot;æ“ä½œéƒ½ä¼šè¢«æ­¤æ§åˆ¶å™¨ç›‘å¬åˆ°ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚åœ¨æ§åˆ¶å™¨ä¸­ç¼–å†™ä¸šåŠ¡ä»£ç ï¼›</li></ol></blockquote><h3 id="operator-åŠŸèƒ½è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#operator-åŠŸèƒ½è®¾è®¡" aria-hidden="true">#</a> Operator åŠŸèƒ½è®¾è®¡</h3><p>å€ŸåŠ© Operator å®Œæˆå’Œä¼ä¸šå†…éƒ¨æ³¨å†Œä¸­å¿ƒçš„æ‰“é€š</p><p><strong>Operator å¼€å‘ SDK æœ‰ 2 ä¸ªé€‰æ‹©ï¼š</strong></p><ul><li>kubebuilder</li><li>operator sdk</li></ul><p>æ³¨æ„ï¼šåœ¨æœ¬è´¨ä¸Šå…¶å®éƒ½æ˜¯åœ¨ K8s æ§åˆ¶å™¨è¿è¡Œæ—¶ä¸Šçš„å°è£…ï¼Œä¸»è¦éƒ½æ˜¯è„šæ‰‹æ¶çš„ç”Ÿæˆï¼Œä½¿ç”¨ä½“éªŒç›¸å·®ä¸å¤§ã€‚</p><p>ä½†æ˜¯æœ‰æ„æ€çš„æ˜¯ï¼ŒKubebuilder çš„ç»´æŠ¤æ–¹æ˜¯ï¼škubernetes-sigsï¼Œæ‰€ä»¥æ›´å—äººå…³æ³¨ã€‚</p><p>åº•å±‚éƒ½æ˜¯åŸºäº k8s æ§åˆ¶å™¨è¿è¡Œæ—¶å°è£…ï¼Œä¸åŒçš„æ˜¯ kubebuilder æ—©æœŸåŒ…å« CRDå’Œ è‡ªå®šä¹‰ Controller å¼€å‘ã€‚ä½†æ˜¯ operator-sdk æ—©æœŸä¸åŒ…å« CRD å¼€å‘ï¼Œä½†æ˜¯ç°åœ¨ä¹Ÿæ˜¯èåˆäº†ã€‚</p><p><strong>CRD å…è®¸ä½ å®šä¹‰è‡ªå·±çš„ Kubernetes API å¯¹è±¡ï¼Œè€Œè‡ªå®šä¹‰æ§åˆ¶å™¨å¯ä»¥ç›‘å¬è¿™äº›å¯¹è±¡çš„äº‹ä»¶å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</strong></p><h3 id="kubebuilder-æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#kubebuilder-æ¶æ„å›¾" aria-hidden="true">#</a> kubebuilder æ¶æ„å›¾</h3><p><strong>å›¾ç‰‡æ¥è‡ªå®˜ç½‘ç«™ï¼š</strong></p><p><img src="http://sm.nsddd.top/sm202304081027380.png" alt="image-20230408102740099"></p><h2 id="installation-kubebuilder" tabindex="-1"><a class="header-anchor" href="#installation-kubebuilder" aria-hidden="true">#</a> installation kubebuilder</h2><p>å®‰è£…kubebuilderï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-o</span> kubebuilder https://go.kubebuilder.io/dl/latest/<span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOOS<span class="token variable">)</span></span>/<span class="token variable"><span class="token variable">$(</span>go <span class="token function">env</span> GOARCH<span class="token variable">)</span></span>

â¯ <span class="token function">chmod</span> +x kubebuilder <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> kubebuilder /usr/local/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ–è€…ï¼Œä½¿ç”¨ <code>make build</code> ï¼Œ è¿™æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„ä¸€ç§æ–¹å¼ï¼Œæ–¹ä¾¿è´¡çŒ®å’Œé˜…è¯»æºç ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBEBUILDER</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/kubebuilder
â¯ <span class="token function">git</span> clone https://github.com/kubernetes-sigs/kubebuilder.git <span class="token variable">$KUBEBUILDER</span>  <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$KUBEBUILDER</span><span class="token punctuation">;</span> <span class="token function">make</span> build <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> bin<span class="token punctuation">;</span> ./kubebuilder<span class="token punctuation">;</span> 
â¯ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$KUBEBUILDER</span>/bin<span class="token punctuation">;</span> kubebuilder
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="create-a-project" tabindex="-1"><a class="header-anchor" href="#create-a-project" aria-hidden="true">#</a> create a project</h2><p>å¾ˆç®€å•çš„è¡Œä¸ºï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¹¶ä¸”ä½¿ç”¨ å‘½ä»¤ åˆå§‹åŒ–å°±å¤Ÿäº†ï¼Œåœ¨åº•å±‚ä¸Š kubebuilder å¹¶ä¸å¸Œæœ›æˆ‘ä»¬çŸ¥é“å®ç°çš„ç»†èŠ‚~</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">mkdir</span> /tmp/guestbook -p<span class="token punctuation">;</span> <span class="token builtin class-name">cd</span> /tmp/guestbook
â¯ kubebuilder init <span class="token parameter variable">--domain</span> my.domain <span class="token parameter variable">--repo</span> my.domain/guestbook
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç›®å½•å°±æ˜¯å¾ˆç¥å¥‡äº†ï¼Œå°±åƒä»£ç ç”Ÿæˆå™¨ä¸€æ ·ç”Ÿæˆäº†ä¸€ä¸ªæ¨¡æ¿ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ tree <span class="token parameter variable">-L</span> <span class="token number">3</span>
<span class="token builtin class-name">.</span>
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Makefile
â”œâ”€â”€ PROJECT
â”œâ”€â”€ README.md
â”œâ”€â”€ cmd
â”‚   â””â”€â”€ main.go
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ default
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â”œâ”€â”€ manager_auth_proxy_patch.yaml
â”‚   â”‚   â””â”€â”€ manager_config_patch.yaml
â”‚   â”œâ”€â”€ manager
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ manager.yaml
â”‚   â”œâ”€â”€ prometheus
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ monitor.yaml
â”‚   â””â”€â”€ rbac
â”‚       â”œâ”€â”€ auth_proxy_client_clusterrole.yaml
â”‚       â”œâ”€â”€ auth_proxy_role.yaml
â”‚       â”œâ”€â”€ auth_proxy_role_binding.yaml
â”‚       â”œâ”€â”€ auth_proxy_service.yaml
â”‚       â”œâ”€â”€ kustomization.yaml
â”‚       â”œâ”€â”€ leader_election_role.yaml
â”‚       â”œâ”€â”€ leader_election_role_binding.yaml
â”‚       â”œâ”€â”€ role_binding.yaml
â”‚       â””â”€â”€ service_account.yaml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ hack
    â””â”€â”€ boilerplate.go.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œæˆ‘å€ŸåŠ©ã€ŠKubernetes operator å¼€å‘è¿›é˜¶ã€‹è¿™æœ¬ä¹¦ï¼ˆä½†ä¸æ¨èï¼‰éƒ¨åˆ†è§£é‡Šï¼š</p><ul><li><code>Dockerfile</code>: ç”¨äºæ„å»º Docker é•œåƒçš„æ–‡ä»¶ã€‚</li><li><code>Makefile</code>: ä¸€ä¸ª Makefileï¼Œå…¶ä¸­åŒ…å«äº†ç”¨äºæ„å»ºå’Œå‘å¸ƒ Operator çš„å¸¸ç”¨å‘½ä»¤ã€‚</li><li><code>PROJECT</code>: é¡¹ç›®åç§°ï¼Œä»¥åŠé¡¹ç›®ä¿¡æ¯ï¼Œè¿™é‡Œæ˜¯ä¸€äº› metadata ã€‚</li><li><code>README.md</code>: é¡¹ç›®çš„è¯´æ˜æ–‡æ¡£ã€‚</li><li><code>cmd/</code>: åŒ…å«äº† Operator çš„å…¥å£ç¨‹åº <code>main.go</code>ã€‚</li><li><code>config/</code>: åŒ…å«äº† Operator çš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ RBAC æƒé™ç›¸å…³çš„ YAML æ–‡ä»¶ã€Prometheus ç›‘æ§æœåŠ¡å‘ç°ï¼ˆServiceMonitorï¼‰ç›¸å…³çš„ Yaml æ–‡ä»¶ã€æ§åˆ¶å™¨ï¼ˆManagerï¼‰éƒ¨åˆ†éƒ¨ç½²çš„ Yaml æ–‡ä»¶ã€‚ <ul><li><code>default/</code>: åŒ…å«äº†é»˜è®¤çš„é…ç½®æ–‡ä»¶ã€‚ <ul><li><code>kustomization.yaml</code>: Kustomize é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†éœ€è¦åº”ç”¨çš„ k8s èµ„æºç±»å‹å’Œåç§°ã€‚</li><li><code>manager_auth_proxy_patch.yaml</code>: åœ¨ manager å®¹å™¨ä¸­æ·»åŠ äº† auth-proxy å®¹å™¨çš„ç›¸å…³ä¿¡æ¯ã€‚</li><li><code>manager_config_patch.yaml</code>: åœ¨ manager å®¹å™¨ä¸­æ·»åŠ äº†ä¸ Operator ç›¸å…³çš„é…ç½®ä¿¡æ¯ã€‚</li></ul></li><li><code>manager/</code>: åŒ…å«äº†éƒ¨ç½² Operator æ‰€éœ€çš„ k8s èµ„æºæ–‡ä»¶ã€‚ <ul><li><code>kustomization.yaml</code>: Kustomize é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†éœ€è¦åº”ç”¨çš„ k8s èµ„æºç±»å‹å’Œåç§°ã€‚</li><li><code>manager.yaml</code>: éƒ¨ç½² Operator æ‰€éœ€çš„ k8s èµ„æºæ–‡ä»¶ã€‚</li></ul></li><li><code>prometheus/</code>: åŒ…å«äº† Prometheus ç›‘æ§ Operator æ‰€éœ€çš„ k8s èµ„æºæ–‡ä»¶ã€‚ <ul><li><code>kustomization.yaml</code>: Kustomize é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†éœ€è¦åº”ç”¨çš„ k8s èµ„æºç±»å‹å’Œåç§°ã€‚</li><li><code>monitor.yaml</code>: éƒ¨ç½² Prometheus ç›‘æ§ Operator æ‰€éœ€çš„ k8s èµ„æºæ–‡ä»¶ã€‚</li></ul></li><li><code>rbac/</code>: åŒ…å«äº† Operator æ‰€éœ€çš„ RBAC èµ„æºæ–‡ä»¶ã€‚ <ul><li><code>auth_proxy_client_clusterrole.yaml</code>: é…ç½®äº†ä¸å®¢æˆ·ç«¯æˆæƒç›¸å…³çš„ ClusterRoleã€‚</li><li><code>auth_proxy_role.yaml</code>: é…ç½®äº†ä¸ auth-proxy ç›¸å…³çš„ Roleã€‚</li><li><code>auth_proxy_role_binding.yaml</code>: é…ç½®äº†ä¸ auth-proxy ç›¸å…³çš„ RoleBindingã€‚</li><li><code>auth_proxy_service.yaml</code>: é…ç½®äº†ä¸ auth-proxy ç›¸å…³çš„ Serviceã€‚</li><li><code>kustomization.yaml</code>: Kustomize é…ç½®æ–‡ä»¶ï¼ŒæŒ‡å®šäº†éœ€è¦åº”ç”¨çš„ k8s èµ„æºç±»å‹å’Œåç§°ã€‚</li><li><code>leader_election_role.yaml</code>: é…ç½®äº†ä¸ leader election ç›¸å…³çš„ Roleã€‚</li><li><code>leader_election_role_binding.yaml</code>: é…ç½®äº†ä¸ leader election ç›¸å…³çš„ RoleBindingã€‚</li><li><code>role_binding.yaml</code>: é…ç½®äº†ä¸ Operator ç›¸å…³çš„ RoleBindingã€‚</li><li><code>service_account.yaml</code>: é…ç½®äº†ä¸ Operator ç›¸å…³çš„ ServiceAccountã€‚</li></ul></li></ul></li><li><code>go.mod</code>: Go é¡¹ç›®çš„æ¨¡å—æ–‡ä»¶ã€‚</li><li><code>go.sum</code>: Go é¡¹ç›®çš„æ¨¡å—ä¾èµ–æ–‡ä»¶ã€‚</li><li><code>hack/</code>: åŒ…å«äº†ç”Ÿæˆä»£ç å’Œæ–‡æ¡£ç­‰ç›¸å…³çš„è„šæœ¬å’Œæ–‡ä»¶ã€‚ <ul><li><code>boilerplate.go.txt</code>: ç”¨äºç”Ÿæˆ Go é¡¹ç›®æ–‡ä»¶çš„ä»£ç æ¨¡æ¿ã€‚</li></ul></li></ul><p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åé¢çš„å­¦ä¹ ï¼Œæˆ‘è¿™é‡Œç”¨ git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œæ–¹ä¾¿è§‚å¯Ÿåé¢ç”Ÿæˆäº†å“ªäº›æ–‡ä»¶</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â¯ git add .
â¯ git commit -a -s -m &quot;kubebuilder init&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="create-an-api" tabindex="-1"><a class="header-anchor" href="#create-an-api" aria-hidden="true">#</a> create an API</h2><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„APIï¼ˆç»„/ç‰ˆæœ¬ï¼‰ä¸º <code>webapp/v1</code> ï¼Œå¹¶åœ¨å…¶ä¸Šåˆ›å»ºæ–°çš„Kindï¼ˆCRDï¼‰ <code>Guestbook</code> ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubebuilder create api <span class="token parameter variable">--group</span> webapp <span class="token parameter variable">--version</span> v1 <span class="token parameter variable">--kind</span> Guestbook
Create Resource <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>
y
Create Controller <span class="token punctuation">[</span>y/n<span class="token punctuation">]</span>
y
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š</p><blockquote><p>å¦‚æœä½ æŒ‰ä¸‹ <code>y</code> åˆ›å»ºèµ„æº[y/n]å’Œåˆ›å»ºæ§åˆ¶å™¨[y/n]ï¼Œåˆ™è¿™å°†åˆ›å»ºæ–‡ä»¶ <code>api/v1/guestbook_types.go</code> ï¼ˆå…¶ä¸­å®šä¹‰äº†APIï¼‰å’Œ <code>controllers/guestbook_controller.go</code> ï¼ˆå…¶ä¸­å®ç°äº†æ­¤ç±»ï¼ˆCRDï¼‰çš„åè°ƒä¸šåŠ¡é€»è¾‘ï¼‰ã€‚</p></blockquote><p>è¿™ä¸ªæ—¶å€™ kubebuilder åˆå·å·çš„åšäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ git çš„å˜åŠ¨ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">git</span> status
On branch master
Changes not staged <span class="token keyword">for</span> commit:
  <span class="token punctuation">(</span>use <span class="token string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed<span class="token punctuation">)</span>
  <span class="token punctuation">(</span>use <span class="token string">&quot;git restore &lt;file&gt;...&quot;</span> to discard changes <span class="token keyword">in</span> working directory<span class="token punctuation">)</span>
        modified:   PROJECT
        modified:   cmd/main.go
        modified:   go.mod
        modified:   go.sum

Untracked files:
  <span class="token punctuation">(</span>use <span class="token string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="token keyword">in</span> what will be committed<span class="token punctuation">)</span>
        api/
        config/crd/
        config/rbac/guestbook_editor_role.yaml
        config/rbac/guestbook_viewer_role.yaml
        config/samples/
        internal/

no changes added to commit <span class="token punctuation">(</span>use <span class="token string">&quot;git add&quot;</span> and/or <span class="token string">&quot;git commit -a&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°å¢ç›®å½•ï¼š</p><ul><li><code>api</code>ï¼šåŒ…å«åˆšåˆšæ·»åŠ çš„ APIï¼Œåé¢ä¼šç»å¸¸ç¼–è¾‘è¿™é‡Œçš„ <code>guestbook_types.go</code> æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æ˜¯ CRD ä»£ç çš„ä¸»è¦å®šä¹‰æ–‡ä»¶ã€‚</li><li><code>config/crd</code>ï¼šå­˜æ”¾çš„æ˜¯ crd éƒ¨ç½²ç›¸å…³çš„ kustomize æ–‡ä»¶ã€‚</li><li><code>config/rbac/</code>ï¼šåˆ†åˆ«æ˜¯ç¼–è¾‘æƒé™å’ŒæŸ¥è¯¢æƒé™çš„ <code>ClusterRole</code></li><li><code>samples</code>ï¼šå¾ˆå¥½ç†è§£ï¼ŒCR ç¤ºä¾‹æ–‡ä»¶</li><li><code>internal</code> ï¼šå¾ˆå¥½ç†è§£ï¼Œå†…éƒ¨æ ¸å¿ƒä»£ç ï¼Œæˆ‘ä»¬æ‰“å¼€çœ‹çœ‹ <code>controllers</code></li></ul><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>â¯ cat internal<span class="token operator">/</span>controller<span class="token operator">/</span>guestbook_controller<span class="token punctuation">.</span><span class="token keyword">go</span>

<span class="token keyword">package</span> controller
<span class="token comment">//...</span>
<span class="token comment">// GuestbookReconciler reconciles a Guestbook object</span>
<span class="token keyword">type</span> GuestbookReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        client<span class="token punctuation">.</span>Client
        Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
<span class="token punctuation">}</span>
<span class="token comment">//...</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>GuestbookReconciler<span class="token punctuation">)</span> <span class="token function">Reconcile</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req ctrl<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token boolean">_</span> <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">FromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>

        <span class="token comment">// TODO(user): your logic here</span>

        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token comment">// SetupWithManager sets up the controller with the Manager.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>GuestbookReconciler<span class="token punctuation">)</span> <span class="token function">SetupWithManager</span><span class="token punctuation">(</span>mgr ctrl<span class="token punctuation">.</span>Manager<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span><span class="token function">NewControllerManagedBy</span><span class="token punctuation">(</span>mgr<span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">For</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>webappv1<span class="token punctuation">.</span>Guestbook<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
                <span class="token function">Complete</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¾ˆæ˜æ˜¾ï¼Œä¸Šé¢çš„ Reconcile å‡½æ•°æ˜¯ä¸€ä¸ªè°ƒè°å‡½æ•°ï¼Œè¿™æ˜¯è´¯ç©¿å§‹ç»ˆçš„ä¸€ä¸ªè¯è¯­ï¼Œåœ¨ æ˜¾çœ¼çš„æç¤º TODO ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¡¥å……è‡ªå·±çš„é€»è¾‘ã€‚</p><p>æˆ‘ä»¬å…·ä½“è§‚å¯Ÿä¸€ä¸‹ PROJECT æ–‡ä»¶ï¼Œå…·ä½“çš„å…ƒæ•°æ®å˜åŒ–ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">git</span> <span class="token function">diff</span> PROJECT
<span class="token function">diff</span> <span class="token parameter variable">--git</span> a/PROJECT b/PROJECT
index a18434c<span class="token punctuation">..</span>3ea38eb <span class="token number">100644</span>
--- a/PROJECT
+++ b/PROJECT
@@ -7,4 +7,14 @@ layout:
 - go.kubebuilder.io/v4
 projectName: guestbook
 repo: my.domain/guestbook
+resources:
+- api:
+    crdVersion: v1
+    namespaced: <span class="token boolean">true</span>
+  controller: <span class="token boolean">true</span>
+  domain: my.domain
+  group: webapp
+  kind: Guestbook
+  path: my.domain/guestbook/api/v1
+  version: v1
 version: <span class="token string">&quot;3&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœè¦ç¼–è¾‘APIå®šä¹‰ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ¸…å•ï¼Œå¦‚è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰æˆ–è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰</p><details class="custom-container details"><summary>CRD å’Œ CR åŒºåˆ«</summary><p>è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰æ˜¯ Kubernetes ä¸­æ‰©å±• API èµ„æºçš„ä¸€ç§æ–¹å¼ï¼Œå®ƒå…è®¸ç”¨æˆ·è‡ªå®šä¹‰ Kubernetes ä¸­çš„èµ„æºç±»å‹ï¼Œå¹¶ä¸ºå…¶åˆ›å»ºè‡ªå·±çš„ API ç«¯ç‚¹ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ kubectl å‘½ä»¤è¡Œå·¥å…·æˆ– Kubernetes API ä»¥ç¼–ç¨‹æ–¹å¼æ“ä½œ CRã€‚CR å¯ä»¥ç”¨äºä»»ä½•ä¸€ç§ Kubernetes èµ„æºçš„æ‰©å±•ï¼Œä¾‹å¦‚ Podã€Service æˆ– Deploymentã€‚</p><p>è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ç”¨äºå®šä¹‰è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰ã€‚å®ƒå®šä¹‰äº† CR çš„ç»“æ„ï¼Œå³å®ƒçš„ API è§„èŒƒã€‚CRD ç”¨äºå®šä¹‰ Kubernetes ä¸­çš„æ–° API èµ„æºç±»å‹ã€‚è¿™äº›èµ„æºç±»å‹å¯ä»¥ç”¨äºæ‰©å±• Kubernetesï¼Œä½¿å…¶æ”¯æŒæ›´å¤šçš„èµ„æºç±»å‹å’Œæ“ä½œã€‚CRD æœ¬èº«æ˜¯ä¸€ä¸ª Kubernetes èµ„æºï¼Œå®ƒå¯ä»¥è¢« kubectl æˆ– Kubernetes API ç”¨äºåˆ›å»ºæ–°çš„ CR ç±»å‹ã€‚</p><p>å› æ­¤ï¼ŒCR æ˜¯ç”¨æˆ·åˆ›å»ºçš„ Kubernetes èµ„æºç±»å‹ï¼Œè€Œ CRD æ˜¯å®šä¹‰å’Œç®¡ç†è¿™äº›èµ„æºç±»å‹çš„æ–¹å¼ã€‚</p></details><h3 id="api-å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#api-å®šä¹‰" aria-hidden="true">#</a> API å®šä¹‰</h3><p>Kubernetes çš„èµ„æºæœ¬è´¨å°±æ˜¯ä¸€ä¸ª API å¯¹è±¡ï¼Œä¸è¿‡è¿™ä¸ªå¯¹è±¡çš„ æœŸæœ›çŠ¶æ€ è¢« API Service ä¿å­˜åœ¨äº† ETCD ä¸­ï¼ˆæˆ–è€…æ˜¯å¯¹äº k3s æ¥è¯´å¯ä»¥ä¿å­˜åœ¨å…¶ä»–çš„æœ‰çŠ¶æ€æ•°æ®åº“ï¼ŒåŒ…æ‹¬ sqliteã€dqliteã€mysqlâ€¦)ï¼Œç„¶åæä¾› RESTful æ¥å£ç”¨äº æ›´æ–°è¿™äº›å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šé¢è®²è¿‡ï¼ŒCRD çš„ä»£ç å®šä¹‰ä¸»è¦åœ¨ <code>api/</code> ç›®å½•ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ç»“æ„ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ tree api
api
â””â”€â”€ v1
    â”œâ”€â”€ groupversion_info.go
    â”œâ”€â”€ guestbook_types.go
    â””â”€â”€ zz_generated.deepcopy.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>guestbook_types.go</code> æ–‡ä»¶ä¸»è¦çš„å®šä¹‰ï¼Œæˆ‘ä»¬çœ‹ä¸‹ spec ç»“æ„ã€‚</p><details class="custom-container details"><summary>Spec ç»“å°¾çš„ç»“æ„ä½“å«ä¹‰</summary><p>åœ¨Goè¯­è¨€ä¸­ï¼Œç»“æ„ä½“ä»¥ spec ç»“å°¾è¡¨ç¤ºè¯¥ç»“æ„ä½“æ˜¯ç”¨äºç‰¹å®šç›®çš„çš„è§„èŒƒç»“æ„ä½“ã€‚è¿™ç§å‘½åçº¦å®šé€šå¸¸ç”¨äºæè¿°ä¸€ä¸ªç»“æ„ä½“çš„ç”¨é€”å’ŒåŠŸèƒ½ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨å®ƒã€‚ä¾‹å¦‚ï¼Œ<code>GuestbookSpec</code>å®šä¹‰äº†æ‰€éœ€çš„ <code>Guestbook</code> çŠ¶æ€</p></details><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// GuestbookSpec defines the desired state of Guestbook</span>
<span class="token keyword">type</span> GuestbookSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
        <span class="token comment">// INSERT ADDITIONAL SPEC FIELDS - desired state of cluster</span>
        <span class="token comment">// Important: Run &quot;make&quot; to regenerate code after modifying this file</span>

        <span class="token comment">// Foo is an example field of Guestbook. Edit guestbook_types.go to remove/update</span>
        Foo <span class="token builtin">string</span> <span class="token string">`json:&quot;foo,omitempty&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„æ³¨é‡Šå†™çš„å¾ˆæ¸…æ¥šï¼ŒFoo æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤æ‰ï¼Œç„¶åæ·»åŠ è‡ªå·±éœ€è¦çš„é…ç½®ã€‚</p><p>ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ååˆ©ç”¨ Makefile é‡æ–°ç”Ÿæˆä»£ç ï¼ŒğŸ’¡ç®€å•çš„ä¸€ä¸ªæ¡ˆä¾‹å¦‚ä¸‹ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
	corev1 <span class="token string">&quot;k8s.io/api/core/v1&quot;</span>
    metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> GuestbookSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Replicas <span class="token builtin">int32</span>					<span class="token string">`json:&quot;replicas,omitempty&quot;`</span>
    Template corev1<span class="token punctuation">.</span>PodTemplateSpec	<span class="token string">`json:&quot;template,omitempty&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åˆ†åˆ«å®šä¹‰äº† ç”¨äºå£°æ˜ Pod å‰¯æœ¬çš„æ•°é‡ã€å’Œç”¨äºç”Ÿæˆ Pod æ¨¡æ¿çš„é…ç½®ã€‚</p><p>æœ€åæˆ‘ä»¬ä¹Ÿè¦è®°å½•åˆ° git commit ä¸­ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â¯ git add .
â¯ git commit -a -s -m &quot;create api&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="crd-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#crd-éƒ¨ç½²" aria-hidden="true">#</a> CRD éƒ¨ç½²</h3><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ <code>make manifests</code> å‘½ä»¤ç”Ÿæˆ ClusterRole å’Œ CustomResourceDefinition é…ç½®ã€‚</strong></p><p><strong>æ£€æŸ¥ git çš„æ›´æ”¹ä¿¡æ¯ï¼š</strong></p><blockquote><p>å¦‚æœè¦ç¼–è¾‘APIå®šä¹‰ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ¸…å•ï¼Œå¦‚è‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰æˆ–è‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">git</span> status
On branch master
Untracked files:
  <span class="token punctuation">(</span>use <span class="token string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="token keyword">in</span> what will be committed<span class="token punctuation">)</span>
        config/crd/bases/
        config/rbac/role.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªç›®å½•æ–‡ä»¶çš„å˜åŒ–ï¼š</p><ul><li><code>config/crd/bases/</code> ç›®å½•ï¼šæ–°å¢ <code>webapp.my.domain_guestbooks.yaml</code> æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯ <code>guestbook</code> ç±»å‹çš„ CRD é…ç½®æ–‡ä»¶ã€‚</li><li><code>config/rbac/role.yaml</code> å®šä¹‰çš„æ˜¯ä¸€ä¸ª ClusterRoleï¼Œä»åå­— manager-role ä¸Šå¤§è‡´ä¹Ÿå¯ä»¥çŒœå‡ºè¿™æ˜¯åé¢ Controller éƒ¨ç½²åå°†å……å½“çš„ â€œ<strong>è§’è‰²</strong>â€ï¼Œå®šä¹‰äº†å¯¹ <code>guestbook</code> èµ„æºçš„ CURD æ“ä½œã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Kubernetes çš„ç¯å¢ƒï¼Œä¸ç®¡æ˜¯ Kind &amp; minikube &amp; k3s ä½œä¸ºæµ‹è¯•ç¯å¢ƒä¹Ÿå¥½ï¼Œæˆ‘é€‰æ‹©äº† Kindï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â¯ kind version
kind v0.18.0-alpha+bc0526729cf900 go1.20.1 linux/amd64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>âš ï¸ æ§åˆ¶å™¨å°†è‡ªåŠ¨ä½¿ç”¨ kubeconfigæ–‡ä»¶ï¼ˆå³é›†ç¾¤<code>kubectl cluster-info</code>æ˜¾ç¤ºçš„ä»»ä½•å†…å®¹ï¼‰ã€‚å¦‚æœå‡ºç°é—®é¢˜æŒ‰ç…§å®˜æ–¹çš„æ–¹æ³•å¯ä»¥è‡ªå·±æ‹·è´ kubeconfig æˆ–è€…æ˜¯ è®¾ç½® ç¯å¢ƒå˜é‡ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>make install</code> å®Œæˆ CRD çš„éƒ¨ç½²è¿‡ç¨‹ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ğŸ¯ æˆ‘ä»¬åº”è¯¥æ£€æŸ¥ä¸€ä¸ª Makefile ä¸­çš„ <code>install target</code>ï¼Œæˆ–è®¸å¯ä»¥çœ‹å‡ºæ¥ <code>install target</code> æ˜¯åŒ…å« <code>make manifests</code> å‘½ä»¤çš„ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯åˆ†å¼€æ“ä½œæœ‰åŠ©äºäº†è§£æ•´ä¸ªè¿‡ç¨‹ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># install   Install CRDs into the K8s cluster specified in ~/.kube/config.</span>
.PHONY: <span class="token function">install</span>
install: manifests kustomize <span class="token comment">## Install CRDs into the K8s cluster specified in ~/.kube/config.</span>
        <span class="token variable"><span class="token variable">$(</span>KUSTOMIZE<span class="token variable">)</span></span> build config/crd <span class="token operator">|</span> kubectl apply <span class="token parameter variable">-f</span> -
      
<span class="token comment"># kustomize Download kustomize locally if necessary. If wrong version is installed, it will be removed before downloading.</span>
.PHONY: kustomize
kustomize: <span class="token variable"><span class="token variable">$(</span>KUSTOMIZE<span class="token variable">)</span></span> <span class="token comment">## Download kustomize locally if necessary. If wrong version is installed, it will be removed before downloading.</span>
<span class="token variable"><span class="token variable">$(</span>KUSTOMIZE<span class="token variable">)</span></span><span class="token builtin class-name">:</span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>
        @if <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>/kustomize <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>/kustomize version <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token variable"><span class="token variable">$(</span>KUSTOMIZE_VERSION<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token punctuation">\</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>/kustomize version is not expected <span class="token variable"><span class="token variable">$(</span>KUSTOMIZE_VERSION<span class="token variable">)</span></span>. Removing it before installing.&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">\</span>
                <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>/kustomize<span class="token punctuation">;</span> <span class="token punctuation">\</span>
        <span class="token keyword">fi</span>
        <span class="token builtin class-name">test</span> <span class="token parameter variable">-s</span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span>/kustomize <span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token function">curl</span> <span class="token parameter variable">-Ss</span> <span class="token variable"><span class="token variable">$(</span>KUSTOMIZE_INSTALL_SCRIPT<span class="token variable">)</span></span> <span class="token parameter variable">--output</span> install_kustomize.sh <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> install_kustomize.sh <span class="token variable"><span class="token variable">$(</span>subst v,,<span class="token punctuation">$(</span>KUSTOMIZE_VERSION<span class="token punctuation">)</span><span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>LOCALBIN<span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token function">rm</span> install_kustomize.sh<span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ ¡éªŒ</strong>ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ k get crd <span class="token parameter variable">-A</span>
NAME                          CREATED AT
crontabs.stable.example.com   <span class="token number">2023</span>-04-07T09:17:55Z
guestbooks.webapp.my.domain   <span class="token number">2023</span>-04-07T15:42:22Z
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>guestbooks.webapp.my.domain</code> å·²ç»å­˜åœ¨äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰èµ„æºï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>k get pod</code> çš„æ–¹å¼æ¥ <code>k get guestbooks</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ k get guestbooks.webapp.my.domain <span class="token parameter variable">-A</span>
No resources found
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™é‡Œå¹¶æ²¡å‡ºå‡ºç° error ï¼Œè¯´æ˜æç¤ºçš„æ˜¯ kube-apiserver å·²ç»å¯ä»¥è¯†åˆ«è¿™ä¸ªèµ„æºï¼Œåªä¸è¿‡æ²¡æœ‰è¿™ä¸ªèµ„æºçš„å…·ä½“å®ä¾‹ã€‚</p><p>è¿è¡Œä½ çš„æ§åˆ¶å™¨ï¼ˆè¿™å°†åœ¨å‰å°è¿è¡Œï¼Œæ‰€ä»¥åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ ç»ˆç«¯ï¼ˆå¦‚æœä½ æƒ³è®©å®ƒä¿æŒè¿è¡Œï¼‰ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> run
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="å®‰è£…è‡ªå®šä¹‰èµ„æºçš„å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#å®‰è£…è‡ªå®šä¹‰èµ„æºçš„å®ä¾‹" aria-hidden="true">#</a> å®‰è£…è‡ªå®šä¹‰èµ„æºçš„å®ä¾‹</h3><p>å¦‚æœä½ æŒ‰äº†<code>y</code>åˆ›å»ºèµ„æº <strong>[y/n]</strong>ï¼Œåˆ™ä½ åœ¨ç¤ºä¾‹ä¸­ä¸ºCRDåˆ›å»ºäº†CRï¼ˆå¦‚æœä½ æ›´æ”¹äº† APIå®šä¹‰ï¼‰ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> config/samples/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="åœ¨é›†ç¾¤ä¸Šè¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#åœ¨é›†ç¾¤ä¸Šè¿è¡Œ" aria-hidden="true">#</a> åœ¨é›†ç¾¤ä¸Šè¿è¡Œ</h3><p>æ„å»ºé•œåƒå¹¶å°†å…¶æ¨é€åˆ°<code>IMG</code>æŒ‡å®šçš„ä½ç½®ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> docker-build docker-push <span class="token assign-left variable">IMG</span><span class="token operator">=</span><span class="token operator">&lt;</span>some-registry<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span>:tag
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨<code>IMG</code>æŒ‡å®šçš„é•œåƒå°†æ§åˆ¶å™¨éƒ¨ç½²åˆ°é›†ç¾¤ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> deploy <span class="token assign-left variable">IMG</span><span class="token operator">=</span><span class="token operator">&lt;</span>some-registry<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>project-name<span class="token operator">&gt;</span>:tag
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="å¸è½½crd" tabindex="-1"><a class="header-anchor" href="#å¸è½½crd" aria-hidden="true">#</a> å¸è½½CRD</h3><p>è¦ä»ç¾¤é›†ä¸­åˆ é™¤CRDï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="å–æ¶ˆéƒ¨ç½²-controller" tabindex="-1"><a class="header-anchor" href="#å–æ¶ˆéƒ¨ç½²-controller" aria-hidden="true">#</a> å–æ¶ˆéƒ¨ç½² controller</h3><p>å°†æ§åˆ¶å™¨å–æ¶ˆéƒ¨ç½²åˆ°ç¾¤é›†ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> undeploy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="cr-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#cr-éƒ¨ç½²" aria-hidden="true">#</a> CR éƒ¨ç½²</h2><p>æˆ‘ä»¬ä½¿ç”¨ CRD å®šä¹‰äº†ä¸€ä¸ªèµ„æºï¼ŒCR å°±åƒå†™ä¸€ä¸ª Deployment ä¸€æ ·ï¼Œåˆ›å»º <code>guestbooks</code> åŒæ ·éœ€è¦ä¸€ä¸ª <code>yaml</code> æ–‡ä»¶ï¼Œå¹¶ä¸”ç¬¦åˆå£°æ˜å¼ã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>â¯ cat config/samples/webapp_v1_guestbook.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> webapp.my.domain/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Guestbook
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> guestbook
    <span class="token key atrule">app.kubernetes.io/instance</span><span class="token punctuation">:</span> guestbook<span class="token punctuation">-</span>sample
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> guestbook
    <span class="token key atrule">app.kubernetes.io/managed-by</span><span class="token punctuation">:</span> kustomize
    <span class="token key atrule">app.kubernetes.io/created-by</span><span class="token punctuation">:</span> guestbook
  <span class="token key atrule">name</span><span class="token punctuation">:</span> guestbook<span class="token punctuation">-</span>sample
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># TODO(user): Add fields here</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

â¯ k apply <span class="token punctuation">-</span>f webapp_v1_guestbook.yaml
guestbook.webapp.my.domain/guestbook<span class="token punctuation">-</span>sample created

â¯ k get guestbooks.webapp.my.domain
NAME               AGE
guestbook<span class="token punctuation">-</span>sample   93s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢è¡¨ç¤ºåˆ›å»ºå‡ºæ¥äº† <code>guestbook-sample </code> å¯¹è±¡ï¼Œä¸è¿‡è¿™ä¸ªæ—¶å€™è¿˜ä¸å¤Ÿï¼Œå› ä¸º Pod è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ï¼Œæˆ‘ä»¬ç»§ç»­å®ç°ç›¸åº”çš„æ§åˆ¶å™¨é€»è¾‘ã€‚</p><h2 id="guestbook-ç”Ÿæˆçš„ä»£ç å’Œç»“æ„" tabindex="-1"><a class="header-anchor" href="#guestbook-ç”Ÿæˆçš„ä»£ç å’Œç»“æ„" aria-hidden="true">#</a> guestbook ç”Ÿæˆçš„ä»£ç å’Œç»“æ„</h2><p>æˆ‘ä»¬è¯¦ç»†è§£é‡Šä¸€ä¸‹ kubebuilder åˆå§‹åŒ–CRDä»¥åŠç›¸å…³çš„æ§åˆ¶å™¨æ¡†æ¶åï¼Œéƒ¨åˆ†çš„ä»£ç ç»“æ„å’Œæºç è§£æã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥ä»ä¸»å‡½æ•°å¼€å§‹ï¼š main.go</p><h3 id="cmd" tabindex="-1"><a class="header-anchor" href="#cmd" aria-hidden="true">#</a> cmd</h3><p>main.go ä½œä¸ºå…¥å£å‡½æ•°ï¼Œæ˜¯æˆ‘ä»¬ä¸»è¦çœ‹çš„ã€‚å½“ç„¶ï¼Œè®¸å¯è¯ä¿¡æ¯çœç•¥æ‰äº†~ æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹å¤´æ–‡ä»¶ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;flag&quot;</span>
	<span class="token string">&quot;os&quot;</span>

	<span class="token comment">// Import all Kubernetes client auth plugins (e.g. Azure, GCP, OIDC, etc.)</span>
	<span class="token comment">// to ensure that exec-entrypoint and run can make use of them.</span>
	<span class="token boolean">_</span> <span class="token string">&quot;k8s.io/client-go/plugin/pkg/client/auth&quot;</span>

	<span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
	utilruntime <span class="token string">&quot;k8s.io/apimachinery/pkg/util/runtime&quot;</span>
	clientgoscheme <span class="token string">&quot;k8s.io/client-go/kubernetes/scheme&quot;</span>
	ctrl <span class="token string">&quot;sigs.k8s.io/controller-runtime&quot;</span>
	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/healthz&quot;</span>
	<span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/log/zap&quot;</span>

	webappv1 <span class="token string">&quot;my.domain/guestbook/api/v1&quot;</span>
	<span class="token string">&quot;my.domain/guestbook/internal/controller&quot;</span>
	<span class="token comment">//+kubebuilder:scaffold:imports</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¯ä¸€ç»„æ§åˆ¶å™¨éƒ½éœ€è¦ä¸€ä¸ªSchemeï¼Œå®ƒæä¾›äº†Kindså’Œå®ƒä»¬å¯¹åº”çš„Goç±»å‹ä¹‹é—´çš„æ˜ å°„ã€‚åœ¨ç¼–å†™APIå®šä¹‰æ—¶ï¼Œæˆ‘ä»¬å°†æ›´å¤šåœ°è®¨è®ºKindsï¼Œæ‰€ä»¥ç¨åè¯·è®°ä½è¿™ä¸€ç‚¹ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
	scheme   <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">NewScheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	setupLog <span class="token operator">=</span> ctrl<span class="token punctuation">.</span>Log<span class="token punctuation">.</span><span class="token function">WithName</span><span class="token punctuation">(</span><span class="token string">&quot;setup&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	utilruntime<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>clientgoscheme<span class="token punctuation">.</span><span class="token function">AddToScheme</span><span class="token punctuation">(</span>scheme<span class="token punctuation">)</span><span class="token punctuation">)</span>

	utilruntime<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>webappv1<span class="token punctuation">.</span><span class="token function">AddToScheme</span><span class="token punctuation">(</span>scheme<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">//+kubebuilder:scaffold:scheme</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>runtime.Scheme</code> æ˜¯ Kubernetes ä¸­å¯¹è±¡çš„ç¼–è§£ç å™¨æ³¨å†Œè¡¨ï¼Œç”¨äºå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œå¹¶å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚æ‰€æœ‰ Kubernetes API å¯¹è±¡éƒ½å¿…é¡»æ³¨å†Œåˆ° <code>runtime.Scheme</code> ä¸­ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨åˆ° etcd æˆ–å‘é€åˆ° API Server æ—¶è¿›è¡Œæ­£ç¡®çš„ç¼–è§£ç ã€‚</p><p>å¯ä»¥é€šè¿‡è°ƒç”¨ <code>scheme.AddKnownTypes()</code> æ–¹æ³•å‘ <code>runtime.Scheme</code> ä¸­æ³¨å†Œæ–°çš„ API å¯¹è±¡ç±»å‹ã€‚</p><p>æˆ‘ä»¬å®ä¾‹åŒ–äº†ä¸¤ä¸ªç®¡ç†å™¨ï¼Œå®ƒè·Ÿè¸ªæ‰€æœ‰æ§åˆ¶å™¨çš„è¿è¡Œæƒ…å†µï¼Œå¹¶ä¸ºAPIæœåŠ¡å™¨è®¾ç½®å…±äº«ç¼“å­˜å’Œå®¢æˆ·æœºã€‚</p><p>âš ï¸ æ³¨æ„ï¼šè¿™é‡Œæœ‰ <code>//+kubebuilder:scaffold:scheme</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„äº‹æƒ…ã€‚</p><p>å‰©ä¸‹å°±æ˜¯æœ€æ ¸å¿ƒçš„ <code>main()</code> å‡½æ•°ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> metricsAddr <span class="token builtin">string</span>
    <span class="token keyword">var</span> enableLeaderElection <span class="token builtin">bool</span>
    <span class="token keyword">var</span> probeAddr <span class="token builtin">string</span>
    flag<span class="token punctuation">.</span><span class="token function">StringVar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>metricsAddr<span class="token punctuation">,</span> <span class="token string">&quot;metrics-bind-address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8080&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;The address the metric endpoint binds to.&quot;</span><span class="token punctuation">)</span>
    flag<span class="token punctuation">.</span><span class="token function">StringVar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>probeAddr<span class="token punctuation">,</span> <span class="token string">&quot;health-probe-bind-address&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;:8081&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;The address the probe endpoint binds to.&quot;</span><span class="token punctuation">)</span>
    flag<span class="token punctuation">.</span><span class="token function">BoolVar</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>enableLeaderElection<span class="token punctuation">,</span> <span class="token string">&quot;leader-elect&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Enable leader election for controller manager. &quot;</span><span class="token operator">+</span>
            <span class="token string">&quot;Enabling this will ensure there is only one active controller manager.&quot;</span><span class="token punctuation">)</span>
    opts <span class="token operator">:=</span> zap<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
        Development<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    opts<span class="token punctuation">.</span><span class="token function">BindFlags</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>
    flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    ctrl<span class="token punctuation">.</span><span class="token function">SetLogger</span><span class="token punctuation">(</span>zap<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>zap<span class="token punctuation">.</span><span class="token function">UseFlagOptions</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>opts<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    mgr<span class="token punctuation">,</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">NewManager</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span><span class="token function">GetConfigOrDie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctrl<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
        Scheme<span class="token punctuation">:</span>                 scheme<span class="token punctuation">,</span>
        MetricsBindAddress<span class="token punctuation">:</span>     metricsAddr<span class="token punctuation">,</span>
        Port<span class="token punctuation">:</span>                   <span class="token number">9443</span><span class="token punctuation">,</span>
        HealthProbeBindAddress<span class="token punctuation">:</span> probeAddr<span class="token punctuation">,</span>
        LeaderElection<span class="token punctuation">:</span>         enableLeaderElection<span class="token punctuation">,</span>
        LeaderElectionID<span class="token punctuation">:</span>       <span class="token string">&quot;80807133.tutorial.kubebuilder.io&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        setupLog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to start manager&quot;</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰é¢æ— éå°±æ˜¯å®šä¹‰äº†ä¸€ä¸ª flag å¹¶ä¸”åˆå§‹åŒ–ã€‚å¹¶ä¸”äº¤ç»™<code>Parse</code>è§£æ<code>os.Args[1:]</code>ä¸­çš„å‘½ä»¤è¡Œæ ‡å¿—ã€‚</p><p>è¯·æ³¨æ„ï¼Œ <code>Manager</code> å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼é™åˆ¶æ‰€æœ‰æ§åˆ¶å™¨å°†ç›‘è§†èµ„æºçš„å‘½åç©ºé—´ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code> mgr<span class="token punctuation">,</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">NewManager</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span><span class="token function">GetConfigOrDie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctrl<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
     Scheme<span class="token punctuation">:</span>                 scheme<span class="token punctuation">,</span>
     Namespace<span class="token punctuation">:</span>              namespace<span class="token punctuation">,</span>
     MetricsBindAddress<span class="token punctuation">:</span>     metricsAddr<span class="token punctuation">,</span>
     Port<span class="token punctuation">:</span>                   <span class="token number">9443</span><span class="token punctuation">,</span>
     HealthProbeBindAddress<span class="token punctuation">:</span> probeAddr<span class="token punctuation">,</span>
     LeaderElection<span class="token punctuation">:</span>         enableLeaderElection<span class="token punctuation">,</span>
     LeaderElectionID<span class="token punctuation">:</span>       <span class="token string">&quot;80807133.tutorial.kubebuilder.io&quot;</span><span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢çš„ç¤ºä¾‹å°†é¡¹ç›®çš„èŒƒå›´æ›´æ”¹ä¸ºå•ä¸ª <code>Namespace</code> ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜å»ºè®®å°†é»˜è®¤çš„ <code>ClusterRole</code> å’Œ <code>ClusterRoleBinding</code> åˆ†åˆ«æ›¿æ¢ä¸º <code>Role</code> å’Œ <code>RoleBinding</code> ï¼Œä»è€Œå°†æä¾›çš„æˆæƒé™åˆ¶åœ¨æ­¤å‘½åç©ºé—´ã€‚è¿™æ ·æ¥è¯´æƒé™å°ä¸€äº›ï¼Œåœ¨ RBAC ä¸­ä»‹ç»è¿‡è¿™éƒ¨åˆ†ã€‚</p><p>ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>MultiNamespacedCacheBuilder</code> æ¥ç›‘è§†ç‰¹æ€§çš„å‘½åç©ºé—´å­é›†ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> namespaces <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token comment">// List of Namespaces</span>

mgr<span class="token punctuation">,</span> err <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span><span class="token function">NewManager</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span><span class="token function">GetConfigOrDie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ctrl<span class="token punctuation">.</span>Options<span class="token punctuation">{</span>
    Scheme<span class="token punctuation">:</span>                 scheme<span class="token punctuation">,</span>
    NewCache<span class="token punctuation">:</span>               cache<span class="token punctuation">.</span><span class="token function">MultiNamespacedCacheBuilder</span><span class="token punctuation">(</span>namespaces<span class="token punctuation">)</span><span class="token punctuation">,</span>
    MetricsBindAddress<span class="token punctuation">:</span>     fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;%s:%d&quot;</span><span class="token punctuation">,</span> metricsHost<span class="token punctuation">,</span> metricsPort<span class="token punctuation">)</span><span class="token punctuation">,</span>
    Port<span class="token punctuation">:</span>                   <span class="token number">9443</span><span class="token punctuation">,</span>
    HealthProbeBindAddress<span class="token punctuation">:</span> probeAddr<span class="token punctuation">,</span>
    LeaderElection<span class="token punctuation">:</span>         enableLeaderElection<span class="token punctuation">,</span>
    LeaderElectionID<span class="token punctuation">:</span>       <span class="token string">&quot;80807133.tutorial.kubebuilder.io&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¥ä¸‹æ¥çš„éƒ¨åˆ†ï¼Œå°±æ˜¯ä¸€äº›é”™è¯¯å¤„ç†ï¼Œå’Œå¼€å§‹æ­å»ºæˆ‘ä»¬çš„APIäº†ï¼</strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// +kubebuilder:scaffold:builder</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> mgr<span class="token punctuation">.</span><span class="token function">AddHealthzCheck</span><span class="token punctuation">(</span><span class="token string">&quot;healthz&quot;</span><span class="token punctuation">,</span> healthz<span class="token punctuation">.</span>Ping<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    setupLog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to set up health check&quot;</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> err <span class="token operator">:=</span> mgr<span class="token punctuation">.</span><span class="token function">AddReadyzCheck</span><span class="token punctuation">(</span><span class="token string">&quot;readyz&quot;</span><span class="token punctuation">,</span> healthz<span class="token punctuation">.</span>Ping<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    setupLog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to set up ready check&quot;</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

setupLog<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;starting manager&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">:=</span> mgr<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span><span class="token function">SetupSignalHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    setupLog<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;problem running manager&quot;</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="groups-versions-kinds-and-resources" tabindex="-1"><a class="header-anchor" href="#groups-versions-kinds-and-resources" aria-hidden="true">#</a> groups, versions, kinds, and resources</h2><p>å½“æˆ‘ä»¬è°ˆè®ºKubernetesä¸­çš„APIæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨4ä¸ªæœ¯è¯­ï¼šç»„ã€ç‰ˆæœ¬ã€ç§ç±»å’Œèµ„æºã€‚</p><p>æ²¡é”™ï¼Œæˆ‘ä»¬åœ¨ <a href="https://docker.nsddd.top/Cloud-Native-k8s/" target="_blank" rel="noopener noreferrer">https://docker.nsddd.top/Cloud-Native-k8s/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­ä»‹ç»è¿‡å¾ˆå¤šå…³äº GVK å’Œ GVR çš„ä»‹ç»ï¼Œä¸ºä»€ä¹ˆåœ¨ Kubebuilder ä¸­å°¤å…¶éœ€è¦å†æä¸€æ¬¡ã€‚</p><p>å½“æˆ‘ä»¬åœ¨ä¸€ä¸ªç‰¹å®šçš„ç»„ç‰ˆæœ¬ä¸­å¼•ç”¨ä¸€ä¸ªç§ç±»æ—¶ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºGroupVersionKindï¼Œæˆ–ç®€ç§°ä¸ºGVKã€‚èµ„æºå’ŒGVRä¹Ÿæ˜¯å¦‚æ­¤ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼Œæ¯ä¸ªGVKå¯¹åº”äºåŒ…ä¸­ç»™å®šçš„ root Go typeã€‚èµ°è¿›æºç ï¼Œä½“ä¼šè¿™ç§æ„Ÿè§‰~</p><h3 id="create-an-api-1" tabindex="-1"><a class="header-anchor" href="#create-an-api-1" aria-hidden="true">#</a> create an API</h3><p>æˆ‘ä»¬åœ¨å‰é¢åˆ›å»ºè¿‡ API ï¼Œ<code>kubebuilder create api --group webapp --version v1 --kind Guestbook</code> å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ª ç»„ä¸º <code>webapp</code>ï¼Œç‰ˆæœ¬ä¸º <code>v1</code>ï¼Œç±»å‹ä¸º <code>Guestbook</code> çš„API èµ„æºå¯¹è±¡ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çš„å‘½ä»¤æ˜¯ <code>create api</code>ï¼Œæ­¤å‘½ä»¤çš„ç›®æ ‡æ˜¯ä¸ºæˆ‘ä»¬çš„åŒç±»åˆ›å»ºè‡ªå®šä¹‰èµ„æºï¼ˆCRï¼‰å’Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼ˆCRDï¼‰ã€‚æˆ‘ç¿»å¼€äº† Kubebuilder çš„æºç éƒ¨åˆ†ï¼š</p><p>åœ¨ <code>pkg/cli</code> ç›®å½•ä¸‹é¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†å…¥å£ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// addSubcommands returns a root command with a subcommand tree reflecting the</span>
<span class="token comment">// current project&#39;s state.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>CLI<span class="token punctuation">)</span> <span class="token function">addSubcommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// add the alpha command if it has any subcommands enabled</span>
	c<span class="token punctuation">.</span><span class="token function">addAlphaCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token comment">// kubebuilder completion</span>
	<span class="token comment">// Only add completion if requested</span>
	<span class="token keyword">if</span> c<span class="token punctuation">.</span>completionCommand <span class="token punctuation">{</span>
		c<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newCompletionCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// kubebuilder create</span>
	createCmd <span class="token operator">:=</span> c<span class="token punctuation">.</span><span class="token function">newCreateCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// kubebuilder create api</span>
	createCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newCreateAPICmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	createCmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newCreateWebhookCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> createCmd<span class="token punctuation">.</span><span class="token function">HasSubCommands</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		c<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>createCmd<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// kubebuilder edit</span>
	c<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newEditCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// kubebuilder init</span>
	c<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newInitCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token comment">// kubebuilder version</span>
	<span class="token comment">// Only add version if a version string was provided</span>
	<span class="token keyword">if</span> c<span class="token punctuation">.</span>version <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
		c<span class="token punctuation">.</span>cmd<span class="token punctuation">.</span><span class="token function">AddCommand</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newVersionCmd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š</p><blockquote><p>é€šè¿‡ <code>newCreateCmd</code> åˆ›å»ºäº†ä¸€ä¸ª <code>create</code> å‘½ä»¤ï¼Œå¹¶ä¸”é€šè¿‡ <code>newCreateAPICmd</code> å’Œ <code>newCreateWebhookCmd</code> ç»‘å®šäº† <code>api</code> å’Œ <code>webhook</code>.</p></blockquote><p><code>webhook</code> æ˜¯ä¸€ä¸ªé’©å­ï¼Œhook åœ¨ Kubernetes ä¸­éšå¤„å¯è§ï¼Œå¯ä»¥ä½¿ç”¨ Webhook æ¥éªŒè¯ CRD å¯¹è±¡çš„è§„èŒƒæ˜¯å¦æ­£ç¡®ï¼Œå¹¶è®¾ç½®é»˜è®¤å€¼ï¼Œä»¥ç¡®ä¿ CRD å¯¹è±¡çš„æ­£ç¡®æ€§ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦åˆ›å»º-api" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦åˆ›å»º-api" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦åˆ›å»º APIï¼Ÿ</h3><p>æ–°çš„APIæ˜¯æˆ‘ä»¬å‘Kubernetesæ•™æˆè‡ªå®šä¹‰å¯¹è±¡çš„æ–¹å¼ã€‚Goç»“æ„ä½“ç”¨äºç”Ÿæˆä¸€ä¸ªCRDï¼Œå…¶ä¸­åŒ…æ‹¬æ•°æ®çš„æ¨¡å¼ä»¥åŠè·Ÿè¸ªæ•°æ®ï¼Œä¾‹å¦‚æˆ‘ä»¬çš„æ–°ç±»å‹è¢«ç§°ä¸ºä»€ä¹ˆã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„è‡ªå®šä¹‰å¯¹è±¡çš„å®ä¾‹ï¼Œè¿™äº›å¯¹è±¡å°†ç”±æˆ‘ä»¬çš„æ§åˆ¶å™¨ç®¡ç†ã€‚</p><p>æˆ‘ä»¬çš„APIå’Œèµ„æºä»£è¡¨æˆ‘ä»¬åœ¨é›†ç¾¤ä¸Šçš„è§£å†³æ–¹æ¡ˆã€‚åŸºæœ¬ä¸Šï¼ŒCRDæ˜¯æˆ‘ä»¬å®šåˆ¶å¯¹è±¡çš„å®šä¹‰ï¼Œè€ŒCRæ˜¯å®ƒçš„å®ä¾‹ã€‚å°±æ¯”å¦‚è¯´ä¸Šé¢ æˆ‘ä»¬ é€šè¿‡ kubebuilder å®šä¹‰äº†ä¸€ä¸ª <code>guestbooks.webapp.my.domain</code> çš„ CRDï¼Œç„¶åå†é€šè¿‡ å£°æ˜å¼ yaml æ–‡ä»¶ç¼–å†™ CRï¼Œå¹¶ä¸”åˆ›å»º CRã€‚</p><blockquote><p>å½“ç„¶å®˜æ–¹æœ‰ä¸€ä¸ªæ›´å¥½ç†è§£çš„ä¾‹å­ï¼šç›®æ ‡æ˜¯è®©åº”ç”¨ç¨‹åºåŠå…¶æ•°æ®åº“åœ¨Kuberneteså¹³å°ä¸Šè¿è¡Œã€‚ç„¶åï¼Œä¸€ä¸ªCRDå¯ä»¥è¡¨ç¤ºAppï¼Œè€Œå¦ä¸€ä¸ªCRDå¯ä»¥è¡¨ç¤ºDBã€‚</p><p>é€šè¿‡ä½¿ç”¨ä¸€ä¸ªCRDæè¿°åº”ç”¨ç¨‹åºï¼Œå¦ä¸€ä¸ªCRDæè¿°æ•°æ®åº“ï¼Œæˆ‘ä»¬ä¸ä¼šæŸå®³å°è£…ã€å•ä¸€è´£ä»»åŸåˆ™å’Œå†…èšç­‰æ¦‚å¿µã€‚</p><p>ç ´åè¿™äº›æ¦‚å¿µå¯èƒ½ä¼šå¯¼è‡´æ„æƒ³ä¸åˆ°çš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚éš¾ä»¥æ‰©å±•ã€é‡ç”¨æˆ–ç»´æŠ¤ç­‰ã€‚</p></blockquote><h3 id="single-group-to-multi-group" tabindex="-1"><a class="header-anchor" href="#single-group-to-multi-group" aria-hidden="true">#</a> Single Group to Multi-Group</h3><p>åœ¨<code>Kubebuilder v2 scaffolding</code>çš„åˆå§‹ç‰ˆæœ¬ä¸­ï¼ˆä»Kubebuilder v2.0.0å¼€å§‹ï¼‰ä¸å­˜åœ¨å¤šç»„<code>scaffolding</code>æ”¯æŒã€‚</p><p>è¦æ›´æ”¹é¡¹ç›®çš„å¸ƒå±€ä»¥æ”¯æŒå¤šç»„ï¼Œè¯·è¿è¡Œå‘½ä»¤ <code>kubebuilder edit --multigroup=true</code> ã€‚ä¸€æ—¦åˆ‡æ¢åˆ°å¤šç»„å¸ƒå±€ï¼Œæ–°çš„Kindså°†åœ¨æ–°å¸ƒå±€ä¸­ç”Ÿæˆï¼Œä½†éœ€è¦é¢å¤–çš„æ‰‹åŠ¨å·¥ä½œå°†æ—§çš„APIç»„ç§»åŠ¨åˆ°æ–°å¸ƒå±€ã€‚</p><p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥æ·»åŠ ä¸€ä¸ª <strong>æ–°çš„ API</strong></p><h3 id="add-new-api" tabindex="-1"><a class="header-anchor" href="#add-new-api" aria-hidden="true">#</a> add new api</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubebuilder create api <span class="token parameter variable">--group</span> batch <span class="token parameter variable">--version</span> v1 <span class="token parameter variable">--kind</span> CronJob
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŒ‰ä¸‹ <code>y</code> é”®ï¼Œé€‰æ‹©â€œåˆ›å»ºèµ„æºâ€å’Œâ€œåˆ›å»ºæ§åˆ¶å™¨â€ã€‚</p><p>ç¬¬ä¸€æ¬¡ä¸ºæ¯ä¸ªç»„ç‰ˆæœ¬è°ƒç”¨æ­¤å‘½ä»¤æ—¶ï¼Œå®ƒå°†ä¸ºæ–°çš„ç»„ç‰ˆæœ¬åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚</p><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸ <code>batch.tutorial.kubebuilder.io/v1</code> å¯¹åº”çš„ <code>api/v1/</code> ç›®å½•ï¼ˆè¿˜è®°å¾—æˆ‘ä»¬ä¸€å¼€å§‹çš„ <code>--domain</code> --domainè®¾ç½®å—ï¼Ÿï¼‰ã€‚</p><p>å®ƒè¿˜ä¸ºæˆ‘ä»¬çš„ <code>CronJob</code> Kindæ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œ <code>api/v1/cronjob_types.go</code> ã€‚æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ä¸åŒç±»å‹çš„å‘½ä»¤æ—¶ï¼Œå®ƒéƒ½ä¼šæ·»åŠ ä¸€ä¸ªç›¸åº”çš„æ–°æ–‡ä»¶ã€‚</p><p>æˆ‘ä»¬çš„å‡ºå‘ç‚¹å¾ˆç®€å•ï¼šæˆ‘ä»¬å¯¼å…¥ <code>meta/v1</code> APIç»„ï¼Œå®ƒé€šå¸¸ä¸ä¼šè‡ªå·±æš´éœ²ï¼Œè€Œæ˜¯åŒ…å«æ‰€æœ‰Kubernetes Kindé€šç”¨çš„å…ƒæ•°æ®ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> v1

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºSpecå’ŒStatus of our Kindå®šä¹‰ç±»å‹ã€‚<strong>Kubernetesçš„åŠŸèƒ½æ˜¯å°†æœŸæœ›çš„çŠ¶æ€ï¼ˆ <code>Spec</code> ï¼‰ä¸å®é™…çš„é›†ç¾¤çŠ¶æ€ï¼ˆå…¶ä»–å¯¹è±¡çš„ <code>Status</code> ï¼‰å’Œå¤–éƒ¨çŠ¶æ€è¿›è¡Œåè°ƒï¼Œç„¶åè®°å½•å®ƒæ‰€è§‚å¯Ÿåˆ°çš„ï¼ˆ <code>Status</code> ï¼‰</strong>ã€‚å› æ­¤ï¼Œæ¯ä¸ªå‡½æ•°å¯¹è±¡éƒ½åŒ…æ‹¬specå’Œstatusã€‚ä¸€äº›ç±»å‹ï¼Œæ¯”å¦‚ <code>ConfigMap</code> ï¼Œä¸éµå¾ªè¿™ç§æ¨¡å¼ï¼Œå› ä¸ºå®ƒä»¬ä¸ç¼–ç æ‰€éœ€çš„çŠ¶æ€ï¼Œä½†å¤§å¤šæ•°ç±»å‹éƒ½æ˜¯è¿™æ ·ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// CronJobSpec defines the desired state of CronJob</span>
<span class="token keyword">type</span> CronJobSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// INSERT ADDITIONAL SPEC FIELDS - desired state of cluster</span>
    <span class="token comment">// Important: Run &quot;make&quot; to regenerate code after modifying this file</span>
<span class="token punctuation">}</span>

<span class="token comment">// CronJobStatus defines the observed state of CronJob</span>
<span class="token keyword">type</span> CronJobStatus <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// INSERT ADDITIONAL STATUS FIELD - define observed state of cluster</span>
    <span class="token comment">// Important: Run &quot;make&quot; to regenerate code after modifying this file</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰å¯¹åº”äºå®é™…Kindçš„ç±»å‹ï¼Œ <code>CronJob</code> å’Œ <code>CronJobList</code> ã€‚ <code>CronJob</code> æ˜¯æˆ‘ä»¬çš„æ ¹ç±»å‹ï¼Œå®ƒæè¿°äº† <code>CronJob</code> ç±»å‹ã€‚åƒæ‰€æœ‰Kuberneteså¯¹è±¡ä¸€æ ·ï¼Œå®ƒåŒ…å« <code>TypeMeta</code> ï¼ˆæè¿°APIç‰ˆæœ¬å’ŒKindï¼‰ï¼Œè¿˜åŒ…å« <code>ObjectMeta</code> ï¼Œå®ƒåŒ…å«åç§°ï¼Œå‘½åç©ºé—´å’Œæ ‡ç­¾ç­‰å†…å®¹ã€‚</p><p><code>CronJobList</code> åªæ˜¯å¤šä¸ª <code>CronJob</code> çš„å®¹å™¨ã€‚å®ƒæ˜¯åœ¨æ‰¹é‡æ“ä½œä¸­ä½¿ç”¨çš„ç±»å‹ï¼Œå¦‚LISTã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä»ä¸ä¿®æ”¹è¿™ä¸¤ä¸ªå±æ€§ä¸­çš„ä»»ä½•ä¸€ä¸ª--æ‰€æœ‰ä¿®æ”¹éƒ½åœ¨Specæˆ–Statusä¸­ã€‚</p><p>è¿™ä¸ªå°å°çš„ <code>+kubebuilder:object:root</code> æ³¨é‡Šè¢«ç§°ä¸ºæ ‡è®°ã€‚æˆ‘ä»¬å°†åœ¨ç¨åçœ‹åˆ°æ›´å¤šï¼Œä½†è¦çŸ¥é“å®ƒä»¬ä½œä¸ºé¢å¤–çš„å…ƒæ•°æ®ï¼Œå‘Šè¯‰æ§åˆ¶å™¨å·¥å…·ï¼ˆæˆ‘ä»¬çš„ä»£ç å’ŒYAMLç”Ÿæˆå™¨ï¼‰é¢å¤–çš„ä¿¡æ¯ã€‚è¿™ä¸ªç‰¹å®šçš„ç±»å‹å‘Šè¯‰ <code>object</code> ç”Ÿæˆå™¨è¿™ä¸ªç±»å‹ä»£è¡¨ä¸€ä¸ªKindã€‚ç„¶åï¼Œ <code>object</code> ç”Ÿæˆå™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆ <code>runtime.Object</code> æ¥å£çš„å®ç°ï¼Œè¿™æ˜¯æ‰€æœ‰è¡¨ç¤ºKindsçš„ç±»å‹éƒ½å¿…é¡»å®ç°çš„æ ‡å‡†æ¥å£ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//+kubebuilder:object:root=true</span>
<span class="token comment">//+kubebuilder:subresource:status</span>

<span class="token comment">// CronJob is the Schema for the cronjobs API</span>
<span class="token keyword">type</span> CronJob <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    metav1<span class="token punctuation">.</span>TypeMeta   <span class="token string">`json:&quot;,inline&quot;`</span>
    metav1<span class="token punctuation">.</span>ObjectMeta <span class="token string">`json:&quot;metadata,omitempty&quot;`</span>

    Spec   CronJobSpec   <span class="token string">`json:&quot;spec,omitempty&quot;`</span>
    Status CronJobStatus <span class="token string">`json:&quot;status,omitempty&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">//+kubebuilder:object:root=true</span>

<span class="token comment">// CronJobList contains a list of CronJob</span>
<span class="token keyword">type</span> CronJobList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    metav1<span class="token punctuation">.</span>TypeMeta <span class="token string">`json:&quot;,inline&quot;`</span>
    metav1<span class="token punctuation">.</span>ListMeta <span class="token string">`json:&quot;metadata,omitempty&quot;`</span>
    Items           <span class="token punctuation">[</span><span class="token punctuation">]</span>CronJob <span class="token string">`json:&quot;items&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬å°†Goç±»å‹æ·»åŠ åˆ°APIç»„ã€‚è¿™å…è®¸æˆ‘ä»¬å°†æ­¤APIç»„ä¸­çš„ç±»å‹æ·»åŠ åˆ°ä»»ä½• Scheme ä¸­ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    SchemeBuilder<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>CronJob<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>CronJobList<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="controller" tabindex="-1"><a class="header-anchor" href="#controller" aria-hidden="true">#</a> controller</h2><p>ä¸€å¥è¯æè¿°ï¼šControllers are the core of Kubernetes, and of any operator</p><p>æ§åˆ¶å™¨çš„å·¥ä½œæ˜¯ç¡®ä¿ï¼Œå¯¹äºä»»ä½•ç»™å®šçš„å¯¹è±¡ï¼Œä¸–ç•Œçš„å®é™…çŠ¶æ€ï¼ˆåŒ…æ‹¬é›†ç¾¤çŠ¶æ€ï¼Œä»¥åŠæ½œåœ¨çš„å¤–éƒ¨çŠ¶æ€ï¼Œå¦‚Kubeletçš„è¿è¡Œå®¹å™¨æˆ–äº‘æä¾›å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼‰ä¸å¯¹è±¡ä¸­æ‰€éœ€çš„çŠ¶æ€ç›¸åŒ¹é…ã€‚</p><p>æ¯ä¸ªæ§åˆ¶å™¨ä¸“æ³¨äºä¸€ä¸ª root Kindï¼Œä½†å¯ä»¥ä¸å…¶ä»–Kindäº¤äº’ã€‚</p><p>æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸ºå’Œè§£ï¼ˆ <em>reconciling</em>ï¼‰ã€‚</p><p>åœ¨controller-runtimeä¸­ï¼Œå®ç°ç‰¹å®šç±»å‹åè°ƒçš„é€»è¾‘ç§°ä¸ºReconcilerã€‚reconcilerè·å–å¯¹è±¡çš„åç§°ï¼Œå¹¶è¿”å›æ˜¯å¦éœ€è¦é‡è¯•ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå‡ºç°é”™è¯¯æˆ–å‘¨æœŸæ€§æ§åˆ¶å™¨ï¼Œå¦‚HorizontalPodAutoscalerï¼‰ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»ä¸€äº›æ ‡å‡†çš„å¯¼å…¥å¼€å§‹ã€‚å’Œå‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦æ ¸å¿ƒæ§åˆ¶å™¨è¿è¡Œæ—¶åº“ï¼Œä»¥åŠå®¢æˆ·ç«¯åŒ…å’ŒAPIç±»å‹çš„åŒ…ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;context&quot;</span>

    <span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
    ctrl <span class="token string">&quot;sigs.k8s.io/controller-runtime&quot;</span>
    <span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span>
    <span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/log&quot;</span>

    batchv1 <span class="token string">&quot;tutorial.kubebuilder.io/project/api/v1&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œkubebuilderä¸ºæˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„reconcilerç»“æ„ã€‚å‡ ä¹æ¯ä¸ªåè°ƒå™¨éƒ½éœ€è¦æ—¥å¿—ï¼Œå¹¶ä¸”éœ€è¦èƒ½å¤Ÿè·å–å¯¹è±¡ï¼Œå› æ­¤è¿™äº›éƒ½æ˜¯å¼€ç®±å³ç”¨çš„ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// CronJobReconciler reconciles a CronJob object</span>
<span class="token keyword">type</span> CronJobReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span>Client
    Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¤§å¤šæ•°æ§åˆ¶å™¨æœ€ç»ˆéƒ½åœ¨é›†ç¾¤ä¸Šè¿è¡Œï¼Œå› æ­¤å®ƒä»¬éœ€è¦RBACæƒé™ï¼Œæˆ‘ä»¬ä½¿ç”¨controller-tools RBACæ ‡è®°æ¥æŒ‡å®šè¿™äº›æƒé™ã€‚è¿™äº›æ˜¯è¿è¡Œæ‰€éœ€çš„æœ€ä½æƒé™ã€‚å½“æˆ‘ä»¬æ·»åŠ æ›´å¤šåŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦é‡æ–°è®¿é—®è¿™äº›ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// +kubebuilder:rbac:groups=batch.tutorial.kubebuilder.io,resources=cronjobs,verbs=get;list;watch;create;update;patch;delete</span>
<span class="token comment">// +kubebuilder:rbac:groups=batch.tutorial.kubebuilder.io,resources=cronjobs/status,verbs=get;update;patch</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡controller-genä»ä¸Šè¿°æ ‡è®°ç”Ÿæˆ <code>config/rbac/role.yaml</code> å¤„çš„ <code>ClusterRole</code> æ¸…å•ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">make</span> manifests
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="å®ç°-controller" tabindex="-1"><a class="header-anchor" href="#å®ç°-controller" aria-hidden="true">#</a> å®ç° Controller</h3><p>æˆ‘ä»¬é€šè¿‡å®ç° Controller é€»è¾‘å»åˆ›å»º Podï¼Œåœ¨ <code>internal/controller/guestbook_controller.go</code></p><p>æˆ‘ä»¬çš„CronJobæ§åˆ¶å™¨çš„åŸºæœ¬é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åŠ è½½å‘½åçš„ CronJob</li><li>åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ jobs å¹¶æ›´æ–°çŠ¶æ€</li><li>æ ¹æ®å†å²é™åˆ¶æ¸…ç† history limits</li><li>æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦è¢«æš‚åœï¼ˆå¦‚æœæ˜¯ï¼Œä¸è¦åšä»»ä½•å…¶ä»–äº‹æƒ…ï¼‰</li><li>è·å–ä¸‹ä¸€æ¬¡è®¡åˆ’è¿è¡Œ</li><li>è¿è¡Œä¸€ä¸ªæ–°çš„ jobï¼Œå¦‚æœå®ƒæ˜¯æŒ‰è®¡åˆ’è¿›è¡Œçš„ï¼Œæ²¡æœ‰è¶…è¿‡æˆªæ­¢æ—¥æœŸï¼Œä¹Ÿæ²¡æœ‰è¢«æˆ‘ä»¬çš„å¹¶å‘ç­–ç•¥é˜»å¡</li><li>å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ jobï¼ˆè‡ªåŠ¨å®Œæˆï¼‰æˆ–è€…åˆ°äº†ä¸‹ä¸€ä¸ªè®¡åˆ’è¿è¡Œçš„æ—¶é—´æ—¶ï¼Œé‡æ–°æ’é˜Ÿã€‚</li></ol><p>æˆ‘ä»¬å…ˆä»è¿›å£å¼€å§‹ã€‚ä¸‹é¢ä½ ä¼šçœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦æ¯”é‚£äº›è„šæ‰‹æ¶æ›´å¤šçš„è¿›å£ã€‚æˆ‘ä»¬å°†åœ¨ä½¿ç”¨æ—¶è®¨è®ºæ¯ä¸€ä¸ªã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> controllers

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;context&quot;</span>
    <span class="token string">&quot;fmt&quot;</span>
    <span class="token string">&quot;sort&quot;</span>
    <span class="token string">&quot;time&quot;</span>

    <span class="token string">&quot;github.com/robfig/cron&quot;</span>
    kbatch <span class="token string">&quot;k8s.io/api/batch/v1&quot;</span>
    corev1 <span class="token string">&quot;k8s.io/api/core/v1&quot;</span>
    metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
    <span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
    ref <span class="token string">&quot;k8s.io/client-go/tools/reference&quot;</span>
    ctrl <span class="token string">&quot;sigs.k8s.io/controller-runtime&quot;</span>
    <span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/client&quot;</span>
    <span class="token string">&quot;sigs.k8s.io/controller-runtime/pkg/log&quot;</span>

    batchv1 <span class="token string">&quot;tutorial.kubebuilder.io/project/api/v1&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ—¶é’Ÿï¼Œè¿™å°†å…è®¸æˆ‘ä»¬åœ¨æµ‹è¯•ä¸­ä¼ªé€ æ—¶é—´ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// CronJobReconciler reconciles a CronJob object</span>
<span class="token keyword">type</span> CronJobReconciler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span>Client
    Scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme
    Clock
<span class="token punctuation">}</span>
<span class="token comment">// Clock</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å°†æ¨¡æ‹Ÿæ—¶é’Ÿï¼Œä»¥ä¾¿åœ¨æµ‹è¯•æ—¶æ›´å®¹æ˜“åœ¨æ—¶é—´ä¸Šè·³è·ƒï¼Œâ€œçœŸå®çš„â€ æ—¶é’Ÿåªæ˜¯è°ƒç”¨ <code>time.Now</code> ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> realClock <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span><span class="token boolean">_</span> realClock<span class="token punctuation">)</span> <span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{</span> <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">// clock knows how to get the current time.</span>
<span class="token comment">// It can be used to fake out timing for testing.</span>
<span class="token keyword">type</span> Clock <span class="token keyword">interface</span> <span class="token punctuation">{</span>
    <span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›RBACæƒé™--å› ä¸ºæˆ‘ä»¬ç°åœ¨æ­£åœ¨åˆ›å»ºå’Œç®¡ç†ä½œä¸šï¼Œæ‰€ä»¥éœ€è¦è¿™äº›æƒé™ï¼Œè¿™æ„å‘³ç€è¦æ·»åŠ ä¸€äº›æ ‡è®°ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">//+kubebuilder:rbac:groups=batch.tutorial.kubebuilder.io,resources=cronjobs,verbs=get;list;watch;create;update;patch;delete</span>
<span class="token comment">//+kubebuilder:rbac:groups=batch.tutorial.kubebuilder.io,resources=cronjobs/status,verbs=get;update;patch</span>
<span class="token comment">//+kubebuilder:rbac:groups=batch.tutorial.kubebuilder.io,resources=cronjobs/finalizers,verbs=update</span>
<span class="token comment">//+kubebuilder:rbac:groups=batch,resources=jobs,verbs=get;list;watch;create;update;patch;delete</span>
<span class="token comment">//+kubebuilder:rbac:groups=batch,resources=jobs/status,verbs=get</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬è¿›å…¥æ§åˆ¶å™¨çš„æ ¸å¿ƒ--åè°ƒå™¨é€»è¾‘ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
    scheduledTimeAnnotation <span class="token operator">=</span> <span class="token string">&quot;batch.tutorial.kubebuilder.io/scheduled-at&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// Reconcile is part of the main kubernetes reconciliation loop which aims to</span>
<span class="token comment">// move the current state of the cluster closer to the desired state.</span>
<span class="token comment">// TODO(user): Modify the Reconcile function to compare the state specified by</span>
<span class="token comment">// the CronJob object against the actual cluster state, and then</span>
<span class="token comment">// perform operations to make the cluster state reflect the state specified by</span>
<span class="token comment">// the user.</span>
<span class="token comment">//</span>
<span class="token comment">// For more details, check Reconcile and its Result here:</span>
<span class="token comment">// - https://pkg.go.dev/sigs.k8s.io/controller-runtime@v0.13.0/pkg/reconcile</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>r <span class="token operator">*</span>CronJobReconciler<span class="token punctuation">)</span> <span class="token function">Reconcile</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req ctrl<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log <span class="token operator">:=</span> log<span class="token punctuation">.</span><span class="token function">FromContext</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŒ‰åç§°åŠ è½½cronjob" tabindex="-1"><a class="header-anchor" href="#æŒ‰åç§°åŠ è½½cronjob" aria-hidden="true">#</a> æŒ‰åç§°åŠ è½½CronJob</h3><p>æˆ‘ä»¬å°†ä½¿ç”¨å®¢æˆ·ç«¯è·å–CronJobã€‚æ‰€æœ‰å®¢æˆ·ç«¯æ–¹æ³•éƒ½å°†ä¸Šä¸‹æ–‡ï¼ˆä»¥å…è®¸å–æ¶ˆï¼‰ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¹¶å°†æœ‰é—®é¢˜çš„å¯¹è±¡ä½œä¸ºå…¶æœ€åä¸€ä¸ªå‚æ•°ã€‚Getæœ‰ç‚¹ç‰¹æ®Šï¼Œå®ƒå°† <code>NamespacedName</code> ä½œä¸ºä¸­é—´å‚æ•°ï¼ˆå¤§å¤šæ•°æ²¡æœ‰ä¸­é—´å‚æ•°ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çœ‹åˆ°ï¼‰ã€‚</p><p>è®¸å¤šå®¢æˆ·ç«¯æ–¹æ³•ä¹Ÿåœ¨æœ€åé‡‡ç”¨å¯å˜å‚æ•°é€‰é¡¹ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> cronJob batchv1<span class="token punctuation">.</span>CronJob
<span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> req<span class="token punctuation">.</span>NamespacedName<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cronJob<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to fetch CronJob&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// we&#39;ll ignore not-found errors, since they can&#39;t be fixed by an immediate</span>
    <span class="token comment">// requeue (we&#39;ll need to wait for a new notification), and we can get them</span>
    <span class="token comment">// on deleted requests.</span>
    <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ä½œä¸š-å¹¶æ›´æ–°çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ä½œä¸š-å¹¶æ›´æ–°çŠ¶æ€" aria-hidden="true">#</a> åˆ—å‡ºæ‰€æœ‰æ´»åŠ¨ä½œä¸šï¼Œå¹¶æ›´æ–°çŠ¶æ€</h3><p>è¦å®Œå…¨æ›´æ–°çŠ¶æ€ï¼Œæˆ‘ä»¬éœ€è¦åˆ—å‡ºæ­¤å‘½åç©ºé—´ä¸­å±äºæ­¤CronJobçš„æ‰€æœ‰å­ä½œä¸šã€‚ä¸Getç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Listæ–¹æ³•åˆ—å‡ºå­ä½œä¸šã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">var</span> childJobs kbatch<span class="token punctuation">.</span>JobList
    <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">List</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>childJobs<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">InNamespace</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>Namespace<span class="token punctuation">)</span><span class="token punctuation">,</span> client<span class="token punctuation">.</span>MatchingFields<span class="token punctuation">{</span>jobOwnerKey<span class="token punctuation">:</span> req<span class="token punctuation">.</span>Name<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to list child Jobs&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦æˆ‘ä»¬æ‹¥æœ‰äº†æ‰€æœ‰çš„ä½œä¸šï¼Œæˆ‘ä»¬å°†æŠŠå®ƒä»¬åˆ†æˆæ´»åŠ¨çš„ã€æˆåŠŸçš„å’Œå¤±è´¥çš„ä½œä¸šï¼Œè·Ÿè¸ªæœ€è¿‘çš„è¿è¡Œï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨çŠ¶æ€ä¸­è®°å½•å®ƒã€‚</p><p>è¯·è®°ä½ï¼ŒçŠ¶æ€åº”è¯¥èƒ½å¤Ÿä»ä¸–ç•Œçš„çŠ¶æ€ä¸­é‡æ–°æ„å»ºï¼Œå› æ­¤é€šå¸¸ä»æ ¹å¯¹è±¡çš„çŠ¶æ€ä¸­è¯»å–ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ç›¸åï¼Œæ‚¨åº”è¯¥åœ¨æ¯æ¬¡è¿è¡Œæ—¶é‡æ–°æ„å»ºå®ƒã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦åšçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çŠ¶æ€æ¡ä»¶æ£€æŸ¥ä½œä¸šæ˜¯å¦â€œå®Œæˆâ€ä»¥åŠå®ƒæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ªé€»è¾‘æ”¾åœ¨ä¸€ä¸ªå¸®åŠ©å™¨ä¸­ï¼Œä»¥ä½¿æˆ‘ä»¬çš„ä»£ç æ›´æ¸…æ™°ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token comment">// find the active list of jobs</span>
    <span class="token keyword">var</span> activeJobs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>kbatch<span class="token punctuation">.</span>Job
    <span class="token keyword">var</span> successfulJobs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>kbatch<span class="token punctuation">.</span>Job
    <span class="token keyword">var</span> failedJobs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>kbatch<span class="token punctuation">.</span>Job
    <span class="token keyword">var</span> mostRecentTime <span class="token operator">*</span>time<span class="token punctuation">.</span>Time <span class="token comment">// find the last run so we can update the status</span>
<span class="token comment">// isJobFinished</span>
<span class="token comment">// getScheduledTimeForJob</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> job <span class="token operator">:=</span> <span class="token keyword">range</span> childJobs<span class="token punctuation">.</span>Items <span class="token punctuation">{</span>
        <span class="token boolean">_</span><span class="token punctuation">,</span> finishedType <span class="token operator">:=</span> <span class="token function">isJobFinished</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>job<span class="token punctuation">)</span>
        <span class="token keyword">switch</span> finishedType <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span> <span class="token comment">// ongoing</span>
            activeJobs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>activeJobs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>childJobs<span class="token punctuation">.</span>Items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> kbatch<span class="token punctuation">.</span>JobFailed<span class="token punctuation">:</span>
            failedJobs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>failedJobs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>childJobs<span class="token punctuation">.</span>Items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> kbatch<span class="token punctuation">.</span>JobComplete<span class="token punctuation">:</span>
            successfulJobs <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>successfulJobs<span class="token punctuation">,</span> <span class="token operator">&amp;</span>childJobs<span class="token punctuation">.</span>Items<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// We&#39;ll store the launch time in an annotation, so we&#39;ll reconstitute that from</span>
        <span class="token comment">// the active jobs themselves.</span>
        scheduledTimeForJob<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getScheduledTimeForJob</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>job<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to parse schedule time for child job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>job<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> scheduledTimeForJob <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> mostRecentTime <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                mostRecentTime <span class="token operator">=</span> scheduledTimeForJob
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> mostRecentTime<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token operator">*</span>scheduledTimeForJob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mostRecentTime <span class="token operator">=</span> scheduledTimeForJob
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> mostRecentTime <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        cronJob<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>LastScheduleTime <span class="token operator">=</span> <span class="token operator">&amp;</span>metav1<span class="token punctuation">.</span>Time<span class="token punctuation">{</span>Time<span class="token punctuation">:</span> <span class="token operator">*</span>mostRecentTime<span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        cronJob<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>LastScheduleTime <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
    cronJob<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Active <span class="token operator">=</span> <span class="token boolean">nil</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> activeJob <span class="token operator">:=</span> <span class="token keyword">range</span> activeJobs <span class="token punctuation">{</span>
        jobRef<span class="token punctuation">,</span> err <span class="token operator">:=</span> ref<span class="token punctuation">.</span><span class="token function">GetReference</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>Scheme<span class="token punctuation">,</span> activeJob<span class="token punctuation">)</span>
        <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to make reference to active job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> activeJob<span class="token punctuation">)</span>
            <span class="token keyword">continue</span>
        <span class="token punctuation">}</span>
        cronJob<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Active <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>cronJob<span class="token punctuation">.</span>Status<span class="token punctuation">.</span>Active<span class="token punctuation">,</span> <span class="token operator">*</span>jobRef<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è®°å½•æˆ‘ä»¬åœ¨ç¨é«˜çš„æ—¥å¿—çº§åˆ«ä¸Šè§‚å¯Ÿåˆ°çš„ä½œä¸šæ•°é‡ï¼Œä»¥ä¾¿è¿›è¡Œè°ƒè¯•ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä¸æ˜¯ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯ä½¿ç”¨å›ºå®šæ¶ˆæ¯ï¼Œå¹¶é™„åŠ å¸¦æœ‰é¢å¤–ä¿¡æ¯çš„é”®å€¼å¯¹ã€‚è¿™ä½¿å¾—è¿‡æ»¤å’ŒæŸ¥è¯¢æ—¥å¿—è¡Œæ›´åŠ å®¹æ˜“ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;job count&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;active jobs&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>activeJobs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;successful jobs&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>successfulJobs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;failed jobs&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>failedJobs<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨æˆ‘ä»¬æ”¶é›†çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†æ›´æ–°CRDçš„çŠ¶æ€ã€‚å°±åƒä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ©ç”¨æˆ‘ä»¬çš„å®¢æˆ·ã€‚ä¸ºäº†ä¸“é—¨æ›´æ–°çŠ¶æ€å­èµ„æºï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®¢æˆ·ç«¯çš„ <code>Status</code> éƒ¨åˆ†å’Œ <code>Update</code> æ–¹æ³•ã€‚</p><p>statuså­èµ„æºå¿½ç•¥å¯¹specçš„æ›´æ”¹ï¼Œå› æ­¤å®ƒä¸å¤ªå¯èƒ½ä¸ä»»ä½•å…¶ä»–æ›´æ–°å†²çªï¼Œå¹¶ä¸”å¯ä»¥å…·æœ‰å•ç‹¬çš„æƒé™ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cronJob<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to update CronJob status&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦æˆ‘ä»¬æ›´æ–°äº†æˆ‘ä»¬çš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ç¡®ä¿ä¸–ç•Œçš„çŠ¶æ€ä¸æˆ‘ä»¬åœ¨è§„èŒƒä¸­æƒ³è¦çš„ç›¸åŒ¹é…ã€‚</p><h3 id="æ ¹æ®å†å²é™åˆ¶æ¸…ç†æ—§ä½œä¸š" tabindex="-1"><a class="header-anchor" href="#æ ¹æ®å†å²é™åˆ¶æ¸…ç†æ—§ä½œä¸š" aria-hidden="true">#</a> æ ¹æ®å†å²é™åˆ¶æ¸…ç†æ—§ä½œä¸š</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†åŠªåŠ›æ¸…ç†æ—§çš„å·¥ä½œï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šç•™ä¸‹å¤ªå¤šçš„é—²ç½®å·¥ä½œã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// NB: deleting these are &quot;best effort&quot; -- if we fail on a particular one,</span>
    <span class="token comment">// we won&#39;t requeue just to finish the deleting.</span>
    <span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>FailedJobsHistoryLimit <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        sort<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span>failedJobs<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> failedJobs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> failedJobs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime <span class="token operator">!=</span> <span class="token boolean">nil</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> failedJobs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>failedJobs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> job <span class="token operator">:=</span> <span class="token keyword">range</span> failedJobs <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token function">int32</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">int32</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>failedJobs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">*</span>cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>FailedJobsHistoryLimit <span class="token punctuation">{</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> job<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">PropagationPolicy</span><span class="token punctuation">(</span>metav1<span class="token punctuation">.</span>DeletePropagationBackground<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to delete old failed job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;deleted old failed job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>SuccessfulJobsHistoryLimit <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        sort<span class="token punctuation">.</span><span class="token function">Slice</span><span class="token punctuation">(</span>successfulJobs<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> successfulJobs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> successfulJobs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime <span class="token operator">!=</span> <span class="token boolean">nil</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> successfulJobs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>successfulJobs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>Status<span class="token punctuation">.</span>StartTime<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> job <span class="token operator">:=</span> <span class="token keyword">range</span> successfulJobs <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token function">int32</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token function">int32</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>successfulJobs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">*</span>cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>SuccessfulJobsHistoryLimit <span class="token punctuation">{</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> job<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">PropagationPolicy</span><span class="token punctuation">(</span>metav1<span class="token punctuation">.</span>DeletePropagationBackground<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to delete old successful job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;deleted old successful job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ£€æŸ¥æ˜¯å¦åœæ­¢" tabindex="-1"><a class="header-anchor" href="#æ£€æŸ¥æ˜¯å¦åœæ­¢" aria-hidden="true">#</a> æ£€æŸ¥æ˜¯å¦åœæ­¢</h3><p>å¦‚æœè¿™ä¸ªå¯¹è±¡è¢«æŒ‚èµ·ï¼Œæˆ‘ä»¬ä¸æƒ³è¿è¡Œä»»ä½•ä½œä¸šï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨åœæ­¢ã€‚å¦‚æœæˆ‘ä»¬æ­£åœ¨è¿è¡Œçš„ä½œä¸šå‡ºç°æ•…éšœï¼Œå¹¶ä¸”æˆ‘ä»¬å¸Œæœ›æš‚åœè¿è¡Œä»¥è¿›è¡Œè°ƒæŸ¥æˆ–å¤„ç†é›†ç¾¤ï¼Œè€Œä¸åˆ é™¤å¯¹è±¡ï¼Œåˆ™æ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Suspend <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>Suspend <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;cronjob suspended, skipping&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è·å–ä¸‹ä¸€æ¬¡è®¡åˆ’è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#è·å–ä¸‹ä¸€æ¬¡è®¡åˆ’è¿è¡Œ" aria-hidden="true">#</a> è·å–ä¸‹ä¸€æ¬¡è®¡åˆ’è¿è¡Œ</h3><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æš‚åœï¼Œæˆ‘ä»¬å°†éœ€è¦è®¡ç®—ä¸‹ä¸€ä¸ªè®¡åˆ’çš„è¿è¡Œï¼Œä»¥åŠæˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ªå°šæœªå¤„ç†çš„è¿è¡Œã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// getNextSchedule</span>
    <span class="token comment">// figure out the next times that we need to create</span>
    <span class="token comment">// jobs at (or anything we missed).</span>
    missedRun<span class="token punctuation">,</span> nextRun<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">getNextSchedule</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cronJob<span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to figure out CronJob schedule&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// we don&#39;t really care about requeuing until we get an update that</span>
        <span class="token comment">// fixes the schedule, so don&#39;t return an error</span>
        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å°†å‡†å¤‡æœ€ç»ˆçš„è¯·æ±‚ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€ä¸ªä½œä¸šä¹‹å‰é‡æ–°æ’é˜Ÿï¼Œç„¶åç¡®å®šæˆ‘ä»¬æ˜¯å¦å®é™…éœ€è¦è¿è¡Œã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    scheduledResult <span class="token operator">:=</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span>RequeueAfter<span class="token punctuation">:</span> nextRun<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// save this so we can re-use it elsewhere</span>
    log <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">WithValues</span><span class="token punctuation">(</span><span class="token string">&quot;now&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;next run&quot;</span><span class="token punctuation">,</span> nextRun<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è¿è¡Œä¸€ä¸ªæ–°çš„ä½œä¸š-å¦‚æœå®ƒæ˜¯æŒ‰è®¡åˆ’è¿›è¡Œçš„-æ²¡æœ‰è¶…è¿‡æˆªæ­¢æ—¥æœŸ-ä¹Ÿæ²¡æœ‰è¢«æˆ‘ä»¬çš„å¹¶å‘ç­–ç•¥é˜»å¡" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œä¸€ä¸ªæ–°çš„ä½œä¸š-å¦‚æœå®ƒæ˜¯æŒ‰è®¡åˆ’è¿›è¡Œçš„-æ²¡æœ‰è¶…è¿‡æˆªæ­¢æ—¥æœŸ-ä¹Ÿæ²¡æœ‰è¢«æˆ‘ä»¬çš„å¹¶å‘ç­–ç•¥é˜»å¡" aria-hidden="true">#</a> è¿è¡Œä¸€ä¸ªæ–°çš„ä½œä¸šï¼Œå¦‚æœå®ƒæ˜¯æŒ‰è®¡åˆ’è¿›è¡Œçš„ï¼Œæ²¡æœ‰è¶…è¿‡æˆªæ­¢æ—¥æœŸï¼Œä¹Ÿæ²¡æœ‰è¢«æˆ‘ä»¬çš„å¹¶å‘ç­–ç•¥é˜»å¡</h3><p>å¦‚æœæˆ‘ä»¬é”™è¿‡äº†ä¸€ä¸ªè¿è¡Œï¼Œå¹¶ä¸”æˆ‘ä»¬ä»ç„¶åœ¨å¼€å§‹å®ƒçš„æˆªæ­¢æ—¥æœŸå†…ï¼Œæˆ‘ä»¬å°†éœ€è¦è¿è¡Œä¸€ä¸ªä½œä¸šã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token keyword">if</span> missedRun<span class="token punctuation">.</span><span class="token function">IsZero</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;no upcoming scheduled times, sleeping until next&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> scheduledResult<span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// make sure we&#39;re not too late to start the run</span>
    log <span class="token operator">=</span> log<span class="token punctuation">.</span><span class="token function">WithValues</span><span class="token punctuation">(</span><span class="token string">&quot;current run&quot;</span><span class="token punctuation">,</span> missedRun<span class="token punctuation">)</span>
    tooLate <span class="token operator">:=</span> <span class="token boolean">false</span>
    <span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>StartingDeadlineSeconds <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        tooLate <span class="token operator">=</span> missedRun<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span><span class="token operator">*</span>cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>StartingDeadlineSeconds<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> tooLate <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;missed starting deadline for last run, sleeping till next&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// TODO(directxman12): events</span>
        <span class="token keyword">return</span> scheduledResult<span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæˆ‘ä»¬å®é™…ä¸Šå¿…é¡»è¿è¡Œä¸€ä¸ªä½œä¸šï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾…ç°æœ‰çš„ä½œä¸šå®Œæˆï¼Œæ›¿æ¢ç°æœ‰çš„ä½œä¸šï¼Œæˆ–è€…åªæ˜¯æ·»åŠ æ–°çš„ä½œä¸šã€‚å¦‚æœæˆ‘ä»¬çš„ä¿¡æ¯ç”±äºç¼“å­˜å»¶è¿Ÿè€Œè¿‡æœŸï¼Œæˆ‘ä»¬å°†åœ¨è·å¾—æœ€æ–°ä¿¡æ¯æ—¶é‡æ–°æ’é˜Ÿã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token comment">// figure out how to run this job -- concurrency policy might forbid us from running</span>
    <span class="token comment">// multiple at the same time...</span>
    <span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>ConcurrencyPolicy <span class="token operator">==</span> batchv1<span class="token punctuation">.</span>ForbidConcurrent <span class="token operator">&amp;&amp;</span> <span class="token function">len</span><span class="token punctuation">(</span>activeJobs<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;concurrency policy blocks concurrent runs, skipping&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;num active&quot;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>activeJobs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> scheduledResult<span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...or instruct us to replace existing ones...</span>
    <span class="token keyword">if</span> cronJob<span class="token punctuation">.</span>Spec<span class="token punctuation">.</span>ConcurrencyPolicy <span class="token operator">==</span> batchv1<span class="token punctuation">.</span>ReplaceConcurrent <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> activeJob <span class="token operator">:=</span> <span class="token keyword">range</span> activeJobs <span class="token punctuation">{</span>
            <span class="token comment">// we don&#39;t care if the job was already deleted</span>
            <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> activeJob<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">PropagationPolicy</span><span class="token punctuation">(</span>metav1<span class="token punctuation">.</span>DeletePropagationBackground<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> client<span class="token punctuation">.</span><span class="token function">IgnoreNotFound</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to delete active job&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> activeJob<span class="token punctuation">)</span>
                <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸€æ—¦æˆ‘ä»¬å¼„æ¸…æ¥šäº†å¦‚ä½•å¤„ç†ç°æœ‰çš„å·¥ä½œï¼Œæˆ‘ä»¬å®é™…ä¸Šå°±ä¼šåˆ›é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„å·¥ä½œ</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// constructJobForCronJob</span>
    <span class="token comment">// actually make the job...</span>
    job<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">constructJobForCronJob</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cronJob<span class="token punctuation">,</span> missedRun<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to construct job from template&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// don&#39;t bother requeuing until we get a change to the spec</span>
        <span class="token keyword">return</span> scheduledResult<span class="token punctuation">,</span> <span class="token boolean">nil</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...and create it on the cluster</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> job<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">&quot;unable to create Job for CronJob&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
        <span class="token keyword">return</span> ctrl<span class="token punctuation">.</span>Result<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> err
    <span class="token punctuation">}</span>

    log<span class="token punctuation">.</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">&quot;created Job for CronJob run&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;job&quot;</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ä½œä¸šæˆ–è€…åˆ°äº†ä¸‹ä¸€ä¸ªè®¡åˆ’è¿è¡Œçš„æ—¶é—´æ—¶é‡æ–°æ’é˜Ÿ" tabindex="-1"><a class="header-anchor" href="#å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ä½œä¸šæˆ–è€…åˆ°äº†ä¸‹ä¸€ä¸ªè®¡åˆ’è¿è¡Œçš„æ—¶é—´æ—¶é‡æ–°æ’é˜Ÿ" aria-hidden="true">#</a> å½“æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ä½œä¸šæˆ–è€…åˆ°äº†ä¸‹ä¸€ä¸ªè®¡åˆ’è¿è¡Œçš„æ—¶é—´æ—¶é‡æ–°æ’é˜Ÿ</h3><p>æœ€åï¼Œæˆ‘ä»¬å°†è¿”å›ä¸Šé¢å‡†å¤‡çš„ç»“æœï¼Œå®ƒè¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›åœ¨ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é‡æ–°æ’é˜Ÿã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªæœ€å¤§çš„æœŸé™--å¦‚æœåœ¨è¿™æœŸé—´å‘ç”Ÿäº†å…¶ä»–å˜åŒ–ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å·¥ä½œå¼€å§‹æˆ–ç»“æŸï¼Œæˆ‘ä»¬è¢«ä¿®æ”¹ï¼Œç­‰ç­‰ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ›´å¿«åœ°å†æ¬¡åè°ƒã€‚</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>    <span class="token comment">// we&#39;ll requeue once we see the running job, and update our status</span>
    <span class="token keyword">return</span> scheduledResult<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯åŠ¨-controller" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨-controller" aria-hidden="true">#</a> å¯åŠ¨ Controller</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å¯åŠ¨è¿™ä¸ª Controller æ¥çœ‹ä¸€ä¸‹æ•ˆæœ</p><p>ç›´æ¥è¿è¡Œ <code>make run</code> å³å¯è¿è¡Œä»£ç ï¼Œå†ç»ˆç«¯ä¸­å¯ä»¥çœ‹åˆ°æ—¥å¿—è¾“å‡ºã€‚</p><p>æŸ¥çœ‹ Pod æ˜¯å¦æˆåŠŸåˆ›å»ºå‡ºæ¥äº†ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get pod 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="éƒ¨ç½²-controller" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-controller" aria-hidden="true">#</a> éƒ¨ç½² Controller</h3><p>æˆ‘ä»¬å°†å…¶éƒ¨ç½²äº†äº†ä¸€ä¸ª ç¤ºä¾‹ï¼Œä¹Ÿè¿è¡Œ Controller çœ‹åˆ°äº†ç›¸åº”çš„ å‰¯æœ¬ Pod è¢«åˆ›å»ºå‡ºæ¥äº†ï¼Œç°åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥æ¨¡æ‹Ÿ Operator å®é™…ä½¿ç”¨æ—¶çš„éƒ¨ç½²æ–¹å¼ï¼ŒæŠŠ Controller æ‰“åŒ…åä»¥ container çš„æ–¹å¼éƒ¨ç½²åˆ° Kubernetes é›†ç¾¤ç¯å¢ƒä¸­ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># æ„å»ºé•œåƒ</span>
<span class="token function">make</span> docker-build <span class="token assign-left variable">IMG</span><span class="token operator">=</span>application-operator:v0.0.1

<span class="token comment"># æ¨é€åˆ° Kind ç¯å¢ƒ</span>
kind load docker-image

<span class="token comment"># éƒ¨ç½² controller </span>
<span class="token function">make</span> deploy <span class="token assign-left variable">IMG</span><span class="token operator">=</span>application-operator:v0.0.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è¡¥å……ï¼šæˆ‘ä»¬å¯ä»¥åœ¨ dockerfile ä¸­è§£å†³Goè¯­è¨€çš„ä»£ç†é—®é¢˜ï¼š</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>ENV <span class="token assign-left variable">GOPROXY</span><span class="token operator">=</span>https://goproxy.op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="èµ„æºæ¸…ç†" tabindex="-1"><a class="header-anchor" href="#èµ„æºæ¸…ç†" aria-hidden="true">#</a> èµ„æºæ¸…ç†</h3><p>ä¸Šé¢æœ‰è®²è¿‡ï¼Œç”¨ Makefile å‘½ä»¤æ¸…ç†è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæˆ‘ä»¬ç›´æ¥æ¸…ç†å°±å¥½äº†ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># å¸è½½ controller</span>
<span class="token function">make</span> undeploy

<span class="token comment"># å¸è½½ CRD</span>
<span class="token function">make</span> uninstall
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="client-go" tabindex="-1"><a class="header-anchor" href="#client-go" aria-hidden="true">#</a> Client-go</h2><p>Kubeilder å·²ç»å±è”½äº† client-go çš„ç»†èŠ‚ï¼Œä½†æ˜¯å¦‚æœå¸Œæœ›æ·±å…¥æŒæ¡ Operator å¼€å‘æœºåˆ¶ï¼Œè¿˜æ˜¯éœ€è¦å¯¹ Client-go ç†Ÿæ‚‰çš„ã€‚</p><p>è¿™æ˜¯ä¸€ç¯‡è¿˜æ²¡å…¥é—¨çš„æ¦‚å¿µäº†è§£ç¬”è®°ï¼š</p><ul><li><a href="https://docker.nsddd.top/Cloud-Native-k8s/35.html" target="_blank" rel="noopener noreferrer">ç¬”è®°éƒ¨åˆ† ~<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>Kubernetes APIæ˜¯ä¸€ç»„REST APIï¼Œç”¨äºä¸Kubernetesé›†ç¾¤äº¤äº’ã€‚è¿™äº›APIå…è®¸å¼€å‘äººå‘˜æ‰§è¡Œå„ç§æ“ä½œï¼ŒåŒ…æ‹¬ç®¡ç†Podã€Deploymentã€Serviceã€Namespaceç­‰ã€‚Kubernetes APIç”±ä¸€ç»„èµ„æºå¯¹è±¡è¡¨ç¤ºï¼Œä¾‹å¦‚Podã€Serviceã€ReplicaSetç­‰ã€‚è¿™äº›èµ„æºå¯¹è±¡ç”±Kubernetes API Serverç®¡ç†ï¼Œå¹¶å¯ä»¥é€šè¿‡kubectlç­‰å·¥å…·è¿›è¡ŒæŸ¥è¯¢å’Œä¿®æ”¹ã€‚</p><table><thead><tr><th>æ–¹å¼</th><th>ç‰¹ç‚¹</th><th>æ”¯æŒè€…</th></tr></thead><tbody><tr><td>Kubernetes dashboard</td><td>ç›´æ¥é€šè¿‡Web UIè¿›è¡Œæ“ä½œï¼Œç®€å•ç›´æ¥ï¼Œå¯å®šåˆ¶åŒ–ç¨‹åº¦ä½</td><td>å®˜æ–¹æ”¯æŒ</td></tr><tr><td>kubectl</td><td>å‘½ä»¤è¡Œæ“ä½œï¼ŒåŠŸèƒ½æœ€å…¨ï¼Œä½†æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œé€‚åˆå¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†è£…ï¼Œå®šåˆ¶åŠŸèƒ½ï¼Œç‰ˆæœ¬é€‚é…æœ€å¥½</td><td>å®˜æ–¹æ”¯æŒ</td></tr><tr><td><a href="https://github.com/kubernetes/client-go" target="_blank" rel="noopener noreferrer">client-go<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td>ä»kubernetesçš„ä»£ç ä¸­æŠ½ç¦»å‡ºæ¥çš„å®¢æˆ·ç«¯åŒ…ï¼Œç®€å•æ˜“ç”¨ï¼Œä½†éœ€è¦å°å¿ƒåŒºåˆ†kubernetesçš„APIç‰ˆæœ¬</td><td>å®˜æ–¹æ”¯æŒ</td></tr></tbody></table><blockquote><p>Kubernetes API Server æä¾›çš„æ˜¯é»˜è®¤çš„ HTTPS æœåŠ¡ï¼Œè€Œä¸”æ˜¯åŒå‘çš„ TLS è®¤è¯ï¼Œè€Œæˆ‘ä»¬ç›®å‰çš„å…³æ³¨ç‚¹æ˜¯ API æœ¬èº«ï¼Œå› æ­¤å…ˆé€šè¿‡ Kubectl æ¥ä»£ç† API Server æœåŠ¡ã€‚</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubectl proxy <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">8080</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡ç®€å•çš„ HTTP è¯·æ±‚æ¥å’Œ API Server äº¤äº’äº†ï¼š</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">curl</span> localhost:8080/version
<span class="token punctuation">{</span>
  <span class="token string">&quot;major&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1&quot;</span>,
  <span class="token string">&quot;minor&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;19&quot;</span>,
  <span class="token string">&quot;gitVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1.19.16&quot;</span>,
  <span class="token string">&quot;gitCommit&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;e37e4ab4cc8dcda84f1344dda47a97bb1927d074&quot;</span>,
  <span class="token string">&quot;gitTreeState&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;clean&quot;</span>,
  <span class="token string">&quot;buildDate&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2022-10-26T15:40:32Z&quot;</span>,
  <span class="token string">&quot;goVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;go1.15.15&quot;</span>,
  <span class="token string">&quot;compiler&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;gc&quot;</span>,
  <span class="token string">&quot;platform&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;linux/amd64&quot;</span>
<span class="token punctuation">}</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥æè¿° Deployment èµ„æºï¼Œåœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª <code>nginx-deploy.yaml</code> æ–‡ä»¶:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.14.2
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬åˆ›å»ºå®ƒï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubectl create <span class="token parameter variable">-f</span> nginx-deploy.yaml
deployment.apps/nginx-deployment created
â¯ k get deployment
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
my-nginx-app       <span class="token number">0</span>/3     <span class="token number">3</span>            <span class="token number">0</span>           23h
nginx-deployment   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           19s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Deployment åˆ›å»ºçš„ API å’Œ åœ¨ Kubernetes ä¸­ API çš„è·¯å¾„ä¸€æ ·ï¼š</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>POST /apis/apps/v1/namespace/{namespace}/deployment
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>Kubernetesä¸­ä½¿ç”¨çš„ RESTful æ¥å£æ›´æ–°è¿™äº›å¯¹è±¡ï¼ŒåŒ…æ‹¬æ“ä½œï¼š</p><div class="language-markdown ext-md line-numbers-mode"><pre class="language-markdown"><code><span class="token list punctuation">-</span> GETï¼šä»æœåŠ¡å™¨è¯»å–ä¸€ä¸ªèµ„æºã€‚
<span class="token list punctuation">-</span> POSTï¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºã€‚
<span class="token list punctuation">-</span> PUTï¼šåœ¨æœåŠ¡å™¨ä¸Šæ›´æ–°ä¸€ä¸ªèµ„æºã€‚
<span class="token list punctuation">-</span> DELETEï¼šä»æœåŠ¡å™¨åˆ é™¤ä¸€ä¸ªèµ„æºã€‚
<span class="token list punctuation">-</span> HEADï¼šä»æœåŠ¡å™¨è¯»å–ä¸€ä¸ªèµ„æºçš„å¤´ä¿¡æ¯ã€‚
<span class="token list punctuation">-</span> PATCHï¼šåœ¨æœåŠ¡å™¨ä¸Šéƒ¨åˆ†æ›´æ–°ä¸€ä¸ªèµ„æºã€‚
<span class="token list punctuation">-</span> OPTIONSï¼šåˆ—å‡ºæœåŠ¡å™¨æ”¯æŒçš„æ–¹æ³•å’ŒåŠŸèƒ½ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>æ—¢ç„¶æƒ³å°è¯• kubectlï¼Œé‚£ä¹ˆæ¥ç‚¹æ–°èŠ±æ ·ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">curl</span> localhost:8080/apis/apps/v1/namespaces/default/deployments/nginx-deploymen
<span class="token punctuation">{</span>
  <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Status&quot;</span>,
  <span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1&quot;</span>,
  <span class="token string">&quot;metadata&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>,
  <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Failure&quot;</span>,
  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;deployments.apps <span class="token entity" title="\&quot;">\&quot;</span>nginx-deploymen<span class="token entity" title="\&quot;">\&quot;</span> not found&quot;</span>,
  <span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;NotFound&quot;</span>,
  <span class="token string">&quot;details&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx-deploymen&quot;</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;apps&quot;</span>,
    <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;deployments&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;code&quot;</span><span class="token builtin class-name">:</span> <span class="token number">404</span>
<span class="token punctuation">}</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>èµ„æºåˆ›å»ºï¼š</strong></p><p>Depolyment çš„åˆ›å»º API æ˜¯ï¼š<code>apps/v1</code> ä¸­çš„ Deploymentã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>POST /apis/apps/v1/namespaces/<span class="token punctuation">{</span>namespace<span class="token punctuation">}</span>/deployments
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨ default å‘½åç©ºé—´ä¸‹åˆ›å»ºä¸€ä¸ª deploymentï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token parameter variable">--header</span> <span class="token string">&#39;Content-Type: application/yaml&#39;</span> --data-binary @nginx-deploy.yaml http://localhost:8080/apis/apps/v1/namespaces/default/deployments
<span class="token punctuation">{</span>
  <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Status&quot;</span>,
  <span class="token string">&quot;apiVersion&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;v1&quot;</span>,
  <span class="token string">&quot;metadata&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>,
  <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;Failure&quot;</span>,
  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;deployments.apps <span class="token entity" title="\&quot;">\&quot;</span>nginx-deployment<span class="token entity" title="\&quot;">\&quot;</span> already exists&quot;</span>,
  <span class="token string">&quot;reason&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;AlreadyExists&quot;</span>,
  <span class="token string">&quot;details&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx-deployment&quot;</span>,
    <span class="token string">&quot;group&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;apps&quot;</span>,
    <span class="token string">&quot;kind&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;deployments&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;code&quot;</span><span class="token builtin class-name">:</span> <span class="token number">409</span>
<span class="token punctuation">}</span><span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="client-go-1" tabindex="-1"><a class="header-anchor" href="#client-go-1" aria-hidden="true">#</a> Client-go</h3><p>kubectl å¹¶ä¸é€‚åˆ Kubernetes çš„äºŒæ¬¡å¼€å‘è€…æ¥å’Œ k8s æ‰“äº¤é“ï¼ŒGoè¯­è¨€æä¾›äº†ä¸€ä¸ªä¸“é—¨å’Œ Kubernetes API äº¤äº’çš„ åº“ Client-go</p><p>Client-goæ˜¯ä¸€ä¸ªç”¨äºä¸Kubernetes APIäº¤äº’çš„Goåº“ã€‚å®ƒæä¾›äº†å¹¿æ³›çš„åŠŸèƒ½ï¼Œç”¨äºä¸Kubernetes APIäº¤äº’ï¼ŒåŒ…æ‹¬å¼ºç±»å‹APIã€èµ„æºå®¢æˆ·ç«¯ã€Watch APIå’ŒåŠ¨æ€å®¢æˆ·ç«¯ã€‚ä½¿ç”¨client-goï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°åœ¨Kubernetesä¸­åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤èµ„æºå¯¹è±¡ã€‚</p><blockquote><p>ä»è¿™ä¸ª<code>package</code>çš„åç§°æ¥çœ‹ï¼Œè¿™åº”è¯¥æ˜¯è·Ÿ<code>k8s</code>æ‰“äº¤é“çš„å®¢æˆ·ç«¯<code>client</code>çš„<code>go</code>å®ç°ï¼Œè¿™ä¸€ç‚¹æ²¡é”™ï¼Œå®ƒå®šä¹‰äº†è¯¸å¤šèµ„æºçš„å®¢æˆ·ç«¯<code>client</code>ã€‚</p></blockquote><ul><li><a href="https://github.com/kubernetes/client-go" target="_blank" rel="noopener noreferrer">Client-go GitHub Address<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>https://github.com/cubxxw/client-go</li></ul><p>ä¸Šé¢æ˜¯ client-go çš„ GitHub ä»“åº“ï¼Œä¸è¿‡è¿™ä¸ªåº“æ˜¯ actions ä»¥æ¯å¤©ä¸€æ¬¡çš„é¢‘ç‡ä» Kubernetes/Kubernetes ä¸»ä»“åº“ä¸­è‡ªåŠ¨åŒæ­¥è¿‡æ¥çš„ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è´¡çŒ®çš„è¯æ‰¾å¥½ä½ç½®å» Kubernetes è´¡çŒ®ï¼ˆkubernetes/stagin/src/k8s.ioï¼‰ã€‚</p><h3 id="client-goç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#client-goç›®å½•ç»“æ„" aria-hidden="true">#</a> Client-goç›®å½•ç»“æ„</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â”œâ”€â”€ discovery   <span class="token comment"># DsicoveryClientå®¢æˆ·ç«¯,ç”¨äºå‘ç°k8sæ‰€æ”¯æŒGVRã€‚</span>
â”œâ”€â”€ dynamic     <span class="token comment"># DynamicClientå®¢æˆ·ç«¯, ç”¨äºè®¿é—®k8s Resourcesï¼Œä¹Ÿå¯ä»¥è®¿é—®CRDã€‚</span>
â”œâ”€â”€ informers   <span class="token comment"># k8sä¸­å„ç§Resourcesçš„Informeræœºåˆ¶çš„å®ç°ã€‚</span>
â”œâ”€â”€ kubernetes  <span class="token comment"># å¯¹RestClientè¿›è¡Œäº†å°è£…ï¼Œå®šä¹‰å¤šç§Clientçš„å®¢æˆ·ç«¯é›†åˆï¼Œä¿—ç§°clientsetã€‚</span>
â”œâ”€â”€ listers     <span class="token comment"># æä¾›å¯¹Resourcesçš„è·å–åŠŸèƒ½ã€‚å¯¹äºGet()å’ŒList()è€Œè¨€ï¼Œlistersæä¾›ç»™äºŒè€…çš„æ•°æ®éƒ½æ˜¯ä»ç¼“å­˜ä¸­è¯»å–çš„ã€‚</span>
â”œâ”€â”€ pkg
â”œâ”€â”€ plugin      <span class="token comment"># æä¾›ç¬¬ä¸‰æ–¹æ’ä»¶ã€‚</span>
â”œâ”€â”€ scale       <span class="token comment"># å®šä¹‰ç”¨äºDeploy, RS, RCç­‰èµ„æºè¿›è¡Œçš„æ‰©ã€ç¼©å®¹çš„å®¢æˆ·ç«¯ScaleClientã€‚</span>
â”œâ”€â”€ tools       <span class="token comment"># å®ç°clientæŸ¥è¯¢å’Œç¼“å­˜æœºåˆ¶ï¼Œä»¥åŠå®šä¹‰è¯¸å¦‚SharedInformerã€Reflectorã€DealtFIFOå’ŒIndexerç­‰å¸¸ç”¨å·¥å…·ã€‚</span>
â”œâ”€â”€ transport
â””â”€â”€ util        <span class="token comment"># æä¾›è¯¸å¦‚WorkQueueã€Certificateç­‰å¸¸ç”¨æ–¹æ³•ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ“œ å¯¹ä¸Šé¢çš„è§£é‡Šï¼š</p><ul><li><code>/discovery</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºå‘ç°å’Œè·å–Kubernetes APIèµ„æºçš„ä»£ç ã€‚è¿™äº›èµ„æºåŒ…æ‹¬Podã€Serviceã€ReplicationControllerç­‰ã€‚<code>discovery</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å‘ç°å’Œä½¿ç”¨è¿™äº›èµ„æºã€‚</li><li><code>/dynamic</code>ï¼šè¯¥ç›®å½•åŒ…å«åŠ¨æ€å®¢æˆ·ç«¯åº“ï¼Œç”¨äºä¸Kubernetes APIäº¤äº’ï¼Œè€Œæ— éœ€ç”Ÿæˆä»£ç ã€‚è¿™å¯¹äºæ„å»ºéœ€è¦ä¸ä»»æ„Kubernetesèµ„æºäº¤äº’çš„é€šç”¨å·¥å…·å’Œå®ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚</li><li><code>/kubernetes</code>ï¼šè¿™ä¸ªåŒ…ä¸­æ–¹çš„æ˜¯ç”¨ client-gen è‡ªåŠ¨ç”Ÿæˆçš„ç”¨æ¥è®¿é—® Kubernetes API çš„ ClientSetï¼Œåé¢ä¼šç»å¸¸çœ‹åˆ° ClientSet è¿™ä¸ªå·¥å…·ã€‚</li><li><code>/informers</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºç›‘è§†Kubernetesèµ„æºå˜åŒ–çš„ä»£ç ã€‚è¿™äº›å˜åŒ–å¯ä»¥åŒ…æ‹¬èµ„æºçš„åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ã€‚<code>informers</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºæ§åˆ¶å™¨å’Œå…¶ä»–éœ€è¦å¯¹Kubernetesç¯å¢ƒä¸­çš„å˜åŒ–åšå‡ºååº”çš„åº”ç”¨ç¨‹åºã€‚</li><li><code>/listers</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºä»KubernetesæœåŠ¡å™¨è·å–èµ„æºåˆ—è¡¨çš„ä»£ç ã€‚è¿™äº›èµ„æºåˆ—è¡¨åŒ…æ‹¬Podã€Serviceã€Namespaceç­‰ã€‚<code>listers</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°è·å–æœ‰å…³Kubernetesèµ„æºçš„ä¿¡æ¯ã€‚</li><li><code>/rest</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºä¸Kubernetes APIäº¤äº’çš„ä»£ç ã€‚è¿™äº›APIåŒ…æ‹¬Podã€Serviceã€Namespaceç­‰ã€‚<code>rest</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ‰§è¡Œå„ç§æ“ä½œï¼ŒåŒ…æ‹¬ç®¡ç†Podã€Deploymentã€Serviceã€Namespaceç­‰ã€‚</li><li><code>/scale</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºä¸Kubernetesèµ„æºçš„è‡ªåŠ¨ç¼©æ”¾ç›¸å…³çš„ä»£ç ã€‚è¿™äº›èµ„æºåŒ…æ‹¬Deploymentã€ReplicaSetã€StatefulSetç­‰ã€‚<code>scale</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨ç¼©æ”¾ä¸Kubernetesèµ„æºç›¸å…³çš„ç»„ä»¶ã€‚</li><li><code>transport</code>ï¼šè¿™ä¸ªåŒ…ç”¨äºè®¾ç½®è®¤è¯å’Œå»ºç«‹è¿æ¥</li><li><code>/tools</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºæµ‹è¯•å’Œå…¶ä»–å®ç”¨ç¨‹åºçš„ä»£ç ã€‚è¿™äº›å®ç”¨ç¨‹åºåŒ…æ‹¬ä»£ç ç”Ÿæˆå™¨ã€æµ‹è¯•å·¥å…·ç­‰ã€‚<code>tools</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°æµ‹è¯•å’Œä½¿ç”¨client-goåº“ã€‚</li><li><code>/util</code>ï¼šè¯¥ç›®å½•åŒ…å«ç”¨äºå®¢æˆ·ç«¯åº“çš„è¾…åŠ©åŠŸèƒ½çš„ä»£ç ã€‚è¿™äº›åŠŸèƒ½åŒ…æ‹¬å¯¹Kubernetes APIå¯¹è±¡çš„ç±»å‹è½¬æ¢ã€å¯¹è±¡æ¯”è¾ƒç­‰ã€‚<code>util</code>ç›®å½•ä¸­çš„ä»£ç å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°ä½¿ç”¨client-goåº“ã€‚</li></ul><h3 id="è·å–-client-go" tabindex="-1"><a class="header-anchor" href="#è·å–-client-go" aria-hidden="true">#</a> è·å– Client-go</h3><p>å¯ä»¥é€šè¿‡ go get å‘½ä»¤è·å– client-goï¼Œä¸è¿‡æˆ‘ç›´æ¥å…‹éš†æœ€æ–°æºä»£ç ï¼Œç„¶åæ„å»ºä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/kubernetes/client-go.git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»–ä»¬ç»™äº†ä¸€äº›æ ·ä¾‹çš„æ–‡ä»¶ï¼Œæˆ‘æ‰¾å‡ºæ¥ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">find</span> <span class="token parameter variable">-name</span> main.go
./examples/workqueue/main.go
./examples/in-cluster-client-configuration/main.go
./examples/out-of-cluster-client-configuration/main.go
./examples/dynamic-create-update-delete-deployment/main.go
./examples/create-update-delete-deployment/main.go
./examples/leader-election/main.go
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™äº›æ–‡ä»¶å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿä¸Šæ‰‹ client-goï¼š</p><ul><li><code>./examples/workqueue/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Kubernetes çš„å·¥ä½œé˜Ÿåˆ—ï¼ˆWorkqueueï¼‰å®ç°èµ„æºæ§åˆ¶å™¨ï¼ˆControllerï¼‰ã€‚</li><li><code>./examples/in-cluster-client-configuration/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•åœ¨ Kubernetes é›†ç¾¤å†…éƒ¨ä½¿ç”¨ <code>client-go</code> è®¿é—® Kubernetes API Serverã€‚</li><li><code>./examples/out-of-cluster-client-configuration/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•åœ¨ Kubernetes é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ <code>client-go</code> è®¿é—® Kubernetes API Serverã€‚</li><li><code>./examples/dynamic-create-update-delete-deployment/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Kubernetes çš„åŠ¨æ€å®¢æˆ·ç«¯åº“ï¼ˆDynamic Clientï¼‰å®ç°å¯¹ Deployment èµ„æºå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</li><li><code>./examples/create-update-delete-deployment/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>client-go</code> å®ç°å¯¹ Deployment èµ„æºå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚</li><li><code>./examples/leader-election/main.go</code>ï¼šæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Kubernetes çš„ Leader Election æœºåˆ¶ï¼Œå®ç°èµ„æºæ§åˆ¶å™¨çš„é«˜å¯ç”¨æ€§å’Œæ•…éšœè½¬ç§»ã€‚</li></ul><p>åœ¨ <code>/root/workspaces/client-go/examples/workqueue</code> ç›®å½•ä¸­ï¼š</p><p>æˆ‘ä»¬æ˜¯ä¸èƒ½ç›´æ¥ç¼–è¯‘çš„ï¼Œçœ‹ä¸€ä¸‹ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ ./main <span class="token parameter variable">--help</span>
Usage of ./main:
  <span class="token parameter variable">-kubeconfig</span> string
        absolute path to the kubeconfig <span class="token function">file</span>
  <span class="token parameter variable">-master</span> string
        master url
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŒ‡å®š kubeconfig ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ <code>export KUBECONFIG</code> ï¼‰</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ ./main <span class="token parameter variable">-kubeconfig</span> ~/.kube/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>ä¸¾ä¾‹ï¼šä½¿ç”¨ kubectl å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºä¸€ä¸ªåä¸º myresource çš„è‡ªå®šä¹‰èµ„æºï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° YAML æ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œè¿è¡Œ <code>go run ./examples/workqueue/main.go</code> å‘½ä»¤å¯åŠ¨æ§åˆ¶å™¨ã€‚æ­¤æ—¶ï¼Œæ§åˆ¶å™¨ä¼šå¼€å§‹ç›‘å¬ myresource èµ„æºï¼Œå¹¶åœ¨è¯¥èµ„æºè¢«åˆ›å»ºæˆ–æ›´æ–°æ—¶ï¼Œå¼‚æ­¥åœ°å¤„ç†ä¸€äº›ä»»åŠ¡ã€‚</p></blockquote><p><strong>ç»§ç»­æ¼”ç¤º å¯¹ Deployment CURD æ“ä½œï¼š</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token builtin class-name">cd</span> dynamic-create-update-delete-deployment/
â¯ <span class="token function">ls</span>
README.md  main.go
â¯ go build main.go
â¯ ./main
Creating deployment<span class="token punctuation">..</span>.
Created deployment <span class="token string">&quot;demo-deployment&quot;</span><span class="token builtin class-name">.</span>
-<span class="token operator">&gt;</span> Press Return key to continue.

Updating deployment<span class="token punctuation">..</span>.
Updated deployment<span class="token punctuation">..</span>.
-<span class="token operator">&gt;</span> Press Return key to continue.

Listing deployments <span class="token keyword">in</span> namespace <span class="token string">&quot;default&quot;</span><span class="token builtin class-name">:</span>
 * demo-deployment <span class="token punctuation">(</span><span class="token number">1</span> replicas<span class="token punctuation">)</span>
 * my-nginx-app <span class="token punctuation">(</span><span class="token number">3</span> replicas<span class="token punctuation">)</span>
 * nginx-deployment <span class="token punctuation">(</span><span class="token number">3</span> replicas<span class="token punctuation">)</span>
-<span class="token operator">&gt;</span> Press Return key to continue.

Deleting deployment<span class="token punctuation">..</span>.
Deleted deployment.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>./examples/dynamic-create-update-delete-deployment/main.go</code>ï¼šè¿™ä¸ªç¤ºä¾‹æ–‡ä»¶æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Kubernetes çš„åŠ¨æ€å®¢æˆ·ç«¯åº“ï¼ˆDynamic Clientï¼‰å®ç°å¯¹ Deployment èµ„æºå¯¹è±¡çš„å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œã€‚ä½¿ç”¨åŠ¨æ€å®¢æˆ·ç«¯åº“ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´åŠ çµæ´»åœ°æ“ä½œ Kubernetes èµ„æºå¯¹è±¡ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™å¤æ‚çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ DynamicClient å¯¹è±¡ï¼ŒåŠ¨æ€åœ°åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ Deployment èµ„æºå¯¹è±¡ã€‚</p><blockquote><p>ä¸¾ä¾‹ï¼šä½¿ç”¨ kubectl å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºä¸€ä¸ªåä¸º my-deployment çš„ Deployment å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ° YAML æ–‡ä»¶ä¸­ã€‚ç„¶åï¼Œè¿è¡Œ <code>go run ./examples/dynamic-create-update-delete-deployment/main.go</code> å‘½ä»¤ï¼Œä½¿ç”¨ DynamicClient å¯¹è±¡ï¼ŒåŠ¨æ€åœ°åˆ›å»ºã€æ›´æ–°å’Œåˆ é™¤ my-deployment Deployment å¯¹è±¡ã€‚</p></blockquote><p>æµ‹è¯•ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ k get deployment
NAME               READY   UP-TO-DATE   AVAILABLE   AGE
demo-deployment    <span class="token number">0</span>/1     <span class="token number">0</span>            <span class="token number">0</span>           4s
my-nginx-app       <span class="token number">0</span>/3     <span class="token number">3</span>            <span class="token number">0</span>           26h
nginx-deployment   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           165m
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>æ¥ä¸‹æ¥çš„ä¸‰ä¸ªéƒ¨åˆ†ï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç» sample-controllerã€kubebuilderã€operator-sdk ä»¥åŠå®ƒä»¬ä¹‹é—´é‚£å¾®å¦™çš„å…³ç³»ã€‚</strong></p><h2 id="sample-controller" tabindex="-1"><a class="header-anchor" href="#sample-controller" aria-hidden="true">#</a> sample-controller</h2><p>æˆ‘ä»¬å°†ç”¨äºå®éªŒåˆ›å»ºæ“ä½œç¬¦çš„ç¬¬ä¸€ä¸ªå·¥å…·æ˜¯sample-controllerï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šhttps://github.com/kubernetes/sample-controllerã€‚</p><p>è¿™ä¸ªé¡¹ç›®ä¸º <code>Foo</code> ç±»å‹å®ç°äº†ä¸€ä¸ªç®€å•çš„æ“ä½œç¬¦ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡ <code>foo</code> æ—¶ï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸€äº›å…¬å…±Dockeré•œåƒå’Œç‰¹å®šæ•°é‡å‰¯æœ¬çš„éƒ¨ç½²ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šé¢å·²ç»ä¸‹è½½è¿‡ï¼Œç°åœ¨æˆ‘å°è¯•ç¼–è¯‘å®ƒï¼š</p><blockquote><p>go version: <code> gvm use go1.20</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token builtin class-name">export</span> <span class="token assign-left variable">SAMPLE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>/sample-controller
â¯ <span class="token function">git</span> clone https://github.com/cubxxw/sample-controller.git <span class="token variable">$SAMPLE</span>  <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$SAMPLE</span><span class="token punctuation">;</span>
â¯ go build <span class="token parameter variable">-o</span> ctrl <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª CRDï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubectl apply <span class="token parameter variable">-f</span> artifacts/examples/crd-status-subresource.yaml
customresourcedefinition.apiextensions.k8s.io/foos.samplecontroller.k8s.io created
â¯ k get CustomResourceDefinition
NAME                           CREATED AT
crontabs.stable.example.com    <span class="token number">2023</span>-04-07T09:17:55Z
foos.samplecontroller.k8s.io   <span class="token number">2023</span>-04-08T12:09:46Z
guestbooks.webapp.my.domain    <span class="token number">2023</span>-04-07T15:42:22Z
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæˆ‘ä»¬è¿è¡Œæ§åˆ¶å™¨ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./ctrl <span class="token parameter variable">-kubeconfig</span> ~/.kube/config  <span class="token parameter variable">-logtostderr</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><code>-logtostderr=true</code>ï¼šå°†æ—¥å¿—è®°å½•åˆ°æ ‡å‡†é”™è¯¯è€Œä¸æ˜¯æ–‡ä»¶(é»˜è®¤ä¸ºtrue)</p></blockquote><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸Šæ“ä½œ <code>Foo</code> å¯¹è±¡ï¼Œçœ‹çœ‹æ§åˆ¶å™¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ kubectl apply <span class="token parameter variable">-f</span> artifacts/examples/example-foo.yaml
foo.samplecontroller.k8s.io/example-foo created
â¯ k get Foo
NAME          AGE
example-foo   9s

<span class="token comment"># ----- åˆ é™¤ Foo -------</span>
â¯ kubectl delete <span class="token parameter variable">-f</span> artifacts/examples/example-foo.yaml
foo.samplecontroller.k8s.io <span class="token string">&quot;example-foo&quot;</span> deleted
â¯ k get pod <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;Foo&quot;</span>
â¯ k get Foo
No resources found <span class="token keyword">in</span> default namespace.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>åœ¨ç¼–å†™å’Œä½¿ç”¨Kubernetes 1.11.0æ—¶ï¼Œæ§åˆ¶å™¨å°†åœ¨åˆ›å»ºéƒ¨ç½²åæ›´æ–° <code>foo</code> å¯¹è±¡çš„çŠ¶æ€æ—¶è¿›å…¥æ— é™å¾ªç¯ï¼šåœ¨ <code>updateFooStatus</code> å‡½æ•°ä¸­ï¼Œæ‚¨å¿…é¡»é€šè¿‡è°ƒç”¨ <code>UpdateStatus(fooCopy)</code> æ¥æ›´æ”¹å¯¹ <code>Update(fooCopy)</code> çš„è°ƒç”¨ã€‚</p></blockquote><p><strong>å¾ˆå¥½ç†è§£ä¸æ˜¯å—ï¼Œapply å£°æ˜å¼åœ¨ controller ä¸­ä¹Ÿæ˜¯é€šè¿‡ for å¾ªç¯ä¸æ–­çš„è¿›è¡Œæ ¡éªŒã€‚æ£€æŸ¥ status å’Œ spec çš„åŒºåˆ«ï¼Œæ˜¯å¦è¾¾æˆä¸€è‡´ã€‚</strong></p><p>åˆ°ç›®å‰ä¸ºæ­¢ä¸€åˆ‡é¡ºåˆ©ï¼Œæ§åˆ¶å™¨ä½¿å·¥ä½œï¼šå½“æˆ‘ä»¬åˆ›å»º <code>foo</code> å¯¹è±¡æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªéƒ¨ç½²ï¼Œå½“æˆ‘ä»¬åˆ é™¤è¯¥å¯¹è±¡æ—¶ï¼Œå®ƒä¼šåœæ­¢éƒ¨ç½²ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒæ•´CRDå’Œæ§åˆ¶å™¨ï¼Œä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰èµ„æºå®šä¹‰ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç¼–å†™ä¸€ä¸ª operator ï¼Œå®ƒå°†åœ¨é›†ç¾¤çš„èŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒå°†ä½¿ç”¨ <code>DaemonSet</code> å¯¹è±¡æ¥éƒ¨ç½²æ­¤å®ˆæŠ¤è¿›ç¨‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤ŸæŒ‡å®šä¸€ä¸ªæ ‡ç­¾ï¼Œä»¥ä¾¿ä»…åœ¨æ ‡è®°æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šéƒ¨ç½²å®ˆæŠ¤è¿›ç¨‹ã€‚æˆ‘ä»¬è¿˜å¸Œæœ›èƒ½å¤ŸæŒ‡å®šè¦éƒ¨ç½²çš„ Docker é•œåƒï¼Œè€Œä¸æ˜¯åƒ<code>sample-controller</code>é‚£æ ·ä½¿ç”¨é™æ€é•œåƒã€‚</p><p>è®©æˆ‘ä»¬é¦–å…ˆä¸º <code>GenericDaemon</code> ç±»å‹åˆ›å»ºè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>// artifacts/generic<span class="token punctuation">-</span>daemon/crd.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apiextensions.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CustomResourceDefinition
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> genericdaemons.mydomain.com
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">group</span><span class="token punctuation">:</span> mydomain.com
  <span class="token key atrule">version</span><span class="token punctuation">:</span> v1beta1
  <span class="token key atrule">names</span><span class="token punctuation">:</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Genericdaemon
    <span class="token key atrule">plural</span><span class="token punctuation">:</span> genericdaemons
  <span class="token key atrule">scope</span><span class="token punctuation">:</span> Namespaced
  <span class="token key atrule">validation</span><span class="token punctuation">:</span>
    <span class="token key atrule">openAPIV3Schema</span><span class="token punctuation">:</span>
      <span class="token key atrule">properties</span><span class="token punctuation">:</span>
        <span class="token key atrule">spec</span><span class="token punctuation">:</span>
          <span class="token key atrule">properties</span><span class="token punctuation">:</span>
            <span class="token key atrule">label</span><span class="token punctuation">:</span>
              <span class="token key atrule">type</span><span class="token punctuation">:</span> string
            <span class="token key atrule">image</span><span class="token punctuation">:</span>
              <span class="token key atrule">type</span><span class="token punctuation">:</span> string
          <span class="token key atrule">required</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> image
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢æ˜¯è¦éƒ¨ç½²çš„å®ˆæŠ¤è¿›ç¨‹çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>// artifacts/generic<span class="token punctuation">-</span>daemon/syslog.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> mydomain.com/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Genericdaemon
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> syslog
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">label</span><span class="token punctuation">:</span> logs
  <span class="token key atrule">image</span><span class="token punctuation">:</span> mbessler/syslogdocker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¿…é¡»ä¸ºAPIæ„å»ºgoæ–‡ä»¶ï¼Œä»¥ä¾¿ä»æ“ä½œç¬¦è®¿é—®è¿™ä¸ªæ–°çš„è‡ªå®šä¹‰èµ„æºå®šä¹‰ã€‚ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• <code>pkg/apis/genericdaemon</code> ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å¤åˆ¶åœ¨ <code>pkg/apis/samplecontroller</code> ä¸­æ‰¾åˆ°çš„æ–‡ä»¶ï¼ˆä½†ä¸åŒ…æ‹¬ <code>zz_generated.deepcopy.go</code> ï¼‰</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>â¯  tree pkg<span class="token operator">/</span>apis<span class="token operator">/</span>genericdaemon<span class="token operator">/</span>
pkg<span class="token operator">/</span>apis<span class="token operator">/</span>genericdaemon<span class="token operator">/</span>
â”œâ”€â”€ register<span class="token punctuation">.</span><span class="token keyword">go</span>
â””â”€â”€ v1alpha1
    â”œâ”€â”€ doc<span class="token punctuation">.</span><span class="token keyword">go</span>
    â”œâ”€â”€ register<span class="token punctuation">.</span><span class="token keyword">go</span>
    â””â”€â”€ types<span class="token punctuation">.</span><span class="token keyword">go</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶è°ƒæ•´å…¶å†…å®¹ï¼ˆæ›´æ”¹çš„éƒ¨åˆ†ä»¥ç²—ä½“æ˜¾ç¤ºï¼‰ï¼š</p><p>å¹¶è°ƒæ•´å…¶å†…å®¹ï¼ˆæ›´æ”¹çš„éƒ¨åˆ†ä»¥ç²—ä½“æ˜¾ç¤ºï¼‰ï¼š</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">////////////////</span>
<span class="token comment">// register.go</span>
<span class="token comment">////////////////</span>
<span class="token keyword">package</span> genericdaemon
<span class="token keyword">const</span> <span class="token punctuation">(</span>
 GroupName <span class="token operator">=</span> <span class="token string">&quot;mydomain.com&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">/////////////////////</span>
<span class="token comment">// v1beta1/doc.go</span>
<span class="token comment">/////////////////////</span>
<span class="token comment">// +k8s:deepcopy-gen=package</span>
<span class="token comment">// Package v1beta1 is the v1beta1 version of the API.</span>
<span class="token comment">// +groupName=mydomain.com</span>
<span class="token keyword">package</span> v1beta1
<span class="token comment">/////////////////////////</span>
<span class="token comment">// v1beta1/register.go</span>
<span class="token comment">/////////////////////////</span>
<span class="token keyword">package</span> v1beta1
<span class="token keyword">import</span> <span class="token punctuation">(</span>
 metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
 <span class="token string">&quot;k8s.io/apimachinery/pkg/runtime&quot;</span>
 <span class="token string">&quot;k8s.io/apimachinery/pkg/runtime/schema&quot;</span>
genericdaemon <span class="token string">&quot;k8s.io/sample-controller/pkg/apis/genericdaemon&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// SchemeGroupVersion is group version used to register these objects</span>
<span class="token keyword">var</span> SchemeGroupVersion <span class="token operator">=</span> schema<span class="token punctuation">.</span>GroupVersion<span class="token punctuation">{</span>Group<span class="token punctuation">:</span> genericdaemon<span class="token punctuation">.</span>GroupName<span class="token punctuation">,</span> Version<span class="token punctuation">:</span> <span class="token string">&quot;v1beta1&quot;</span><span class="token punctuation">}</span>
<span class="token comment">// Kind takes an unqualified kind and returns back a Group qualified GroupKind</span>
<span class="token keyword">func</span> <span class="token function">Kind</span><span class="token punctuation">(</span>kind <span class="token builtin">string</span><span class="token punctuation">)</span> schema<span class="token punctuation">.</span>GroupKind <span class="token punctuation">{</span>
 <span class="token keyword">return</span> SchemeGroupVersion<span class="token punctuation">.</span><span class="token function">WithKind</span><span class="token punctuation">(</span>kind<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupKind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Resource takes an unqualified resource and returns a Group qualified GroupResource</span>
<span class="token keyword">func</span> <span class="token function">Resource</span><span class="token punctuation">(</span>resource <span class="token builtin">string</span><span class="token punctuation">)</span> schema<span class="token punctuation">.</span>GroupResource <span class="token punctuation">{</span>
 <span class="token keyword">return</span> SchemeGroupVersion<span class="token punctuation">.</span><span class="token function">WithResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GroupResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
 SchemeBuilder <span class="token operator">=</span> runtime<span class="token punctuation">.</span><span class="token function">NewSchemeBuilder</span><span class="token punctuation">(</span>addKnownTypes<span class="token punctuation">)</span>
 AddToScheme   <span class="token operator">=</span> SchemeBuilder<span class="token punctuation">.</span>AddToScheme
<span class="token punctuation">)</span>
<span class="token comment">// Adds the list of known types to Scheme.</span>
<span class="token keyword">func</span> <span class="token function">addKnownTypes</span><span class="token punctuation">(</span>scheme <span class="token operator">*</span>runtime<span class="token punctuation">.</span>Scheme<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
 scheme<span class="token punctuation">.</span><span class="token function">AddKnownTypes</span><span class="token punctuation">(</span>SchemeGroupVersion<span class="token punctuation">,</span>
  <span class="token operator">&amp;</span>Genericdaemon<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">&amp;</span>GenericdaemonList<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">)</span>
 metav1<span class="token punctuation">.</span><span class="token function">AddToGroupVersion</span><span class="token punctuation">(</span>scheme<span class="token punctuation">,</span> SchemeGroupVersion<span class="token punctuation">)</span>
 <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
<span class="token comment">//////////////////////</span>
<span class="token comment">// v1beta1/types.go</span>
<span class="token comment">//////////////////////</span>
<span class="token keyword">package</span> v1beta1
<span class="token keyword">import</span> <span class="token punctuation">(</span>
 metav1 <span class="token string">&quot;k8s.io/apimachinery/pkg/apis/meta/v1&quot;</span>
<span class="token punctuation">)</span>
<span class="token comment">// +genclient</span>
<span class="token comment">// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</span>
<span class="token comment">// Genericdaemon is a specification for a Generic Daemon resource</span>
<span class="token keyword">type</span> Genericdaemon <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 metav1<span class="token punctuation">.</span>TypeMeta   <span class="token string">`json:&quot;,inline&quot;`</span>
 metav1<span class="token punctuation">.</span>ObjectMeta <span class="token string">`json:&quot;metadata,omitempty&quot;`</span>
 Spec   GenericdaemonSpec   <span class="token string">`json:&quot;spec&quot;`</span>
 Status GenericdaemonStatus <span class="token string">`json:&quot;status&quot;`</span>
<span class="token punctuation">}</span>
<span class="token comment">// GenericDaemonSpec is the spec for a GenericDaemon resource</span>
<span class="token keyword">type</span> GenericdaemonSpec <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Label <span class="token builtin">string</span> <span class="token string">`json:&quot;label&quot;`</span>
 Image <span class="token builtin">string</span> <span class="token string">`json:&quot;image&quot;`</span>
<span class="token punctuation">}</span>
<span class="token comment">// GenericDaemonStatus is the status for a GenericDaemon resource</span>
<span class="token keyword">type</span> GenericdaemonStatus <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 Installed <span class="token builtin">int32</span> <span class="token string">`json:&quot;installed&quot;`</span>
<span class="token punctuation">}</span>
<span class="token comment">// +k8s:deepcopy-gen:interfaces=k8s.io/apimachinery/pkg/runtime.Object</span>
<span class="token comment">// GenericDaemonList is a list of GenericDaemon resources</span>
<span class="token keyword">type</span> GenericdaemonList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 metav1<span class="token punctuation">.</span>TypeMeta <span class="token string">`json:&quot;,inline&quot;`</span>
 metav1<span class="token punctuation">.</span>ListMeta <span class="token string">`json:&quot;metadata&quot;`</span>
Items <span class="token punctuation">[</span><span class="token punctuation">]</span>Genericdaemon <span class="token string">`json:&quot;items&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å®ƒä¸ºæˆ‘ä»¬æä¾›äº†å“ªäº›å¯ç”¨çš„è„šæœ¬:</p><p>å®ƒä½¿ç”¨www.example.comä¸­çš„ç”Ÿæˆå™¨<a href="https://github.com/kubernetes/code-generator" target="_blank" rel="noopener noreferrer">k8s.io/code-generator<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ç”Ÿæˆä¸€ä¸ªç±»å‹åŒ–çš„å®¢æˆ·ç«¯ã€informersã€listerså’Œdeep-copyå‡½æ•°ã€‚ä½ å¯ä»¥ è¯·ä½¿ç”¨<code>./hack/update-codegen.sh</code>è„šæœ¬è‡ªå·±æ‰§è¡Œæ­¤æ“ä½œã€‚</p><h3 id="ä»£ç ç”Ÿæˆå™¨" tabindex="-1"><a class="header-anchor" href="#ä»£ç ç”Ÿæˆå™¨" aria-hidden="true">#</a> ä»£ç ç”Ÿæˆå™¨</h3><p><code>k8s.io/client-go</code> æä¾›äº†å¯¹k8såŸç”Ÿèµ„æºçš„informerå’Œclientsetç­‰ç­‰ï¼Œä½†å¯¹äºè‡ªå®šä¹‰èµ„æºçš„æ“ä½œåˆ™ç›¸å¯¹ä½æ•ˆï¼Œéœ€è¦ä½¿ç”¨ rest api å’Œ dynamic client æ¥æ“ä½œï¼Œå¹¶è‡ªå·±å®ç°ååºåˆ—åŒ–ç­‰åŠŸèƒ½ã€‚</p><p>code-generator æä¾›äº†ä»¥ä¸‹å·¥å…·ç”¨äºä¸ºk8sä¸­çš„èµ„æºç”Ÿæˆç›¸å…³ä»£ç ï¼Œå¯ä»¥æ›´åŠ æ–¹ä¾¿çš„æ“ä½œè‡ªå®šä¹‰èµ„æºï¼š</p><p><code>deepcopy-gen</code>: ç”Ÿæˆæ·±åº¦æ‹·è´å¯¹è±¡æ–¹æ³•</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li>åœ¨æ–‡ä»¶ä¸­æ·»åŠ æ³¨é‡Š<code>// +k8s:deepcopy-gen=package</code></li><li>ä¸ºå•ä¸ªç±»å‹æ·»åŠ è‡ªåŠ¨ç”Ÿæˆ<code>// +k8s:deepcopy-gen=true</code></li><li>ä¸ºå•ä¸ªç±»å‹å…³é—­è‡ªåŠ¨ç”Ÿæˆ<code>// +k8s:deepcopy-gen=false</code></li></ul><p><code>client-gen</code>: ä¸ºèµ„æºç”Ÿæˆæ ‡å‡†çš„æ“ä½œæ–¹æ³•(get;list;watch;create;update;patch;delete)</p><blockquote><p>åœ¨ <code>pkg/apis/${GROUP}/${VERSION}/types.go</code>ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨<code>// +genclient</code>æ ‡è®°å¯¹åº”ç±»å‹ç”Ÿæˆçš„å®¢æˆ·ç«¯ï¼Œ å¦‚æœä¸è¯¥ç±»å‹ç›¸å…³è”çš„èµ„æºä¸æ˜¯å‘½åç©ºé—´èŒƒå›´çš„(ä¾‹å¦‚PersistentVolume), åˆ™è¿˜éœ€è¦é™„åŠ <code>// + genclientï¼šnonNamespaced</code>æ ‡è®°ï¼Œ</p></blockquote><ul><li><p><code>// +genclient</code> - ç”Ÿæˆé»˜è®¤çš„å®¢æˆ·ç«¯åŠ¨ä½œå‡½æ•°ï¼ˆcreate, update, delete, get, list, update, patch, watchä»¥åŠ æ˜¯å¦ç”ŸæˆupdateStatuså–å†³äº.Statuså­—æ®µæ˜¯å¦å­˜åœ¨ï¼‰ã€‚</p></li><li><p><code>// +genclient:nonNamespaced</code> - æ‰€æœ‰åŠ¨ä½œå‡½æ•°éƒ½æ˜¯åœ¨æ²¡æœ‰åç§°ç©ºé—´çš„æƒ…å†µä¸‹ç”Ÿæˆ</p></li><li><p><code>// +genclient:onlyVerbs=create,get</code> - æŒ‡å®šçš„åŠ¨ä½œå‡½æ•°è¢«ç”Ÿæˆ.</p></li><li><p><code>// +genclient:skipVerbs=watch</code> - ç”Ÿæˆwatchä»¥å¤–æ‰€æœ‰çš„åŠ¨ä½œå‡½æ•°.</p></li><li><p><code>// +genclient:noStatus</code> - å³ä½¿.Statuså­—æ®µå­˜åœ¨ä¹Ÿä¸ç”ŸæˆupdateStatusåŠ¨ä½œå‡½æ•°</p></li></ul><p><code>informer-gen</code>: ç”Ÿæˆinformerï¼Œæä¾›äº‹ä»¶æœºåˆ¶(AddFunc,UpdateFunc,DeleteFunc)æ¥å“åº”kubernetesçš„event</p><p><code>lister-gen</code>: ä¸ºgetå’Œlistæ–¹æ³•æä¾›åªè¯»ç¼“å­˜å±‚</p><p><code>conversion-gen</code>æ˜¯ç”¨äºè‡ªåŠ¨ç”Ÿæˆåœ¨å†…éƒ¨å’Œå¤–éƒ¨ç±»å‹ä¹‹é—´è½¬æ¢çš„å‡½æ•°çš„å·¥å…·</p><p>ä¸€èˆ¬çš„è½¬æ¢ä»£ç ç”Ÿæˆä»»åŠ¡æ¶‰åŠä¸‰å¥—ç¨‹åºåŒ…ï¼š</p><ul><li>ä¸€å¥—åŒ…å«å†…éƒ¨ç±»å‹çš„ç¨‹åºåŒ…ï¼Œ</li><li>ä¸€å¥—åŒ…å«å¤–éƒ¨ç±»å‹çš„ç¨‹åºåŒ…</li><li>å•ä¸ªç›®æ ‡ç¨‹åºåŒ…ï¼ˆå³ï¼Œç”Ÿæˆçš„è½¬æ¢å‡½æ•°æ‰€åœ¨çš„ä½ç½®ï¼Œä»¥åŠå¼€å‘äººå‘˜æˆæƒçš„è½¬æ¢åŠŸèƒ½æ‰€åœ¨çš„ä½ç½®ï¼‰ã€‚åŒ…å«å†…éƒ¨ç±»å‹çš„åŒ…åœ¨Kubernetesçš„å¸¸è§„ä»£ç ç”Ÿæˆæ¡†æ¶ä¸­æ‰®æ¼”ç€ç§°ä¸º<code>peer package</code>çš„è§’è‰²ã€‚</li></ul><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li>æ ‡è®°è½¬æ¢å†…éƒ¨è½¯ä»¶åŒ… <code>// +k8s:conversion-gen=&lt;import-path-of-internal-package&gt;</code></li><li>æ ‡è®°è½¬æ¢å¤–éƒ¨è½¯ä»¶åŒ…<code>// +k8s:conversion-gen-external-types=&lt;import-path-of-external-package&gt;</code></li><li>æ ‡è®°ä¸è½¬æ¢å¯¹åº”æ³¨é‡Šæˆ–ç»“æ„ <code>// +k8s:conversion-gen=false</code></li></ul><p><code>defaulter-gen</code> ç”¨äºç”Ÿäº§Defaulterå‡½æ•°</p><ul><li>ä¸ºåŒ…å«å­—æ®µçš„æ‰€æœ‰ç±»å‹åˆ›å»ºdefaultersï¼Œ<code>// +k8s:defaulter-gen=&lt;field-name-to-flag&gt;</code></li><li>æ‰€æœ‰éƒ½ç”Ÿæˆ<code>// +k8s:defaulter-gen=true|false</code></li></ul><p><code>go-to-protobuf</code> é€šè¿‡go structç”Ÿæˆpb idl</p><p><code>import-boss</code> åœ¨ç»™å®šå­˜å‚¨åº“ä¸­å¼ºåˆ¶æ‰§è¡Œå¯¼å…¥é™åˆ¶</p><p><code>openapi-gen</code> ç”ŸæˆopenAPIå®šä¹‰</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><ul><li><code>+k8s:openapi-gen=true</code> ä¸ºæŒ‡å®šåŒ…æˆ–æ–¹æ³•å¼€å¯</li><li><code>+k8s:openapi-gen=false</code> æŒ‡å®šåŒ…å…³é—­</li></ul><p><code>register-gen</code> ç”Ÿæˆregister</p><p><code>set-gen</code></p><p>code-generatoræ•´åˆäº†è¿™äº›genï¼Œä½¿ç”¨è„šæœ¬<a href="https://github.com/kubernetes/code-generator/blob/master/generate-groups.sh" target="_blank" rel="noopener noreferrer">generate-groups.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å’Œ<a href="https://github.com/kubernetes/code-generator/blob/master/generate-internal-groups.sh" target="_blank" rel="noopener noreferrer">generate-internal-groups.sh<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å¯ä»¥ä¸ºè‡ªå®šä¹‰èµ„æºç”Ÿäº§ç›¸å…³ä»£ç ã€‚</p><h3 id="è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ" aria-hidden="true">#</a> è„šæœ¬è‡ªåŠ¨ç”Ÿæˆ</h3><p>è„šæœ¬ <code>hack/update-codegen.sh</code> å¯ç”¨äºå›´ç»•æˆ‘ä»¬ä½¿ç”¨è¿™äº›å…ˆå‰æ–‡ä»¶å®šä¹‰çš„æ–°è‡ªå®šä¹‰èµ„æºå®šä¹‰ç”Ÿæˆä»£ç ã€‚æˆ‘ä»¬å°†ä¸å¾—ä¸è°ƒæ•´è¿™ä¸ªè„šæœ¬æ¥ä¸ºæˆ‘ä»¬çš„æ–°CRDç”Ÿæˆæ–‡ä»¶ï¼š</p><p><code>update-codegen</code>è„šæœ¬å°†è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶&amp; ç›®å½•ï¼š</p><ul><li><code>pkg/apis/samplecontroller/v1alpha1/zz_generated.deepcopy.go</code></li><li><code>pkg/generated/</code></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>// hack/update<span class="token punctuation">-</span>codegen.sh
<span class="token comment">#!/usr/bin/env bash</span>
set <span class="token punctuation">-</span>o errexit
set <span class="token punctuation">-</span>o nounset
set <span class="token punctuation">-</span>o pipefail

SCRIPT_ROOT=$(dirname &quot;$<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span>&quot;)/..
CODEGEN_PKG=$<span class="token punctuation">{</span>CODEGEN_PKG<span class="token punctuation">:</span><span class="token punctuation">-</span>$(cd &quot;$<span class="token punctuation">{</span>SCRIPT_ROOT<span class="token punctuation">}</span>&quot;; ls <span class="token punctuation">-</span>d <span class="token punctuation">-</span>1 ./vendor/k8s.io/code<span class="token punctuation">-</span>generator 2<span class="token punctuation">&gt;</span>/dev/null <span class="token punctuation">|</span><span class="token punctuation">|</span> echo ../code<span class="token punctuation">-</span>generator)<span class="token punctuation">}</span>

<span class="token comment"># generate the code with:</span>
<span class="token comment"># --output-base    because this script should also be able to run inside the vendor dir of</span>
<span class="token comment">#                  k8s.io/kubernetes. The output-base is needed for the generators to output into the vendor dir</span>
<span class="token comment">#                  instead of the $GOPATH directly. For normal projects this can be dropped.</span>
echo &quot;===<span class="token punctuation">&gt;</span> Generating code<span class="token punctuation">...</span>&quot;
&quot;$<span class="token punctuation">{</span>CODEGEN_PKG<span class="token punctuation">}</span>/generate<span class="token punctuation">-</span>groups.sh&quot; &quot;deepcopy<span class="token punctuation">,</span>client<span class="token punctuation">,</span>informer<span class="token punctuation">,</span>lister&quot; \
  k8s.io/sample<span class="token punctuation">-</span>controller/pkg/generated \
  k8s.io/sample<span class="token punctuation">-</span>controller/pkg/apis \
  samplecontroller<span class="token punctuation">:</span>v1alpha1 \
  <span class="token punctuation">-</span><span class="token punctuation">-</span>output<span class="token punctuation">-</span>base &quot;$(dirname &quot;$<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span>&quot;)/../../..&quot; \
  <span class="token punctuation">-</span><span class="token punctuation">-</span>go<span class="token punctuation">-</span>header<span class="token punctuation">-</span>file &quot;$<span class="token punctuation">{</span>SCRIPT_ROOT<span class="token punctuation">}</span>&quot;/hack/boilerplate.go.txt
<span class="token comment"># To use your own boilerplate text append:</span>
<span class="token comment">#   --go-header-file &quot;${SCRIPT_ROOT}&quot;/hack/custom-boilerplate.go.txt</span>

echo &quot;===<span class="token punctuation">&gt;</span> Generating genericdaemon code&quot;
&quot;$<span class="token punctuation">{</span>CODEGEN_PKG<span class="token punctuation">}</span>/generate<span class="token punctuation">-</span>groups.sh&quot; &quot;deepcopy<span class="token punctuation">,</span>client<span class="token punctuation">,</span>informer<span class="token punctuation">,</span>lister&quot; \
  k8s.io/sample<span class="token punctuation">-</span>controller/pkg/generated \
  k8s.io/sample<span class="token punctuation">-</span>controller/pkg/apis \
  genericdaemon<span class="token punctuation">:</span>v1beta1 \
  <span class="token punctuation">-</span><span class="token punctuation">-</span>output<span class="token punctuation">-</span>base &quot;$(dirname &quot;$<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span>&quot;)/../../..&quot; \
  <span class="token punctuation">-</span><span class="token punctuation">-</span>go<span class="token punctuation">-</span>header<span class="token punctuation">-</span>file &quot;$<span class="token punctuation">{</span>SCRIPT_ROOT<span class="token punctuation">}</span>&quot;/hack/boilerplate.go.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åæ‰§è¡Œå®ƒï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ ./hack/update-codegen.sh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥è°ƒæ•´æˆ‘ä»¬çš„æ“ä½œå‘˜ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å°†æ‰€æœ‰å¯¹å‰ä¸€ä¸ª <code>Foo</code> ç±»å‹çš„å¼•ç”¨æ›´æ”¹ä¸º <code>Genericdaemon</code> ç±»å‹ã€‚ç¬¬äºŒï¼Œå½“åˆ›å»ºæ–°çš„é€šç”¨å®ˆæŠ¤è¿›ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºDaemonsetè€Œä¸æ˜¯éƒ¨ç½²ã€‚</p><h3 id="å°†-operator-éƒ¨ç½²åˆ°kubernetesé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#å°†-operator-éƒ¨ç½²åˆ°kubernetesé›†ç¾¤" aria-hidden="true">#</a> å°† operator éƒ¨ç½²åˆ°Kubernetesé›†ç¾¤</h3><p>å½“æˆ‘ä»¬æ ¹æ®éœ€è¦ä¿®æ”¹å®Œsample-controlleråï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶éƒ¨ç½²åˆ°kubernetesé›†ç¾¤ã€‚äº‹å®ä¸Šï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ä½¿ç”¨æˆ‘ä»¬çš„å‡­è¯ä»æˆ‘ä»¬çš„å¼€å‘ç³»ç»Ÿè¿è¡Œå®ƒæ¥æµ‹è¯•å®ƒã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„Dockerfileï¼Œç”¨äºä½¿ç”¨<code>operator</code>æ„å»ºDockeré•œåƒï¼ˆæ‚¨å¿…é¡»ä»åŸå§‹çš„<code>sample-controller</code>ä¸­åˆ é™¤æ‰€æœ‰ä»£ç æ‰èƒ½æ„å»ºé•œåƒï¼‰ï¼š</p><div class="language-docker ext-docker line-numbers-mode"><pre class="language-docker"><code><span class="token instruction"><span class="token keyword">FROM</span> golang</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir -p /go/src/k8s.io/sample-controller</span>
<span class="token instruction"><span class="token keyword">ADD</span> . /go/src/k8s.io/sample-controller</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /go</span>
<span class="token instruction"><span class="token keyword">RUN</span> go get ./...</span>
<span class="token instruction"><span class="token keyword">RUN</span> go install -v ./...</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;/go/bin/sample-controller&quot;</span>]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥æ„å»ºé•œåƒå¹¶å°†å…¶æ¨é€åˆ°Docker Hubï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>â¯ <span class="token function">docker</span> build <span class="token builtin class-name">.</span> <span class="token parameter variable">-t</span> cubxxw/genericdaemon
â¯ <span class="token function">docker</span> push cubxxw/genericdaemon
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>âš ï¸ æœ€å¼€å§‹ä½¿ç”¨ <code>buildpacks</code> æ¥æ„å»ºçš„ï¼Œå¤ªç¦»è°±äº†ï¼Œæ”¾å¼ƒäº†~</p></blockquote><p>æœ€åï¼Œä½¿ç”¨æ­¤æ–°æ˜ åƒå¯åŠ¨éƒ¨ç½²ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>// deploy.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> sample<span class="token punctuation">-</span>controller
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> sample
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> sample
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> sample
        <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token string">&quot;cubxxw/genericdaemon:latest&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>and <code>kubectl apply -f deploy.yaml</code></p><p>operatorç°åœ¨æ­£åœ¨è¿è¡Œï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬æ£€æŸ¥podçš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆæƒå­˜åœ¨é—®é¢˜;PODä¸è·å¾—å¯¹ä¸åŒèµ„æºçš„è®¿é—®æƒé™ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ kubectl logs sample-controller-66b79c7d5f-2qnft
E0721 <span class="token number">14</span>:34:50.499584       <span class="token number">1</span> reflector.go:134<span class="token punctuation">]</span> k8s.io/sample-controller/pkg/client/informers/externalversions/factory.go:117: Failed to list *v1beta1.Genericdaemon: genericdaemons.mydomain.com is forbidden: User <span class="token string">&quot;system:serviceaccount:default:default&quot;</span> cannot list genericdaemons.mydomain.com at the cluster scope
E0721 <span class="token number">14</span>:34:50.500385       <span class="token number">1</span> reflector.go:134<span class="token punctuation">]</span> k8s.io/client-go/informers/factory.go:131: Failed to list *v1.DaemonSet: daemonsets.apps is forbidden: User <span class="token string">&quot;system:serviceaccount:default:default&quot;</span> cannot list daemonsets.apps at the cluster scope
<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>ClusterRole</code> å’Œä¸€ä¸ª <code>ClusterRoleBinding</code> æ¥ç»™äºˆæ“ä½œå‘˜å¿…è¦çš„æƒé™ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>// rbac_role.yaml
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> operator<span class="token punctuation">-</span>role
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> apps
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> daemonsets
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> delete
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> mydomain.com
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> genericdaemons
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> delete
// rbac_role_binding.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> operator<span class="token punctuation">-</span>rolebinding
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> operator<span class="token punctuation">-</span>role
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> default
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨ç½²ï¼š</p><div class="language-bash&#39; ext-bash&#39; line-numbers-mode"><pre class="language-bash&#39;"><code>kubectl apply -f rbac_role.yaml
kubectl delete -f deploy.yaml
kubectl apply -f deploy.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œæ‚¨çš„ operator åº”è¯¥éƒ¨ç½²åˆ°æ‚¨çš„Kubernetesé›†ç¾¤å¹¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p><h2 id="end-é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#end-é“¾æ¥" aria-hidden="true">#</a> END é“¾æ¥</h2><ul><li><div><a href="65.md" style="float:left;">â¬†ï¸ä¸Šä¸€èŠ‚ğŸ”— </a><a href="67.md" style="float:right;"> ï¸ä¸‹ä¸€èŠ‚ğŸ”—</a></div></li></ul><ul><li><p><a href="/" class="">â“‚ï¸å›åˆ°ç›®å½•ğŸ </a></p></li><li><p><a href="https://nsddd.top/archives/contributors" target="_blank" rel="noopener noreferrer"><strong>ğŸ«µå‚ä¸è´¡çŒ®ğŸ’â¤ï¸â€ğŸ”¥ğŸ’–</strong><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p></li><li><p>âœ´ï¸ç‰ˆæƒå£°æ˜ Â© ï¼šæœ¬ä¹¦æ‰€æœ‰å†…å®¹éµå¾ª<a href="http://zh.wikipedia.org/wiki/Wikipedia:CC-by-sa-3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="noopener noreferrer">CC-BY-SA 3.0åè®®ï¼ˆç½²å-ç›¸åŒæ–¹å¼å…±äº«ï¼‰Â©<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><p><strong>å…³äºCRDæœ‰ä¸€äº›é“¾æ¥:</strong></p><ul><li>å®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.io/docs/tasks/access-kubernetes-api/custom-resources/custom-resource-definitions/</li><li>å®˜æ–¹è§£é‡Šï¼šhttps://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/#create-a-customresourcedefinition</li><li>CRD Yamlçš„Schemaï¼šhttps://kubernetes.io/docs/reference/generated/kubernetes-api/v1.13/#customresourcedefinition-v1beta1-apiextensions-k8s-io</li><li>https://kubernetes.feisky.xyz/cha-jian-kuo-zhan/api/customresourcedefinition</li><li>https://book.kubebuilder.io/</li><li>ä¹¦ç±ï¼šã€ŠKubernetes Operator å¼€å‘è¿›é˜¶ - èƒ¡æ¶›ã€‹ ä½†ä¸æ¨èè´­ä¹°~</li></ul><p><strong>è¿™ç¯‡æ–‡ç« å‚è€ƒçš„åšå®¢è¿æ¥ï¼š</strong></p><ul><li><a href="https://xieys.club/code-generator-crd/" target="_blank" rel="noopener noreferrer">ä½¿ç”¨code-generatorç”Ÿæˆcrdçš„clientsetã€informerã€listers<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://sq.163yun.com/blog/article/174980128954048512" target="_blank" rel="noopener noreferrer">kubernetes1.9ç®¡ä¸­çª¥è±¹-CRDæ¦‚å¿µã€ä½¿ç”¨åœºæ™¯åŠå®ä¾‹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://segmentfault.com/a/1190000039706356" target="_blank" rel="noopener noreferrer">ç»“åˆKubebuilderä¸code-generatorå¼€å‘Operator<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://lailin.xyz/post/operator-kubebuilder-clientset.html" target="_blank" rel="noopener noreferrer">kubebuilder èƒ½å¦ç”Ÿæˆç±»ä¼¼ client-go çš„ sdk?<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/boling_cavalry/article/details/88917818" target="_blank" rel="noopener noreferrer">k8sè‡ªå®šä¹‰controllerä¸‰éƒ¨æ›²ä¹‹ä¸€:åˆ›å»ºCRDï¼ˆCustom Resource Definitionï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p><strong>å¼ºæ¨å…¥é—¨ç³»åˆ—æ–‡ç« ï¼š</strong></p><ul><li><a href="https://itnext.io/building-an-operator-for-kubernetes-with-the-sample-controller-b4204be9ad56" target="_blank" rel="noopener noreferrer">sample-controller<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><blockquote><ul><li>è¿™æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œå°†æ¢è®¨sample-controllerã€‚</li><li><a href="https://medium.com/p/17cbd3f07761" target="_blank" rel="noopener noreferrer">æœ¬ç³»åˆ—çš„ç¬¬äºŒç¯‡æ–‡ç« <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å°†æ¢ç´¢kubebuilderã€‚</li><li><a href="https://medium.com/p/40a029ea056" target="_blank" rel="noopener noreferrer">æœ¬ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡æ–‡ç« <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>å°†æ¢è®¨operator-sdkã€‚</li></ul></blockquote></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/3293172751/awesome-docker/edit/master/docs/Cloud-Native-k8s/66.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨GitHubä¸Šè´¡çŒ®æ­¤é¡µé¢"><!--[--><!--]--> åœ¨GitHubä¸Šè´¡çŒ®æ­¤é¡µé¢ <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">ä¸Šæ¬¡æ›´æ–°: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 3293172751nss@gmail.com">xiongxinwei</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/Cloud-Native-k8s/65.html" class="" aria-label="ç¬¬65èŠ‚ eBPF åˆ¨æä»¥åŠæºç å­¦ä¹ "><!--[--><!--]--> ç¬¬65èŠ‚ eBPF åˆ¨æä»¥åŠæºç å­¦ä¹  <!--[--><!--]--></a></span><span class="next"><a href="/Cloud-Native-k8s/67.html" class="" aria-label="ç¬¬67èŠ‚"><!--[--><!--]--> ç¬¬67èŠ‚ <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.74e47ba8.js" defer></script>
  </body>
</html>
